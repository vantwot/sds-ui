{"version":3,"sources":["../src/camera.ts"],"names":["EventEmitter","LngLat","LngLatBounds","Point","Transform","Event","clamp","ease","defaultEasing","interpolate","now","pick","prefersReducedMotion","wrap","Camera","options","t","Math","min","easeStart","easeOptions","duration","onEaseFrame","easing","easeFrameId","requestRenderFrame","renderFrameCallback","stop","minZoom","maxZoom","minPitch","maxPitch","renderWorldCopies","moving","zooming","bearingSnap","transform","cb","_","center","lng","lat","zoom","pitch","eventData","jumpTo","bearing","lnglat","easeTo","zoomTo","getZoom","padding","rotateTo","bounds","fitInternal","cameraForBounds","convert","cameraForBoxAndBearing","getNorthWest","getSouthEast","abs","getBearing","resetNorth","tr","zoomChanged","bearingChanged","pitchChanged","undefined","isPaddingEqual","emit","offset","animate","essential","startZoom","startBearing","startPitch","getPitch","startPadding","getPadding","normalizeBearing","offsetAsPoint","pointAtOffset","centerPoint","add","locationAtOffset","pointLocation","normalizeCenter","from","project","delta","sub","finalScale","zoomScale","around","aroundPoint","locationPoint","currently","rotating","pitching","easeId","prepareEase","noMoveStart","clearTimeout","easeEndTimeoutID","k","interpolatePadding","setLocationAtPoint","scale","base","max","speedup","pow","newCenter","unproject","mult","fireMoveEvents","interruptingEaseId","afterEase","coercedOptions","speed","curve","rho","w0","width","height","w1","u1","mag","wMax","sqrt","rho2","r","i","b","log","sinh","n","exp","cosh","tanh","r0","w","s","u","S","isFinite","V","screenSpeed","maxDuration","easeScale","scaleZoom","p0","p1","allowGestures","cancelRenderFrame","onEaseEnd","call","currentBearing","diff","lngRange","wasZooming","wasRotating","wasPitching","frame","finish","defaultPadding","top","bottom","right","left","p","edgePadding","p0world","p1world","p0rotated","rotate","PI","p1rotated","upperRight","x","y","lowerLeft","size","scaleX","scaleY","paddingOffsetX","paddingOffsetY","offsetAtInitialZoom","offsetAtFinalZoom","div","calculatedOptions","linear","flyTo"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport { EventEmitter } from 'eventemitter3';\nimport { merge } from 'lodash';\nimport { IPaddingOptions } from './geo/edge_insets';\nimport LngLat, { LngLatLike } from './geo/lng_lat';\nimport LngLatBounds, { LngLatBoundsLike } from './geo/lng_lat_bounds';\nimport Point, { PointLike } from './geo/point';\nimport Transform from './geo/transform';\nimport { Event } from './handler/events/event';\nimport { IMapOptions } from './interface';\ntype CallBack = (_: number) => void;\nimport {\n  cancel,\n  clamp,\n  ease as defaultEasing,\n  interpolate,\n  now,\n  pick,\n  prefersReducedMotion,\n  raf,\n  wrap,\n} from './util';\n\nexport interface ICameraOptions {\n  center?: LngLatLike;\n  zoom?: number;\n  bearing?: number;\n  pitch?: number;\n  around?: LngLatLike;\n  padding?: IPaddingOptions;\n}\n\nexport interface IAnimationOptions {\n  duration?: number;\n  easing?: (_: number) => number;\n  offset?: PointLike;\n  animate?: boolean;\n  essential?: boolean;\n  linear?: boolean;\n}\n\nexport default class Camera extends EventEmitter {\n  public transform: Transform;\n  // public requestRenderFrame: (_: any) => number;\n  // public cancelRenderFrame: (_: number) => void;\n  protected options: IMapOptions;\n  protected moving: boolean;\n  protected zooming: boolean;\n  protected rotating: boolean;\n  protected pitching: boolean;\n  protected padding: boolean;\n\n  private bearingSnap: number;\n  private easeEndTimeoutID: number;\n  private easeStart: number;\n  private easeOptions: {\n    duration: number;\n    easing: (_: number) => number;\n  };\n  private easeId: string | void;\n  private onEaseFrame: (_: number) => void;\n  private onEaseEnd: (easeId?: string) => void;\n  private easeFrameId: number;\n\n  constructor(options: IMapOptions) {\n    super();\n    this.options = options;\n    const { minZoom, maxZoom, minPitch, maxPitch, renderWorldCopies } = options;\n    this.moving = false;\n    this.zooming = false;\n    this.bearingSnap = options.bearingSnap;\n    this.transform = new Transform(\n      minZoom,\n      maxZoom,\n      minPitch,\n      maxPitch,\n      renderWorldCopies,\n    );\n  }\n  public requestRenderFrame(cb: CallBack): number {\n    return 0;\n  }\n  public cancelRenderFrame(_: number): void {\n    return;\n  }\n\n  public getCenter() {\n    const { lng, lat } = this.transform.center;\n    return new LngLat(lng, lat);\n  }\n\n  public getZoom(): number {\n    return this.transform.zoom;\n  }\n\n  public getPitch(): number {\n    return this.transform.pitch;\n  }\n\n  public setCenter(center: LngLatLike, eventData?: any) {\n    return this.jumpTo({ center }, eventData);\n  }\n\n  public setPitch(pitch: number, eventData?: any) {\n    this.jumpTo({ pitch }, eventData);\n    return this;\n  }\n\n  public getBearing(): number {\n    return this.transform.bearing;\n  }\n\n  public panTo(\n    lnglat: LngLatLike,\n    options?: IAnimationOptions,\n    eventData?: any,\n  ) {\n    return this.easeTo(\n      merge(\n        {\n          center: lnglat,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public zoomOut(options?: IAnimationOptions, eventData?: any) {\n    this.zoomTo(this.getZoom() - 1, options, eventData);\n    return this;\n  }\n\n  public setBearing(bearing: number, eventData?: any) {\n    this.jumpTo({ bearing }, eventData);\n    return this;\n  }\n  public setZoom(zoom: number, eventData?: any) {\n    this.jumpTo({ zoom }, eventData);\n    return this;\n  }\n\n  public zoomIn(options?: IAnimationOptions, eventData?: any) {\n    this.zoomTo(this.getZoom() + 1, options, eventData);\n    return this;\n  }\n\n  public zoomTo(zoom: number, options?: IAnimationOptions, eventData?: any) {\n    return this.easeTo(\n      merge(\n        {\n          zoom,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public getPadding(): IPaddingOptions {\n    return this.transform.padding;\n  }\n\n  public setPadding(padding: IPaddingOptions, eventData?: any) {\n    this.jumpTo({ padding }, eventData);\n    return this;\n  }\n\n  public rotateTo(\n    bearing: number,\n    options?: IAnimationOptions,\n    eventData?: any,\n  ) {\n    return this.easeTo(\n      merge(\n        {\n          bearing,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public resetNorth(options?: IAnimationOptions, eventData?: any) {\n    this.rotateTo(0, merge({ duration: 1000 }, options), eventData);\n    return this;\n  }\n\n  public resetNorthPitch(options?: IAnimationOptions, eventData?: any) {\n    this.easeTo(\n      merge(\n        {\n          bearing: 0,\n          pitch: 0,\n          duration: 1000,\n        },\n        options,\n      ),\n      eventData,\n    );\n    return this;\n  }\n  public fitBounds(\n    bounds: LngLatBoundsLike,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    return this.fitInternal(\n      // @ts-ignore\n      this.cameraForBounds(bounds, options),\n      options,\n      eventData,\n    );\n  }\n  public cameraForBounds(\n    bounds: LngLatBoundsLike,\n    options?: ICameraOptions,\n  ): void | (ICameraOptions & IAnimationOptions) {\n    bounds = LngLatBounds.convert(bounds);\n    return this.cameraForBoxAndBearing(\n      bounds.getNorthWest(),\n      bounds.getSouthEast(),\n      0,\n      // @ts-ignore\n      options,\n    );\n  }\n\n  public snapToNorth(options?: IAnimationOptions, eventData?: any) {\n    if (Math.abs(this.getBearing()) < this.bearingSnap) {\n      return this.resetNorth(options, eventData);\n    }\n    return this;\n  }\n\n  public jumpTo(options: ICameraOptions = {}, eventData?: any) {\n    this.stop();\n\n    const tr = this.transform;\n    let zoomChanged = false;\n    let bearingChanged = false;\n    let pitchChanged = false;\n\n    if (options.zoom && tr.zoom !== +options.zoom) {\n      zoomChanged = true;\n      tr.zoom = +options.zoom;\n    }\n\n    if (options.center !== undefined) {\n      tr.center = LngLat.convert(options.center);\n    }\n\n    if (options.bearing && tr.bearing !== +options.bearing) {\n      bearingChanged = true;\n      tr.bearing = +options.bearing;\n    }\n\n    if (options.pitch && tr.pitch !== +options.pitch) {\n      pitchChanged = true;\n      tr.pitch = +options.pitch;\n    }\n\n    if (options.padding != null && !tr.isPaddingEqual(options.padding)) {\n      tr.padding = options.padding;\n    }\n\n    this.emit('movestart', new Event('movestart', eventData));\n    this.emit('move', new Event('move', eventData));\n\n    if (zoomChanged) {\n      this.emit('zoomstart', new Event('zoomstart', eventData));\n      this.emit('zoom', new Event('zoom', eventData));\n      this.emit('zoomend', new Event('zoomend', eventData));\n    }\n\n    if (bearingChanged) {\n      this.emit('rotatestart', new Event('rotatestart', eventData));\n      this.emit('rotate', new Event('rotate', eventData));\n      this.emit('rotateend', new Event('rotateend', eventData));\n    }\n\n    if (pitchChanged) {\n      this.emit('pitchstart', new Event('pitchstart', eventData));\n      this.emit('pitch', new Event('pitch', eventData));\n      this.emit('pitchend', new Event('pitchend', eventData));\n    }\n\n    return this.emit('moveend', new Event('moveend', eventData));\n  }\n\n  public easeTo(\n    options: ICameraOptions &\n      IAnimationOptions & { easeId?: string; noMoveStart?: boolean } = {},\n    eventData?: any,\n  ) {\n    options = merge(\n      {\n        offset: [0, 0],\n        duration: 500,\n        easing: defaultEasing,\n      },\n      options,\n    );\n\n    if (\n      options.animate === false ||\n      (!options.essential && prefersReducedMotion())\n    ) {\n      options.duration = 0;\n    }\n\n    const tr = this.transform;\n    const startZoom = this.getZoom();\n    const startBearing = this.getBearing();\n    const startPitch = this.getPitch();\n    const startPadding = this.getPadding();\n\n    const zoom = options.zoom ? +options.zoom : startZoom;\n    const bearing = options.bearing\n      ? this.normalizeBearing(options.bearing, startBearing)\n      : startBearing;\n    const pitch = options.pitch ? +options.pitch : startPitch;\n    const padding = options.padding ? options.padding : tr.padding;\n\n    const offsetAsPoint = Point.convert(options.offset);\n    let pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n    const locationAtOffset = tr.pointLocation(pointAtOffset);\n    const center = LngLat.convert(options.center || locationAtOffset);\n    this.normalizeCenter(center);\n\n    const from = tr.project(locationAtOffset);\n    const delta = tr.project(center).sub(from);\n    const finalScale = tr.zoomScale(zoom - startZoom);\n\n    let around: LngLat;\n    let aroundPoint: Point;\n\n    if (options.around) {\n      around = LngLat.convert(options.around);\n      aroundPoint = tr.locationPoint(around);\n    }\n\n    const currently = {\n      moving: this.moving,\n      zooming: this.zooming,\n      rotating: this.rotating,\n      pitching: this.pitching,\n    };\n\n    this.zooming = this.zooming || zoom !== startZoom;\n    this.rotating = this.rotating || startBearing !== bearing;\n    this.pitching = this.pitching || pitch !== startPitch;\n    this.padding = !tr.isPaddingEqual(padding);\n\n    this.easeId = options.easeId;\n    this.prepareEase(eventData, options.noMoveStart, currently);\n\n    clearTimeout(this.easeEndTimeoutID);\n\n    this.ease(\n      (k) => {\n        if (this.zooming) {\n          tr.zoom = interpolate(startZoom, zoom, k);\n        }\n        if (this.rotating) {\n          tr.bearing = interpolate(startBearing, bearing, k);\n        }\n        if (this.pitching) {\n          tr.pitch = interpolate(startPitch, pitch, k);\n        }\n        if (this.padding) {\n          tr.interpolatePadding(startPadding, padding, k);\n          // When padding is being applied, Transform#centerPoint is changing continously,\n          // thus we need to recalculate offsetPoint every fra,e\n          pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n        }\n\n        if (around) {\n          tr.setLocationAtPoint(around, aroundPoint);\n        } else {\n          const scale = tr.zoomScale(tr.zoom - startZoom);\n          const base =\n            zoom > startZoom\n              ? Math.min(2, finalScale)\n              : Math.max(0.5, finalScale);\n          const speedup = Math.pow(base, 1 - k);\n          const newCenter = tr.unproject(\n            from.add(delta.mult(k * speedup)).mult(scale),\n          );\n          tr.setLocationAtPoint(\n            tr.renderWorldCopies ? newCenter.wrap() : newCenter,\n            pointAtOffset,\n          );\n        }\n\n        this.fireMoveEvents(eventData);\n      },\n      (interruptingEaseId?: string) => {\n        this.afterEase(eventData, interruptingEaseId);\n      },\n      // @ts-ignore\n      options,\n    );\n\n    return this;\n  }\n  public flyTo(options: any = {}, eventData?: any) {\n    // Fall through to jumpTo if user has set prefers-reduced-motion\n    if (!options.essential && prefersReducedMotion()) {\n      const coercedOptions = pick(options, [\n        'center',\n        'zoom',\n        'bearing',\n        'pitch',\n        'around',\n      ]) as ICameraOptions;\n      return this.jumpTo(coercedOptions, eventData);\n    }\n\n    this.stop();\n\n    options = merge(\n      {\n        offset: [0, 0],\n        speed: 1.2,\n        curve: 1.42,\n        easing: defaultEasing,\n      },\n      options,\n    );\n    const tr = this.transform;\n    const startZoom = this.getZoom();\n    const startBearing = this.getBearing();\n    const startPitch = this.getPitch();\n    const startPadding = this.getPadding();\n\n    const zoom = options.zoom\n      ? clamp(+options.zoom, tr.minZoom, tr.maxZoom)\n      : startZoom;\n    const bearing = options.bearing\n      ? this.normalizeBearing(options.bearing, startBearing)\n      : startBearing;\n    const pitch = options.pitch ? +options.pitch : startPitch;\n    const padding = 'padding' in options ? options.padding : tr.padding;\n\n    const scale = tr.zoomScale(zoom - startZoom);\n    const offsetAsPoint = Point.convert(options.offset);\n    let pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n    const locationAtOffset = tr.pointLocation(pointAtOffset);\n    const center = LngLat.convert(options.center || locationAtOffset);\n    this.normalizeCenter(center);\n\n    const from = tr.project(locationAtOffset);\n    const delta = tr.project(center).sub(from);\n\n    let rho = options.curve;\n\n    // w₀: Initial visible span, measured in pixels at the initial scale.\n    const w0 = Math.max(tr.width, tr.height);\n    // w₁: Final visible span, measured in pixels with respect to the initial scale.\n    const w1 = w0 / scale;\n    // Length of the flight path as projected onto the ground plane, measured in pixels from\n    // the world image origin at the initial scale.\n    const u1 = delta.mag();\n\n    if ('minZoom' in options) {\n      const minZoom = clamp(\n        Math.min(options.minZoom, startZoom, zoom),\n        tr.minZoom,\n        tr.maxZoom,\n      );\n      // w<sub>m</sub>: Maximum visible span, measured in pixels with respect to the initial\n      // scale.\n      const wMax = w0 / tr.zoomScale(minZoom - startZoom);\n      rho = Math.sqrt((wMax / u1) * 2);\n    }\n\n    // ρ²\n    const rho2 = rho * rho;\n\n    /**\n     * rᵢ: Returns the zoom-out factor at one end of the animation.\n     *\n     * @param i 0 for the ascent or 1 for the descent.\n     * @private\n     */\n    function r(i: number) {\n      const b =\n        (w1 * w1 - w0 * w0 + (i ? -1 : 1) * rho2 * rho2 * u1 * u1) /\n        (2 * (i ? w1 : w0) * rho2 * u1);\n      return Math.log(Math.sqrt(b * b + 1) - b);\n    }\n\n    function sinh(n: number) {\n      return (Math.exp(n) - Math.exp(-n)) / 2;\n    }\n    function cosh(n: number) {\n      return (Math.exp(n) + Math.exp(-n)) / 2;\n    }\n    function tanh(n: number) {\n      return sinh(n) / cosh(n);\n    }\n\n    // r₀: Zoom-out factor during ascent.\n    const r0 = r(0);\n\n    // w(s): Returns the visible span on the ground, measured in pixels with respect to the\n    // initial scale. Assumes an angular field of view of 2 arctan ½ ≈ 53°.\n    let w: (_: number) => number = (s) => {\n      return cosh(r0) / cosh(r0 + rho * s);\n    };\n\n    // u(s): Returns the distance along the flight path as projected onto the ground plane,\n    // measured in pixels from the world image origin at the initial scale.\n    let u: (_: number) => number = (s) => {\n      return (w0 * ((cosh(r0) * tanh(r0 + rho * s) - sinh(r0)) / rho2)) / u1;\n    };\n\n    // S: Total length of the flight path, measured in ρ-screenfuls.\n    let S = (r(1) - r0) / rho;\n\n    // When u₀ = u₁, the optimal path doesn’t require both ascent and descent.\n    if (Math.abs(u1) < 0.000001 || !isFinite(S)) {\n      // Perform a more or less instantaneous transition if the path is too short.\n      if (Math.abs(w0 - w1) < 0.000001) {\n        return this.easeTo(options, eventData);\n      }\n\n      const k = w1 < w0 ? -1 : 1;\n      S = Math.abs(Math.log(w1 / w0)) / rho;\n\n      u = () => {\n        return 0;\n      };\n      w = (s) => {\n        return Math.exp(k * rho * s);\n      };\n    }\n\n    if ('duration' in options) {\n      options.duration = +options.duration;\n    } else {\n      const V =\n        'screenSpeed' in options ? +options.screenSpeed / rho : +options.speed;\n      options.duration = (1000 * S) / V;\n    }\n\n    if (options.maxDuration && options.duration > options.maxDuration) {\n      options.duration = 0;\n    }\n\n    this.zooming = true;\n    this.rotating = startBearing !== bearing;\n    this.pitching = pitch !== startPitch;\n    this.padding = !tr.isPaddingEqual(padding);\n\n    this.prepareEase(eventData, false);\n\n    this.ease(\n      (k) => {\n        // s: The distance traveled along the flight path, measured in ρ-screenfuls.\n        const s = k * S;\n        // @ts-ignore\n        const easeScale = 1 / w(s);\n        tr.zoom = k === 1 ? zoom : startZoom + tr.scaleZoom(easeScale);\n\n        if (this.rotating) {\n          tr.bearing = interpolate(startBearing, bearing, k);\n        }\n        if (this.pitching) {\n          tr.pitch = interpolate(startPitch, pitch, k);\n        }\n        if (this.padding) {\n          tr.interpolatePadding(startPadding, padding, k);\n          // When padding is being applied, Transform#centerPoint is changing continously,\n          // thus we need to recalculate offsetPoint every frame\n          pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n        }\n\n        const newCenter =\n          k === 1\n            ? center\n            : tr.unproject(from.add(delta.mult(u(s))).mult(easeScale));\n        tr.setLocationAtPoint(\n          tr.renderWorldCopies ? newCenter.wrap() : newCenter,\n          pointAtOffset,\n        );\n\n        this.fireMoveEvents(eventData);\n      },\n      () => this.afterEase(eventData),\n      options,\n    );\n\n    return this;\n  }\n  public fitScreenCoordinates(\n    p0: PointLike,\n    p1: PointLike,\n    bearing: number,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    return this.fitInternal(\n      // @ts-ignore\n      this.cameraForBoxAndBearing(\n        this.transform.pointLocation(Point.convert(p0)),\n        this.transform.pointLocation(Point.convert(p1)),\n        bearing,\n        // @ts-ignore\n        options,\n      ),\n      options,\n      eventData,\n    );\n  }\n  public stop(allowGestures?: boolean, easeId?: string) {\n    if (this.easeFrameId) {\n      this.cancelRenderFrame(this.easeFrameId);\n      // @ts-ignore\n      delete this.easeFrameId;\n      // @ts-ignore\n      delete this.onEaseFrame;\n    }\n\n    if (this.onEaseEnd) {\n      // The _onEaseEnd function might emit events which trigger new\n      // animation, which sets a new _onEaseEnd. Ensure we don't delete\n      // it unintentionally.\n      const onEaseEnd = this.onEaseEnd;\n      // @ts-ignore\n      delete this.onEaseEnd;\n      onEaseEnd.call(this, easeId);\n    }\n    // if (!allowGestures) {\n    //     const handlers = (this: any).handlers;\n    //     if (handlers) handlers.stop();\n    // }\n    return this;\n  }\n  public renderFrameCallback = () => {\n    const t = Math.min((now() - this.easeStart) / this.easeOptions.duration, 1);\n    this.onEaseFrame(this.easeOptions.easing(t));\n    if (t < 1) {\n      // this.easeFrameId = window.requestAnimationFrame(this.renderFrameCallback);\n      this.easeFrameId = this.requestRenderFrame(this.renderFrameCallback);\n    } else {\n      this.stop();\n    }\n  };\n  private normalizeBearing(bearing: number, currentBearing: number) {\n    bearing = wrap(bearing, -180, 180);\n    const diff = Math.abs(bearing - currentBearing);\n    if (Math.abs(bearing - 360 - currentBearing) < diff) {\n      bearing -= 360;\n    }\n    if (Math.abs(bearing + 360 - currentBearing) < diff) {\n      bearing += 360;\n    }\n    return bearing;\n  }\n\n  private normalizeCenter(center: LngLat) {\n    const tr = this.transform;\n    if (!tr.renderWorldCopies || tr.lngRange) {\n      return;\n    }\n\n    const delta = center.lng - tr.center.lng;\n    center.lng += delta > 180 ? -360 : delta < -180 ? 360 : 0;\n  }\n\n  private fireMoveEvents(eventData?: any) {\n    this.emit('move', new Event('move', eventData));\n    if (this.zooming) {\n      this.emit('zoom', new Event('zoom', eventData));\n    }\n    if (this.rotating) {\n      this.emit('rotate', new Event('rotate', eventData));\n    }\n    if (this.pitching) {\n      this.emit('rotate', new Event('pitch', eventData));\n    }\n  }\n  private prepareEase(\n    eventData: object | undefined,\n    noMoveStart: boolean = false,\n    currently: { [key: string]: boolean } = {},\n  ) {\n    this.moving = true;\n\n    if (!noMoveStart && !currently.moving) {\n      this.emit('movestart', new Event('movestart', eventData));\n    }\n    if (this.zooming && !currently.zooming) {\n      this.emit('zoomstart', new Event('zoomstart', eventData));\n    }\n    if (this.rotating && !currently.rotating) {\n      this.emit('rotatestart', new Event('rotatestart', eventData));\n    }\n    if (this.pitching && !currently.pitching) {\n      this.emit('pitchstart', new Event('pitchstart', eventData));\n    }\n  }\n\n  private afterEase(eventData: object | undefined, easeId?: string) {\n    // if this easing is being stopped to start another easing with\n    // the same id then don't fire any events to avoid extra start/stop events\n    if (this.easeId && easeId && this.easeId === easeId) {\n      return;\n    }\n    delete this.easeId;\n\n    const wasZooming = this.zooming;\n    const wasRotating = this.rotating;\n    const wasPitching = this.pitching;\n    this.moving = false;\n    this.zooming = false;\n    this.rotating = false;\n    this.pitching = false;\n    this.padding = false;\n\n    if (wasZooming) {\n      this.emit('zoomend', new Event('zoomend', eventData));\n    }\n    if (wasRotating) {\n      this.emit('rotateend', new Event('rotateend', eventData));\n    }\n    if (wasPitching) {\n      this.emit('pitchend', new Event('pitchend', eventData));\n    }\n    this.emit('moveend', new Event('moveend', eventData));\n  }\n\n  private ease(\n    frame: (_: number) => void,\n    finish: () => void,\n    options: {\n      animate: boolean;\n      duration: number;\n      easing: (_: number) => number;\n    },\n  ) {\n    if (options.animate === false || options.duration === 0) {\n      frame(1);\n      finish();\n    } else {\n      this.easeStart = now();\n      this.easeOptions = options;\n      this.onEaseFrame = frame;\n      this.onEaseEnd = finish;\n      this.easeFrameId = this.requestRenderFrame(this.renderFrameCallback);\n    }\n  }\n\n  private cameraForBoxAndBearing(\n    p0: LngLatLike,\n    p1: LngLatLike,\n    bearing: number,\n    options?: ICameraOptions & {\n      offset: [number, number];\n      maxZoom: number;\n      padding: IPaddingOptions;\n    },\n  ): void | (ICameraOptions & IAnimationOptions) {\n    const defaultPadding = {\n      top: 0,\n      bottom: 0,\n      right: 0,\n      left: 0,\n    };\n    options = merge(\n      {\n        padding: defaultPadding,\n        offset: [0, 0],\n        maxZoom: this.transform.maxZoom,\n      },\n      options,\n    );\n\n    if (typeof options.padding === 'number') {\n      const p = options.padding;\n      options.padding = {\n        top: p,\n        bottom: p,\n        right: p,\n        left: p,\n      };\n    }\n\n    options.padding = merge(defaultPadding, options.padding);\n    const tr = this.transform;\n    const edgePadding = tr.padding as IPaddingOptions;\n\n    // We want to calculate the upper right and lower left of the box defined by p0 and p1\n    // in a coordinate system rotate to match the destination bearing.\n    const p0world = tr.project(LngLat.convert(p0));\n    const p1world = tr.project(LngLat.convert(p1));\n    const p0rotated = p0world.rotate((-bearing * Math.PI) / 180);\n    const p1rotated = p1world.rotate((-bearing * Math.PI) / 180);\n\n    const upperRight = new Point(\n      Math.max(p0rotated.x, p1rotated.x),\n      Math.max(p0rotated.y, p1rotated.y),\n    );\n    const lowerLeft = new Point(\n      Math.min(p0rotated.x, p1rotated.x),\n      Math.min(p0rotated.y, p1rotated.y),\n    );\n\n    // Calculate zoom: consider the original bbox and padding.\n    const size = upperRight.sub(lowerLeft);\n    const scaleX =\n      (tr.width -\n        // @ts-ignore\n        (edgePadding.left +\n          // @ts-ignore\n          edgePadding.right +\n          // @ts-ignore\n          options.padding.left +\n          // @ts-ignore\n          options.padding.right)) /\n      size.x;\n    const scaleY =\n      (tr.height -\n        // @ts-ignore\n        (edgePadding.top +\n          // @ts-ignore\n          edgePadding.bottom +\n          // @ts-ignore\n          options.padding.top +\n          // @ts-ignore\n          options.padding.bottom)) /\n      size.y;\n\n    if (scaleY < 0 || scaleX < 0) {\n      return;\n    }\n\n    const zoom = Math.min(\n      tr.scaleZoom(tr.scale * Math.min(scaleX, scaleY)),\n      options.maxZoom,\n    );\n\n    // Calculate center: apply the zoom, the configured offset, as well as offset that exists as a result of padding.\n    const offset = Point.convert(options.offset);\n    // @ts-ignore\n    const paddingOffsetX = (options.padding.left - options.padding.right) / 2;\n    // @ts-ignore\n    const paddingOffsetY = (options.padding.top - options.padding.bottom) / 2;\n    const offsetAtInitialZoom = new Point(\n      offset.x + paddingOffsetX,\n      offset.y + paddingOffsetY,\n    );\n    const offsetAtFinalZoom = offsetAtInitialZoom.mult(\n      tr.scale / tr.zoomScale(zoom),\n    );\n\n    const center = tr.unproject(\n      p0world\n        .add(p1world)\n        .div(2)\n        .sub(offsetAtFinalZoom),\n    );\n\n    return {\n      center,\n      zoom,\n      bearing,\n    };\n  }\n\n  private fitInternal(\n    calculatedOptions?: ICameraOptions & IAnimationOptions,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    // cameraForBounds warns + returns undefined if unable to fit:\n    if (!calculatedOptions) {\n      return this;\n    }\n\n    options = merge(calculatedOptions, options);\n    // Explictly remove the padding field because, calculatedOptions already accounts for padding by setting zoom and center accordingly.\n    delete options.padding;\n    // @ts-ignore\n    return options.linear\n      ? this.easeTo(options, eventData)\n      : this.flyTo(options, eventData);\n  }\n}\n"],"file":"camera.js"}