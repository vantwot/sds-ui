{"ast":null,"code":"import _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { ManaSyringe, DisposableCollection, NsGraph, Disposable, XFlowEdgeCommands } from '@antv/xflow-core';\nimport { IGraphCommandFactory, IHookContribution, IModelContribution, IGraphCommandContribution } from '@antv/xflow-core';\nimport { HookHub } from '@antv/xflow-hook';\nimport { XFlowNode } from '../x6-extension/node';\nimport { XFlowEdge, EDGE_PATH_TYPE } from '../x6-extension/edge';\nimport { GRAPH_STATUS_INFO } from '../constants';\nimport { NsGraphStatusCommand } from './command';\nexport var NsAddEdgeEvent;\n\n(function (NsAddEdgeEvent) {\n  NsAddEdgeEvent.EVENT_NAME = 'ADD_EDGE_CMD_EVENT';\n})(NsAddEdgeEvent || (NsAddEdgeEvent = {}));\n\nexport var ANT_PREFIX = 'ant';\nexport var dagOptions = {\n  keyboard: {\n    enabled: true\n  },\n  // 点选/框选配置（详细文档：https://X6.antv.vision/zh/docs/tutorial/basic/selection）\n  selecting: {\n    enabled: true,\n    multiple: true,\n    selectCellOnMoved: true,\n    showNodeSelectionBox: false,\n    // 框选可以选中edge\n    rubberEdge: true,\n    // 框选可以选中node\n    rubberNode: true,\n    movable: true\n  },\n  connecting: {\n    //链接桩的位置 https://x6.antv.vision/zh/docs/api/registry/node-anchor\n    sourceAnchor: 'bottom',\n    //链接桩的位置 https://x6.antv.vision/zh/docs/api/registry/node-anchor\n    targetAnchor: 'center',\n    connectionPoint: 'anchor',\n    snap: {\n      radius: 20\n    },\n    router: {\n      name: 'manhattan'\n    },\n    connector: {\n      name: EDGE_PATH_TYPE.VERTICAL_NODE,\n      args: {\n        radius: 15\n      }\n    },\n    highlight: true,\n    dangling: false,\n    createEdge: function createEdge() {\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      var graph = this;\n      var edge = new XFlowEdge({\n        attrs: {\n          line: {\n            strokeDasharray: '5 5',\n            stroke: '#888',\n            strokeWidth: 1,\n            targetMarker: {\n              name: 'block',\n              args: {\n                size: '6'\n              }\n            }\n          }\n        }\n      });\n      graph.once('edge:connected', function (args) {\n        var isNew = args.isNew;\n        var edgeCell = args.edge;\n\n        if (isNew && edgeCell.isEdge()) {\n          var portId = edgeCell.getTargetPortId();\n          var targetNode = edgeCell.getTargetCell();\n\n          if (targetNode && targetNode.isNode()) {\n            targetNode.setPortProp(portId, 'connected', false);\n            edgeCell.attr({\n              line: {\n                strokeDasharray: '',\n                targetMarker: '',\n                stroke: '#d5d5d5'\n              }\n            });\n            var targetPortId = edgeCell.getTargetPortId();\n            var sourcePortId = edgeCell.getSourcePortId();\n            var sourceCellId = edgeCell.getSourceCellId();\n            var targetCellId = edgeCell.getTargetCellId();\n            graph.trigger(NsAddEdgeEvent.EVENT_NAME, {\n              targetPortId: targetPortId,\n              sourcePortId: sourcePortId,\n              source: sourceCellId,\n              target: targetCellId,\n              edge: edge\n            });\n          }\n        }\n      });\n      return edge;\n    },\n    validateEdge: function validateEdge(args) {\n      var _a;\n\n      var edge = args.edge;\n      return !!((_a = edge === null || edge === void 0 ? void 0 : edge.target) === null || _a === void 0 ? void 0 : _a.port);\n    },\n    // 是否触发交互事件\n    validateMagnet: function validateMagnet(_ref) {\n      var magnet = _ref.magnet;\n      return magnet.getAttribute('port-group') !== NsGraph.AnchorGroup.TOP;\n    },\n    // 显示可用的链接桩\n    validateConnection: function validateConnection(_ref2) {\n      var sourceView = _ref2.sourceView,\n          targetView = _ref2.targetView,\n          sourceMagnet = _ref2.sourceMagnet,\n          targetMagnet = _ref2.targetMagnet;\n\n      // 不允许连接到自己\n      if (sourceView === targetView) {\n        return false;\n      } // 只能从上游节点的输出链接桩创建连接\n\n\n      if (!sourceMagnet || sourceMagnet.getAttribute('port-group') === NsGraph.AnchorGroup.TOP) {\n        return false;\n      } // 只能连接到下游节点的输入桩\n\n\n      if (!targetMagnet || targetMagnet.getAttribute('port-group') !== NsGraph.AnchorGroup.TOP) {\n        return false;\n      }\n\n      var node = targetView.cell; // 判断目标链接桩是否可连接\n\n      var portId = targetMagnet.getAttribute('port');\n      var port = node.getPort(portId);\n      return !(port && port.connected);\n    }\n  },\n  highlighting: {\n    nodeAvailable: {\n      name: 'className',\n      args: {\n        className: 'available'\n      }\n    },\n    magnetAvailable: {\n      name: 'className',\n      args: {\n        className: 'available'\n      }\n    },\n    magnetAdsorbed: {\n      name: 'className',\n      args: {\n        className: 'adsorbed'\n      }\n    }\n  },\n  scaling: {\n    max: 1.05,\n    min: 0.01\n  }\n};\n/**\n * 内置的hook contribution\n * 处理 config上的runtime的注册项\n */\n\nvar DagHooksContribution = /*#__PURE__*/function () {\n  function DagHooksContribution() {\n    var _this = this;\n\n    _classCallCheck(this, DagHooksContribution);\n\n    /** 注册Command */\n    this.registerGraphCommands = function (commands) {\n      commands.registerCommand(NsGraphStatusCommand.command, {\n        createCommand: _this.commandFactory\n      });\n    };\n    /** 注册Hub */\n\n\n    this.toDispose = new DisposableCollection();\n    /** 注册Hook */\n\n    this.registerHook = function (hooks) {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n        var _this2 = this;\n\n        var toDispose, disposables;\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                toDispose = new DisposableCollection();\n                disposables = [hooks.addNode.registerHook({\n                  name: 'dag-add-node',\n                  handler: function handler(args) {\n                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                      var _this3 = this;\n\n                      var cellFactory;\n                      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                        while (1) {\n                          switch (_context2.prev = _context2.next) {\n                            case 0:\n                              cellFactory = function cellFactory(nodeConfig) {\n                                return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                                  var node;\n                                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                                    while (1) {\n                                      switch (_context.prev = _context.next) {\n                                        case 0:\n                                          node = new XFlowNode(Object.assign({}, nodeConfig));\n                                          return _context.abrupt(\"return\", node);\n\n                                        case 2:\n                                        case \"end\":\n                                          return _context.stop();\n                                      }\n                                    }\n                                  }, _callee);\n                                }));\n                              };\n\n                              args.cellFactory = cellFactory;\n\n                            case 2:\n                            case \"end\":\n                              return _context2.stop();\n                          }\n                        }\n                      }, _callee2);\n                    }));\n                  }\n                }), hooks.addEdge.registerHook({\n                  name: 'dag-add-edge',\n                  handler: function handler(args) {\n                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                      var _this4 = this;\n\n                      var cellFactory;\n                      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                        while (1) {\n                          switch (_context4.prev = _context4.next) {\n                            case 0:\n                              cellFactory = function cellFactory(edgeConfig) {\n                                return __awaiter(_this4, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                                  var cell;\n                                  return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                                    while (1) {\n                                      switch (_context3.prev = _context3.next) {\n                                        case 0:\n                                          cell = new XFlowEdge({\n                                            id: edgeConfig.id,\n                                            source: {\n                                              cell: edgeConfig.source,\n                                              port: edgeConfig.sourcePortId,\n                                              anchor: {\n                                                name: 'bottom'\n                                              }\n                                            },\n                                            target: {\n                                              cell: edgeConfig.target,\n                                              port: edgeConfig.targetPortId,\n                                              anchor: {\n                                                name: 'center'\n                                              }\n                                            },\n                                            attrs: {\n                                              line: {\n                                                strokeDasharray: '',\n                                                targetMarker: '',\n                                                stroke: '#d5d5d5',\n                                                strokeWidth: 1\n                                              }\n                                            },\n                                            data: Object.assign({}, edgeConfig)\n                                          });\n                                          return _context3.abrupt(\"return\", cell);\n\n                                        case 2:\n                                        case \"end\":\n                                          return _context3.stop();\n                                      }\n                                    }\n                                  }, _callee3);\n                                }));\n                              };\n\n                              args.cellFactory = cellFactory;\n\n                            case 2:\n                            case \"end\":\n                              return _context4.stop();\n                          }\n                        }\n                      }, _callee4);\n                    }));\n                  }\n                }), hooks.addEdge.registerHook({\n                  name: 'after add edge, set target port props',\n                  handler: function handler(handlerArgs, _handler) {\n                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n                      var _this5 = this;\n\n                      var main;\n                      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                        while (1) {\n                          switch (_context6.prev = _context6.next) {\n                            case 0:\n                              main = function main(args) {\n                                return __awaiter(_this5, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n                                  var res, targetNode, portId;\n                                  return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n                                    while (1) {\n                                      switch (_context5.prev = _context5.next) {\n                                        case 0:\n                                          _context5.next = 2;\n                                          return _handler(args);\n\n                                        case 2:\n                                          res = _context5.sent;\n                                          targetNode = res.edgeCell.getTargetCell();\n                                          portId = res.edgeCell.getTargetPortId();\n                                          targetNode.setPortProp(portId, 'connected', true);\n                                          return _context5.abrupt(\"return\", res);\n\n                                        case 7:\n                                        case \"end\":\n                                          return _context5.stop();\n                                      }\n                                    }\n                                  }, _callee5);\n                                }));\n                              };\n\n                              return _context6.abrupt(\"return\", main);\n\n                            case 2:\n                            case \"end\":\n                              return _context6.stop();\n                          }\n                        }\n                      }, _callee6);\n                    }));\n                  }\n                }), hooks.delEdge.registerHook({\n                  name: 'afetr del edge, reset target node port props',\n                  handler: function handler(args, _handler2) {\n                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n                      var _this6 = this;\n\n                      var newHandler;\n                      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                        while (1) {\n                          switch (_context8.prev = _context8.next) {\n                            case 0:\n                              newHandler = function newHandler(handlerArgs) {\n                                return __awaiter(_this6, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                                  var result, targetCell, targetPortId;\n                                  return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                                    while (1) {\n                                      switch (_context7.prev = _context7.next) {\n                                        case 0:\n                                          _context7.next = 2;\n                                          return _handler2(handlerArgs);\n\n                                        case 2:\n                                          result = _context7.sent;\n                                          targetCell = result.targetCell, targetPortId = result.targetPortId;\n\n                                          if (targetCell && targetCell.isNode() && targetPortId) {\n                                            targetCell.setPortProp(targetPortId, 'connected', false);\n                                          }\n\n                                          return _context7.abrupt(\"return\", result);\n\n                                        case 6:\n                                        case \"end\":\n                                          return _context7.stop();\n                                      }\n                                    }\n                                  }, _callee7);\n                                }));\n                              };\n\n                              return _context8.abrupt(\"return\", newHandler);\n\n                            case 2:\n                            case \"end\":\n                              return _context8.stop();\n                          }\n                        }\n                      }, _callee8);\n                    }));\n                  }\n                }), hooks.afterGraphInit.registerHook({\n                  name: 'call add edge to replace temp edge',\n                  handler: function handler(handlerArgs) {\n                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n                      var commandService, graph;\n                      return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                        while (1) {\n                          switch (_context9.prev = _context9.next) {\n                            case 0:\n                              commandService = handlerArgs.commandService, graph = handlerArgs.graph;\n                              graph.on(NsAddEdgeEvent.EVENT_NAME, function (args) {\n                                commandService.executeCommand(XFlowEdgeCommands.ADD_EDGE.id, {\n                                  edgeConfig: args\n                                });\n                                args.edge.remove();\n                              });\n\n                            case 2:\n                            case \"end\":\n                              return _context9.stop();\n                          }\n                        }\n                      }, _callee9);\n                    }));\n                  }\n                }), hooks.graphOptions.registerHook({\n                  name: 'dag-extension-x6-options',\n                  handler: function handler(args) {\n                    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n                      return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n                        while (1) {\n                          switch (_context10.prev = _context10.next) {\n                            case 0:\n                              Object.assign(args, dagOptions);\n\n                            case 1:\n                            case \"end\":\n                              return _context10.stop();\n                          }\n                        }\n                      }, _callee10);\n                    }));\n                  }\n                })];\n                toDispose.pushAll(disposables);\n                return _context11.abrupt(\"return\", Disposable.create(function () {}));\n\n              case 4:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11);\n      }));\n    };\n    /** 注册Hub */\n\n\n    this.registerHookHub = function (registry) {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                return _context12.abrupt(\"return\", registry.registerHookHub(NsGraphStatusCommand.hookKey, new HookHub()));\n\n              case 1:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12);\n      }));\n    };\n  }\n  /** 扩展Model */\n\n\n  _createClass(DagHooksContribution, [{\n    key: \"registerModel\",\n    value: function registerModel(registry) {\n      var _this7 = this;\n\n      /** node status map */\n      registry.registerModel({\n        id: GRAPH_STATUS_INFO.id,\n        getInitialValue: function getInitialValue() {\n          return {\n            statusMap: new Map(),\n            subscription: new DisposableCollection(),\n            graphStatus: GRAPH_STATUS_INFO.StatusEnum.DEFAULT\n          };\n        },\n        watchChange: function watchChange(self) {\n          return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n            var _yield$self$getValidV, subscription;\n\n            return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n              while (1) {\n                switch (_context13.prev = _context13.next) {\n                  case 0:\n                    _context13.next = 2;\n                    return self.getValidValue();\n\n                  case 2:\n                    _yield$self$getValidV = _context13.sent;\n                    subscription = _yield$self$getValidV.subscription;\n                    return _context13.abrupt(\"return\", subscription);\n\n                  case 5:\n                  case \"end\":\n                    return _context13.stop();\n                }\n              }\n            }, _callee13);\n          }));\n        }\n      });\n    }\n  }]);\n\n  return DagHooksContribution;\n}();\n\n__decorate([ManaSyringe.inject(IGraphCommandFactory), __metadata(\"design:type\", Function)], DagHooksContribution.prototype, \"commandFactory\", void 0);\n\nDagHooksContribution = __decorate([ManaSyringe.singleton({\n  contrib: [IHookContribution, IModelContribution, IGraphCommandContribution]\n})], DagHooksContribution);\nexport { DagHooksContribution };","map":{"version":3,"sources":["../../../src/canvas-dag-extension/contributions/dag.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ManaSyringe, DisposableCollection, NsGraph, Disposable, XFlowEdgeCommands, } from '@antv/xflow-core';\nimport { IGraphCommandFactory, IHookContribution, IModelContribution, IGraphCommandContribution, } from '@antv/xflow-core';\nimport { HookHub } from '@antv/xflow-hook';\nimport { XFlowNode } from '../x6-extension/node';\nimport { XFlowEdge, EDGE_PATH_TYPE } from '../x6-extension/edge';\nimport { GRAPH_STATUS_INFO } from '../constants';\nimport { NsGraphStatusCommand } from './command';\nexport var NsAddEdgeEvent;\n(function (NsAddEdgeEvent) {\n    NsAddEdgeEvent.EVENT_NAME = 'ADD_EDGE_CMD_EVENT';\n})(NsAddEdgeEvent || (NsAddEdgeEvent = {}));\nexport const ANT_PREFIX = 'ant';\nexport const dagOptions = {\n    keyboard: {\n        enabled: true,\n    },\n    // 点选/框选配置（详细文档：https://X6.antv.vision/zh/docs/tutorial/basic/selection）\n    selecting: {\n        enabled: true,\n        multiple: true,\n        selectCellOnMoved: true,\n        showNodeSelectionBox: false,\n        // 框选可以选中edge\n        rubberEdge: true,\n        // 框选可以选中node\n        rubberNode: true,\n        movable: true,\n    },\n    connecting: {\n        //链接桩的位置 https://x6.antv.vision/zh/docs/api/registry/node-anchor\n        sourceAnchor: 'bottom',\n        //链接桩的位置 https://x6.antv.vision/zh/docs/api/registry/node-anchor\n        targetAnchor: 'center',\n        connectionPoint: 'anchor',\n        snap: { radius: 20 },\n        router: { name: 'manhattan' },\n        connector: {\n            name: EDGE_PATH_TYPE.VERTICAL_NODE,\n            args: {\n                radius: 15,\n            },\n        },\n        highlight: true,\n        dangling: false,\n        createEdge() {\n            /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n            const graph = this;\n            const edge = new XFlowEdge({\n                attrs: {\n                    line: {\n                        strokeDasharray: '5 5',\n                        stroke: '#888',\n                        strokeWidth: 1,\n                        targetMarker: {\n                            name: 'block',\n                            args: {\n                                size: '6',\n                            },\n                        },\n                    },\n                },\n            });\n            graph.once('edge:connected', args => {\n                const { isNew } = args;\n                const edgeCell = args.edge;\n                if (isNew && edgeCell.isEdge()) {\n                    const portId = edgeCell.getTargetPortId();\n                    const targetNode = edgeCell.getTargetCell();\n                    if (targetNode && targetNode.isNode()) {\n                        targetNode.setPortProp(portId, 'connected', false);\n                        edgeCell.attr({\n                            line: {\n                                strokeDasharray: '',\n                                targetMarker: '',\n                                stroke: '#d5d5d5',\n                            },\n                        });\n                        const targetPortId = edgeCell.getTargetPortId();\n                        const sourcePortId = edgeCell.getSourcePortId();\n                        const sourceCellId = edgeCell.getSourceCellId();\n                        const targetCellId = edgeCell.getTargetCellId();\n                        graph.trigger(NsAddEdgeEvent.EVENT_NAME, {\n                            targetPortId,\n                            sourcePortId,\n                            source: sourceCellId,\n                            target: targetCellId,\n                            edge: edge,\n                        });\n                    }\n                }\n            });\n            return edge;\n        },\n        validateEdge: args => {\n            var _a;\n            const { edge } = args;\n            return !!((_a = edge === null || edge === void 0 ? void 0 : edge.target) === null || _a === void 0 ? void 0 : _a.port);\n        },\n        // 是否触发交互事件\n        validateMagnet({ magnet }) {\n            return magnet.getAttribute('port-group') !== NsGraph.AnchorGroup.TOP;\n        },\n        // 显示可用的链接桩\n        validateConnection({ sourceView, targetView, sourceMagnet, targetMagnet }) {\n            // 不允许连接到自己\n            if (sourceView === targetView) {\n                return false;\n            }\n            // 只能从上游节点的输出链接桩创建连接\n            if (!sourceMagnet || sourceMagnet.getAttribute('port-group') === NsGraph.AnchorGroup.TOP) {\n                return false;\n            }\n            // 只能连接到下游节点的输入桩\n            if (!targetMagnet || targetMagnet.getAttribute('port-group') !== NsGraph.AnchorGroup.TOP) {\n                return false;\n            }\n            const node = targetView.cell;\n            // 判断目标链接桩是否可连接\n            const portId = targetMagnet.getAttribute('port');\n            const port = node.getPort(portId);\n            return !(port && port.connected);\n        },\n    },\n    highlighting: {\n        nodeAvailable: {\n            name: 'className',\n            args: {\n                className: 'available',\n            },\n        },\n        magnetAvailable: {\n            name: 'className',\n            args: {\n                className: 'available',\n            },\n        },\n        magnetAdsorbed: {\n            name: 'className',\n            args: {\n                className: 'adsorbed',\n            },\n        },\n    },\n    scaling: {\n        max: 1.05,\n        min: 0.01,\n    },\n};\n/**\n * 内置的hook contribution\n * 处理 config上的runtime的注册项\n */\nlet DagHooksContribution = class DagHooksContribution {\n    constructor() {\n        /** 注册Command */\n        this.registerGraphCommands = (commands) => {\n            commands.registerCommand(NsGraphStatusCommand.command, {\n                createCommand: this.commandFactory,\n            });\n        };\n        /** 注册Hub */\n        this.toDispose = new DisposableCollection();\n        /** 注册Hook */\n        this.registerHook = (hooks) => __awaiter(this, void 0, void 0, function* () {\n            const toDispose = new DisposableCollection();\n            const disposables = [\n                hooks.addNode.registerHook({\n                    name: 'dag-add-node',\n                    handler: (args) => __awaiter(this, void 0, void 0, function* () {\n                        const cellFactory = (nodeConfig) => __awaiter(this, void 0, void 0, function* () {\n                            const node = new XFlowNode(Object.assign({}, nodeConfig));\n                            return node;\n                        });\n                        args.cellFactory = cellFactory;\n                    }),\n                }),\n                hooks.addEdge.registerHook({\n                    name: 'dag-add-edge',\n                    handler: (args) => __awaiter(this, void 0, void 0, function* () {\n                        const cellFactory = (edgeConfig) => __awaiter(this, void 0, void 0, function* () {\n                            const cell = new XFlowEdge({\n                                id: edgeConfig.id,\n                                source: {\n                                    cell: edgeConfig.source,\n                                    port: edgeConfig.sourcePortId,\n                                    anchor: {\n                                        name: 'bottom',\n                                    },\n                                },\n                                target: {\n                                    cell: edgeConfig.target,\n                                    port: edgeConfig.targetPortId,\n                                    anchor: {\n                                        name: 'center',\n                                    },\n                                },\n                                attrs: {\n                                    line: {\n                                        strokeDasharray: '',\n                                        targetMarker: '',\n                                        stroke: '#d5d5d5',\n                                        strokeWidth: 1,\n                                    },\n                                },\n                                data: Object.assign({}, edgeConfig),\n                            });\n                            return cell;\n                        });\n                        args.cellFactory = cellFactory;\n                    }),\n                }),\n                hooks.addEdge.registerHook({\n                    name: 'after add edge, set target port props',\n                    handler: (handlerArgs, handler) => __awaiter(this, void 0, void 0, function* () {\n                        const main = (args) => __awaiter(this, void 0, void 0, function* () {\n                            const res = yield handler(args);\n                            const targetNode = res.edgeCell.getTargetCell();\n                            const portId = res.edgeCell.getTargetPortId();\n                            targetNode.setPortProp(portId, 'connected', true);\n                            return res;\n                        });\n                        return main;\n                    }),\n                }),\n                hooks.delEdge.registerHook({\n                    name: 'afetr del edge, reset target node port props',\n                    handler: (args, handler) => __awaiter(this, void 0, void 0, function* () {\n                        const newHandler = (handlerArgs) => __awaiter(this, void 0, void 0, function* () {\n                            const result = yield handler(handlerArgs);\n                            const { targetCell, targetPortId } = result;\n                            if (targetCell && targetCell.isNode() && targetPortId) {\n                                targetCell.setPortProp(targetPortId, 'connected', false);\n                            }\n                            return result;\n                        });\n                        return newHandler;\n                    }),\n                }),\n                hooks.afterGraphInit.registerHook({\n                    name: 'call add edge to replace temp edge',\n                    handler: (handlerArgs) => __awaiter(this, void 0, void 0, function* () {\n                        const { commandService, graph } = handlerArgs;\n                        graph.on(NsAddEdgeEvent.EVENT_NAME, (args) => {\n                            commandService.executeCommand(XFlowEdgeCommands.ADD_EDGE.id, { edgeConfig: args });\n                            args.edge.remove();\n                        });\n                    }),\n                }),\n                hooks.graphOptions.registerHook({\n                    name: 'dag-extension-x6-options',\n                    handler: (args) => __awaiter(this, void 0, void 0, function* () {\n                        Object.assign(args, dagOptions);\n                    }),\n                }),\n            ];\n            toDispose.pushAll(disposables);\n            return Disposable.create(() => { });\n        });\n        /** 注册Hub */\n        this.registerHookHub = (registry) => __awaiter(this, void 0, void 0, function* () {\n            return registry.registerHookHub(NsGraphStatusCommand.hookKey, new HookHub());\n        });\n    }\n    /** 扩展Model */\n    registerModel(registry) {\n        /** node status map */\n        registry.registerModel({\n            id: GRAPH_STATUS_INFO.id,\n            getInitialValue: () => ({\n                statusMap: new Map(),\n                subscription: new DisposableCollection(),\n                graphStatus: GRAPH_STATUS_INFO.StatusEnum.DEFAULT,\n            }),\n            watchChange: (self) => __awaiter(this, void 0, void 0, function* () {\n                const { subscription } = yield self.getValidValue();\n                return subscription;\n            }),\n        });\n    }\n};\n__decorate([\n    ManaSyringe.inject(IGraphCommandFactory),\n    __metadata(\"design:type\", Function)\n], DagHooksContribution.prototype, \"commandFactory\", void 0);\nDagHooksContribution = __decorate([\n    ManaSyringe.singleton({\n        contrib: [IHookContribution, IModelContribution, IGraphCommandContribution],\n    })\n], DagHooksContribution);\nexport { DagHooksContribution };\n//# sourceMappingURL=dag.js.map"]},"metadata":{},"sourceType":"module"}