{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport Base from '../base';\nimport { isArray, isNumber, uniqueId } from '@antv/util';\nimport { Util } from '@antv/g6-core';\nimport { Canvas } from '@antv/g-canvas';\nvar ALLOW_EVENTS = ['click', 'mouseenter'];\n\nvar Legend =\n/** @class */\nfunction (_super) {\n  __extends(Legend, _super);\n\n  function Legend(config) {\n    return _super.call(this, config) || this;\n  }\n\n  Legend.prototype.getDefaultCfgs = function () {\n    return {\n      data: {},\n      position: 'top',\n      padding: 8,\n      margin: 8,\n      offsetX: 0,\n      offsetY: 0,\n      layout: 'horizontal',\n      flipPage: false,\n      containerStyle: {},\n      align: undefined,\n      horiSep: 8,\n      vertiSep: 8,\n      filter: {\n        enable: false,\n        trigger: 'click'\n      }\n    };\n  };\n\n  Legend.prototype.init = function () {\n    this.formatArray('padding');\n    this.formatArray('margin');\n    var filter = this.get('filter') || {};\n    var multiple = filter.multiple;\n    if (multiple && filter.trigger === 'mouseenter') this.set('multiple', false);\n    var align = this.get('align');\n\n    if (!align) {\n      var positions = this.get('position').split('-');\n      if (positions.includes('left')) align = 'left';\n      if (positions.includes('right')) align = 'right';else align = 'center';\n      this.set('align', align);\n    }\n\n    var graph = this.get('graph');\n    var graphContainer = graph.get('container');\n    var container = createDom(\"<div class='g6-legend-container' style=\\\"position: absolute;\\\"></div>\");\n    graphContainer.appendChild(container);\n    this.set('container', container);\n    var size = this.render();\n    modifyCSS(container, this.getContainerPos(size));\n    this.bindEvents();\n  };\n\n  Legend.prototype.getContainerPos = function (size) {\n    if (size === void 0) {\n      size = [0, 0];\n    }\n\n    var self = this;\n    var graph = self.get('graph');\n    var offsetX = this.get('offsetX');\n    var offsetY = this.get('offsetY');\n    var margin = this.get('margin');\n    var positions = this.get('position').split('-');\n    var posIdxMap = {\n      'top': 0,\n      'right': 1,\n      'bottom': 2,\n      'left': 3\n    };\n    var x = 0,\n        y = 0;\n    var containerCSS = {\n      left: (graph.getWidth() - size[0]) / 2 + x,\n      top: (graph.getHeight() - size[1]) / 2 + y\n    };\n    positions.forEach(function (pos) {\n      var marginValue = margin[posIdxMap[pos]];\n      var key = pos;\n\n      switch (pos) {\n        case 'top':\n          marginValue += y;\n          break;\n\n        case 'left':\n          marginValue += x;\n          break;\n\n        case 'bottom':\n          marginValue = graph.getHeight() - size[1] - marginValue + y;\n          key = 'top';\n          break;\n\n        default:\n          marginValue = graph.getWidth() - size[0] - marginValue + x;\n          key = 'left';\n          break;\n      }\n\n      containerCSS[key] = marginValue;\n    });\n    containerCSS.top += offsetY + graph.getContainer().offsetTop;\n    containerCSS.left += offsetX + graph.getContainer().offsetLeft;\n    Object.keys(containerCSS).forEach(function (key) {\n      containerCSS[key] = containerCSS[key] + \"px\";\n    });\n    return containerCSS;\n  }; // class-methods-use-this\n\n\n  Legend.prototype.bindEvents = function () {\n    var self = this;\n    var filter = self.get('filter');\n    if (!filter || !filter.enable) return;\n    var trigger = filter.trigger || 'click';\n\n    if (!ALLOW_EVENTS.includes(trigger)) {\n      console.warn('Trigger for legend filterling must be \\'click\\' or \\'mouseenter\\', \\'click\\' will take effect by default.');\n      trigger = 'click';\n    }\n\n    var lc = self.get('legendCanvas');\n\n    if (trigger === 'mouseenter') {\n      lc.on('node-container:mouseenter', function (e) {\n        return self.filterData(e);\n      });\n      lc.on('node-container:mouseleave', function (e) {\n        self.clearFilter();\n        self.clearActiveLegend();\n      });\n    } else {\n      lc.on('node-container:click', function (e) {\n        return self.filterData(e);\n      });\n      lc.on('click', function (e) {\n        if (e.target && e.target.isCanvas && e.target.isCanvas()) {\n          self.clearFilter();\n          self.clearActiveLegend();\n        }\n      });\n    }\n  };\n  /**\n   * 更新 legend 数据，开放给用户控制\n   * @param param\n   */\n\n\n  Legend.prototype.changeData = function (data) {\n    this.set('data', data);\n    var size = this.render();\n    modifyCSS(this.get('container'), this.getContainerPos(size));\n  };\n\n  Legend.prototype.activateLegend = function (shape) {\n    var filter = this.get('filter');\n    var multiple = filter === null || filter === void 0 ? void 0 : filter.multiple;\n    if (!multiple) this.clearActiveLegend();\n    var shapeGroup = shape.get('parent'); // 若被高亮元素已经处于 active 状态，则取消它的 active 状态\n    // 并根据目前是否有其他 active 状态的元素决定是否要设置为 inactive 状态\n\n    if (shapeGroup.get('active')) {\n      shapeGroup.set('active', false);\n      if (this.findLegendItemsByState('active').length) shapeGroup.set('inactive', true);\n    } else {\n      shapeGroup.set('inactive', false);\n      shapeGroup.set('active', true);\n    } // 当目前有元素为 active 状态时，将非 active 的元素设置为 inactive\n\n\n    if (this.findLegendItemsByState('active').length) {\n      this.findLegendItemsByState('active', 'all', false).forEach(function (subGroup) {\n        subGroup.set('inactive', true);\n      });\n    } else {\n      this.clearActiveLegend();\n    } // 设置样式\n\n\n    var stateStyles = (filter === null || filter === void 0 ? void 0 : filter.lengedStateStyles) || {};\n    var legendInactive = (stateStyles === null || stateStyles === void 0 ? void 0 : stateStyles.inactive) || {\n      opacity: 0.5,\n      'text-shape': {\n        opacity: 0.5\n      }\n    };\n    var legendTextInactive = legendInactive['text-shape'] || {};\n    this.findLegendItemsByState('inactive').forEach(function (subGroup) {\n      var _a = subGroup.get('children'),\n          keyShape = _a[0],\n          text = _a[1];\n\n      keyShape.attr(__assign(__assign({}, keyShape.get('oriAttrs')), legendInactive));\n      text.attr(__assign(__assign({}, text.get('oriAttrs')), legendTextInactive));\n    });\n    var legendActive = (stateStyles === null || stateStyles === void 0 ? void 0 : stateStyles.active) || {\n      stroke: '#000',\n      lineWidth: 2,\n      'text-shape': {\n        fontWeight: 'bold'\n      }\n    };\n    var legendTextActive = legendActive['text-shape'] || {};\n    this.findLegendItemsByState('active').forEach(function (subGroup) {\n      var _a = subGroup.get('children'),\n          keyShape = _a[0],\n          text = _a[1];\n\n      keyShape.attr(__assign(__assign({}, keyShape.get('oriAttrs')), legendActive));\n      text.attr(__assign(__assign({}, text.get('oriAttrs')), legendTextActive));\n    });\n  };\n\n  Legend.prototype.findLegendItemsByState = function (stateName, type, value) {\n    if (type === void 0) {\n      type = 'all';\n    }\n\n    if (value === void 0) {\n      value = true;\n    }\n\n    var group = this.get('legendCanvas').find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    if (type === 'node') return nodeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    });\n    if (type === 'edge') return edgeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    });\n    return nodeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    }).concat(edgeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    }));\n  };\n\n  Legend.prototype.clearActiveLegend = function () {\n    var lg = this.get('legendCanvas');\n    var group = lg.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var groups = [group.find(function (e) {\n      return e.get('name') === 'node-group';\n    }), group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    })];\n    groups.forEach(function (itemGroup) {\n      itemGroup.get('children').forEach(function (subGroup) {\n        subGroup.set('active', false);\n        subGroup.set('inactive', false);\n\n        var _a = subGroup.get('children'),\n            keyShape = _a[0],\n            text = _a[1];\n\n        keyShape.attr(keyShape.get('oriAttrs'));\n        text.attr(text.get('oriAttrs'));\n      });\n    });\n  };\n  /**\n   * 高亮和置灰图例，并过滤主图元素\n   * @param param\n   */\n\n\n  Legend.prototype.filterData = function (e) {\n    var filter = this.get('filter');\n    var filterFunctions = filter === null || filter === void 0 ? void 0 : filter.filterFunctions;\n    if (!filter || !filterFunctions) return;\n    var lc = this.get('legendCanvas');\n    var graph = this.get('graph');\n    var activeState = filter.graphActiveState || 'active';\n    var inactiveState = filter.graphInactiveState || 'inactive';\n    var multiple = filter.multiple;\n    this.clearFilter();\n    if (!multiple) this.clearActiveLegend(); // 设置 legend 的高亮状态\n\n    this.activateLegend(e.target);\n    var group = lc.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    var activeNodeLegend = nodeGroup.get('children').filter(function (e) {\n      return e.get('active');\n    });\n    var activeEdgeLegend = edgeGroup.get('children').filter(function (e) {\n      return e.get('active');\n    });\n    var activeCount = 0;\n    var typeFuncs = ['getNodes', 'getEdges'];\n    typeFuncs.forEach(function (typeFunc) {\n      graph[typeFunc]().forEach(function (graphItem) {\n        var active = false;\n        var activeLegend = typeFunc === 'getNodes' ? activeNodeLegend : activeEdgeLegend;\n        activeLegend.forEach(function (itemGroup) {\n          var func = filterFunctions[itemGroup.get('id')];\n          active = active || func(graphItem.getModel());\n        });\n\n        if (active) {\n          graph.setItemState(graphItem, inactiveState, false);\n          graph.setItemState(graphItem, activeState, true);\n          activeCount++;\n        } else {\n          graph.setItemState(graphItem, activeState, false);\n          graph.setItemState(graphItem, inactiveState, true);\n        }\n      });\n    });\n    if (!activeCount) typeFuncs.forEach(function (typeFunc) {\n      graph[typeFunc]().forEach(function (graphItem) {\n        graph.clearItemStates(graphItem, [inactiveState]);\n      });\n    });\n  };\n  /**\n   * 清除主图相关状态\n   * @param param\n   */\n\n\n  Legend.prototype.clearFilter = function () {\n    // 清除 legend 的高亮状态\n    var graph = this.get('graph');\n    var filter = this.get('filter');\n    if (!filter) return;\n    var activeState = filter.graphActiveState || 'active';\n    var inactiveState = filter.graphInactiveState || 'inactive';\n    graph.getNodes().forEach(function (node) {\n      graph.clearItemStates(node, [activeState, inactiveState]);\n    });\n    graph.getEdges().forEach(function (edge) {\n      graph.clearItemStates(edge, [activeState, inactiveState]);\n    });\n  };\n  /**\n   * 渲染 legend 图\n   * @param param\n   */\n\n\n  Legend.prototype.render = function () {\n    var _this = this;\n\n    this.processData();\n    var lc = this.get('legendCanvas');\n\n    if (!lc) {\n      lc = new Canvas({\n        container: this.get('container'),\n        width: 200,\n        height: 200\n      });\n      var rootGroup = lc.addGroup({\n        name: 'root'\n      });\n      rootGroup.addGroup({\n        name: 'node-group'\n      });\n      rootGroup.addGroup({\n        name: 'edge-group'\n      }); // nodeStateStyles: {\n      //   legendActive,\n      //   legendInactive\n      // }\n\n      this.set('legendCanvas', lc);\n    }\n\n    var group = lc.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    var itemsData = this.get('itemsData');\n    var itemTypes = ['nodes', 'edges'];\n    var itemGroup = [nodeGroup, edgeGroup];\n    itemTypes.forEach(function (itemType, i) {\n      itemsData[itemType].forEach(function (data) {\n        var _a;\n\n        var subGroup = itemGroup[i].addGroup({\n          id: data.id,\n          name: 'node-container'\n        });\n        var attrs;\n        var shapeType = data.type;\n\n        var _b = _this.getShapeSize(data),\n            width = _b.width,\n            height = _b.height,\n            r = _b.r;\n\n        var style = _this.getStyle(itemType.substr(0, 4), data);\n\n        switch (data.type) {\n          case 'circle':\n            attrs = {\n              r: r,\n              x: 0,\n              y: 0\n            };\n            break;\n\n          case 'rect':\n            attrs = {\n              width: width,\n              height: height,\n              x: -width / 2,\n              y: -height / 2\n            };\n            break;\n\n          case 'ellipse':\n            attrs = {\n              r1: width,\n              r2: height,\n              x: 0,\n              y: 0\n            };\n            break;\n\n          case 'line':\n            attrs = {\n              x1: -width / 2,\n              y1: 0,\n              x2: width / 2,\n              y2: 0\n            };\n            shapeType = 'line';\n            break;\n\n          case 'quadratic':\n            attrs = {\n              path: [['M', -width / 2, 0], ['Q', 0, width / 2, width / 2, 0]]\n            };\n            shapeType = 'path';\n            break;\n\n          case 'cubic':\n            attrs = {\n              path: [['M', -width / 2, 0], ['C', -width / 6, width / 2, width / 6, -width / 2, width / 2, 0]]\n            };\n            shapeType = 'path';\n            break;\n\n          default:\n            attrs = {\n              r: r,\n              x: 0,\n              y: 0\n            };\n            break;\n        }\n\n        var keyShape = subGroup.addShape(shapeType, {\n          attrs: __assign(__assign({}, attrs), style),\n          name: data.type + \"-node-keyShape\",\n          oriAttrs: __assign({\n            opacity: 1\n          }, style)\n        });\n\n        if (data.label) {\n          var keyShapeBBox = keyShape.getBBox();\n          var labelStyle = ((_a = data.labelCfg) === null || _a === void 0 ? void 0 : _a.style) || {};\n\n          var attrs_1 = __assign({\n            textAlign: 'begin',\n            fontSize: 12,\n            textBaseline: 'middle',\n            fill: '#000',\n            opacity: 1,\n            fontWeight: 'normal'\n          }, labelStyle);\n\n          subGroup.addShape('text', {\n            attrs: __assign({\n              x: keyShapeBBox.maxX + 4,\n              y: 0,\n              text: data.label\n            }, attrs_1),\n            className: 'legend-label',\n            name: data.type + \"-node-text\",\n            oriAttrs: attrs_1\n          });\n        }\n      });\n    });\n    var padding = this.get('padding');\n    var titleShape;\n    var titleGroup = group.find(function (e) {\n      return e.get('name') === 'title-container';\n    });\n    var titleGroupBBox = {\n      height: 0,\n      maxY: 0,\n      width: 0\n    };\n\n    if (this.get('title')) {\n      if (!titleGroup) {\n        titleGroup = group.addGroup({\n          name: 'title-container'\n        });\n      }\n\n      var defaultTitleStyle = {\n        fontSize: 20,\n        fontFamily: 'Arial',\n        fontWeight: 300,\n        textBaseline: 'top',\n        textAlign: 'center',\n        fill: \"#000\",\n        x: 0,\n        y: padding[0]\n      };\n      var titleConfig = this.get('titleConfig') || {};\n      var style = Object.assign(defaultTitleStyle, titleConfig.style || {});\n      titleShape = titleGroup.addShape('text', {\n        attrs: __assign({\n          text: this.get('title')\n        }, style)\n      });\n      titleGroupBBox = titleGroup.getCanvasBBox();\n      titleGroup.setMatrix([1, 0, 0, 0, 1, 0, titleConfig.offsetX, titleConfig.offsetY, 1]);\n    }\n\n    this.layoutItems();\n    var lcBBox = group.getCanvasBBox();\n    var nodeGroupBBox = nodeGroup.getCanvasBBox(); // 若有图形超过边界的情况，平移回来\n\n    var nodeGroupBeginX = nodeGroupBBox.minX < 0 ? Math.abs(nodeGroupBBox.minX) + padding[3] : padding[3];\n    var nodeGroupBeginY = titleGroupBBox.maxY < nodeGroupBBox.minY ? Math.abs(titleGroupBBox.maxY - nodeGroupBBox.minY) + padding[0] : titleGroupBBox.maxY + padding[0];\n    var nodeGroupMatrix = [1, 0, 0, 0, 1, 0, nodeGroupBeginX, nodeGroupBeginY, 1];\n    nodeGroup.setMatrix(nodeGroupMatrix);\n    lcBBox = group.getCanvasBBox();\n    var size = [lcBBox.minX + lcBBox.width + padding[1], lcBBox.minY + lcBBox.height + padding[2]]; // 根据 size 和 titleConfig 调整 title 位置，再调整 nodeGroup 位置\n\n    if (titleShape) {\n      var titleConfig = __assign({\n        position: 'center',\n        offsetX: 0,\n        offsetY: 0\n      }, this.get('titleConfig'));\n\n      titleGroupBBox = titleGroup.getCanvasBBox();\n      var titleGroupMatrix = titleGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n      if (titleConfig.position === 'center') {\n        titleGroupMatrix[6] = size[0] / 2 + titleConfig.offsetX;\n      } else if (titleConfig.position === 'right') {\n        titleGroupMatrix[6] = size[0] - padding[3] + titleConfig.offsetX;\n        titleShape.attr({\n          textAlign: 'right'\n        });\n      } else {\n        titleGroupMatrix[6] = padding[3] + titleConfig.offsetX;\n        titleShape.attr({\n          textAlign: 'left'\n        });\n      }\n\n      titleGroup.setMatrix(titleGroupMatrix);\n      titleGroupBBox = titleGroup.getCanvasBBox(); // 若有图形超过边界的情况，平移回来\n\n      nodeGroupBeginX = nodeGroupBBox.minX < 0 ? Math.abs(nodeGroupBBox.minX) + padding[3] : padding[3];\n      nodeGroupBeginY = nodeGroupBBox.minY < titleGroupBBox.maxY ? Math.abs(titleGroupBBox.maxY - nodeGroupBBox.minY) + padding[0] : titleGroupBBox.maxY + padding[0];\n      nodeGroupMatrix = [1, 0, 0, 0, 1, 0, nodeGroupBeginX, nodeGroupBeginY, 1];\n      nodeGroup.setMatrix(nodeGroupMatrix);\n      var edgeGroupMatrix_1 = [1, 0, 0, 0, 1, 0, nodeGroupBeginX, nodeGroupBeginY, 1];\n      if (this.get('layout') === 'vertical') edgeGroupMatrix_1[6] += nodeGroupBBox.maxX + this.get('horiSep');else edgeGroupMatrix_1[7] += nodeGroupBBox.maxY + this.get('vertiSep');\n      edgeGroup.setMatrix(edgeGroupMatrix_1);\n    } else {\n      // 没有 title，也需要平移 edgeGroup\n      nodeGroupBBox = nodeGroup.getCanvasBBox();\n      var edgeGroupMatrix_2 = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n      if (this.get('layout') === 'vertical') edgeGroupMatrix_2[6] += nodeGroupMatrix[6] + nodeGroupBBox.maxX + this.get('horiSep');else edgeGroupMatrix_2[7] += nodeGroupMatrix[7] + nodeGroupBBox.maxY + this.get('vertiSep');\n      edgeGroup.setMatrix(edgeGroupMatrix_2);\n    }\n\n    lcBBox = group.getCanvasBBox();\n    nodeGroupBBox = nodeGroup.getCanvasBBox();\n    nodeGroupMatrix = nodeGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var edgeGroupMatrix = edgeGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var edgeGroupBBox = edgeGroup.getCanvasBBox();\n    size = [Math.max(nodeGroupBBox.width + nodeGroupMatrix[6], edgeGroupBBox.width + edgeGroupMatrix[6]) + padding[1], Math.max(nodeGroupBBox.height + nodeGroupMatrix[7], edgeGroupBBox.height + edgeGroupMatrix[7]) + padding[2]];\n    lc.changeSize(size[0], size[1]); // 更新容器背景样式\n\n    var containerStyle = this.get('containerStyle');\n    var viewportMatrix = group.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var beginPos = Util.invertMatrix({\n      x: 0,\n      y: 0\n    }, viewportMatrix);\n    var backRect = group.addShape('rect', {\n      attrs: __assign({\n        x: beginPos.x + (containerStyle.lineWidth || 1),\n        y: beginPos.y + (containerStyle.lineWidth || 1),\n        width: size[0] - 2 * (containerStyle.lineWidth || 1),\n        height: size[1] - 2 * (containerStyle.lineWidth || 1),\n        fill: \"#f00\",\n        stroke: '#000',\n        lineWidth: 1,\n        opacity: 0.5\n      }, containerStyle),\n      name: 'legend-back-rect',\n      capture: false\n    });\n    backRect.toBack();\n    return size;\n  };\n\n  Legend.prototype.layoutItems = function () {\n    var lc = this.get('legendCanvas');\n    var horiSep = this.get('horiSep');\n    var vertiSep = this.get('vertiSep');\n    var layout = this.get('layout');\n    var align = this.get('align');\n    var begin = [0, 0];\n    var group = lc.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    var nodeLegendSize = {\n      min: 0,\n      max: -Infinity\n    };\n    var rowMaxY = -Infinity;\n    nodeGroup.get('children').forEach(function (cNodeGroup, i) {\n      if (i === 0) nodeLegendSize.min = begin[0];\n      var keyShape = cNodeGroup.get('children')[0];\n      var bbox = cNodeGroup.getCanvasBBox();\n\n      var _a = keyShape.getBBox(),\n          keyShapeWidth = _a.width,\n          keyShapeHeight = _a.height;\n\n      var curHeight = 0,\n          x = 0,\n          y = 0;\n\n      if (layout === 'vertical') {\n        x = begin[1];\n        y = begin[0] + keyShapeWidth / 2;\n        begin[0] = y + bbox.height + vertiSep;\n        curHeight = bbox.maxX + x + keyShapeWidth / 2;\n      } else {\n        x = begin[0] + keyShapeWidth / 2;\n        y = begin[1];\n        begin[0] = x + bbox.width + horiSep;\n        curHeight = bbox.maxY + y + keyShapeHeight / 2;\n      }\n\n      if (begin[0] > nodeLegendSize.max) nodeLegendSize.max = begin[0];\n      if (curHeight > rowMaxY) rowMaxY = curHeight;\n      cNodeGroup.setMatrix([1, 0, 0, 0, 1, 0, x, y, 1]);\n    });\n    var nw = nodeLegendSize.max - nodeLegendSize.min;\n    var edgeLegendSize = {\n      min: 0,\n      max: -Infinity\n    };\n    var nodeGroupBBox = nodeGroup.getCanvasBBox();\n    begin[0] = 0;\n    begin[1] = layout === 'vertical' ? nodeGroupBBox.maxX + horiSep : nodeGroupBBox.maxY + vertiSep;\n    edgeGroup.get('children').forEach(function (subGroup, i) {\n      if (i === 0) edgeLegendSize.min = begin[0];\n      var keyShape = subGroup.get('children')[0];\n      var bbox = subGroup.getCanvasBBox();\n\n      var _a = keyShape.getBBox(),\n          keyShapeWidth = _a.width,\n          keyShapeHeight = _a.height;\n\n      var x = 0,\n          y = 0;\n\n      if (layout === 'vertical') {\n        x = begin[1];\n        y = begin[0];\n        begin[0] = y + bbox.height + vertiSep;\n        subGroup.setMatrix([1, 0, 0, 0, 1, 0, 0, y + keyShapeHeight / 2, 1]);\n      } else {\n        x = begin[0];\n        y = begin[1];\n        begin[0] = x + bbox.width + horiSep;\n        subGroup.setMatrix([1, 0, 0, 0, 1, 0, x + keyShapeWidth / 2, 0, 1]);\n      }\n\n      if (begin[0] > edgeLegendSize.max) edgeLegendSize.max = begin[0];\n    });\n    var ew = edgeLegendSize.max - edgeLegendSize.min;\n\n    if (align && align !== '' && align !== 'left') {\n      var widthDiff = nw - ew;\n      var movement_1 = align === 'center' ? Math.abs(widthDiff) / 2 : Math.abs(widthDiff);\n      var shouldAdjustGroup = widthDiff < 0 ? nodeGroup : edgeGroup;\n      shouldAdjustGroup.get('children').forEach(function (subGroup) {\n        var matrix = subGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n        if (layout === 'vertical') matrix[7] += movement_1;else matrix[6] += movement_1;\n        subGroup.setMatrix(matrix);\n      });\n    }\n  };\n\n  Legend.prototype.processData = function () {\n    var data = this.get('data');\n    var itemsData = {\n      nodes: [],\n      edges: []\n    };\n\n    if (data.nodes) {\n      data.nodes.sort(function (a, b) {\n        return a.order - b.order;\n      });\n      data.nodes.forEach(function (node) {\n        var _a, _b, _c, _d, _e;\n\n        var size = node.size || [((_a = node.style) === null || _a === void 0 ? void 0 : _a.width) || ((_b = node.style) === null || _b === void 0 ? void 0 : _b.r) || 8, ((_c = node.style) === null || _c === void 0 ? void 0 : _c.height) || ((_d = node.style) === null || _d === void 0 ? void 0 : _d.r) || 8];\n        var labelStyle = ((_e = node.labelCfg) === null || _e === void 0 ? void 0 : _e.style) || {};\n        itemsData.nodes.push({\n          id: node.id || uniqueId(),\n          type: node.type || 'circle',\n          style: __assign({}, node.style),\n          order: node.order,\n          label: node.label,\n          itemType: 'node',\n          size: size,\n          labelCfg: {\n            position: 'right',\n            style: __assign({\n              fontFamily: \"Arial\"\n            }, labelStyle)\n          }\n        });\n      });\n    }\n\n    if (data.edges) {\n      data.edges.sort(function (a, b) {\n        return a.order - b.order;\n      });\n      data.edges.forEach(function (edge) {\n        var _a, _b;\n\n        var type = edge.type || 'line';\n        if (edge.type === 'cubic-horizontal') type = 'cubic';\n        var labelStyle = ((_a = edge.labelCfg) === null || _a === void 0 ? void 0 : _a.style) || {};\n        var size = edge.size || [((_b = edge.style) === null || _b === void 0 ? void 0 : _b.width) || 8, 1];\n        itemsData.edges.push({\n          id: edge.id || uniqueId(),\n          type: type,\n          size: size,\n          style: __assign({\n            lineWidth: isArray(size) ? size[1] : 1\n          }, edge.style),\n          order: edge.order,\n          label: edge.label,\n          itemType: 'edge',\n          labelCfg: {\n            position: 'right',\n            style: __assign({\n              fontFamily: \"Arial\"\n            }, labelStyle)\n          }\n        });\n      });\n    }\n\n    this.set('itemsData', itemsData);\n  };\n\n  Legend.prototype.getContainer = function () {\n    return this.get('container');\n  };\n\n  Legend.prototype.formatArray = function (key) {\n    var value = this.get(key);\n    if (isNumber(value)) this.set(key, [value, value, value, value]);else if (isArray(value)) {\n      switch (value.length) {\n        case 0:\n          this.set(key, [0, 0, 0, 0]);\n          break;\n\n        case 1:\n          this.set(key, [value[0], value[0], value[0], value[0]]);\n          break;\n\n        case 2:\n          this.set(key, [value[0], value[1], value[0], value[1]]);\n          break;\n\n        case 3:\n          this.set(key, [value[0], value[1], value[2], value[1]]);\n          break;\n\n        default:\n          break;\n      }\n    }\n    return this.get(key);\n  };\n\n  Legend.prototype.getShapeSize = function (data) {\n    var width, height, r;\n\n    if (data.size) {\n      if (isArray(data.size)) {\n        width = data.size[0];\n        height = data.size[1] || data.size[0];\n        r = data.size[0] / 2;\n      } else if (isNumber(data.size)) {\n        width = data.size;\n        height = data.size;\n        r = data.size / 2;\n      }\n    }\n\n    if (data.style) {\n      if (data.style.width) width = data.style.width;\n      if (data.style.height) height = data.style.height;\n      if (data.style.r) r = data.style.r;\n    }\n\n    if (!r) r = 5;\n    if (!width) width = r;\n    if (!height) height = r;\n    return {\n      width: width,\n      height: height,\n      r: r\n    };\n  };\n\n  Legend.prototype.getStyle = function (type, data) {\n    var defaultStyle = type === 'node' ? {\n      fill: '#ccc',\n      lineWidth: 0\n    } : {\n      stroke: '#000',\n      lineWidth: 1\n    };\n    return __assign(__assign({}, defaultStyle), data.style || {});\n  };\n\n  Legend.prototype.destroy = function () {\n    var graph = this.get('graph');\n    var graphContainer = graph.get('container');\n    var container = this.get('container');\n    graphContainer.removeChild(container);\n  };\n\n  return Legend;\n}(Base);\n\nexport default Legend;","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@antv/g6-plugin/es/legend/index.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","modifyCSS","createDom","Base","isArray","isNumber","uniqueId","Util","Canvas","ALLOW_EVENTS","Legend","_super","config","getDefaultCfgs","data","position","padding","margin","offsetX","offsetY","layout","flipPage","containerStyle","align","undefined","horiSep","vertiSep","filter","enable","trigger","init","formatArray","get","multiple","set","positions","split","includes","graph","graphContainer","container","appendChild","size","render","getContainerPos","bindEvents","self","posIdxMap","x","y","containerCSS","left","getWidth","top","getHeight","forEach","pos","marginValue","key","getContainer","offsetTop","offsetLeft","keys","console","warn","lc","on","e","filterData","clearFilter","clearActiveLegend","target","isCanvas","changeData","activateLegend","shape","shapeGroup","findLegendItemsByState","subGroup","stateStyles","lengedStateStyles","legendInactive","inactive","opacity","legendTextInactive","_a","keyShape","text","attr","legendActive","active","stroke","lineWidth","fontWeight","legendTextActive","stateName","type","value","group","find","nodeGroup","edgeGroup","g","concat","lg","groups","itemGroup","filterFunctions","activeState","graphActiveState","inactiveState","graphInactiveState","activeNodeLegend","activeEdgeLegend","activeCount","typeFuncs","typeFunc","graphItem","activeLegend","func","getModel","setItemState","clearItemStates","getNodes","node","getEdges","edge","_this","processData","width","height","rootGroup","addGroup","name","itemsData","itemTypes","itemType","id","attrs","shapeType","_b","getShapeSize","r","style","getStyle","substr","r1","r2","x1","y1","x2","y2","path","addShape","oriAttrs","label","keyShapeBBox","getBBox","labelStyle","labelCfg","attrs_1","textAlign","fontSize","textBaseline","fill","maxX","className","titleShape","titleGroup","titleGroupBBox","maxY","defaultTitleStyle","fontFamily","titleConfig","getCanvasBBox","setMatrix","layoutItems","lcBBox","nodeGroupBBox","nodeGroupBeginX","minX","Math","abs","nodeGroupBeginY","minY","nodeGroupMatrix","titleGroupMatrix","getMatrix","edgeGroupMatrix_1","edgeGroupMatrix_2","edgeGroupMatrix","edgeGroupBBox","max","changeSize","viewportMatrix","beginPos","invertMatrix","backRect","capture","toBack","begin","nodeLegendSize","min","Infinity","rowMaxY","cNodeGroup","bbox","keyShapeWidth","keyShapeHeight","curHeight","nw","edgeLegendSize","ew","widthDiff","movement_1","shouldAdjustGroup","matrix","nodes","edges","sort","a","order","_c","_d","_e","push","defaultStyle","destroy","removeChild"],"mappings":"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","sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport Base from '../base';\nimport { isArray, isNumber, uniqueId } from '@antv/util';\nimport { Util } from '@antv/g6-core';\nimport { Canvas } from '@antv/g-canvas';\nvar ALLOW_EVENTS = ['click', 'mouseenter'];\n\nvar Legend =\n/** @class */\nfunction (_super) {\n  __extends(Legend, _super);\n\n  function Legend(config) {\n    return _super.call(this, config) || this;\n  }\n\n  Legend.prototype.getDefaultCfgs = function () {\n    return {\n      data: {},\n      position: 'top',\n      padding: 8,\n      margin: 8,\n      offsetX: 0,\n      offsetY: 0,\n      layout: 'horizontal',\n      flipPage: false,\n      containerStyle: {},\n      align: undefined,\n      horiSep: 8,\n      vertiSep: 8,\n      filter: {\n        enable: false,\n        trigger: 'click'\n      }\n    };\n  };\n\n  Legend.prototype.init = function () {\n    this.formatArray('padding');\n    this.formatArray('margin');\n    var filter = this.get('filter') || {};\n    var multiple = filter.multiple;\n    if (multiple && filter.trigger === 'mouseenter') this.set('multiple', false);\n    var align = this.get('align');\n\n    if (!align) {\n      var positions = this.get('position').split('-');\n      if (positions.includes('left')) align = 'left';\n      if (positions.includes('right')) align = 'right';else align = 'center';\n      this.set('align', align);\n    }\n\n    var graph = this.get('graph');\n    var graphContainer = graph.get('container');\n    var container = createDom(\"<div class='g6-legend-container' style=\\\"position: absolute;\\\"></div>\");\n    graphContainer.appendChild(container);\n    this.set('container', container);\n    var size = this.render();\n    modifyCSS(container, this.getContainerPos(size));\n    this.bindEvents();\n  };\n\n  Legend.prototype.getContainerPos = function (size) {\n    if (size === void 0) {\n      size = [0, 0];\n    }\n\n    var self = this;\n    var graph = self.get('graph');\n    var offsetX = this.get('offsetX');\n    var offsetY = this.get('offsetY');\n    var margin = this.get('margin');\n    var positions = this.get('position').split('-');\n    var posIdxMap = {\n      'top': 0,\n      'right': 1,\n      'bottom': 2,\n      'left': 3\n    };\n    var x = 0,\n        y = 0;\n    var containerCSS = {\n      left: (graph.getWidth() - size[0]) / 2 + x,\n      top: (graph.getHeight() - size[1]) / 2 + y\n    };\n    positions.forEach(function (pos) {\n      var marginValue = margin[posIdxMap[pos]];\n      var key = pos;\n\n      switch (pos) {\n        case 'top':\n          marginValue += y;\n          break;\n\n        case 'left':\n          marginValue += x;\n          break;\n\n        case 'bottom':\n          marginValue = graph.getHeight() - size[1] - marginValue + y;\n          key = 'top';\n          break;\n\n        default:\n          marginValue = graph.getWidth() - size[0] - marginValue + x;\n          key = 'left';\n          break;\n      }\n\n      containerCSS[key] = marginValue;\n    });\n    containerCSS.top += offsetY + graph.getContainer().offsetTop;\n    containerCSS.left += offsetX + graph.getContainer().offsetLeft;\n    Object.keys(containerCSS).forEach(function (key) {\n      containerCSS[key] = containerCSS[key] + \"px\";\n    });\n    return containerCSS;\n  }; // class-methods-use-this\n\n\n  Legend.prototype.bindEvents = function () {\n    var self = this;\n    var filter = self.get('filter');\n    if (!filter || !filter.enable) return;\n    var trigger = filter.trigger || 'click';\n\n    if (!ALLOW_EVENTS.includes(trigger)) {\n      console.warn('Trigger for legend filterling must be \\'click\\' or \\'mouseenter\\', \\'click\\' will take effect by default.');\n      trigger = 'click';\n    }\n\n    var lc = self.get('legendCanvas');\n\n    if (trigger === 'mouseenter') {\n      lc.on('node-container:mouseenter', function (e) {\n        return self.filterData(e);\n      });\n      lc.on('node-container:mouseleave', function (e) {\n        self.clearFilter();\n        self.clearActiveLegend();\n      });\n    } else {\n      lc.on('node-container:click', function (e) {\n        return self.filterData(e);\n      });\n      lc.on('click', function (e) {\n        if (e.target && e.target.isCanvas && e.target.isCanvas()) {\n          self.clearFilter();\n          self.clearActiveLegend();\n        }\n      });\n    }\n  };\n  /**\n   * 更新 legend 数据，开放给用户控制\n   * @param param\n   */\n\n\n  Legend.prototype.changeData = function (data) {\n    this.set('data', data);\n    var size = this.render();\n    modifyCSS(this.get('container'), this.getContainerPos(size));\n  };\n\n  Legend.prototype.activateLegend = function (shape) {\n    var filter = this.get('filter');\n    var multiple = filter === null || filter === void 0 ? void 0 : filter.multiple;\n    if (!multiple) this.clearActiveLegend();\n    var shapeGroup = shape.get('parent'); // 若被高亮元素已经处于 active 状态，则取消它的 active 状态\n    // 并根据目前是否有其他 active 状态的元素决定是否要设置为 inactive 状态\n\n    if (shapeGroup.get('active')) {\n      shapeGroup.set('active', false);\n      if (this.findLegendItemsByState('active').length) shapeGroup.set('inactive', true);\n    } else {\n      shapeGroup.set('inactive', false);\n      shapeGroup.set('active', true);\n    } // 当目前有元素为 active 状态时，将非 active 的元素设置为 inactive\n\n\n    if (this.findLegendItemsByState('active').length) {\n      this.findLegendItemsByState('active', 'all', false).forEach(function (subGroup) {\n        subGroup.set('inactive', true);\n      });\n    } else {\n      this.clearActiveLegend();\n    } // 设置样式\n\n\n    var stateStyles = (filter === null || filter === void 0 ? void 0 : filter.lengedStateStyles) || {};\n    var legendInactive = (stateStyles === null || stateStyles === void 0 ? void 0 : stateStyles.inactive) || {\n      opacity: 0.5,\n      'text-shape': {\n        opacity: 0.5\n      }\n    };\n    var legendTextInactive = legendInactive['text-shape'] || {};\n    this.findLegendItemsByState('inactive').forEach(function (subGroup) {\n      var _a = subGroup.get('children'),\n          keyShape = _a[0],\n          text = _a[1];\n\n      keyShape.attr(__assign(__assign({}, keyShape.get('oriAttrs')), legendInactive));\n      text.attr(__assign(__assign({}, text.get('oriAttrs')), legendTextInactive));\n    });\n    var legendActive = (stateStyles === null || stateStyles === void 0 ? void 0 : stateStyles.active) || {\n      stroke: '#000',\n      lineWidth: 2,\n      'text-shape': {\n        fontWeight: 'bold'\n      }\n    };\n    var legendTextActive = legendActive['text-shape'] || {};\n    this.findLegendItemsByState('active').forEach(function (subGroup) {\n      var _a = subGroup.get('children'),\n          keyShape = _a[0],\n          text = _a[1];\n\n      keyShape.attr(__assign(__assign({}, keyShape.get('oriAttrs')), legendActive));\n      text.attr(__assign(__assign({}, text.get('oriAttrs')), legendTextActive));\n    });\n  };\n\n  Legend.prototype.findLegendItemsByState = function (stateName, type, value) {\n    if (type === void 0) {\n      type = 'all';\n    }\n\n    if (value === void 0) {\n      value = true;\n    }\n\n    var group = this.get('legendCanvas').find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    if (type === 'node') return nodeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    });\n    if (type === 'edge') return edgeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    });\n    return nodeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    }).concat(edgeGroup.get('children').filter(function (g) {\n      return !!g.get(stateName) === value;\n    }));\n  };\n\n  Legend.prototype.clearActiveLegend = function () {\n    var lg = this.get('legendCanvas');\n    var group = lg.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var groups = [group.find(function (e) {\n      return e.get('name') === 'node-group';\n    }), group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    })];\n    groups.forEach(function (itemGroup) {\n      itemGroup.get('children').forEach(function (subGroup) {\n        subGroup.set('active', false);\n        subGroup.set('inactive', false);\n\n        var _a = subGroup.get('children'),\n            keyShape = _a[0],\n            text = _a[1];\n\n        keyShape.attr(keyShape.get('oriAttrs'));\n        text.attr(text.get('oriAttrs'));\n      });\n    });\n  };\n  /**\n   * 高亮和置灰图例，并过滤主图元素\n   * @param param\n   */\n\n\n  Legend.prototype.filterData = function (e) {\n    var filter = this.get('filter');\n    var filterFunctions = filter === null || filter === void 0 ? void 0 : filter.filterFunctions;\n    if (!filter || !filterFunctions) return;\n    var lc = this.get('legendCanvas');\n    var graph = this.get('graph');\n    var activeState = filter.graphActiveState || 'active';\n    var inactiveState = filter.graphInactiveState || 'inactive';\n    var multiple = filter.multiple;\n    this.clearFilter();\n    if (!multiple) this.clearActiveLegend(); // 设置 legend 的高亮状态\n\n    this.activateLegend(e.target);\n    var group = lc.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    var activeNodeLegend = nodeGroup.get('children').filter(function (e) {\n      return e.get('active');\n    });\n    var activeEdgeLegend = edgeGroup.get('children').filter(function (e) {\n      return e.get('active');\n    });\n    var activeCount = 0;\n    var typeFuncs = ['getNodes', 'getEdges'];\n    typeFuncs.forEach(function (typeFunc) {\n      graph[typeFunc]().forEach(function (graphItem) {\n        var active = false;\n        var activeLegend = typeFunc === 'getNodes' ? activeNodeLegend : activeEdgeLegend;\n        activeLegend.forEach(function (itemGroup) {\n          var func = filterFunctions[itemGroup.get('id')];\n          active = active || func(graphItem.getModel());\n        });\n\n        if (active) {\n          graph.setItemState(graphItem, inactiveState, false);\n          graph.setItemState(graphItem, activeState, true);\n          activeCount++;\n        } else {\n          graph.setItemState(graphItem, activeState, false);\n          graph.setItemState(graphItem, inactiveState, true);\n        }\n      });\n    });\n    if (!activeCount) typeFuncs.forEach(function (typeFunc) {\n      graph[typeFunc]().forEach(function (graphItem) {\n        graph.clearItemStates(graphItem, [inactiveState]);\n      });\n    });\n  };\n  /**\n   * 清除主图相关状态\n   * @param param\n   */\n\n\n  Legend.prototype.clearFilter = function () {\n    // 清除 legend 的高亮状态\n    var graph = this.get('graph');\n    var filter = this.get('filter');\n    if (!filter) return;\n    var activeState = filter.graphActiveState || 'active';\n    var inactiveState = filter.graphInactiveState || 'inactive';\n    graph.getNodes().forEach(function (node) {\n      graph.clearItemStates(node, [activeState, inactiveState]);\n    });\n    graph.getEdges().forEach(function (edge) {\n      graph.clearItemStates(edge, [activeState, inactiveState]);\n    });\n  };\n  /**\n   * 渲染 legend 图\n   * @param param\n   */\n\n\n  Legend.prototype.render = function () {\n    var _this = this;\n\n    this.processData();\n    var lc = this.get('legendCanvas');\n\n    if (!lc) {\n      lc = new Canvas({\n        container: this.get('container'),\n        width: 200,\n        height: 200\n      });\n      var rootGroup = lc.addGroup({\n        name: 'root'\n      });\n      rootGroup.addGroup({\n        name: 'node-group'\n      });\n      rootGroup.addGroup({\n        name: 'edge-group'\n      }); // nodeStateStyles: {\n      //   legendActive,\n      //   legendInactive\n      // }\n\n      this.set('legendCanvas', lc);\n    }\n\n    var group = lc.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    var itemsData = this.get('itemsData');\n    var itemTypes = ['nodes', 'edges'];\n    var itemGroup = [nodeGroup, edgeGroup];\n    itemTypes.forEach(function (itemType, i) {\n      itemsData[itemType].forEach(function (data) {\n        var _a;\n\n        var subGroup = itemGroup[i].addGroup({\n          id: data.id,\n          name: 'node-container'\n        });\n        var attrs;\n        var shapeType = data.type;\n\n        var _b = _this.getShapeSize(data),\n            width = _b.width,\n            height = _b.height,\n            r = _b.r;\n\n        var style = _this.getStyle(itemType.substr(0, 4), data);\n\n        switch (data.type) {\n          case 'circle':\n            attrs = {\n              r: r,\n              x: 0,\n              y: 0\n            };\n            break;\n\n          case 'rect':\n            attrs = {\n              width: width,\n              height: height,\n              x: -width / 2,\n              y: -height / 2\n            };\n            break;\n\n          case 'ellipse':\n            attrs = {\n              r1: width,\n              r2: height,\n              x: 0,\n              y: 0\n            };\n            break;\n\n          case 'line':\n            attrs = {\n              x1: -width / 2,\n              y1: 0,\n              x2: width / 2,\n              y2: 0\n            };\n            shapeType = 'line';\n            break;\n\n          case 'quadratic':\n            attrs = {\n              path: [['M', -width / 2, 0], ['Q', 0, width / 2, width / 2, 0]]\n            };\n            shapeType = 'path';\n            break;\n\n          case 'cubic':\n            attrs = {\n              path: [['M', -width / 2, 0], ['C', -width / 6, width / 2, width / 6, -width / 2, width / 2, 0]]\n            };\n            shapeType = 'path';\n            break;\n\n          default:\n            attrs = {\n              r: r,\n              x: 0,\n              y: 0\n            };\n            break;\n        }\n\n        var keyShape = subGroup.addShape(shapeType, {\n          attrs: __assign(__assign({}, attrs), style),\n          name: data.type + \"-node-keyShape\",\n          oriAttrs: __assign({\n            opacity: 1\n          }, style)\n        });\n\n        if (data.label) {\n          var keyShapeBBox = keyShape.getBBox();\n          var labelStyle = ((_a = data.labelCfg) === null || _a === void 0 ? void 0 : _a.style) || {};\n\n          var attrs_1 = __assign({\n            textAlign: 'begin',\n            fontSize: 12,\n            textBaseline: 'middle',\n            fill: '#000',\n            opacity: 1,\n            fontWeight: 'normal'\n          }, labelStyle);\n\n          subGroup.addShape('text', {\n            attrs: __assign({\n              x: keyShapeBBox.maxX + 4,\n              y: 0,\n              text: data.label\n            }, attrs_1),\n            className: 'legend-label',\n            name: data.type + \"-node-text\",\n            oriAttrs: attrs_1\n          });\n        }\n      });\n    });\n    var padding = this.get('padding');\n    var titleShape;\n    var titleGroup = group.find(function (e) {\n      return e.get('name') === 'title-container';\n    });\n    var titleGroupBBox = {\n      height: 0,\n      maxY: 0,\n      width: 0\n    };\n\n    if (this.get('title')) {\n      if (!titleGroup) {\n        titleGroup = group.addGroup({\n          name: 'title-container'\n        });\n      }\n\n      var defaultTitleStyle = {\n        fontSize: 20,\n        fontFamily: 'Arial',\n        fontWeight: 300,\n        textBaseline: 'top',\n        textAlign: 'center',\n        fill: \"#000\",\n        x: 0,\n        y: padding[0]\n      };\n      var titleConfig = this.get('titleConfig') || {};\n      var style = Object.assign(defaultTitleStyle, titleConfig.style || {});\n      titleShape = titleGroup.addShape('text', {\n        attrs: __assign({\n          text: this.get('title')\n        }, style)\n      });\n      titleGroupBBox = titleGroup.getCanvasBBox();\n      titleGroup.setMatrix([1, 0, 0, 0, 1, 0, titleConfig.offsetX, titleConfig.offsetY, 1]);\n    }\n\n    this.layoutItems();\n    var lcBBox = group.getCanvasBBox();\n    var nodeGroupBBox = nodeGroup.getCanvasBBox(); // 若有图形超过边界的情况，平移回来\n\n    var nodeGroupBeginX = nodeGroupBBox.minX < 0 ? Math.abs(nodeGroupBBox.minX) + padding[3] : padding[3];\n    var nodeGroupBeginY = titleGroupBBox.maxY < nodeGroupBBox.minY ? Math.abs(titleGroupBBox.maxY - nodeGroupBBox.minY) + padding[0] : titleGroupBBox.maxY + padding[0];\n    var nodeGroupMatrix = [1, 0, 0, 0, 1, 0, nodeGroupBeginX, nodeGroupBeginY, 1];\n    nodeGroup.setMatrix(nodeGroupMatrix);\n    lcBBox = group.getCanvasBBox();\n    var size = [lcBBox.minX + lcBBox.width + padding[1], lcBBox.minY + lcBBox.height + padding[2]]; // 根据 size 和 titleConfig 调整 title 位置，再调整 nodeGroup 位置\n\n    if (titleShape) {\n      var titleConfig = __assign({\n        position: 'center',\n        offsetX: 0,\n        offsetY: 0\n      }, this.get('titleConfig'));\n\n      titleGroupBBox = titleGroup.getCanvasBBox();\n      var titleGroupMatrix = titleGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n      if (titleConfig.position === 'center') {\n        titleGroupMatrix[6] = size[0] / 2 + titleConfig.offsetX;\n      } else if (titleConfig.position === 'right') {\n        titleGroupMatrix[6] = size[0] - padding[3] + titleConfig.offsetX;\n        titleShape.attr({\n          textAlign: 'right'\n        });\n      } else {\n        titleGroupMatrix[6] = padding[3] + titleConfig.offsetX;\n        titleShape.attr({\n          textAlign: 'left'\n        });\n      }\n\n      titleGroup.setMatrix(titleGroupMatrix);\n      titleGroupBBox = titleGroup.getCanvasBBox(); // 若有图形超过边界的情况，平移回来\n\n      nodeGroupBeginX = nodeGroupBBox.minX < 0 ? Math.abs(nodeGroupBBox.minX) + padding[3] : padding[3];\n      nodeGroupBeginY = nodeGroupBBox.minY < titleGroupBBox.maxY ? Math.abs(titleGroupBBox.maxY - nodeGroupBBox.minY) + padding[0] : titleGroupBBox.maxY + padding[0];\n      nodeGroupMatrix = [1, 0, 0, 0, 1, 0, nodeGroupBeginX, nodeGroupBeginY, 1];\n      nodeGroup.setMatrix(nodeGroupMatrix);\n      var edgeGroupMatrix_1 = [1, 0, 0, 0, 1, 0, nodeGroupBeginX, nodeGroupBeginY, 1];\n      if (this.get('layout') === 'vertical') edgeGroupMatrix_1[6] += nodeGroupBBox.maxX + this.get('horiSep');else edgeGroupMatrix_1[7] += nodeGroupBBox.maxY + this.get('vertiSep');\n      edgeGroup.setMatrix(edgeGroupMatrix_1);\n    } else {\n      // 没有 title，也需要平移 edgeGroup\n      nodeGroupBBox = nodeGroup.getCanvasBBox();\n      var edgeGroupMatrix_2 = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n      if (this.get('layout') === 'vertical') edgeGroupMatrix_2[6] += nodeGroupMatrix[6] + nodeGroupBBox.maxX + this.get('horiSep');else edgeGroupMatrix_2[7] += nodeGroupMatrix[7] + nodeGroupBBox.maxY + this.get('vertiSep');\n      edgeGroup.setMatrix(edgeGroupMatrix_2);\n    }\n\n    lcBBox = group.getCanvasBBox();\n    nodeGroupBBox = nodeGroup.getCanvasBBox();\n    nodeGroupMatrix = nodeGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var edgeGroupMatrix = edgeGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var edgeGroupBBox = edgeGroup.getCanvasBBox();\n    size = [Math.max(nodeGroupBBox.width + nodeGroupMatrix[6], edgeGroupBBox.width + edgeGroupMatrix[6]) + padding[1], Math.max(nodeGroupBBox.height + nodeGroupMatrix[7], edgeGroupBBox.height + edgeGroupMatrix[7]) + padding[2]];\n    lc.changeSize(size[0], size[1]); // 更新容器背景样式\n\n    var containerStyle = this.get('containerStyle');\n    var viewportMatrix = group.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    var beginPos = Util.invertMatrix({\n      x: 0,\n      y: 0\n    }, viewportMatrix);\n    var backRect = group.addShape('rect', {\n      attrs: __assign({\n        x: beginPos.x + (containerStyle.lineWidth || 1),\n        y: beginPos.y + (containerStyle.lineWidth || 1),\n        width: size[0] - 2 * (containerStyle.lineWidth || 1),\n        height: size[1] - 2 * (containerStyle.lineWidth || 1),\n        fill: \"#f00\",\n        stroke: '#000',\n        lineWidth: 1,\n        opacity: 0.5\n      }, containerStyle),\n      name: 'legend-back-rect',\n      capture: false\n    });\n    backRect.toBack();\n    return size;\n  };\n\n  Legend.prototype.layoutItems = function () {\n    var lc = this.get('legendCanvas');\n    var horiSep = this.get('horiSep');\n    var vertiSep = this.get('vertiSep');\n    var layout = this.get('layout');\n    var align = this.get('align');\n    var begin = [0, 0];\n    var group = lc.find(function (e) {\n      return e.get('name') === 'root';\n    });\n    var nodeGroup = group.find(function (e) {\n      return e.get('name') === 'node-group';\n    });\n    var edgeGroup = group.find(function (e) {\n      return e.get('name') === 'edge-group';\n    });\n    var nodeLegendSize = {\n      min: 0,\n      max: -Infinity\n    };\n    var rowMaxY = -Infinity;\n    nodeGroup.get('children').forEach(function (cNodeGroup, i) {\n      if (i === 0) nodeLegendSize.min = begin[0];\n      var keyShape = cNodeGroup.get('children')[0];\n      var bbox = cNodeGroup.getCanvasBBox();\n\n      var _a = keyShape.getBBox(),\n          keyShapeWidth = _a.width,\n          keyShapeHeight = _a.height;\n\n      var curHeight = 0,\n          x = 0,\n          y = 0;\n\n      if (layout === 'vertical') {\n        x = begin[1];\n        y = begin[0] + keyShapeWidth / 2;\n        begin[0] = y + bbox.height + vertiSep;\n        curHeight = bbox.maxX + x + keyShapeWidth / 2;\n      } else {\n        x = begin[0] + keyShapeWidth / 2;\n        y = begin[1];\n        begin[0] = x + bbox.width + horiSep;\n        curHeight = bbox.maxY + y + keyShapeHeight / 2;\n      }\n\n      if (begin[0] > nodeLegendSize.max) nodeLegendSize.max = begin[0];\n      if (curHeight > rowMaxY) rowMaxY = curHeight;\n      cNodeGroup.setMatrix([1, 0, 0, 0, 1, 0, x, y, 1]);\n    });\n    var nw = nodeLegendSize.max - nodeLegendSize.min;\n    var edgeLegendSize = {\n      min: 0,\n      max: -Infinity\n    };\n    var nodeGroupBBox = nodeGroup.getCanvasBBox();\n    begin[0] = 0;\n    begin[1] = layout === 'vertical' ? nodeGroupBBox.maxX + horiSep : nodeGroupBBox.maxY + vertiSep;\n    edgeGroup.get('children').forEach(function (subGroup, i) {\n      if (i === 0) edgeLegendSize.min = begin[0];\n      var keyShape = subGroup.get('children')[0];\n      var bbox = subGroup.getCanvasBBox();\n\n      var _a = keyShape.getBBox(),\n          keyShapeWidth = _a.width,\n          keyShapeHeight = _a.height;\n\n      var x = 0,\n          y = 0;\n\n      if (layout === 'vertical') {\n        x = begin[1];\n        y = begin[0];\n        begin[0] = y + bbox.height + vertiSep;\n        subGroup.setMatrix([1, 0, 0, 0, 1, 0, 0, y + keyShapeHeight / 2, 1]);\n      } else {\n        x = begin[0];\n        y = begin[1];\n        begin[0] = x + bbox.width + horiSep;\n        subGroup.setMatrix([1, 0, 0, 0, 1, 0, x + keyShapeWidth / 2, 0, 1]);\n      }\n\n      if (begin[0] > edgeLegendSize.max) edgeLegendSize.max = begin[0];\n    });\n    var ew = edgeLegendSize.max - edgeLegendSize.min;\n\n    if (align && align !== '' && align !== 'left') {\n      var widthDiff = nw - ew;\n      var movement_1 = align === 'center' ? Math.abs(widthDiff) / 2 : Math.abs(widthDiff);\n      var shouldAdjustGroup = widthDiff < 0 ? nodeGroup : edgeGroup;\n      shouldAdjustGroup.get('children').forEach(function (subGroup) {\n        var matrix = subGroup.getMatrix() || [1, 0, 0, 0, 1, 0, 0, 0, 1];\n        if (layout === 'vertical') matrix[7] += movement_1;else matrix[6] += movement_1;\n        subGroup.setMatrix(matrix);\n      });\n    }\n  };\n\n  Legend.prototype.processData = function () {\n    var data = this.get('data');\n    var itemsData = {\n      nodes: [],\n      edges: []\n    };\n\n    if (data.nodes) {\n      data.nodes.sort(function (a, b) {\n        return a.order - b.order;\n      });\n      data.nodes.forEach(function (node) {\n        var _a, _b, _c, _d, _e;\n\n        var size = node.size || [((_a = node.style) === null || _a === void 0 ? void 0 : _a.width) || ((_b = node.style) === null || _b === void 0 ? void 0 : _b.r) || 8, ((_c = node.style) === null || _c === void 0 ? void 0 : _c.height) || ((_d = node.style) === null || _d === void 0 ? void 0 : _d.r) || 8];\n        var labelStyle = ((_e = node.labelCfg) === null || _e === void 0 ? void 0 : _e.style) || {};\n        itemsData.nodes.push({\n          id: node.id || uniqueId(),\n          type: node.type || 'circle',\n          style: __assign({}, node.style),\n          order: node.order,\n          label: node.label,\n          itemType: 'node',\n          size: size,\n          labelCfg: {\n            position: 'right',\n            style: __assign({\n              fontFamily: \"Arial\"\n            }, labelStyle)\n          }\n        });\n      });\n    }\n\n    if (data.edges) {\n      data.edges.sort(function (a, b) {\n        return a.order - b.order;\n      });\n      data.edges.forEach(function (edge) {\n        var _a, _b;\n\n        var type = edge.type || 'line';\n        if (edge.type === 'cubic-horizontal') type = 'cubic';\n        var labelStyle = ((_a = edge.labelCfg) === null || _a === void 0 ? void 0 : _a.style) || {};\n        var size = edge.size || [((_b = edge.style) === null || _b === void 0 ? void 0 : _b.width) || 8, 1];\n        itemsData.edges.push({\n          id: edge.id || uniqueId(),\n          type: type,\n          size: size,\n          style: __assign({\n            lineWidth: isArray(size) ? size[1] : 1\n          }, edge.style),\n          order: edge.order,\n          label: edge.label,\n          itemType: 'edge',\n          labelCfg: {\n            position: 'right',\n            style: __assign({\n              fontFamily: \"Arial\"\n            }, labelStyle)\n          }\n        });\n      });\n    }\n\n    this.set('itemsData', itemsData);\n  };\n\n  Legend.prototype.getContainer = function () {\n    return this.get('container');\n  };\n\n  Legend.prototype.formatArray = function (key) {\n    var value = this.get(key);\n    if (isNumber(value)) this.set(key, [value, value, value, value]);else if (isArray(value)) {\n      switch (value.length) {\n        case 0:\n          this.set(key, [0, 0, 0, 0]);\n          break;\n\n        case 1:\n          this.set(key, [value[0], value[0], value[0], value[0]]);\n          break;\n\n        case 2:\n          this.set(key, [value[0], value[1], value[0], value[1]]);\n          break;\n\n        case 3:\n          this.set(key, [value[0], value[1], value[2], value[1]]);\n          break;\n\n        default:\n          break;\n      }\n    }\n    return this.get(key);\n  };\n\n  Legend.prototype.getShapeSize = function (data) {\n    var width, height, r;\n\n    if (data.size) {\n      if (isArray(data.size)) {\n        width = data.size[0];\n        height = data.size[1] || data.size[0];\n        r = data.size[0] / 2;\n      } else if (isNumber(data.size)) {\n        width = data.size;\n        height = data.size;\n        r = data.size / 2;\n      }\n    }\n\n    if (data.style) {\n      if (data.style.width) width = data.style.width;\n      if (data.style.height) height = data.style.height;\n      if (data.style.r) r = data.style.r;\n    }\n\n    if (!r) r = 5;\n    if (!width) width = r;\n    if (!height) height = r;\n    return {\n      width: width,\n      height: height,\n      r: r\n    };\n  };\n\n  Legend.prototype.getStyle = function (type, data) {\n    var defaultStyle = type === 'node' ? {\n      fill: '#ccc',\n      lineWidth: 0\n    } : {\n      stroke: '#000',\n      lineWidth: 1\n    };\n    return __assign(__assign({}, defaultStyle), data.style || {});\n  };\n\n  Legend.prototype.destroy = function () {\n    var graph = this.get('graph');\n    var graphContainer = graph.get('container');\n    var container = this.get('container');\n    graphContainer.removeChild(container);\n  };\n\n  return Legend;\n}(Base);\n\nexport default Legend;"]},"metadata":{},"sourceType":"module"}