{"ast":null,"code":"var ALLOW_EVENTS = ['shift', 'ctrl', 'alt', 'control'];\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      direction: 'both',\n      enableOptimize: false,\n      zoomKey: 'ctrl',\n      // scroll-canvas 可滚动的扩展范围，默认为 0，即最多可以滚动一屏的位置\n      // 当设置的值大于 0 时，即滚动可以超过一屏\n      // 当设置的值小于 0 时，相当于缩小了可滚动范围\n      // 具体实例可参考：https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*IFfoS67_HssAAAAAAAAAAAAAARQnAQ\n      scalableRange: 0\n    };\n  },\n  getEvents: function getEvents() {\n    if (!this.zoomKey || ALLOW_EVENTS.indexOf(this.zoomKey) === -1) this.zoomKey = 'ctrl';\n    return {\n      wheel: 'onWheel'\n    };\n  },\n  onWheel: function onWheel(ev) {\n    var _this = this;\n\n    var graph = this.graph;\n    var keyDown = ev[this.zoomKey + \"Key\"];\n    if (this.zoomKey === 'control') keyDown = ev.ctrlKey;\n\n    if (keyDown) {\n      var canvas = graph.get('canvas');\n      var point = canvas.getPointByClient(ev.clientX, ev.clientY);\n      var ratio = graph.getZoom();\n\n      if (ev.wheelDelta > 0) {\n        ratio = ratio + ratio * 0.05;\n      } else {\n        ratio = ratio - ratio * 0.05;\n      }\n\n      graph.zoomTo(ratio, {\n        x: point.x,\n        y: point.y\n      });\n    } else {\n      var dx = ev.deltaX || ev.movementX;\n      var dy = ev.deltaY || ev.movementY;\n      if (!dy && navigator.userAgent.indexOf('Firefox') > -1) dy = -ev.wheelDelta * 125 / 3;\n      var width = this.graph.get('width');\n      var height = this.graph.get('height');\n      var graphCanvasBBox = this.graph.get('canvas').getCanvasBBox();\n      var expandWidth = this.scalableRange;\n      var expandHeight = this.scalableRange; // 若 scalableRange 是 0~1 的小数，则作为比例考虑\n\n      if (expandWidth < 1 && expandWidth > -1) {\n        expandWidth = width * expandWidth;\n        expandHeight = height * expandHeight;\n      }\n\n      var minX = graphCanvasBBox.minX,\n          maxX = graphCanvasBBox.maxX,\n          minY = graphCanvasBBox.minY,\n          maxY = graphCanvasBBox.maxY;\n\n      if (dx > 0) {\n        if (maxX < -expandWidth) {\n          dx = 0;\n        } else if (maxX - dx < -expandWidth) {\n          dx = maxX + expandWidth;\n        }\n      } else if (dx < 0) {\n        if (minX > width + expandWidth) {\n          dx = 0;\n        } else if (minX - dx > width + expandWidth) {\n          dx = minX - (width + expandWidth);\n        }\n      }\n\n      if (dy > 0) {\n        if (maxY < -expandHeight) {\n          dy = 0;\n        } else if (maxY - dy < -expandHeight) {\n          dy = maxY + expandHeight;\n        }\n      } else if (dy < 0) {\n        if (minY > height + expandHeight) {\n          dy = 0;\n        } else if (minY - dy > height + expandHeight) {\n          dy = minY - (height + expandHeight);\n        }\n      }\n\n      if (this.get('direction') === 'x') {\n        dy = 0;\n      } else if (this.get('direction') === 'y') {\n        dx = 0;\n      }\n\n      graph.translate(-dx, -dy);\n    }\n\n    ev.preventDefault(); // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = node.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n                var oriVis = shape.get('ori-visibility');\n\n                if (!shape.get('visible') && oriVis) {\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = edge.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  var oriVis = shape.get('ori-visibility');\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 100);\n      this.set('timeout', timeout);\n    }\n  }\n};","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@antv/g6-pc/es/behavior/scroll-canvas.js"],"names":["ALLOW_EVENTS","getDefaultCfg","direction","enableOptimize","zoomKey","scalableRange","getEvents","indexOf","wheel","onWheel","ev","_this","graph","keyDown","ctrlKey","canvas","get","point","getPointByClient","clientX","clientY","ratio","getZoom","wheelDelta","zoomTo","x","y","dx","deltaX","movementX","dy","deltaY","movementY","navigator","userAgent","width","height","graphCanvasBBox","getCanvasBBox","expandWidth","expandHeight","minX","maxX","minY","maxY","translate","preventDefault","optimizeZoom_1","optimized","nodes_1","getNodes","edges_1","getEdges","nodesLength_1","length","edgesLength_1","n","node","destroyed","children","childrenLength","c","shape","destoryed","set","hide","edgeIndex","edge","clearTimeout","timeout","setTimeout","currentZoom","curOptimized","keyShape","getKeyShape","oriVis","show"],"mappings":"AAAA,IAAIA,YAAY,GAAG,CAAC,OAAD,EAAU,MAAV,EAAkB,KAAlB,EAAyB,SAAzB,CAAnB;AACA,eAAe;AACbC,EAAAA,aAAa,EAAE,SAASA,aAAT,GAAyB;AACtC,WAAO;AACLC,MAAAA,SAAS,EAAE,MADN;AAELC,MAAAA,cAAc,EAAE,KAFX;AAGLC,MAAAA,OAAO,EAAE,MAHJ;AAIL;AACA;AACA;AACA;AACAC,MAAAA,aAAa,EAAE;AARV,KAAP;AAUD,GAZY;AAabC,EAAAA,SAAS,EAAE,SAASA,SAAT,GAAqB;AAC9B,QAAI,CAAC,KAAKF,OAAN,IAAiBJ,YAAY,CAACO,OAAb,CAAqB,KAAKH,OAA1B,MAAuC,CAAC,CAA7D,EAAgE,KAAKA,OAAL,GAAe,MAAf;AAChE,WAAO;AACLI,MAAAA,KAAK,EAAE;AADF,KAAP;AAGD,GAlBY;AAmBbC,EAAAA,OAAO,EAAE,SAASA,OAAT,CAAiBC,EAAjB,EAAqB;AAC5B,QAAIC,KAAK,GAAG,IAAZ;;AAEA,QAAIC,KAAK,GAAG,KAAKA,KAAjB;AACA,QAAIC,OAAO,GAAGH,EAAE,CAAC,KAAKN,OAAL,GAAe,KAAhB,CAAhB;AACA,QAAI,KAAKA,OAAL,KAAiB,SAArB,EAAgCS,OAAO,GAAGH,EAAE,CAACI,OAAb;;AAEhC,QAAID,OAAJ,EAAa;AACX,UAAIE,MAAM,GAAGH,KAAK,CAACI,GAAN,CAAU,QAAV,CAAb;AACA,UAAIC,KAAK,GAAGF,MAAM,CAACG,gBAAP,CAAwBR,EAAE,CAACS,OAA3B,EAAoCT,EAAE,CAACU,OAAvC,CAAZ;AACA,UAAIC,KAAK,GAAGT,KAAK,CAACU,OAAN,EAAZ;;AAEA,UAAIZ,EAAE,CAACa,UAAH,GAAgB,CAApB,EAAuB;AACrBF,QAAAA,KAAK,GAAGA,KAAK,GAAGA,KAAK,GAAG,IAAxB;AACD,OAFD,MAEO;AACLA,QAAAA,KAAK,GAAGA,KAAK,GAAGA,KAAK,GAAG,IAAxB;AACD;;AAEDT,MAAAA,KAAK,CAACY,MAAN,CAAaH,KAAb,EAAoB;AAClBI,QAAAA,CAAC,EAAER,KAAK,CAACQ,CADS;AAElBC,QAAAA,CAAC,EAAET,KAAK,CAACS;AAFS,OAApB;AAID,KAfD,MAeO;AACL,UAAIC,EAAE,GAAGjB,EAAE,CAACkB,MAAH,IAAalB,EAAE,CAACmB,SAAzB;AACA,UAAIC,EAAE,GAAGpB,EAAE,CAACqB,MAAH,IAAarB,EAAE,CAACsB,SAAzB;AACA,UAAI,CAACF,EAAD,IAAOG,SAAS,CAACC,SAAV,CAAoB3B,OAApB,CAA4B,SAA5B,IAAyC,CAAC,CAArD,EAAwDuB,EAAE,GAAG,CAACpB,EAAE,CAACa,UAAJ,GAAiB,GAAjB,GAAuB,CAA5B;AACxD,UAAIY,KAAK,GAAG,KAAKvB,KAAL,CAAWI,GAAX,CAAe,OAAf,CAAZ;AACA,UAAIoB,MAAM,GAAG,KAAKxB,KAAL,CAAWI,GAAX,CAAe,QAAf,CAAb;AACA,UAAIqB,eAAe,GAAG,KAAKzB,KAAL,CAAWI,GAAX,CAAe,QAAf,EAAyBsB,aAAzB,EAAtB;AACA,UAAIC,WAAW,GAAG,KAAKlC,aAAvB;AACA,UAAImC,YAAY,GAAG,KAAKnC,aAAxB,CARK,CAQkC;;AAEvC,UAAIkC,WAAW,GAAG,CAAd,IAAmBA,WAAW,GAAG,CAAC,CAAtC,EAAyC;AACvCA,QAAAA,WAAW,GAAGJ,KAAK,GAAGI,WAAtB;AACAC,QAAAA,YAAY,GAAGJ,MAAM,GAAGI,YAAxB;AACD;;AAED,UAAIC,IAAI,GAAGJ,eAAe,CAACI,IAA3B;AAAA,UACIC,IAAI,GAAGL,eAAe,CAACK,IAD3B;AAAA,UAEIC,IAAI,GAAGN,eAAe,CAACM,IAF3B;AAAA,UAGIC,IAAI,GAAGP,eAAe,CAACO,IAH3B;;AAKA,UAAIjB,EAAE,GAAG,CAAT,EAAY;AACV,YAAIe,IAAI,GAAG,CAACH,WAAZ,EAAyB;AACvBZ,UAAAA,EAAE,GAAG,CAAL;AACD,SAFD,MAEO,IAAIe,IAAI,GAAGf,EAAP,GAAY,CAACY,WAAjB,EAA8B;AACnCZ,UAAAA,EAAE,GAAGe,IAAI,GAAGH,WAAZ;AACD;AACF,OAND,MAMO,IAAIZ,EAAE,GAAG,CAAT,EAAY;AACjB,YAAIc,IAAI,GAAGN,KAAK,GAAGI,WAAnB,EAAgC;AAC9BZ,UAAAA,EAAE,GAAG,CAAL;AACD,SAFD,MAEO,IAAIc,IAAI,GAAGd,EAAP,GAAYQ,KAAK,GAAGI,WAAxB,EAAqC;AAC1CZ,UAAAA,EAAE,GAAGc,IAAI,IAAIN,KAAK,GAAGI,WAAZ,CAAT;AACD;AACF;;AAED,UAAIT,EAAE,GAAG,CAAT,EAAY;AACV,YAAIc,IAAI,GAAG,CAACJ,YAAZ,EAA0B;AACxBV,UAAAA,EAAE,GAAG,CAAL;AACD,SAFD,MAEO,IAAIc,IAAI,GAAGd,EAAP,GAAY,CAACU,YAAjB,EAA+B;AACpCV,UAAAA,EAAE,GAAGc,IAAI,GAAGJ,YAAZ;AACD;AACF,OAND,MAMO,IAAIV,EAAE,GAAG,CAAT,EAAY;AACjB,YAAIa,IAAI,GAAGP,MAAM,GAAGI,YAApB,EAAkC;AAChCV,UAAAA,EAAE,GAAG,CAAL;AACD,SAFD,MAEO,IAAIa,IAAI,GAAGb,EAAP,GAAYM,MAAM,GAAGI,YAAzB,EAAuC;AAC5CV,UAAAA,EAAE,GAAGa,IAAI,IAAIP,MAAM,GAAGI,YAAb,CAAT;AACD;AACF;;AAED,UAAI,KAAKxB,GAAL,CAAS,WAAT,MAA0B,GAA9B,EAAmC;AACjCc,QAAAA,EAAE,GAAG,CAAL;AACD,OAFD,MAEO,IAAI,KAAKd,GAAL,CAAS,WAAT,MAA0B,GAA9B,EAAmC;AACxCW,QAAAA,EAAE,GAAG,CAAL;AACD;;AAEDf,MAAAA,KAAK,CAACiC,SAAN,CAAgB,CAAClB,EAAjB,EAAqB,CAACG,EAAtB;AACD;;AAEDpB,IAAAA,EAAE,CAACoC,cAAH,GA/E4B,CA+EP;AACrB;;AAEA,QAAI3C,cAAc,GAAG,KAAKa,GAAL,CAAS,gBAAT,CAArB;;AAEA,QAAIb,cAAJ,EAAoB;AAClB,UAAI4C,cAAc,GAAG,KAAK/B,GAAL,CAAS,cAAT,CAArB;AACA,UAAIgC,SAAS,GAAG,KAAKhC,GAAL,CAAS,WAAT,CAAhB;AACA,UAAIiC,OAAO,GAAGrC,KAAK,CAACsC,QAAN,EAAd;AACA,UAAIC,OAAO,GAAGvC,KAAK,CAACwC,QAAN,EAAd;AACA,UAAIC,aAAa,GAAGJ,OAAO,CAACK,MAA5B;AACA,UAAIC,aAAa,GAAGJ,OAAO,CAACG,MAA5B,CANkB,CAMkB;;AAEpC,UAAI,CAACN,SAAL,EAAgB;AACd,aAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,aAApB,EAAmCG,CAAC,EAApC,EAAwC;AACtC,cAAIC,IAAI,GAAGR,OAAO,CAACO,CAAD,CAAlB;;AAEA,cAAI,CAACC,IAAI,CAACC,SAAV,EAAqB;AACnB,gBAAIC,QAAQ,GAAGF,IAAI,CAACzC,GAAL,CAAS,OAAT,EAAkBA,GAAlB,CAAsB,UAAtB,CAAf;AACA,gBAAI4C,cAAc,GAAGD,QAAQ,CAACL,MAA9B;;AAEA,iBAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,cAApB,EAAoCC,CAAC,EAArC,EAAyC;AACvC,kBAAIC,KAAK,GAAGH,QAAQ,CAACE,CAAD,CAApB;;AAEA,kBAAI,CAACC,KAAK,CAACC,SAAP,IAAoB,CAACD,KAAK,CAAC9C,GAAN,CAAU,YAAV,CAAzB,EAAkD;AAChD8C,gBAAAA,KAAK,CAACE,GAAN,CAAU,gBAAV,EAA4BF,KAAK,CAAC9C,GAAN,CAAU,gBAAV,KAA+B8C,KAAK,CAAC9C,GAAN,CAAU,SAAV,CAA3D;AACA8C,gBAAAA,KAAK,CAACG,IAAN;AACD;AACF;AACF;AACF;;AAED,aAAK,IAAIC,SAAS,GAAG,CAArB,EAAwBA,SAAS,GAAGX,aAApC,EAAmDW,SAAS,EAA5D,EAAgE;AAC9D,cAAIC,IAAI,GAAGhB,OAAO,CAACe,SAAD,CAAlB;AACA,cAAIP,QAAQ,GAAGQ,IAAI,CAACnD,GAAL,CAAS,OAAT,EAAkBA,GAAlB,CAAsB,UAAtB,CAAf;AACA,cAAI4C,cAAc,GAAGD,QAAQ,CAACL,MAA9B;;AAEA,eAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,cAApB,EAAoCC,CAAC,EAArC,EAAyC;AACvC,gBAAIC,KAAK,GAAGH,QAAQ,CAACE,CAAD,CAApB;AACAC,YAAAA,KAAK,CAACE,GAAN,CAAU,gBAAV,EAA4BF,KAAK,CAAC9C,GAAN,CAAU,gBAAV,KAA+B8C,KAAK,CAAC9C,GAAN,CAAU,SAAV,CAA3D;AACA8C,YAAAA,KAAK,CAACG,IAAN;AACD;AACF;;AAED,aAAKD,GAAL,CAAS,WAAT,EAAsB,IAAtB;AACD,OAxCiB,CAwChB;;;AAGFI,MAAAA,YAAY,CAAC,KAAKpD,GAAL,CAAS,SAAT,CAAD,CAAZ;AACA,UAAIqD,OAAO,GAAGC,UAAU,CAAC,YAAY;AACnC,YAAIC,WAAW,GAAG3D,KAAK,CAACU,OAAN,EAAlB;;AAEA,YAAIkD,YAAY,GAAG7D,KAAK,CAACK,GAAN,CAAU,WAAV,CAAnB;;AAEA,YAAIwD,YAAJ,EAAkB;AAChB7D,UAAAA,KAAK,CAACqD,GAAN,CAAU,WAAV,EAAuB,KAAvB;;AAEA,eAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,aAApB,EAAmCG,CAAC,EAApC,EAAwC;AACtC,gBAAIC,IAAI,GAAGR,OAAO,CAACO,CAAD,CAAlB;AACA,gBAAIG,QAAQ,GAAGF,IAAI,CAACzC,GAAL,CAAS,OAAT,EAAkBA,GAAlB,CAAsB,UAAtB,CAAf;AACA,gBAAI4C,cAAc,GAAGD,QAAQ,CAACL,MAA9B;;AAEA,gBAAIiB,WAAW,GAAGxB,cAAlB,EAAkC;AAChC,kBAAI0B,QAAQ,GAAGhB,IAAI,CAACiB,WAAL,EAAf;AACA,kBAAIC,MAAM,GAAGF,QAAQ,CAACzD,GAAT,CAAa,gBAAb,CAAb;AACA,kBAAI2D,MAAJ,EAAYF,QAAQ,CAACG,IAAT;AACb,aAJD,MAIO;AACL,mBAAK,IAAIf,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,cAApB,EAAoCC,CAAC,EAArC,EAAyC;AACvC,oBAAIC,KAAK,GAAGH,QAAQ,CAACE,CAAD,CAApB;AACA,oBAAIc,MAAM,GAAGb,KAAK,CAAC9C,GAAN,CAAU,gBAAV,CAAb;;AAEA,oBAAI,CAAC8C,KAAK,CAAC9C,GAAN,CAAU,SAAV,CAAD,IAAyB2D,MAA7B,EAAqC;AACnC,sBAAIA,MAAJ,EAAYb,KAAK,CAACc,IAAN;AACb;AACF;AACF;AACF;;AAED,eAAK,IAAIV,SAAS,GAAG,CAArB,EAAwBA,SAAS,GAAGX,aAApC,EAAmDW,SAAS,EAA5D,EAAgE;AAC9D,gBAAIC,IAAI,GAAGhB,OAAO,CAACe,SAAD,CAAlB;AACA,gBAAIP,QAAQ,GAAGQ,IAAI,CAACnD,GAAL,CAAS,OAAT,EAAkBA,GAAlB,CAAsB,UAAtB,CAAf;AACA,gBAAI4C,cAAc,GAAGD,QAAQ,CAACL,MAA9B;;AAEA,gBAAIiB,WAAW,GAAGxB,cAAlB,EAAkC;AAChC,kBAAI0B,QAAQ,GAAGN,IAAI,CAACO,WAAL,EAAf;AACA,kBAAIC,MAAM,GAAGF,QAAQ,CAACzD,GAAT,CAAa,gBAAb,CAAb;AACA,kBAAI2D,MAAJ,EAAYF,QAAQ,CAACG,IAAT;AACb,aAJD,MAIO;AACL,mBAAK,IAAIf,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,cAApB,EAAoCC,CAAC,EAArC,EAAyC;AACvC,oBAAIC,KAAK,GAAGH,QAAQ,CAACE,CAAD,CAApB;;AAEA,oBAAI,CAACC,KAAK,CAAC9C,GAAN,CAAU,SAAV,CAAL,EAA2B;AACzB,sBAAI2D,MAAM,GAAGb,KAAK,CAAC9C,GAAN,CAAU,gBAAV,CAAb;AACA,sBAAI2D,MAAJ,EAAYb,KAAK,CAACc,IAAN;AACb;AACF;AACF;AACF;AACF;AACF,OAlDuB,EAkDrB,GAlDqB,CAAxB;AAmDA,WAAKZ,GAAL,CAAS,SAAT,EAAoBK,OAApB;AACD;AACF;AAxMY,CAAf","sourcesContent":["var ALLOW_EVENTS = ['shift', 'ctrl', 'alt', 'control'];\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      direction: 'both',\n      enableOptimize: false,\n      zoomKey: 'ctrl',\n      // scroll-canvas 可滚动的扩展范围，默认为 0，即最多可以滚动一屏的位置\n      // 当设置的值大于 0 时，即滚动可以超过一屏\n      // 当设置的值小于 0 时，相当于缩小了可滚动范围\n      // 具体实例可参考：https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*IFfoS67_HssAAAAAAAAAAAAAARQnAQ\n      scalableRange: 0\n    };\n  },\n  getEvents: function getEvents() {\n    if (!this.zoomKey || ALLOW_EVENTS.indexOf(this.zoomKey) === -1) this.zoomKey = 'ctrl';\n    return {\n      wheel: 'onWheel'\n    };\n  },\n  onWheel: function onWheel(ev) {\n    var _this = this;\n\n    var graph = this.graph;\n    var keyDown = ev[this.zoomKey + \"Key\"];\n    if (this.zoomKey === 'control') keyDown = ev.ctrlKey;\n\n    if (keyDown) {\n      var canvas = graph.get('canvas');\n      var point = canvas.getPointByClient(ev.clientX, ev.clientY);\n      var ratio = graph.getZoom();\n\n      if (ev.wheelDelta > 0) {\n        ratio = ratio + ratio * 0.05;\n      } else {\n        ratio = ratio - ratio * 0.05;\n      }\n\n      graph.zoomTo(ratio, {\n        x: point.x,\n        y: point.y\n      });\n    } else {\n      var dx = ev.deltaX || ev.movementX;\n      var dy = ev.deltaY || ev.movementY;\n      if (!dy && navigator.userAgent.indexOf('Firefox') > -1) dy = -ev.wheelDelta * 125 / 3;\n      var width = this.graph.get('width');\n      var height = this.graph.get('height');\n      var graphCanvasBBox = this.graph.get('canvas').getCanvasBBox();\n      var expandWidth = this.scalableRange;\n      var expandHeight = this.scalableRange; // 若 scalableRange 是 0~1 的小数，则作为比例考虑\n\n      if (expandWidth < 1 && expandWidth > -1) {\n        expandWidth = width * expandWidth;\n        expandHeight = height * expandHeight;\n      }\n\n      var minX = graphCanvasBBox.minX,\n          maxX = graphCanvasBBox.maxX,\n          minY = graphCanvasBBox.minY,\n          maxY = graphCanvasBBox.maxY;\n\n      if (dx > 0) {\n        if (maxX < -expandWidth) {\n          dx = 0;\n        } else if (maxX - dx < -expandWidth) {\n          dx = maxX + expandWidth;\n        }\n      } else if (dx < 0) {\n        if (minX > width + expandWidth) {\n          dx = 0;\n        } else if (minX - dx > width + expandWidth) {\n          dx = minX - (width + expandWidth);\n        }\n      }\n\n      if (dy > 0) {\n        if (maxY < -expandHeight) {\n          dy = 0;\n        } else if (maxY - dy < -expandHeight) {\n          dy = maxY + expandHeight;\n        }\n      } else if (dy < 0) {\n        if (minY > height + expandHeight) {\n          dy = 0;\n        } else if (minY - dy > height + expandHeight) {\n          dy = minY - (height + expandHeight);\n        }\n      }\n\n      if (this.get('direction') === 'x') {\n        dy = 0;\n      } else if (this.get('direction') === 'y') {\n        dx = 0;\n      }\n\n      graph.translate(-dx, -dy);\n    }\n\n    ev.preventDefault(); // hide the shapes when the zoom ratio is smaller than optimizeZoom\n    // hide the shapes when zoomming\n\n    var enableOptimize = this.get('enableOptimize');\n\n    if (enableOptimize) {\n      var optimizeZoom_1 = this.get('optimizeZoom');\n      var optimized = this.get('optimized');\n      var nodes_1 = graph.getNodes();\n      var edges_1 = graph.getEdges();\n      var nodesLength_1 = nodes_1.length;\n      var edgesLength_1 = edges_1.length; // hiding\n\n      if (!optimized) {\n        for (var n = 0; n < nodesLength_1; n++) {\n          var node = nodes_1[n];\n\n          if (!node.destroyed) {\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            for (var c = 0; c < childrenLength; c++) {\n              var shape = children[c];\n\n              if (!shape.destoryed && !shape.get('isKeyShape')) {\n                shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n                shape.hide();\n              }\n            }\n          }\n        }\n\n        for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n          var edge = edges_1[edgeIndex];\n          var children = edge.get('group').get('children');\n          var childrenLength = children.length;\n\n          for (var c = 0; c < childrenLength; c++) {\n            var shape = children[c];\n            shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n            shape.hide();\n          }\n        }\n\n        this.set('optimized', true);\n      } // showing after 100ms\n\n\n      clearTimeout(this.get('timeout'));\n      var timeout = setTimeout(function () {\n        var currentZoom = graph.getZoom();\n\n        var curOptimized = _this.get('optimized');\n\n        if (curOptimized) {\n          _this.set('optimized', false);\n\n          for (var n = 0; n < nodesLength_1; n++) {\n            var node = nodes_1[n];\n            var children = node.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = node.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n                var oriVis = shape.get('ori-visibility');\n\n                if (!shape.get('visible') && oriVis) {\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n\n          for (var edgeIndex = 0; edgeIndex < edgesLength_1; edgeIndex++) {\n            var edge = edges_1[edgeIndex];\n            var children = edge.get('group').get('children');\n            var childrenLength = children.length;\n\n            if (currentZoom < optimizeZoom_1) {\n              var keyShape = edge.getKeyShape();\n              var oriVis = keyShape.get('ori-visibility');\n              if (oriVis) keyShape.show();\n            } else {\n              for (var c = 0; c < childrenLength; c++) {\n                var shape = children[c];\n\n                if (!shape.get('visible')) {\n                  var oriVis = shape.get('ori-visibility');\n                  if (oriVis) shape.show();\n                }\n              }\n            }\n          }\n        }\n      }, 100);\n      this.set('timeout', timeout);\n    }\n  }\n};"]},"metadata":{},"sourceType":"module"}