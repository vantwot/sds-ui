{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { View } from '../../view';\nexport class Widget extends View {\n  constructor(options) {\n    super();\n\n    const _a = options,\n          {\n      view,\n      cell,\n      node,\n      edge,\n      graph\n    } = _a,\n          localOptions = __rest(_a, [\"view\", \"cell\", \"node\", \"edge\", \"graph\"]);\n\n    if (view) {\n      this.view = view;\n      this.cell = view.cell;\n      this.graph = view.graph;\n      this.model = this.graph.model;\n    } else if ((cell || edge || node) && graph) {\n      this.cell = node || edge || cell;\n      this.view = graph.renderer.findViewByCell(this.cell);\n      this.graph = graph;\n      this.model = this.graph.model;\n    }\n\n    const ctor = this.constructor;\n\n    if (options.clearAll !== false) {\n      ctor.removeInstances(this.graph);\n    }\n\n    ctor.register(this);\n    this.init(localOptions);\n  }\n\n  static ensureCache() {\n    if (!this.instanceCache.has(this)) {\n      this.instanceCache.set(this, {});\n    }\n\n    return this.instanceCache.get(this);\n  }\n\n  static register(instance, graph) {\n    if (graph == null) {\n      // eslint-disable-next-line\n      graph = instance.graph;\n    }\n\n    const dic = this.ensureCache();\n    let cache = dic[graph.view.cid];\n\n    if (cache == null) {\n      cache = dic[graph.view.cid] = {};\n    }\n\n    cache[instance.cid] = instance;\n  }\n\n  static unregister(instance, graph) {\n    if (graph == null) {\n      // eslint-disable-next-line\n      graph = instance.graph;\n    }\n\n    const dic = this.ensureCache();\n\n    if (dic[graph.view.cid]) {\n      delete dic[graph.view.cid][instance.cid];\n    }\n  }\n\n  static removeInstances(graph) {\n    const dic = this.ensureCache();\n    const cache = dic[graph.view.cid];\n\n    if (cache) {\n      Object.keys(cache).forEach(cid => {\n        const instance = cache[cid];\n\n        if (instance) {\n          instance.remove();\n        }\n      });\n    }\n  }\n\n  static getInstances(graph) {\n    const dic = this.ensureCache();\n    return dic[graph.view.cid] || {};\n  }\n\n  init(options) {} // eslint-disable-line\n\n\n  render() {\n    return this;\n  }\n\n  startListening() {\n    if (this.options.clearOnBlankMouseDown !== false) {\n      this.graph.on('blank:mousedown', this.remove, this);\n    }\n  }\n\n  stopListening() {\n    if (this.options.clearOnBlankMouseDown !== false) {\n      this.graph.off('blank:mousedown', this.remove, this);\n    }\n  }\n\n  remove() {\n    this.stopListening();\n    const ctor = this.constructor;\n    ctor.unregister(this);\n    return super.remove();\n  }\n\n  dispose() {\n    this.remove();\n  }\n\n} // #region static\n\nWidget.instanceCache = new WeakMap();\n\n__decorate([View.dispose()], Widget.prototype, \"dispose\", null);","map":{"version":3,"sources":["../../../src/addon/common/widget.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { View } from '../../view';\nexport class Widget extends View {\n    constructor(options) {\n        super();\n        const _a = options, { view, cell, node, edge, graph } = _a, localOptions = __rest(_a, [\"view\", \"cell\", \"node\", \"edge\", \"graph\"]);\n        if (view) {\n            this.view = view;\n            this.cell = view.cell;\n            this.graph = view.graph;\n            this.model = this.graph.model;\n        }\n        else if ((cell || edge || node) && graph) {\n            this.cell = node || edge || cell;\n            this.view = graph.renderer.findViewByCell(this.cell);\n            this.graph = graph;\n            this.model = this.graph.model;\n        }\n        const ctor = this.constructor;\n        if (options.clearAll !== false) {\n            ctor.removeInstances(this.graph);\n        }\n        ctor.register(this);\n        this.init(localOptions);\n    }\n    static ensureCache() {\n        if (!this.instanceCache.has(this)) {\n            this.instanceCache.set(this, {});\n        }\n        return this.instanceCache.get(this);\n    }\n    static register(instance, graph) {\n        if (graph == null) {\n            // eslint-disable-next-line\n            graph = instance.graph;\n        }\n        const dic = this.ensureCache();\n        let cache = dic[graph.view.cid];\n        if (cache == null) {\n            cache = dic[graph.view.cid] = {};\n        }\n        cache[instance.cid] = instance;\n    }\n    static unregister(instance, graph) {\n        if (graph == null) {\n            // eslint-disable-next-line\n            graph = instance.graph;\n        }\n        const dic = this.ensureCache();\n        if (dic[graph.view.cid]) {\n            delete dic[graph.view.cid][instance.cid];\n        }\n    }\n    static removeInstances(graph) {\n        const dic = this.ensureCache();\n        const cache = dic[graph.view.cid];\n        if (cache) {\n            Object.keys(cache).forEach((cid) => {\n                const instance = cache[cid];\n                if (instance) {\n                    instance.remove();\n                }\n            });\n        }\n    }\n    static getInstances(graph) {\n        const dic = this.ensureCache();\n        return dic[graph.view.cid] || {};\n    }\n    init(options) { } // eslint-disable-line\n    render() {\n        return this;\n    }\n    startListening() {\n        if (this.options.clearOnBlankMouseDown !== false) {\n            this.graph.on('blank:mousedown', this.remove, this);\n        }\n    }\n    stopListening() {\n        if (this.options.clearOnBlankMouseDown !== false) {\n            this.graph.off('blank:mousedown', this.remove, this);\n        }\n    }\n    remove() {\n        this.stopListening();\n        const ctor = this.constructor;\n        ctor.unregister(this);\n        return super.remove();\n    }\n    dispose() {\n        this.remove();\n    }\n}\n// #region static\nWidget.instanceCache = new WeakMap();\n__decorate([\n    View.dispose()\n], Widget.prototype, \"dispose\", null);\n//# sourceMappingURL=widget.js.map"]},"metadata":{},"sourceType":"module"}