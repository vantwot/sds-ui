{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { StringExt, Dom, Vector } from '../util';\nimport { Filter } from '../registry';\nimport { Markup } from '../view';\nimport { Base } from './base';\nexport class DefsManager extends Base {\n  get cid() {\n    return this.graph.view.cid;\n  }\n\n  get svg() {\n    return this.view.svg;\n  }\n\n  get defs() {\n    return this.view.defs;\n  }\n\n  isDefined(id) {\n    return this.svg.getElementById(id) != null;\n  }\n\n  filter(options) {\n    let filterId = options.id;\n    const name = options.name;\n\n    if (!filterId) {\n      filterId = `filter-${name}-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n    }\n\n    if (!this.isDefined(filterId)) {\n      const fn = Filter.registry.get(name);\n\n      if (fn == null) {\n        return Filter.registry.onNotFound(name);\n      }\n\n      const markup = fn(options.args || {}); // Set the filter area to be 3x the bounding box of the cell\n      // and center the filter around the cell.\n\n      const attrs = Object.assign(Object.assign({\n        x: -1,\n        y: -1,\n        width: 3,\n        height: 3,\n        filterUnits: 'objectBoundingBox'\n      }, options.attrs), {\n        id: filterId\n      });\n      Vector.create(Markup.sanitize(markup), attrs).appendTo(this.defs);\n    }\n\n    return filterId;\n  }\n\n  gradient(options) {\n    let id = options.id;\n    const type = options.type;\n\n    if (!id) {\n      id = `gradient-${type}-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n    }\n\n    if (!this.isDefined(id)) {\n      const stops = options.stops;\n      const arr = stops.map(stop => {\n        const opacity = stop.opacity != null && Number.isFinite(stop.opacity) ? stop.opacity : 1;\n        return `<stop offset=\"${stop.offset}\" stop-color=\"${stop.color}\" stop-opacity=\"${opacity}\"/>`;\n      });\n      const markup = `<${type}>${arr.join('')}</${type}>`;\n      const attrs = Object.assign({\n        id\n      }, options.attrs);\n      Vector.create(markup, attrs).appendTo(this.defs);\n    }\n\n    return id;\n  }\n\n  marker(options) {\n    const {\n      id,\n      refX,\n      refY,\n      markerUnits,\n      markerOrient,\n      tagName,\n      children\n    } = options,\n          attrs = __rest(options, [\"id\", \"refX\", \"refY\", \"markerUnits\", \"markerOrient\", \"tagName\", \"children\"]);\n\n    let markerId = id;\n\n    if (!markerId) {\n      markerId = `marker-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n    }\n\n    if (!this.isDefined(markerId)) {\n      if (tagName !== 'path') {\n        // remove unnecessary d attribute inherit from standard edge.\n        delete attrs.d;\n      }\n\n      const pathMarker = Vector.create('marker', {\n        refX,\n        refY,\n        id: markerId,\n        overflow: 'visible',\n        orient: markerOrient != null ? markerOrient : 'auto',\n        markerUnits: markerUnits || 'userSpaceOnUse'\n      }, children ? children.map(_a => {\n        var {\n          tagName\n        } = _a,\n            other = __rest(_a, [\"tagName\"]);\n\n        return Vector.create(`${tagName}` || 'path', Dom.kebablizeAttrs(Object.assign(Object.assign({}, attrs), other)));\n      }) : [Vector.create(tagName || 'path', Dom.kebablizeAttrs(attrs))]);\n      this.defs.appendChild(pathMarker.node);\n    }\n\n    return markerId;\n  }\n\n  remove(id) {\n    const elem = this.svg.getElementById(id);\n\n    if (elem && elem.parentNode) {\n      elem.parentNode.removeChild(elem);\n    }\n  }\n\n}","map":{"version":3,"sources":["../../src/graph/defs.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { StringExt, Dom, Vector } from '../util';\nimport { Filter } from '../registry';\nimport { Markup } from '../view';\nimport { Base } from './base';\nexport class DefsManager extends Base {\n    get cid() {\n        return this.graph.view.cid;\n    }\n    get svg() {\n        return this.view.svg;\n    }\n    get defs() {\n        return this.view.defs;\n    }\n    isDefined(id) {\n        return this.svg.getElementById(id) != null;\n    }\n    filter(options) {\n        let filterId = options.id;\n        const name = options.name;\n        if (!filterId) {\n            filterId = `filter-${name}-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n        }\n        if (!this.isDefined(filterId)) {\n            const fn = Filter.registry.get(name);\n            if (fn == null) {\n                return Filter.registry.onNotFound(name);\n            }\n            const markup = fn(options.args || {});\n            // Set the filter area to be 3x the bounding box of the cell\n            // and center the filter around the cell.\n            const attrs = Object.assign(Object.assign({ x: -1, y: -1, width: 3, height: 3, filterUnits: 'objectBoundingBox' }, options.attrs), { id: filterId });\n            Vector.create(Markup.sanitize(markup), attrs).appendTo(this.defs);\n        }\n        return filterId;\n    }\n    gradient(options) {\n        let id = options.id;\n        const type = options.type;\n        if (!id) {\n            id = `gradient-${type}-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n        }\n        if (!this.isDefined(id)) {\n            const stops = options.stops;\n            const arr = stops.map((stop) => {\n                const opacity = stop.opacity != null && Number.isFinite(stop.opacity)\n                    ? stop.opacity\n                    : 1;\n                return `<stop offset=\"${stop.offset}\" stop-color=\"${stop.color}\" stop-opacity=\"${opacity}\"/>`;\n            });\n            const markup = `<${type}>${arr.join('')}</${type}>`;\n            const attrs = Object.assign({ id }, options.attrs);\n            Vector.create(markup, attrs).appendTo(this.defs);\n        }\n        return id;\n    }\n    marker(options) {\n        const { id, refX, refY, markerUnits, markerOrient, tagName, children } = options, attrs = __rest(options, [\"id\", \"refX\", \"refY\", \"markerUnits\", \"markerOrient\", \"tagName\", \"children\"]);\n        let markerId = id;\n        if (!markerId) {\n            markerId = `marker-${this.cid}-${StringExt.hashcode(JSON.stringify(options))}`;\n        }\n        if (!this.isDefined(markerId)) {\n            if (tagName !== 'path') {\n                // remove unnecessary d attribute inherit from standard edge.\n                delete attrs.d;\n            }\n            const pathMarker = Vector.create('marker', {\n                refX,\n                refY,\n                id: markerId,\n                overflow: 'visible',\n                orient: markerOrient != null ? markerOrient : 'auto',\n                markerUnits: markerUnits || 'userSpaceOnUse',\n            }, children\n                ? children.map((_a) => {\n                    var { tagName } = _a, other = __rest(_a, [\"tagName\"]);\n                    return Vector.create(`${tagName}` || 'path', Dom.kebablizeAttrs(Object.assign(Object.assign({}, attrs), other)));\n                })\n                : [Vector.create(tagName || 'path', Dom.kebablizeAttrs(attrs))]);\n            this.defs.appendChild(pathMarker.node);\n        }\n        return markerId;\n    }\n    remove(id) {\n        const elem = this.svg.getElementById(id);\n        if (elem && elem.parentNode) {\n            elem.parentNode.removeChild(elem);\n        }\n    }\n}\n//# sourceMappingURL=defs.js.map"]},"metadata":{},"sourceType":"module"}