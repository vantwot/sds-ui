{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { ManaSyringe, DisposableCollection, MenuItemType, IModelContribution, IModelService, RxModel, Disposable } from '@antv/xflow-core';\nimport { MODELS } from '@antv/xflow-core';\nimport { CONTEXT_MENU_MODEL } from '../interface';\nimport { ContextMenuConfig } from '../config';\nconst {\n  inject,\n  singleton\n} = ManaSyringe;\n/**\n * IModelContribution\n */\n\nlet CanvasContextMenuContribution = class CanvasContextMenuContribution {\n  constructor() {\n    /** 注册 model */\n    this.toDispose = new DisposableCollection();\n    /** 获取 MenuModel */\n\n    this.getMenuModelValue = contextMenuInfo => __awaiter(this, void 0, void 0, function* () {\n      const config = yield this.menuConfig.getConfig();\n      /** 获取坐标 */\n\n      const {\n        anchor,\n        type,\n        cell\n      } = contextMenuInfo;\n      /** 获取Menu */\n\n      const toDispose = new DisposableCollection();\n      this.toDispose.push(toDispose);\n      const data = cell ? cell.getData() : null;\n      const menuModel = new RxModel({\n        id: 'menuroot',\n        type: MenuItemType.Root,\n        submenu: []\n      });\n      toDispose.push(Disposable.create(() => {\n        menuModel.dispose();\n      }));\n      const renderProps = {\n        toDispose,\n        anchor: anchor,\n        target: {\n          data,\n          type\n        },\n        customRender: null,\n        menuModel: menuModel\n      };\n\n      if (config.menuCustomRender) {\n        renderProps.customRender = yield config.menuCustomRender(contextMenuInfo, this.modelService);\n      }\n\n      if (config.menuModelService) {\n        yield config.menuModelService(contextMenuInfo, renderProps.menuModel, this.modelService, toDispose);\n      }\n\n      return renderProps;\n    });\n  }\n  /** 注册 MenuModel */\n\n\n  registerModel(registry) {\n    const toDispose = [registry.registerModel({\n      id: CONTEXT_MENU_MODEL.id,\n      getInitialValue: () => null,\n      watchChange: (self, modelService) => __awaiter(this, void 0, void 0, function* () {\n        const contextMenuModel = yield MODELS.CONTEXTMENU_TARGET.getModel(modelService);\n        return contextMenuModel.watch(contextMenuInfo => __awaiter(this, void 0, void 0, function* () {\n          const contextMenuValue = yield this.getMenuModelValue(contextMenuInfo);\n          self.setValue(contextMenuValue);\n        }));\n      })\n    })];\n    this.toDispose.pushAll(toDispose);\n  }\n\n};\n\n__decorate([inject(ContextMenuConfig), __metadata(\"design:type\", ContextMenuConfig)], CanvasContextMenuContribution.prototype, \"menuConfig\", void 0);\n\n__decorate([inject(IModelService), __metadata(\"design:type\", Object)], CanvasContextMenuContribution.prototype, \"modelService\", void 0);\n\nCanvasContextMenuContribution = __decorate([singleton({\n  contrib: [IModelContribution]\n})], CanvasContextMenuContribution);\nexport { CanvasContextMenuContribution };","map":{"version":3,"sources":["../../../src/canvas-context-menu/contributions/model.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ManaSyringe, DisposableCollection, MenuItemType, IModelContribution, IModelService, RxModel, Disposable, } from '@antv/xflow-core';\nimport { MODELS } from '@antv/xflow-core';\nimport { CONTEXT_MENU_MODEL } from '../interface';\nimport { ContextMenuConfig } from '../config';\nconst { inject, singleton } = ManaSyringe;\n/**\n * IModelContribution\n */\nlet CanvasContextMenuContribution = class CanvasContextMenuContribution {\n    constructor() {\n        /** 注册 model */\n        this.toDispose = new DisposableCollection();\n        /** 获取 MenuModel */\n        this.getMenuModelValue = (contextMenuInfo) => __awaiter(this, void 0, void 0, function* () {\n            const config = yield this.menuConfig.getConfig();\n            /** 获取坐标 */\n            const { anchor, type, cell } = contextMenuInfo;\n            /** 获取Menu */\n            const toDispose = new DisposableCollection();\n            this.toDispose.push(toDispose);\n            const data = cell ? cell.getData() : null;\n            const menuModel = new RxModel({\n                id: 'menuroot',\n                type: MenuItemType.Root,\n                submenu: [],\n            });\n            toDispose.push(Disposable.create(() => {\n                menuModel.dispose();\n            }));\n            const renderProps = {\n                toDispose,\n                anchor: anchor,\n                target: { data, type },\n                customRender: null,\n                menuModel: menuModel,\n            };\n            if (config.menuCustomRender) {\n                renderProps.customRender = yield config.menuCustomRender(contextMenuInfo, this.modelService);\n            }\n            if (config.menuModelService) {\n                yield config.menuModelService(contextMenuInfo, renderProps.menuModel, this.modelService, toDispose);\n            }\n            return renderProps;\n        });\n    }\n    /** 注册 MenuModel */\n    registerModel(registry) {\n        const toDispose = [\n            registry.registerModel({\n                id: CONTEXT_MENU_MODEL.id,\n                getInitialValue: () => null,\n                watchChange: (self, modelService) => __awaiter(this, void 0, void 0, function* () {\n                    const contextMenuModel = yield MODELS.CONTEXTMENU_TARGET.getModel(modelService);\n                    return contextMenuModel.watch((contextMenuInfo) => __awaiter(this, void 0, void 0, function* () {\n                        const contextMenuValue = yield this.getMenuModelValue(contextMenuInfo);\n                        self.setValue(contextMenuValue);\n                    }));\n                }),\n            }),\n        ];\n        this.toDispose.pushAll(toDispose);\n    }\n};\n__decorate([\n    inject(ContextMenuConfig),\n    __metadata(\"design:type\", ContextMenuConfig)\n], CanvasContextMenuContribution.prototype, \"menuConfig\", void 0);\n__decorate([\n    inject(IModelService),\n    __metadata(\"design:type\", Object)\n], CanvasContextMenuContribution.prototype, \"modelService\", void 0);\nCanvasContextMenuContribution = __decorate([\n    singleton({ contrib: [IModelContribution] })\n], CanvasContextMenuContribution);\nexport { CanvasContextMenuContribution };\n//# sourceMappingURL=model.js.map"]},"metadata":{},"sourceType":"module"}