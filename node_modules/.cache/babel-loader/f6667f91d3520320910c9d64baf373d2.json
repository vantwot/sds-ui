{"ast":null,"code":"import _createForOfIteratorHelper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nimport { singleton, contrib, Contribution } from 'mana-syringe';\nimport { DisposableCollection, Disposable } from '../common/disposable';\nimport { IFrontendApplicationContribution } from '../xflow-main/interface';\nimport { IMenuService, IMenuContribution } from './interface';\n\nvar MenuRegistry = /*#__PURE__*/function () {\n  function MenuRegistry() {\n    var _this = this;\n\n    _classCallCheck(this, MenuRegistry);\n\n    /** disposables */\n    this.toDispose = new DisposableCollection();\n    /** menuMap */\n\n    this.menuMap = new Map();\n    /**\n     * 获取 menu\n     * @param menuId menuId\n     */\n\n    this.getMenu = function (menuId) {\n      return _this.menuMap.get(menuId);\n    };\n    /**\n     * 注册一批可单独dispose的扩展项目\n     * @param externalRegisterFn IRegisterMenuFunction\n     */\n\n\n    this.registerDisposableMenu = function (externalRegisterFn) {\n      var toDispose = new DisposableCollection();\n      var disposableRegistry = {\n        registerMenu: function registerMenu(config) {\n          var disposable = _this.registerMenu(config);\n\n          toDispose.push(disposable);\n          return disposable;\n        }\n      };\n      externalRegisterFn(disposableRegistry);\n\n      _this.toDispose.push(toDispose);\n\n      return toDispose;\n    };\n  }\n  /** app启动时，收集menu扩展点的注册项 */\n\n\n  _createClass(MenuRegistry, [{\n    key: \"onStart\",\n    value: function onStart() {\n      var contributions = this.contributionProvider.getContributions();\n\n      var _iterator = _createForOfIteratorHelper(contributions),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var contribution = _step.value;\n          contribution.registerMenu(this);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    /** app的停止逻辑 */\n\n  }, {\n    key: \"onStop\",\n    value: function onStop() {\n      this.toDispose.dispose();\n    }\n    /**\n     * 注册 menu 类型\n     * @param config IMenu\n     */\n\n  }, {\n    key: \"registerMenu\",\n    value: function registerMenu(config) {\n      var _this2 = this;\n\n      this.menuMap.set(config.id, config);\n      return Disposable.create(function () {\n        return _this2.menuMap.delete(config.id);\n      });\n    }\n  }]);\n\n  return MenuRegistry;\n}();\n\n__decorate([contrib(IMenuContribution), __metadata(\"design:type\", Object)], MenuRegistry.prototype, \"contributionProvider\", void 0);\n\nMenuRegistry = __decorate([singleton({\n  contrib: [IFrontendApplicationContribution, IMenuService]\n})], MenuRegistry);\nexport { MenuRegistry };","map":{"version":3,"sources":["../../src/menu/menu-registry.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,SAAS,SAAT,EAAoB,OAApB,EAA6B,YAA7B,QAAiD,cAAjD;AACA,SAAS,oBAAT,EAA+B,UAA/B,QAAiD,sBAAjD;AACA,SAAS,gCAAT,QAAiD,yBAAjD;AAGA,SAAS,YAAT,EAAuB,iBAAvB,QAAgD,aAAhD;;AAGA,IAAa,YAAb;AAAA,0BAAA;AAAA;;AAAA;;AACE;AACQ,SAAA,SAAA,GAAY,IAAI,oBAAJ,EAAZ;AACR;;AACQ,SAAA,OAAA,GAAU,IAAI,GAAJ,EAAV;AAuBR;;;AAGG;;AACH,SAAA,OAAA,GAAU,UAAC,MAAD,EAAoB;AAC5B,aAAO,KAAI,CAAC,OAAL,CAAa,GAAb,CAAiB,MAAjB,CAAP;AACD,KAFD;AAGA;;;AAGG;;;AACH,SAAA,sBAAA,GAAyB,UAAC,kBAAD,EAA8C;AACrE,UAAM,SAAS,GAAG,IAAI,oBAAJ,EAAlB;AACA,UAAM,kBAAkB,GAAG;AACzB,QAAA,YAAY,EAAE,sBAAC,MAAD,EAAyB;AACrC,cAAM,UAAU,GAAG,KAAI,CAAC,YAAL,CAAkB,MAAlB,CAAnB;;AACA,UAAA,SAAS,CAAC,IAAV,CAAe,UAAf;AACA,iBAAO,UAAP;AACD;AALwB,OAA3B;AAOA,MAAA,kBAAkB,CAAC,kBAAD,CAAlB;;AACA,MAAA,KAAI,CAAC,SAAL,CAAe,IAAf,CAAoB,SAApB;;AACA,aAAO,SAAP;AACD,KAZD;AAaD;AA3CC;;;AARF;AAAA;AAAA,WASE,mBAAO;AACL,UAAM,aAAa,GAAG,KAAK,oBAAL,CAA0B,gBAA1B,EAAtB;;AADK,iDAEsB,aAFtB;AAAA;;AAAA;AAEL,4DAA0C;AAAA,cAA/B,YAA+B;AACxC,UAAA,YAAY,CAAC,YAAb,CAA0B,IAA1B;AACD;AAJI;AAAA;AAAA;AAAA;AAAA;AAKN;AACD;;AAfF;AAAA;AAAA,WAgBE,kBAAM;AACJ,WAAK,SAAL,CAAe,OAAf;AACD;AACD;;;AAGG;;AAtBL;AAAA;AAAA,WAuBE,sBAAa,MAAb,EAAiC;AAAA;;AAC/B,WAAK,OAAL,CAAa,GAAb,CAAiB,MAAM,CAAC,EAAxB,EAA4B,MAA5B;AACA,aAAO,UAAU,CAAC,MAAX,CAAkB;AAAA,eAAM,MAAI,CAAC,OAAL,CAAa,MAAb,CAAoB,MAAM,CAAC,EAA3B,CAAN;AAAA,OAAlB,CAAP;AACD;AA1BH;;AAAA;AAAA,GAAA;;AAOE,UAAA,CAAA,CADC,OAAO,CAAC,iBAAD,CACR,E,iCAAA,CAAA,E,sBAAA,E,sBAAA,E,KAAiF,CAAjF,CAAA;;AAPW,YAAY,GAAA,UAAA,CAAA,CADxB,SAAS,CAAC;AAAE,EAAA,OAAO,EAAE,CAAC,gCAAD,EAAmC,YAAnC;AAAX,CAAD,CACe,CAAA,EAAZ,YAAY,CAAZ;SAAA,Y","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { singleton, contrib, Contribution } from 'mana-syringe';\nimport { DisposableCollection, Disposable } from '../common/disposable';\nimport { IFrontendApplicationContribution } from '../xflow-main/interface';\nimport { IMenuService, IMenuContribution } from './interface';\nlet MenuRegistry = class MenuRegistry {\n    constructor() {\n        /** disposables */\n        this.toDispose = new DisposableCollection();\n        /** menuMap */\n        this.menuMap = new Map();\n        /**\n         * 获取 menu\n         * @param menuId menuId\n         */\n        this.getMenu = (menuId) => {\n            return this.menuMap.get(menuId);\n        };\n        /**\n         * 注册一批可单独dispose的扩展项目\n         * @param externalRegisterFn IRegisterMenuFunction\n         */\n        this.registerDisposableMenu = (externalRegisterFn) => {\n            const toDispose = new DisposableCollection();\n            const disposableRegistry = {\n                registerMenu: (config) => {\n                    const disposable = this.registerMenu(config);\n                    toDispose.push(disposable);\n                    return disposable;\n                },\n            };\n            externalRegisterFn(disposableRegistry);\n            this.toDispose.push(toDispose);\n            return toDispose;\n        };\n    }\n    /** app启动时，收集menu扩展点的注册项 */\n    onStart() {\n        const contributions = this.contributionProvider.getContributions();\n        for (const contribution of contributions) {\n            contribution.registerMenu(this);\n        }\n    }\n    /** app的停止逻辑 */\n    onStop() {\n        this.toDispose.dispose();\n    }\n    /**\n     * 注册 menu 类型\n     * @param config IMenu\n     */\n    registerMenu(config) {\n        this.menuMap.set(config.id, config);\n        return Disposable.create(() => this.menuMap.delete(config.id));\n    }\n};\n__decorate([\n    contrib(IMenuContribution),\n    __metadata(\"design:type\", Object)\n], MenuRegistry.prototype, \"contributionProvider\", void 0);\nMenuRegistry = __decorate([\n    singleton({ contrib: [IFrontendApplicationContribution, IMenuService] })\n], MenuRegistry);\nexport { MenuRegistry };\n//# sourceMappingURL=menu-registry.js.map"]},"metadata":{},"sourceType":"module"}