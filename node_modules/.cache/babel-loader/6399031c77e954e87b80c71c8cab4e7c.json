{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { useRef, useEffect } from 'react';\nimport { isEqual } from '@antv/util';\nimport createNode from '../util/createNode';\nimport { hasPath, isType, deepClone, clone, setPath } from '../util';\nexport default function useInit(ChartClass, config) {\n  var chart = useRef();\n  var chartOptions = useRef();\n  var container = useRef(null);\n  var onReady = config.onReady,\n      onEvent = config.onEvent;\n  /**\n   * Get data base64\n   * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n   * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n   */\n\n  var toDataURL = function toDataURL(type, encoderOptions) {\n    var _a;\n\n    if (type === void 0) {\n      type = 'image/png';\n    }\n\n    return (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n  };\n  /**\n   * Download Iamge\n   * @param {string} name A name of image\n   * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n   * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n   */\n\n\n  var downloadImage = function downloadImage(name, type, encoderOptions) {\n    var _a;\n\n    if (name === void 0) {\n      name = 'download';\n    }\n\n    if (type === void 0) {\n      type = 'image/png';\n    }\n\n    var imageName = name;\n\n    if (name.indexOf('.') === -1) {\n      imageName = \"\".concat(name, \".\").concat(type.split('/')[1]);\n    }\n\n    var base64 = (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n    var a = document.createElement('a');\n    a.href = base64;\n    a.download = imageName;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    a = null;\n    return imageName;\n  };\n\n  var reactDomToString = function reactDomToString(source, path, type) {\n    var statisticCustomHtml = hasPath(source, path);\n    setPath(source, path, function () {\n      var arg = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        arg[_i] = arguments[_i];\n      }\n\n      var statisticDom = isType(statisticCustomHtml, 'Function') ? statisticCustomHtml.apply(void 0, arg) : statisticCustomHtml;\n\n      if (isType(statisticDom, 'String') || isType(statisticDom, 'Number') || isType(statisticDom, 'HTMLDivElement')) {\n        return statisticDom;\n      }\n\n      return createNode(statisticDom, type);\n    });\n  };\n\n  var processConfig = function processConfig() {\n    // statistic\n    if (hasPath(config, ['statistic', 'content', 'customHtml'])) {\n      reactDomToString(config, ['statistic', 'content', 'customHtml']);\n    }\n\n    if (hasPath(config, ['statistic', 'title', 'customHtml'])) {\n      reactDomToString(config, ['statistic', 'title', 'customHtml']);\n    } // tooltip\n\n\n    if (typeof config.tooltip === 'object') {\n      if (hasPath(config, ['tooltip', 'container'])) {\n        reactDomToString(config, ['tooltip', 'container'], 'tooltip');\n      }\n\n      if (hasPath(config, ['tooltip', 'customContent'])) {\n        reactDomToString(config, ['tooltip', 'customContent'], 'tooltip');\n      }\n    }\n  };\n\n  useEffect(function () {\n    if (chart.current && !isEqual(chartOptions.current, config)) {\n      var changeData = false;\n\n      if (chartOptions.current) {\n        // 从 options 里面取出 data 、value 、 percent 进行比对，判断是否仅数值发生改变\n        var _a = chartOptions.current,\n            currentData = _a.data,\n            currentValue = _a.value,\n            currentPercent = _a.percent,\n            currentConfig = __rest(_a, [\"data\", \"value\", \"percent\"]);\n\n        var inputData = config.data,\n            inputValue = config.value,\n            inputPercent = config.percent,\n            inputConfig = __rest(config, [\"data\", \"value\", \"percent\"]);\n\n        changeData = isEqual(currentConfig, inputConfig);\n      }\n\n      if (changeData) {\n        var changeType_1 = 'data';\n        var typeMaps = ['percent']; // 特殊类型的图表 data 字段，例如 RingProgress\n\n        var currentKeys_1 = Object.keys(config);\n        typeMaps.forEach(function (type) {\n          if (currentKeys_1.includes(type)) {\n            changeType_1 = type;\n          }\n        });\n        chart.current.changeData((config === null || config === void 0 ? void 0 : config[changeType_1]) || []);\n      } else {\n        processConfig();\n        chart.current.update(config);\n      }\n\n      chartOptions.current = deepClone(config);\n    }\n  }, [config]);\n  useEffect(function () {\n    if (!container.current) {\n      return function () {\n        return null;\n      };\n    }\n\n    processConfig();\n    var chartInstance = new ChartClass(container.current, __assign({}, config));\n\n    ChartClass.__proto__.toDataURL = function (type, encoderOptions) {\n      return toDataURL(type, encoderOptions);\n    };\n\n    ChartClass.prototype.downloadImage = function (name, type, encoderOptions) {\n      return downloadImage(name, type, encoderOptions);\n    };\n\n    chartInstance.render();\n\n    if (!chartOptions.current) {\n      chartOptions.current = deepClone(config);\n    }\n\n    chart.current = clone(chartInstance);\n\n    if (onReady) {\n      onReady(chartInstance);\n    }\n\n    var handler = function handler(event) {\n      if (onEvent) {\n        onEvent(chartInstance, event);\n      }\n    };\n\n    chartInstance.on('*', handler); // 组件销毁时销毁图表\n\n    return function () {\n      if (chart.current) {\n        chart.current.destroy();\n        chart.current.off('*', handler);\n        chart.current = undefined;\n      }\n    };\n  }, []);\n  return {\n    chart: chart,\n    container: container\n  };\n}","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@ant-design/plots/es/hooks/useChart.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useRef","useEffect","isEqual","createNode","hasPath","isType","deepClone","clone","setPath","useInit","ChartClass","config","chart","chartOptions","container","onReady","onEvent","toDataURL","type","encoderOptions","_a","current","canvas","cfg","el","downloadImage","name","imageName","concat","split","base64","a","document","createElement","href","download","body","appendChild","click","removeChild","reactDomToString","source","path","statisticCustomHtml","arg","_i","statisticDom","processConfig","tooltip","changeData","currentData","data","currentValue","value","currentPercent","percent","currentConfig","inputData","inputValue","inputPercent","inputConfig","changeType_1","typeMaps","currentKeys_1","keys","forEach","includes","update","chartInstance","__proto__","render","handler","event","on","destroy","off","undefined"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { useRef, useEffect } from 'react';\nimport { isEqual } from '@antv/util';\nimport createNode from '../util/createNode';\nimport { hasPath, isType, deepClone, clone, setPath } from '../util';\nexport default function useInit(ChartClass, config) {\n    var chart = useRef();\n    var chartOptions = useRef();\n    var container = useRef(null);\n    var onReady = config.onReady, onEvent = config.onEvent;\n    /**\n     * Get data base64\n     * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n     * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n     */\n    var toDataURL = function (type, encoderOptions) {\n        var _a;\n        if (type === void 0) { type = 'image/png'; }\n        return (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n    };\n    /**\n     * Download Iamge\n     * @param {string} name A name of image\n     * @param {string} type A DOMString indicating the image format. The default format type is image/png.\n     * @param {number} encoderOptions A Number between 0 and 1 indicating the image quality\n     */\n    var downloadImage = function (name, type, encoderOptions) {\n        var _a;\n        if (name === void 0) { name = 'download'; }\n        if (type === void 0) { type = 'image/png'; }\n        var imageName = name;\n        if (name.indexOf('.') === -1) {\n            imageName = \"\".concat(name, \".\").concat(type.split('/')[1]);\n        }\n        var base64 = (_a = chart.current) === null || _a === void 0 ? void 0 : _a.chart.canvas.cfg.el.toDataURL(type, encoderOptions);\n        var a = document.createElement('a');\n        a.href = base64;\n        a.download = imageName;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        a = null;\n        return imageName;\n    };\n    var reactDomToString = function (source, path, type) {\n        var statisticCustomHtml = hasPath(source, path);\n        setPath(source, path, function () {\n            var arg = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                arg[_i] = arguments[_i];\n            }\n            var statisticDom = isType(statisticCustomHtml, 'Function') ? statisticCustomHtml.apply(void 0, arg) : statisticCustomHtml;\n            if (isType(statisticDom, 'String') || isType(statisticDom, 'Number') || isType(statisticDom, 'HTMLDivElement')) {\n                return statisticDom;\n            }\n            return createNode(statisticDom, type);\n        });\n    };\n    var processConfig = function () {\n        // statistic\n        if (hasPath(config, ['statistic', 'content', 'customHtml'])) {\n            reactDomToString(config, ['statistic', 'content', 'customHtml']);\n        }\n        if (hasPath(config, ['statistic', 'title', 'customHtml'])) {\n            reactDomToString(config, ['statistic', 'title', 'customHtml']);\n        }\n        // tooltip\n        if (typeof config.tooltip === 'object') {\n            if (hasPath(config, ['tooltip', 'container'])) {\n                reactDomToString(config, ['tooltip', 'container'], 'tooltip');\n            }\n            if (hasPath(config, ['tooltip', 'customContent'])) {\n                reactDomToString(config, ['tooltip', 'customContent'], 'tooltip');\n            }\n        }\n    };\n    useEffect(function () {\n        if (chart.current && !isEqual(chartOptions.current, config)) {\n            var changeData = false;\n            if (chartOptions.current) {\n                // 从 options 里面取出 data 、value 、 percent 进行比对，判断是否仅数值发生改变\n                var _a = chartOptions.current, currentData = _a.data, currentValue = _a.value, currentPercent = _a.percent, currentConfig = __rest(_a, [\"data\", \"value\", \"percent\"]);\n                var inputData = config.data, inputValue = config.value, inputPercent = config.percent, inputConfig = __rest(config, [\"data\", \"value\", \"percent\"]);\n                changeData = isEqual(currentConfig, inputConfig);\n            }\n            if (changeData) {\n                var changeType_1 = 'data';\n                var typeMaps = ['percent']; // 特殊类型的图表 data 字段，例如 RingProgress\n                var currentKeys_1 = Object.keys(config);\n                typeMaps.forEach(function (type) {\n                    if (currentKeys_1.includes(type)) {\n                        changeType_1 = type;\n                    }\n                });\n                chart.current.changeData((config === null || config === void 0 ? void 0 : config[changeType_1]) || []);\n            }\n            else {\n                processConfig();\n                chart.current.update(config);\n            }\n            chartOptions.current = deepClone(config);\n        }\n    }, [config]);\n    useEffect(function () {\n        if (!container.current) {\n            return function () { return null; };\n        }\n        processConfig();\n        var chartInstance = new ChartClass(container.current, __assign({}, config));\n        ChartClass.__proto__.toDataURL = function (type, encoderOptions) {\n            return toDataURL(type, encoderOptions);\n        };\n        ChartClass.prototype.downloadImage = function (name, type, encoderOptions) {\n            return downloadImage(name, type, encoderOptions);\n        };\n        chartInstance.render();\n        if (!chartOptions.current) {\n            chartOptions.current = deepClone(config);\n        }\n        chart.current = clone(chartInstance);\n        if (onReady) {\n            onReady(chartInstance);\n        }\n        var handler = function (event) {\n            if (onEvent) {\n                onEvent(chartInstance, event);\n            }\n        };\n        chartInstance.on('*', handler);\n        // 组件销毁时销毁图表\n        return function () {\n            if (chart.current) {\n                chart.current.destroy();\n                chart.current.off('*', handler);\n                chart.current = undefined;\n            }\n        };\n    }, []);\n    return {\n        chart: chart,\n        container: container,\n    };\n}\n"]},"metadata":{},"sourceType":"module"}