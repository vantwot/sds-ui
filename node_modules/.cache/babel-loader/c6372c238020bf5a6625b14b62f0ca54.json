{"ast":null,"code":"import { G6Event } from '@antv/g6-core';\nimport Util from '../util';\nvar cloneEvent = Util.cloneEvent,\n    isNaN = Util.isNaN;\nvar abs = Math.abs;\nvar DRAG_OFFSET = 10;\nvar ALLOW_EVENTS = ['shift', 'ctrl', 'alt', 'control'];\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      direction: 'both',\n      enableOptimize: false,\n      // drag-canvas 可拖动的扩展范围，默认为 0，即最多可以拖动一屏的位置\n      // 当设置的值大于 0 时，即拖动可以超过一屏\n      // 当设置的值小于 0 时，相当于缩小了可拖动范围\n      // 具体实例可参考：https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*IFfoS67_HssAAAAAAAAAAAAAARQnAQ\n      scalableRange: 0,\n      allowDragOnItem: false\n    };\n  },\n  getEvents: function getEvents() {\n    return {\n      dragstart: 'onMouseDown',\n      drag: 'onMouseMove',\n      dragend: 'onMouseUp',\n      'canvas:click': 'onMouseUp',\n      keyup: 'onKeyUp',\n      focus: 'onKeyUp',\n      keydown: 'onKeyDown',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onMouseUp'\n    };\n  },\n  updateViewport: function updateViewport(e) {\n    var origin = this.origin;\n    var clientX = +e.clientX;\n    var clientY = +e.clientY;\n\n    if (isNaN(clientX) || isNaN(clientY)) {\n      return;\n    }\n\n    var dx = clientX - origin.x;\n    var dy = clientY - origin.y;\n\n    if (this.get('direction') === 'x') {\n      dy = 0;\n    } else if (this.get('direction') === 'y') {\n      dx = 0;\n    }\n\n    this.origin = {\n      x: clientX,\n      y: clientY\n    };\n    var width = this.graph.get('width');\n    var height = this.graph.get('height');\n    var graphCanvasBBox = this.graph.get('canvas').getCanvasBBox();\n    var expandWidth = this.scalableRange;\n    var expandHeight = this.scalableRange; // 若 scalableRange 是 0~1 的小数，则作为比例考虑\n\n    if (expandWidth < 1 && expandWidth > -1) {\n      expandWidth = width * expandWidth;\n      expandHeight = height * expandHeight;\n    }\n\n    if (graphCanvasBBox.minX <= width + expandWidth && graphCanvasBBox.minX + dx > width + expandWidth || graphCanvasBBox.maxX + expandWidth >= 0 && graphCanvasBBox.maxX + expandWidth + dx < 0) {\n      dx = 0;\n    }\n\n    if (graphCanvasBBox.minY <= height + expandHeight && graphCanvasBBox.minY + dy > height + expandHeight || graphCanvasBBox.maxY + expandHeight >= 0 && graphCanvasBBox.maxY + expandHeight + dy < 0) {\n      dy = 0;\n    }\n\n    this.graph.translate(dx, dy);\n  },\n  onTouchStart: function onTouchStart(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布\n\n    if (event1 && event2) {\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseDown(e);\n  },\n  onMouseDown: function onMouseDown(e) {\n    var self = this;\n    var event = e.originalEvent;\n\n    if (event && e.name !== G6Event.TOUCHSTART && event.button !== 0) {\n      return;\n    }\n\n    if (e.name !== G6Event.TOUCHSTART && typeof window !== 'undefined' && window.event && !window.event.buttons && !window.event.button) {\n      return;\n    }\n\n    if (!this.shouldBegin.call(this, e)) {\n      return;\n    }\n\n    if (self.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    self.origin = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    self.dragging = false;\n\n    if (this.enableOptimize) {\n      // 拖动 canvas 过程中隐藏所有的边及label\n      var graph = this.graph;\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n          shape.hide();\n        });\n      }\n\n      var nodes = graph.getNodes();\n\n      for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n        var container = nodes[j].getContainer();\n        var children = container.get('children');\n\n        for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n          var child = children_1[_i];\n          var isKeyShape = child.get('isKeyShape');\n\n          if (!isKeyShape) {\n            child.set('ori-visibility', child.get('ori-visibility') || child.get('visible'));\n            child.hide();\n          }\n        }\n      }\n    }\n  },\n  onTouchMove: function onTouchMove(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布，结束拖拽\n\n    if (event1 && event2) {\n      this.onMouseUp(e);\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseMove(e);\n  },\n  onMouseMove: function onMouseMove(e) {\n    var graph = this.graph;\n    if (this.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    e = cloneEvent(e);\n\n    if (!this.origin) {\n      return;\n    }\n\n    if (!this.dragging) {\n      if (abs(this.origin.x - e.clientX) + abs(this.origin.y - e.clientY) < DRAG_OFFSET) {\n        return;\n      }\n\n      if (this.shouldBegin.call(this, e)) {\n        e.type = 'dragstart';\n        graph.emit('canvas:dragstart', e);\n        this.originPosition = {\n          x: e.clientX,\n          y: e.clientY\n        };\n        this.dragging = true;\n      }\n    } else {\n      e.type = 'drag';\n      graph.emit('canvas:drag', e);\n    }\n\n    if (this.shouldUpdate.call(this, e)) {\n      this.updateViewport(e);\n    }\n  },\n  onMouseUp: function onMouseUp(e) {\n    var _a, _b;\n\n    var graph = this.graph;\n    if (this.keydown) return;\n    var currentZoom = graph.getZoom();\n    var modeController = graph.get('modeController');\n    var zoomCanvas = (_b = (_a = modeController === null || modeController === void 0 ? void 0 : modeController.modes[modeController.mode]) === null || _a === void 0 ? void 0 : _a.filter(function (behavior) {\n      return behavior.type === 'zoom-canvas';\n    })) === null || _b === void 0 ? void 0 : _b[0];\n    var optimizeZoom = zoomCanvas ? zoomCanvas.optimizeZoom || 0.1 : 0;\n\n    if (this.enableOptimize) {\n      // 拖动结束后显示所有的边\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          var oriVis = shape.get('ori-visibility');\n          if (oriVis) shape.show();\n        });\n      }\n\n      if (currentZoom > optimizeZoom) {\n        var nodes = graph.getNodes();\n\n        for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n          var container = nodes[j].getContainer();\n          var children = container.get('children');\n\n          for (var _i = 0, children_2 = children; _i < children_2.length; _i++) {\n            var child = children_2[_i];\n            var isKeyShape = child.get('isKeyShape');\n\n            if (!isKeyShape) {\n              var oriVis = child.get('ori-visibility');\n              if (oriVis) child.show();\n            }\n          }\n        }\n      }\n    }\n\n    if (!this.dragging) {\n      this.origin = null;\n      return;\n    }\n\n    e = cloneEvent(e);\n\n    if (this.shouldEnd.call(this, e)) {\n      this.updateViewport(e);\n    }\n\n    e.type = 'dragend';\n    e.dx = e.clientX - this.originPosition.x;\n    e.dy = e.clientY - this.originPosition.y;\n    graph.emit('canvas:dragend', e);\n    this.endDrag();\n  },\n  endDrag: function endDrag() {\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  },\n  onKeyDown: function onKeyDown(e) {\n    var self = this;\n    var code = e.key;\n\n    if (!code) {\n      return;\n    }\n\n    if (ALLOW_EVENTS.indexOf(code.toLowerCase()) > -1) {\n      self.keydown = true;\n    } else {\n      self.keydown = false;\n    }\n  },\n  onKeyUp: function onKeyUp() {\n    this.keydown = false;\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  }\n};","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@antv/g6-pc/es/behavior/drag-canvas.js"],"names":["G6Event","Util","cloneEvent","isNaN","abs","Math","DRAG_OFFSET","ALLOW_EVENTS","getDefaultCfg","direction","enableOptimize","scalableRange","allowDragOnItem","getEvents","dragstart","drag","dragend","keyup","focus","keydown","touchstart","touchmove","touchend","updateViewport","e","origin","clientX","clientY","dx","x","dy","y","get","width","graph","height","graphCanvasBBox","getCanvasBBox","expandWidth","expandHeight","minX","maxX","minY","maxY","translate","onTouchStart","self","touches","originalEvent","event1","event2","preventDefault","onMouseDown","event","name","TOUCHSTART","button","window","buttons","shouldBegin","call","target","targetIsCanvas","isCanvas","dragging","edges","getEdges","i","len","length","shapes","forEach","shape","set","hide","nodes","getNodes","j","nodeLen","container","getContainer","children","_i","children_1","child","isKeyShape","onTouchMove","onMouseUp","onMouseMove","type","emit","originPosition","shouldUpdate","_a","_b","currentZoom","getZoom","modeController","zoomCanvas","modes","mode","filter","behavior","optimizeZoom","oriVis","show","children_2","shouldEnd","endDrag","dragbegin","onKeyDown","code","key","indexOf","toLowerCase","onKeyUp"],"mappings":"AAAA,SAASA,OAAT,QAAwB,eAAxB;AACA,OAAOC,IAAP,MAAiB,SAAjB;AACA,IAAIC,UAAU,GAAGD,IAAI,CAACC,UAAtB;AAAA,IACIC,KAAK,GAAGF,IAAI,CAACE,KADjB;AAEA,IAAIC,GAAG,GAAGC,IAAI,CAACD,GAAf;AACA,IAAIE,WAAW,GAAG,EAAlB;AACA,IAAIC,YAAY,GAAG,CAAC,OAAD,EAAU,MAAV,EAAkB,KAAlB,EAAyB,SAAzB,CAAnB;AACA,eAAe;AACbC,EAAAA,aAAa,EAAE,SAASA,aAAT,GAAyB;AACtC,WAAO;AACLC,MAAAA,SAAS,EAAE,MADN;AAELC,MAAAA,cAAc,EAAE,KAFX;AAGL;AACA;AACA;AACA;AACAC,MAAAA,aAAa,EAAE,CAPV;AAQLC,MAAAA,eAAe,EAAE;AARZ,KAAP;AAUD,GAZY;AAabC,EAAAA,SAAS,EAAE,SAASA,SAAT,GAAqB;AAC9B,WAAO;AACLC,MAAAA,SAAS,EAAE,aADN;AAELC,MAAAA,IAAI,EAAE,aAFD;AAGLC,MAAAA,OAAO,EAAE,WAHJ;AAIL,sBAAgB,WAJX;AAKLC,MAAAA,KAAK,EAAE,SALF;AAMLC,MAAAA,KAAK,EAAE,SANF;AAOLC,MAAAA,OAAO,EAAE,WAPJ;AAQLC,MAAAA,UAAU,EAAE,cARP;AASLC,MAAAA,SAAS,EAAE,aATN;AAULC,MAAAA,QAAQ,EAAE;AAVL,KAAP;AAYD,GA1BY;AA2BbC,EAAAA,cAAc,EAAE,SAASA,cAAT,CAAwBC,CAAxB,EAA2B;AACzC,QAAIC,MAAM,GAAG,KAAKA,MAAlB;AACA,QAAIC,OAAO,GAAG,CAACF,CAAC,CAACE,OAAjB;AACA,QAAIC,OAAO,GAAG,CAACH,CAAC,CAACG,OAAjB;;AAEA,QAAIxB,KAAK,CAACuB,OAAD,CAAL,IAAkBvB,KAAK,CAACwB,OAAD,CAA3B,EAAsC;AACpC;AACD;;AAED,QAAIC,EAAE,GAAGF,OAAO,GAAGD,MAAM,CAACI,CAA1B;AACA,QAAIC,EAAE,GAAGH,OAAO,GAAGF,MAAM,CAACM,CAA1B;;AAEA,QAAI,KAAKC,GAAL,CAAS,WAAT,MAA0B,GAA9B,EAAmC;AACjCF,MAAAA,EAAE,GAAG,CAAL;AACD,KAFD,MAEO,IAAI,KAAKE,GAAL,CAAS,WAAT,MAA0B,GAA9B,EAAmC;AACxCJ,MAAAA,EAAE,GAAG,CAAL;AACD;;AAED,SAAKH,MAAL,GAAc;AACZI,MAAAA,CAAC,EAAEH,OADS;AAEZK,MAAAA,CAAC,EAAEJ;AAFS,KAAd;AAIA,QAAIM,KAAK,GAAG,KAAKC,KAAL,CAAWF,GAAX,CAAe,OAAf,CAAZ;AACA,QAAIG,MAAM,GAAG,KAAKD,KAAL,CAAWF,GAAX,CAAe,QAAf,CAAb;AACA,QAAII,eAAe,GAAG,KAAKF,KAAL,CAAWF,GAAX,CAAe,QAAf,EAAyBK,aAAzB,EAAtB;AACA,QAAIC,WAAW,GAAG,KAAK3B,aAAvB;AACA,QAAI4B,YAAY,GAAG,KAAK5B,aAAxB,CA1ByC,CA0BF;;AAEvC,QAAI2B,WAAW,GAAG,CAAd,IAAmBA,WAAW,GAAG,CAAC,CAAtC,EAAyC;AACvCA,MAAAA,WAAW,GAAGL,KAAK,GAAGK,WAAtB;AACAC,MAAAA,YAAY,GAAGJ,MAAM,GAAGI,YAAxB;AACD;;AAED,QAAIH,eAAe,CAACI,IAAhB,IAAwBP,KAAK,GAAGK,WAAhC,IAA+CF,eAAe,CAACI,IAAhB,GAAuBZ,EAAvB,GAA4BK,KAAK,GAAGK,WAAnF,IAAkGF,eAAe,CAACK,IAAhB,GAAuBH,WAAvB,IAAsC,CAAtC,IAA2CF,eAAe,CAACK,IAAhB,GAAuBH,WAAvB,GAAqCV,EAArC,GAA0C,CAA3L,EAA8L;AAC5LA,MAAAA,EAAE,GAAG,CAAL;AACD;;AAED,QAAIQ,eAAe,CAACM,IAAhB,IAAwBP,MAAM,GAAGI,YAAjC,IAAiDH,eAAe,CAACM,IAAhB,GAAuBZ,EAAvB,GAA4BK,MAAM,GAAGI,YAAtF,IAAsGH,eAAe,CAACO,IAAhB,GAAuBJ,YAAvB,IAAuC,CAAvC,IAA4CH,eAAe,CAACO,IAAhB,GAAuBJ,YAAvB,GAAsCT,EAAtC,GAA2C,CAAjM,EAAoM;AAClMA,MAAAA,EAAE,GAAG,CAAL;AACD;;AAED,SAAKI,KAAL,CAAWU,SAAX,CAAqBhB,EAArB,EAAyBE,EAAzB;AACD,GArEY;AAsEbe,EAAAA,YAAY,EAAE,SAASA,YAAT,CAAsBrB,CAAtB,EAAyB;AACrC,QAAIsB,IAAI,GAAG,IAAX;AACA,QAAIC,OAAO,GAAGvB,CAAC,CAACwB,aAAF,CAAgBD,OAA9B;AACA,QAAIE,MAAM,GAAGF,OAAO,CAAC,CAAD,CAApB;AACA,QAAIG,MAAM,GAAGH,OAAO,CAAC,CAAD,CAApB,CAJqC,CAIZ;;AAEzB,QAAIE,MAAM,IAAIC,MAAd,EAAsB;AACpB;AACD;;AAED1B,IAAAA,CAAC,CAAC2B,cAAF;AACAL,IAAAA,IAAI,CAACM,WAAL,CAAiB5B,CAAjB;AACD,GAlFY;AAmFb4B,EAAAA,WAAW,EAAE,SAASA,WAAT,CAAqB5B,CAArB,EAAwB;AACnC,QAAIsB,IAAI,GAAG,IAAX;AACA,QAAIO,KAAK,GAAG7B,CAAC,CAACwB,aAAd;;AAEA,QAAIK,KAAK,IAAI7B,CAAC,CAAC8B,IAAF,KAAWtD,OAAO,CAACuD,UAA5B,IAA0CF,KAAK,CAACG,MAAN,KAAiB,CAA/D,EAAkE;AAChE;AACD;;AAED,QAAIhC,CAAC,CAAC8B,IAAF,KAAWtD,OAAO,CAACuD,UAAnB,IAAiC,OAAOE,MAAP,KAAkB,WAAnD,IAAkEA,MAAM,CAACJ,KAAzE,IAAkF,CAACI,MAAM,CAACJ,KAAP,CAAaK,OAAhG,IAA2G,CAACD,MAAM,CAACJ,KAAP,CAAaG,MAA7H,EAAqI;AACnI;AACD;;AAED,QAAI,CAAC,KAAKG,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,EAA4BpC,CAA5B,CAAL,EAAqC;AACnC;AACD;;AAED,QAAIsB,IAAI,CAAC3B,OAAT,EAAkB;AAClB,QAAI0C,MAAM,GAAGrC,CAAC,CAACqC,MAAf;AACA,QAAIC,cAAc,GAAGD,MAAM,IAAIA,MAAM,CAACE,QAAjB,IAA6BF,MAAM,CAACE,QAAP,EAAlD;AACA,QAAI,CAAC,KAAKnD,eAAN,IAAyB,CAACkD,cAA9B,EAA8C;AAC9ChB,IAAAA,IAAI,CAACrB,MAAL,GAAc;AACZI,MAAAA,CAAC,EAAEL,CAAC,CAACE,OADO;AAEZK,MAAAA,CAAC,EAAEP,CAAC,CAACG;AAFO,KAAd;AAIAmB,IAAAA,IAAI,CAACkB,QAAL,GAAgB,KAAhB;;AAEA,QAAI,KAAKtD,cAAT,EAAyB;AACvB;AACA,UAAIwB,KAAK,GAAG,KAAKA,KAAjB;AACA,UAAI+B,KAAK,GAAG/B,KAAK,CAACgC,QAAN,EAAZ;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,KAAK,CAACI,MAA5B,EAAoCF,CAAC,GAAGC,GAAxC,EAA6CD,CAAC,EAA9C,EAAkD;AAChD,YAAIG,MAAM,GAAGL,KAAK,CAACE,CAAD,CAAL,CAASnC,GAAT,CAAa,OAAb,EAAsBA,GAAtB,CAA0B,UAA1B,CAAb;AACA,YAAI,CAACsC,MAAL,EAAa;AACbA,QAAAA,MAAM,CAACC,OAAP,CAAe,UAAUC,KAAV,EAAiB;AAC9BA,UAAAA,KAAK,CAACC,GAAN,CAAU,gBAAV,EAA4BD,KAAK,CAACxC,GAAN,CAAU,gBAAV,KAA+BwC,KAAK,CAACxC,GAAN,CAAU,SAAV,CAA3D;AACAwC,UAAAA,KAAK,CAACE,IAAN;AACD,SAHD;AAID;;AAED,UAAIC,KAAK,GAAGzC,KAAK,CAAC0C,QAAN,EAAZ;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,OAAO,GAAGH,KAAK,CAACN,MAAhC,EAAwCQ,CAAC,GAAGC,OAA5C,EAAqDD,CAAC,EAAtD,EAA0D;AACxD,YAAIE,SAAS,GAAGJ,KAAK,CAACE,CAAD,CAAL,CAASG,YAAT,EAAhB;AACA,YAAIC,QAAQ,GAAGF,SAAS,CAAC/C,GAAV,CAAc,UAAd,CAAf;;AAEA,aAAK,IAAIkD,EAAE,GAAG,CAAT,EAAYC,UAAU,GAAGF,QAA9B,EAAwCC,EAAE,GAAGC,UAAU,CAACd,MAAxD,EAAgEa,EAAE,EAAlE,EAAsE;AACpE,cAAIE,KAAK,GAAGD,UAAU,CAACD,EAAD,CAAtB;AACA,cAAIG,UAAU,GAAGD,KAAK,CAACpD,GAAN,CAAU,YAAV,CAAjB;;AAEA,cAAI,CAACqD,UAAL,EAAiB;AACfD,YAAAA,KAAK,CAACX,GAAN,CAAU,gBAAV,EAA4BW,KAAK,CAACpD,GAAN,CAAU,gBAAV,KAA+BoD,KAAK,CAACpD,GAAN,CAAU,SAAV,CAA3D;AACAoD,YAAAA,KAAK,CAACV,IAAN;AACD;AACF;AACF;AACF;AACF,GA5IY;AA6IbY,EAAAA,WAAW,EAAE,SAASA,WAAT,CAAqB9D,CAArB,EAAwB;AACnC,QAAIsB,IAAI,GAAG,IAAX;AACA,QAAIC,OAAO,GAAGvB,CAAC,CAACwB,aAAF,CAAgBD,OAA9B;AACA,QAAIE,MAAM,GAAGF,OAAO,CAAC,CAAD,CAApB;AACA,QAAIG,MAAM,GAAGH,OAAO,CAAC,CAAD,CAApB,CAJmC,CAIV;;AAEzB,QAAIE,MAAM,IAAIC,MAAd,EAAsB;AACpB,WAAKqC,SAAL,CAAe/D,CAAf;AACA;AACD;;AAEDA,IAAAA,CAAC,CAAC2B,cAAF;AACAL,IAAAA,IAAI,CAAC0C,WAAL,CAAiBhE,CAAjB;AACD,GA1JY;AA2JbgE,EAAAA,WAAW,EAAE,SAASA,WAAT,CAAqBhE,CAArB,EAAwB;AACnC,QAAIU,KAAK,GAAG,KAAKA,KAAjB;AACA,QAAI,KAAKf,OAAT,EAAkB;AAClB,QAAI0C,MAAM,GAAGrC,CAAC,CAACqC,MAAf;AACA,QAAIC,cAAc,GAAGD,MAAM,IAAIA,MAAM,CAACE,QAAjB,IAA6BF,MAAM,CAACE,QAAP,EAAlD;AACA,QAAI,CAAC,KAAKnD,eAAN,IAAyB,CAACkD,cAA9B,EAA8C;AAC9CtC,IAAAA,CAAC,GAAGtB,UAAU,CAACsB,CAAD,CAAd;;AAEA,QAAI,CAAC,KAAKC,MAAV,EAAkB;AAChB;AACD;;AAED,QAAI,CAAC,KAAKuC,QAAV,EAAoB;AAClB,UAAI5D,GAAG,CAAC,KAAKqB,MAAL,CAAYI,CAAZ,GAAgBL,CAAC,CAACE,OAAnB,CAAH,GAAiCtB,GAAG,CAAC,KAAKqB,MAAL,CAAYM,CAAZ,GAAgBP,CAAC,CAACG,OAAnB,CAApC,GAAkErB,WAAtE,EAAmF;AACjF;AACD;;AAED,UAAI,KAAKqD,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,EAA4BpC,CAA5B,CAAJ,EAAoC;AAClCA,QAAAA,CAAC,CAACiE,IAAF,GAAS,WAAT;AACAvD,QAAAA,KAAK,CAACwD,IAAN,CAAW,kBAAX,EAA+BlE,CAA/B;AACA,aAAKmE,cAAL,GAAsB;AACpB9D,UAAAA,CAAC,EAAEL,CAAC,CAACE,OADe;AAEpBK,UAAAA,CAAC,EAAEP,CAAC,CAACG;AAFe,SAAtB;AAIA,aAAKqC,QAAL,GAAgB,IAAhB;AACD;AACF,KAdD,MAcO;AACLxC,MAAAA,CAAC,CAACiE,IAAF,GAAS,MAAT;AACAvD,MAAAA,KAAK,CAACwD,IAAN,CAAW,aAAX,EAA0BlE,CAA1B;AACD;;AAED,QAAI,KAAKoE,YAAL,CAAkBhC,IAAlB,CAAuB,IAAvB,EAA6BpC,CAA7B,CAAJ,EAAqC;AACnC,WAAKD,cAAL,CAAoBC,CAApB;AACD;AACF,GA7LY;AA8Lb+D,EAAAA,SAAS,EAAE,SAASA,SAAT,CAAmB/D,CAAnB,EAAsB;AAC/B,QAAIqE,EAAJ,EAAQC,EAAR;;AAEA,QAAI5D,KAAK,GAAG,KAAKA,KAAjB;AACA,QAAI,KAAKf,OAAT,EAAkB;AAClB,QAAI4E,WAAW,GAAG7D,KAAK,CAAC8D,OAAN,EAAlB;AACA,QAAIC,cAAc,GAAG/D,KAAK,CAACF,GAAN,CAAU,gBAAV,CAArB;AACA,QAAIkE,UAAU,GAAG,CAACJ,EAAE,GAAG,CAACD,EAAE,GAAGI,cAAc,KAAK,IAAnB,IAA2BA,cAAc,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,cAAc,CAACE,KAAf,CAAqBF,cAAc,CAACG,IAApC,CAAtE,MAAqH,IAArH,IAA6HP,EAAE,KAAK,KAAK,CAAzI,GAA6I,KAAK,CAAlJ,GAAsJA,EAAE,CAACQ,MAAH,CAAU,UAAUC,QAAV,EAAoB;AACzM,aAAOA,QAAQ,CAACb,IAAT,KAAkB,aAAzB;AACD,KAF4K,CAA5J,MAET,IAFS,IAEDK,EAAE,KAAK,KAAK,CAFX,GAEe,KAAK,CAFpB,GAEwBA,EAAE,CAAC,CAAD,CAF3C;AAGA,QAAIS,YAAY,GAAGL,UAAU,GAAGA,UAAU,CAACK,YAAX,IAA2B,GAA9B,GAAoC,CAAjE;;AAEA,QAAI,KAAK7F,cAAT,EAAyB;AACvB;AACA,UAAIuD,KAAK,GAAG/B,KAAK,CAACgC,QAAN,EAAZ;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,KAAK,CAACI,MAA5B,EAAoCF,CAAC,GAAGC,GAAxC,EAA6CD,CAAC,EAA9C,EAAkD;AAChD,YAAIG,MAAM,GAAGL,KAAK,CAACE,CAAD,CAAL,CAASnC,GAAT,CAAa,OAAb,EAAsBA,GAAtB,CAA0B,UAA1B,CAAb;AACA,YAAI,CAACsC,MAAL,EAAa;AACbA,QAAAA,MAAM,CAACC,OAAP,CAAe,UAAUC,KAAV,EAAiB;AAC9B,cAAIgC,MAAM,GAAGhC,KAAK,CAACxC,GAAN,CAAU,gBAAV,CAAb;AACA,cAAIwE,MAAJ,EAAYhC,KAAK,CAACiC,IAAN;AACb,SAHD;AAID;;AAED,UAAIV,WAAW,GAAGQ,YAAlB,EAAgC;AAC9B,YAAI5B,KAAK,GAAGzC,KAAK,CAAC0C,QAAN,EAAZ;;AAEA,aAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,OAAO,GAAGH,KAAK,CAACN,MAAhC,EAAwCQ,CAAC,GAAGC,OAA5C,EAAqDD,CAAC,EAAtD,EAA0D;AACxD,cAAIE,SAAS,GAAGJ,KAAK,CAACE,CAAD,CAAL,CAASG,YAAT,EAAhB;AACA,cAAIC,QAAQ,GAAGF,SAAS,CAAC/C,GAAV,CAAc,UAAd,CAAf;;AAEA,eAAK,IAAIkD,EAAE,GAAG,CAAT,EAAYwB,UAAU,GAAGzB,QAA9B,EAAwCC,EAAE,GAAGwB,UAAU,CAACrC,MAAxD,EAAgEa,EAAE,EAAlE,EAAsE;AACpE,gBAAIE,KAAK,GAAGsB,UAAU,CAACxB,EAAD,CAAtB;AACA,gBAAIG,UAAU,GAAGD,KAAK,CAACpD,GAAN,CAAU,YAAV,CAAjB;;AAEA,gBAAI,CAACqD,UAAL,EAAiB;AACf,kBAAImB,MAAM,GAAGpB,KAAK,CAACpD,GAAN,CAAU,gBAAV,CAAb;AACA,kBAAIwE,MAAJ,EAAYpB,KAAK,CAACqB,IAAN;AACb;AACF;AACF;AACF;AACF;;AAED,QAAI,CAAC,KAAKzC,QAAV,EAAoB;AAClB,WAAKvC,MAAL,GAAc,IAAd;AACA;AACD;;AAEDD,IAAAA,CAAC,GAAGtB,UAAU,CAACsB,CAAD,CAAd;;AAEA,QAAI,KAAKmF,SAAL,CAAe/C,IAAf,CAAoB,IAApB,EAA0BpC,CAA1B,CAAJ,EAAkC;AAChC,WAAKD,cAAL,CAAoBC,CAApB;AACD;;AAEDA,IAAAA,CAAC,CAACiE,IAAF,GAAS,SAAT;AACAjE,IAAAA,CAAC,CAACI,EAAF,GAAOJ,CAAC,CAACE,OAAF,GAAY,KAAKiE,cAAL,CAAoB9D,CAAvC;AACAL,IAAAA,CAAC,CAACM,EAAF,GAAON,CAAC,CAACG,OAAF,GAAY,KAAKgE,cAAL,CAAoB5D,CAAvC;AACAG,IAAAA,KAAK,CAACwD,IAAN,CAAW,gBAAX,EAA6BlE,CAA7B;AACA,SAAKoF,OAAL;AACD,GA3PY;AA4PbA,EAAAA,OAAO,EAAE,SAASA,OAAT,GAAmB;AAC1B,SAAKnF,MAAL,GAAc,IAAd;AACA,SAAKuC,QAAL,GAAgB,KAAhB;AACA,SAAK6C,SAAL,GAAiB,KAAjB;AACD,GAhQY;AAiQbC,EAAAA,SAAS,EAAE,SAASA,SAAT,CAAmBtF,CAAnB,EAAsB;AAC/B,QAAIsB,IAAI,GAAG,IAAX;AACA,QAAIiE,IAAI,GAAGvF,CAAC,CAACwF,GAAb;;AAEA,QAAI,CAACD,IAAL,EAAW;AACT;AACD;;AAED,QAAIxG,YAAY,CAAC0G,OAAb,CAAqBF,IAAI,CAACG,WAAL,EAArB,IAA2C,CAAC,CAAhD,EAAmD;AACjDpE,MAAAA,IAAI,CAAC3B,OAAL,GAAe,IAAf;AACD,KAFD,MAEO;AACL2B,MAAAA,IAAI,CAAC3B,OAAL,GAAe,KAAf;AACD;AACF,GA9QY;AA+QbgG,EAAAA,OAAO,EAAE,SAASA,OAAT,GAAmB;AAC1B,SAAKhG,OAAL,GAAe,KAAf;AACA,SAAKM,MAAL,GAAc,IAAd;AACA,SAAKuC,QAAL,GAAgB,KAAhB;AACA,SAAK6C,SAAL,GAAiB,KAAjB;AACD;AApRY,CAAf","sourcesContent":["import { G6Event } from '@antv/g6-core';\nimport Util from '../util';\nvar cloneEvent = Util.cloneEvent,\n    isNaN = Util.isNaN;\nvar abs = Math.abs;\nvar DRAG_OFFSET = 10;\nvar ALLOW_EVENTS = ['shift', 'ctrl', 'alt', 'control'];\nexport default {\n  getDefaultCfg: function getDefaultCfg() {\n    return {\n      direction: 'both',\n      enableOptimize: false,\n      // drag-canvas 可拖动的扩展范围，默认为 0，即最多可以拖动一屏的位置\n      // 当设置的值大于 0 时，即拖动可以超过一屏\n      // 当设置的值小于 0 时，相当于缩小了可拖动范围\n      // 具体实例可参考：https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*IFfoS67_HssAAAAAAAAAAAAAARQnAQ\n      scalableRange: 0,\n      allowDragOnItem: false\n    };\n  },\n  getEvents: function getEvents() {\n    return {\n      dragstart: 'onMouseDown',\n      drag: 'onMouseMove',\n      dragend: 'onMouseUp',\n      'canvas:click': 'onMouseUp',\n      keyup: 'onKeyUp',\n      focus: 'onKeyUp',\n      keydown: 'onKeyDown',\n      touchstart: 'onTouchStart',\n      touchmove: 'onTouchMove',\n      touchend: 'onMouseUp'\n    };\n  },\n  updateViewport: function updateViewport(e) {\n    var origin = this.origin;\n    var clientX = +e.clientX;\n    var clientY = +e.clientY;\n\n    if (isNaN(clientX) || isNaN(clientY)) {\n      return;\n    }\n\n    var dx = clientX - origin.x;\n    var dy = clientY - origin.y;\n\n    if (this.get('direction') === 'x') {\n      dy = 0;\n    } else if (this.get('direction') === 'y') {\n      dx = 0;\n    }\n\n    this.origin = {\n      x: clientX,\n      y: clientY\n    };\n    var width = this.graph.get('width');\n    var height = this.graph.get('height');\n    var graphCanvasBBox = this.graph.get('canvas').getCanvasBBox();\n    var expandWidth = this.scalableRange;\n    var expandHeight = this.scalableRange; // 若 scalableRange 是 0~1 的小数，则作为比例考虑\n\n    if (expandWidth < 1 && expandWidth > -1) {\n      expandWidth = width * expandWidth;\n      expandHeight = height * expandHeight;\n    }\n\n    if (graphCanvasBBox.minX <= width + expandWidth && graphCanvasBBox.minX + dx > width + expandWidth || graphCanvasBBox.maxX + expandWidth >= 0 && graphCanvasBBox.maxX + expandWidth + dx < 0) {\n      dx = 0;\n    }\n\n    if (graphCanvasBBox.minY <= height + expandHeight && graphCanvasBBox.minY + dy > height + expandHeight || graphCanvasBBox.maxY + expandHeight >= 0 && graphCanvasBBox.maxY + expandHeight + dy < 0) {\n      dy = 0;\n    }\n\n    this.graph.translate(dx, dy);\n  },\n  onTouchStart: function onTouchStart(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布\n\n    if (event1 && event2) {\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseDown(e);\n  },\n  onMouseDown: function onMouseDown(e) {\n    var self = this;\n    var event = e.originalEvent;\n\n    if (event && e.name !== G6Event.TOUCHSTART && event.button !== 0) {\n      return;\n    }\n\n    if (e.name !== G6Event.TOUCHSTART && typeof window !== 'undefined' && window.event && !window.event.buttons && !window.event.button) {\n      return;\n    }\n\n    if (!this.shouldBegin.call(this, e)) {\n      return;\n    }\n\n    if (self.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    self.origin = {\n      x: e.clientX,\n      y: e.clientY\n    };\n    self.dragging = false;\n\n    if (this.enableOptimize) {\n      // 拖动 canvas 过程中隐藏所有的边及label\n      var graph = this.graph;\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          shape.set('ori-visibility', shape.get('ori-visibility') || shape.get('visible'));\n          shape.hide();\n        });\n      }\n\n      var nodes = graph.getNodes();\n\n      for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n        var container = nodes[j].getContainer();\n        var children = container.get('children');\n\n        for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {\n          var child = children_1[_i];\n          var isKeyShape = child.get('isKeyShape');\n\n          if (!isKeyShape) {\n            child.set('ori-visibility', child.get('ori-visibility') || child.get('visible'));\n            child.hide();\n          }\n        }\n      }\n    }\n  },\n  onTouchMove: function onTouchMove(e) {\n    var self = this;\n    var touches = e.originalEvent.touches;\n    var event1 = touches[0];\n    var event2 = touches[1]; // 如果是双指操作，不允许拖拽画布，结束拖拽\n\n    if (event1 && event2) {\n      this.onMouseUp(e);\n      return;\n    }\n\n    e.preventDefault();\n    self.onMouseMove(e);\n  },\n  onMouseMove: function onMouseMove(e) {\n    var graph = this.graph;\n    if (this.keydown) return;\n    var target = e.target;\n    var targetIsCanvas = target && target.isCanvas && target.isCanvas();\n    if (!this.allowDragOnItem && !targetIsCanvas) return;\n    e = cloneEvent(e);\n\n    if (!this.origin) {\n      return;\n    }\n\n    if (!this.dragging) {\n      if (abs(this.origin.x - e.clientX) + abs(this.origin.y - e.clientY) < DRAG_OFFSET) {\n        return;\n      }\n\n      if (this.shouldBegin.call(this, e)) {\n        e.type = 'dragstart';\n        graph.emit('canvas:dragstart', e);\n        this.originPosition = {\n          x: e.clientX,\n          y: e.clientY\n        };\n        this.dragging = true;\n      }\n    } else {\n      e.type = 'drag';\n      graph.emit('canvas:drag', e);\n    }\n\n    if (this.shouldUpdate.call(this, e)) {\n      this.updateViewport(e);\n    }\n  },\n  onMouseUp: function onMouseUp(e) {\n    var _a, _b;\n\n    var graph = this.graph;\n    if (this.keydown) return;\n    var currentZoom = graph.getZoom();\n    var modeController = graph.get('modeController');\n    var zoomCanvas = (_b = (_a = modeController === null || modeController === void 0 ? void 0 : modeController.modes[modeController.mode]) === null || _a === void 0 ? void 0 : _a.filter(function (behavior) {\n      return behavior.type === 'zoom-canvas';\n    })) === null || _b === void 0 ? void 0 : _b[0];\n    var optimizeZoom = zoomCanvas ? zoomCanvas.optimizeZoom || 0.1 : 0;\n\n    if (this.enableOptimize) {\n      // 拖动结束后显示所有的边\n      var edges = graph.getEdges();\n\n      for (var i = 0, len = edges.length; i < len; i++) {\n        var shapes = edges[i].get('group').get('children');\n        if (!shapes) continue;\n        shapes.forEach(function (shape) {\n          var oriVis = shape.get('ori-visibility');\n          if (oriVis) shape.show();\n        });\n      }\n\n      if (currentZoom > optimizeZoom) {\n        var nodes = graph.getNodes();\n\n        for (var j = 0, nodeLen = nodes.length; j < nodeLen; j++) {\n          var container = nodes[j].getContainer();\n          var children = container.get('children');\n\n          for (var _i = 0, children_2 = children; _i < children_2.length; _i++) {\n            var child = children_2[_i];\n            var isKeyShape = child.get('isKeyShape');\n\n            if (!isKeyShape) {\n              var oriVis = child.get('ori-visibility');\n              if (oriVis) child.show();\n            }\n          }\n        }\n      }\n    }\n\n    if (!this.dragging) {\n      this.origin = null;\n      return;\n    }\n\n    e = cloneEvent(e);\n\n    if (this.shouldEnd.call(this, e)) {\n      this.updateViewport(e);\n    }\n\n    e.type = 'dragend';\n    e.dx = e.clientX - this.originPosition.x;\n    e.dy = e.clientY - this.originPosition.y;\n    graph.emit('canvas:dragend', e);\n    this.endDrag();\n  },\n  endDrag: function endDrag() {\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  },\n  onKeyDown: function onKeyDown(e) {\n    var self = this;\n    var code = e.key;\n\n    if (!code) {\n      return;\n    }\n\n    if (ALLOW_EVENTS.indexOf(code.toLowerCase()) > -1) {\n      self.keydown = true;\n    } else {\n      self.keydown = false;\n    }\n  },\n  onKeyUp: function onKeyUp() {\n    this.keydown = false;\n    this.origin = null;\n    this.dragging = false;\n    this.dragbegin = false;\n  }\n};"]},"metadata":{},"sourceType":"module"}