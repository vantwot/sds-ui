{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport { isString } from '@antv/util';\nimport insertCss from 'insert-css';\nimport Base from '../base';\ntypeof document !== 'undefined' && insertCss(\"\\n  .g6-component-contextmenu {\\n    border: 1px solid #e2e2e2;\\n    border-radius: 4px;\\n    font-size: 12px;\\n    color: #545454;\\n    background-color: rgba(255, 255, 255, 0.9);\\n    padding: 10px 8px;\\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\\n  }\\n  .g6-contextmenu-ul {\\n    padding: 0;\\n    margin: 0;\\n    list-style: none;\\n  }\\n\\n\");\n\nvar Menu =\n/** @class */\nfunction (_super) {\n  __extends(Menu, _super);\n\n  function Menu(config) {\n    return _super.call(this, config) || this;\n  }\n\n  Menu.prototype.getDefaultCfgs = function () {\n    return {\n      offsetX: 6,\n      offsetY: 6,\n      handleMenuClick: undefined,\n      // 指定菜单内容，function(e) {...}\n      getContent: function getContent(e) {\n        return \"\\n          <ul class='g6-contextmenu-ul'>\\n            <li>\\u83DC\\u5355\\u98791</li>\\n            <li>\\u83DC\\u5355\\u98792</li>\\n          </ul>\\n        \";\n      },\n      shouldBegin: function shouldBegin(e) {\n        return true;\n      },\n      // 菜单隐藏事件\n      onHide: function onHide() {\n        return true;\n      },\n      itemTypes: ['node', 'edge', 'combo'],\n      trigger: 'contextmenu'\n    };\n  }; // class-methods-use-this\n\n\n  Menu.prototype.getEvents = function () {\n    if (this.get('trigger') === 'click') {\n      return {\n        click: 'onMenuShow'\n      };\n    }\n\n    return {\n      contextmenu: 'onMenuShow'\n    };\n  };\n\n  Menu.prototype.init = function () {\n    var className = this.get('className');\n    var menu = createDom(\"<div class=\" + (className || 'g6-component-contextmenu') + \"></div>\");\n    modifyCSS(menu, {\n      top: '0px',\n      position: 'absolute',\n      visibility: 'hidden'\n    });\n    var container = this.get('container');\n\n    if (!container) {\n      container = this.get('graph').get('container');\n    }\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    container.appendChild(menu);\n    this.set('menu', menu);\n  };\n\n  Menu.prototype.onMenuShow = function (e) {\n    var self = this;\n    e.preventDefault();\n    var itemTypes = this.get('itemTypes');\n\n    if (!e.item) {\n      if (itemTypes.indexOf('canvas') === -1) {\n        self.onMenuHide();\n        return;\n      }\n    } else {\n      if (e.item && e.item.getType && itemTypes.indexOf(e.item.getType()) === -1) {\n        self.onMenuHide();\n        return;\n      }\n    }\n\n    var shouldBegin = this.get('shouldBegin');\n    if (!shouldBegin(e)) return;\n    var menuDom = this.get('menu');\n    var getContent = this.get('getContent');\n    var graph = this.get('graph');\n    var menu = getContent(e, graph);\n\n    if (isString(menu)) {\n      menuDom.innerHTML = menu;\n    } else {\n      menuDom.innerHTML = menu.outerHTML;\n    } // 清除之前监听的事件\n\n\n    this.removeMenuEventListener();\n    var handleMenuClick = this.get('handleMenuClick');\n\n    if (handleMenuClick) {\n      var handleMenuClickWrapper = function handleMenuClickWrapper(evt) {\n        handleMenuClick(evt.target, e.item, graph);\n      };\n\n      this.set('handleMenuClickWrapper', handleMenuClickWrapper);\n      menuDom.addEventListener('click', handleMenuClickWrapper);\n    }\n\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var bbox = menuDom.getBoundingClientRect();\n    var offsetX = this.get('offsetX') || 0;\n    var offsetY = this.get('offsetY') || 0;\n    var graphTop = graph.getContainer().offsetTop;\n    var graphLeft = graph.getContainer().offsetLeft;\n    var x = e.canvasX + graphLeft + offsetX;\n    var y = e.canvasY + graphTop + offsetY; // when the menu is (part of) out of the canvas\n\n    if (x + bbox.width > width) {\n      x = e.canvasX - bbox.width - offsetX + graphLeft;\n    }\n\n    if (y + bbox.height > height) {\n      y = e.canvasY - bbox.height - offsetY + graphTop;\n    }\n\n    modifyCSS(menuDom, {\n      top: y + \"px\",\n      left: x + \"px\",\n      visibility: 'visible'\n    }); // 左键单击会触发 body 上监听的 click 事件，导致菜单展示出来后又立即被隐藏了，需要过滤掉\n\n    var triggeredByFirstClick = this.get('trigger') === 'click';\n\n    var handler = function handler(evt) {\n      if (triggeredByFirstClick) {\n        triggeredByFirstClick = false;\n        return;\n      }\n\n      self.onMenuHide();\n    }; // 如果在页面中其他任意地方进行click, 隐去菜单\n\n\n    document.body.addEventListener('click', handler);\n    this.set('handler', handler);\n  };\n\n  Menu.prototype.removeMenuEventListener = function () {\n    var handleMenuClickWrapper = this.get('handleMenuClickWrapper');\n    var handler = this.get('handler');\n\n    if (handleMenuClickWrapper) {\n      var menuDom = this.get('menu');\n      menuDom.removeEventListener('click', handleMenuClickWrapper);\n      this.set('handleMenuClickWrapper', null);\n    }\n\n    if (handler) {\n      document.body.removeEventListener('click', handler);\n    }\n  };\n\n  Menu.prototype.onMenuHide = function () {\n    var menuDom = this.get('menu');\n\n    if (menuDom) {\n      modifyCSS(menuDom, {\n        visibility: 'hidden'\n      });\n    } // 隐藏菜单后需要移除事件监听\n\n\n    this.removeMenuEventListener();\n  };\n\n  Menu.prototype.destroy = function () {\n    var menu = this.get('menu');\n    this.removeMenuEventListener();\n\n    if (menu) {\n      var container = this.get('container');\n\n      if (!container) {\n        container = this.get('graph').get('container');\n      }\n\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      container.removeChild(menu);\n    }\n  };\n\n  return Menu;\n}(Base);\n\nexport default Menu;","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@antv/g6-plugin/es/menu/index.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","modifyCSS","createDom","isString","insertCss","Base","document","Menu","_super","config","getDefaultCfgs","offsetX","offsetY","handleMenuClick","undefined","getContent","e","shouldBegin","onHide","itemTypes","trigger","getEvents","get","click","contextmenu","init","className","menu","top","position","visibility","container","getElementById","appendChild","set","onMenuShow","self","preventDefault","item","indexOf","onMenuHide","getType","menuDom","graph","innerHTML","outerHTML","removeMenuEventListener","handleMenuClickWrapper","evt","target","addEventListener","width","height","bbox","getBoundingClientRect","graphTop","getContainer","offsetTop","graphLeft","offsetLeft","x","canvasX","y","canvasY","left","triggeredByFirstClick","handler","body","removeEventListener","destroy","removeChild"],"mappings":"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","sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { modifyCSS, createDom } from '@antv/dom-util';\nimport { isString } from '@antv/util';\nimport insertCss from 'insert-css';\nimport Base from '../base';\ntypeof document !== 'undefined' && insertCss(\"\\n  .g6-component-contextmenu {\\n    border: 1px solid #e2e2e2;\\n    border-radius: 4px;\\n    font-size: 12px;\\n    color: #545454;\\n    background-color: rgba(255, 255, 255, 0.9);\\n    padding: 10px 8px;\\n    box-shadow: rgb(174, 174, 174) 0px 0px 10px;\\n  }\\n  .g6-contextmenu-ul {\\n    padding: 0;\\n    margin: 0;\\n    list-style: none;\\n  }\\n\\n\");\n\nvar Menu =\n/** @class */\nfunction (_super) {\n  __extends(Menu, _super);\n\n  function Menu(config) {\n    return _super.call(this, config) || this;\n  }\n\n  Menu.prototype.getDefaultCfgs = function () {\n    return {\n      offsetX: 6,\n      offsetY: 6,\n      handleMenuClick: undefined,\n      // 指定菜单内容，function(e) {...}\n      getContent: function getContent(e) {\n        return \"\\n          <ul class='g6-contextmenu-ul'>\\n            <li>\\u83DC\\u5355\\u98791</li>\\n            <li>\\u83DC\\u5355\\u98792</li>\\n          </ul>\\n        \";\n      },\n      shouldBegin: function shouldBegin(e) {\n        return true;\n      },\n      // 菜单隐藏事件\n      onHide: function onHide() {\n        return true;\n      },\n      itemTypes: ['node', 'edge', 'combo'],\n      trigger: 'contextmenu'\n    };\n  }; // class-methods-use-this\n\n\n  Menu.prototype.getEvents = function () {\n    if (this.get('trigger') === 'click') {\n      return {\n        click: 'onMenuShow'\n      };\n    }\n\n    return {\n      contextmenu: 'onMenuShow'\n    };\n  };\n\n  Menu.prototype.init = function () {\n    var className = this.get('className');\n    var menu = createDom(\"<div class=\" + (className || 'g6-component-contextmenu') + \"></div>\");\n    modifyCSS(menu, {\n      top: '0px',\n      position: 'absolute',\n      visibility: 'hidden'\n    });\n    var container = this.get('container');\n\n    if (!container) {\n      container = this.get('graph').get('container');\n    }\n\n    if (isString(container)) {\n      container = document.getElementById(container);\n    }\n\n    container.appendChild(menu);\n    this.set('menu', menu);\n  };\n\n  Menu.prototype.onMenuShow = function (e) {\n    var self = this;\n    e.preventDefault();\n    var itemTypes = this.get('itemTypes');\n\n    if (!e.item) {\n      if (itemTypes.indexOf('canvas') === -1) {\n        self.onMenuHide();\n        return;\n      }\n    } else {\n      if (e.item && e.item.getType && itemTypes.indexOf(e.item.getType()) === -1) {\n        self.onMenuHide();\n        return;\n      }\n    }\n\n    var shouldBegin = this.get('shouldBegin');\n    if (!shouldBegin(e)) return;\n    var menuDom = this.get('menu');\n    var getContent = this.get('getContent');\n    var graph = this.get('graph');\n    var menu = getContent(e, graph);\n\n    if (isString(menu)) {\n      menuDom.innerHTML = menu;\n    } else {\n      menuDom.innerHTML = menu.outerHTML;\n    } // 清除之前监听的事件\n\n\n    this.removeMenuEventListener();\n    var handleMenuClick = this.get('handleMenuClick');\n\n    if (handleMenuClick) {\n      var handleMenuClickWrapper = function handleMenuClickWrapper(evt) {\n        handleMenuClick(evt.target, e.item, graph);\n      };\n\n      this.set('handleMenuClickWrapper', handleMenuClickWrapper);\n      menuDom.addEventListener('click', handleMenuClickWrapper);\n    }\n\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var bbox = menuDom.getBoundingClientRect();\n    var offsetX = this.get('offsetX') || 0;\n    var offsetY = this.get('offsetY') || 0;\n    var graphTop = graph.getContainer().offsetTop;\n    var graphLeft = graph.getContainer().offsetLeft;\n    var x = e.canvasX + graphLeft + offsetX;\n    var y = e.canvasY + graphTop + offsetY; // when the menu is (part of) out of the canvas\n\n    if (x + bbox.width > width) {\n      x = e.canvasX - bbox.width - offsetX + graphLeft;\n    }\n\n    if (y + bbox.height > height) {\n      y = e.canvasY - bbox.height - offsetY + graphTop;\n    }\n\n    modifyCSS(menuDom, {\n      top: y + \"px\",\n      left: x + \"px\",\n      visibility: 'visible'\n    }); // 左键单击会触发 body 上监听的 click 事件，导致菜单展示出来后又立即被隐藏了，需要过滤掉\n\n    var triggeredByFirstClick = this.get('trigger') === 'click';\n\n    var handler = function handler(evt) {\n      if (triggeredByFirstClick) {\n        triggeredByFirstClick = false;\n        return;\n      }\n\n      self.onMenuHide();\n    }; // 如果在页面中其他任意地方进行click, 隐去菜单\n\n\n    document.body.addEventListener('click', handler);\n    this.set('handler', handler);\n  };\n\n  Menu.prototype.removeMenuEventListener = function () {\n    var handleMenuClickWrapper = this.get('handleMenuClickWrapper');\n    var handler = this.get('handler');\n\n    if (handleMenuClickWrapper) {\n      var menuDom = this.get('menu');\n      menuDom.removeEventListener('click', handleMenuClickWrapper);\n      this.set('handleMenuClickWrapper', null);\n    }\n\n    if (handler) {\n      document.body.removeEventListener('click', handler);\n    }\n  };\n\n  Menu.prototype.onMenuHide = function () {\n    var menuDom = this.get('menu');\n\n    if (menuDom) {\n      modifyCSS(menuDom, {\n        visibility: 'hidden'\n      });\n    } // 隐藏菜单后需要移除事件监听\n\n\n    this.removeMenuEventListener();\n  };\n\n  Menu.prototype.destroy = function () {\n    var menu = this.get('menu');\n    this.removeMenuEventListener();\n\n    if (menu) {\n      var container = this.get('container');\n\n      if (!container) {\n        container = this.get('graph').get('container');\n      }\n\n      if (isString(container)) {\n        container = document.getElementById(container);\n      }\n\n      container.removeChild(menu);\n    }\n  };\n\n  return Menu;\n}(Base);\n\nexport default Menu;"]},"metadata":{},"sourceType":"module"}