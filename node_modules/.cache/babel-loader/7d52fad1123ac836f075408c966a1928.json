{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Tooltip = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar l7_component_1 = require(\"@antv/l7-component\");\n\nvar event_emitter_1 = (0, tslib_1.__importDefault)(require(\"@antv/event-emitter\"));\n\nvar util_1 = require(\"@antv/util\");\n\nvar l7plot_component_1 = require(\"@antv/l7plot-component\");\n\nvar lodash_es_1 = require(\"lodash-es\");\n\nvar types_1 = require(\"../types\");\n\nvar utils_1 = require(\"../utils\");\n\nvar TRIGGER_LIST = ['mousemove', 'click'];\n\nvar Tooltip =\n/** @class */\nfunction (_super) {\n  (0, tslib_1.__extends)(Tooltip, _super);\n\n  function Tooltip(scene, interactionLayers, options) {\n    var _this = _super.call(this) || this;\n    /**\n     * tooltip 是否可见\n     */\n\n\n    _this.currentVisible = false;\n\n    _this.interactionTriggerHander = function (event) {\n      var feature = event.feature,\n          featureId = event.featureId;\n      var _a = _this.options,\n          title = _a.title,\n          customTitle = _a.customTitle,\n          items = _a.items,\n          customItems = _a.customItems; // is GeoJson type\n\n      var isGeoFeature = feature.type === 'Feature' && feature.geometry && feature.properties; // parse GeoJson properties\n\n      var properties = isGeoFeature ? feature.properties : feature;\n      var tooltipItems = [];\n\n      if (customItems) {\n        var items_1 = customItems(feature);\n\n        if (Array.isArray(items_1)) {\n          tooltipItems = items_1;\n        } else {\n          throw new Error('customItems return array');\n        }\n      } else if (items) {\n        items.forEach(function (item) {\n          if ((0, util_1.isString)(item)) {\n            var name_1 = item.split('.').pop() || item;\n            var value = (0, lodash_es_1.get)(properties, item);\n\n            if (value !== undefined) {\n              tooltipItems.push({\n                name: name_1,\n                value: value\n              });\n            }\n          } else {\n            var field = item.field,\n                alias = item.alias,\n                customValue = item.customValue;\n            var name_2 = alias || field.split('.').pop() || field;\n            var value = (0, lodash_es_1.get)(properties, field);\n\n            if (value !== undefined) {\n              tooltipItems.push({\n                name: name_2,\n                value: customValue ? customValue(value, properties, featureId) : value\n              });\n            }\n          }\n        });\n      }\n\n      var componentOptions = {\n        title: customTitle ? customTitle(properties) : title,\n        items: tooltipItems\n      };\n\n      _this.updateTooltip(event, componentOptions);\n    };\n\n    _this.interactionUntriggerHander = function () {\n      _this.hideTooltip();\n    };\n\n    _this.scene = scene;\n    _this.interactionLayers = interactionLayers;\n    _this.options = (0, utils_1.deepAssign)({}, _this.getDefaultOptions(), options);\n    var _a = _this.options,\n        offsets = _a.offsets,\n        title = _a.title,\n        showTitle = _a.showTitle,\n        customContent = _a.customContent,\n        domStyles = _a.domStyles,\n        anchor = _a.anchor,\n        className = _a.className;\n    _this.marker = new l7_component_1.Marker({\n      offsets: offsets,\n      anchor: anchor,\n      draggable: false\n    });\n    _this.tooltipComponent = new l7plot_component_1.Tooltip({\n      title: title,\n      showTitle: showTitle,\n      items: [],\n      customContent: customContent,\n      domStyles: domStyles,\n      className: className\n    });\n\n    _this.setComponent();\n\n    _this.initInteractionEvent();\n\n    return _this;\n  }\n  /**\n   * 获取默认配置\n   */\n\n\n  Tooltip.prototype.getDefaultOptions = function () {\n    return {\n      showTitle: true,\n      showComponent: true,\n      items: [],\n      offsets: [15, 0],\n      trigger: 'mousemove',\n      anchor: types_1.TooltipAnchorType['TOP-LEFT']\n    };\n  };\n  /**\n   * 更新 tooltip 组件\n   */\n\n\n  Tooltip.prototype.update = function (options) {\n    this.marker.remove();\n    this.currentVisible = false;\n    this.options = (0, utils_1.deepAssign)({}, this.options, options);\n    var _a = this.options,\n        offsets = _a.offsets,\n        showTitle = _a.showTitle,\n        customContent = _a.customContent,\n        domStyles = _a.domStyles,\n        anchor = _a.anchor,\n        className = _a.className;\n    this.marker = new l7_component_1.Marker({\n      offsets: offsets,\n      anchor: anchor,\n      draggable: false\n    });\n    this.tooltipComponent.update({\n      showTitle: showTitle,\n      customContent: customContent,\n      domStyles: domStyles,\n      className: className\n    });\n    this.setComponent();\n  };\n\n  Tooltip.prototype.initInteractionEvent = function () {\n    var _this = this;\n\n    var trigger = this.options.trigger || 'mousemove';\n\n    if (!TRIGGER_LIST.includes(trigger)) {\n      throw new Error('trigger is mousemove or click');\n    }\n\n    this.interactionLayers.forEach(function (_a) {\n      var layer = _a.layer;\n      layer.on(trigger, _this.interactionTriggerHander);\n      layer.on(\"un\".concat(trigger), _this.interactionUntriggerHander);\n    });\n  };\n\n  Tooltip.prototype.unBindInteractionEvent = function () {\n    var _this = this;\n\n    var trigger = this.options.trigger || 'mousemove';\n    this.interactionLayers.forEach(function (_a) {\n      var layer = _a.layer;\n      layer.off(trigger, _this.interactionTriggerHander);\n      layer.off(\"un\".concat(trigger), _this.interactionUntriggerHander);\n    });\n  };\n\n  Tooltip.prototype.updateTooltip = function (mouseEvent, componentOptions) {\n    var lngLat = mouseEvent.lngLat,\n        x = mouseEvent.x,\n        y = mouseEvent.y;\n\n    if (this.options.showComponent) {\n      this.updateComponent(componentOptions);\n      this.setPostion(lngLat);\n    }\n\n    if (this.currentVisible) {\n      var event_1 = {\n        type: 'tooltip:change',\n        data: componentOptions,\n        lngLat: lngLat,\n        x: x,\n        y: y\n      };\n      this.emit('tooltip:change', event_1);\n    } else {\n      this.showTooltip();\n      var event_2 = {\n        type: 'tooltip:show',\n        data: componentOptions,\n        lngLat: lngLat,\n        x: x,\n        y: y\n      };\n      this.emit('tooltip:show', event_2);\n    }\n  };\n  /**\n   * tooltip 添加到地图上\n   */\n\n\n  Tooltip.prototype.showTooltip = function () {\n    if (this.currentVisible) return;\n\n    if (this.options.showComponent) {\n      this.scene.addMarker(this.marker);\n    }\n\n    this.currentVisible = true;\n  };\n  /**\n   * tooltip 从地图上移除\n   */\n\n\n  Tooltip.prototype.hideTooltip = function () {\n    if (!this.currentVisible) return;\n\n    if (this.options.showComponent) {\n      this.marker.remove();\n    }\n\n    this.currentVisible = false;\n    var event = {\n      type: 'tooltip:hide'\n    };\n    this.emit('tooltip:hide', event);\n  };\n  /**\n   * 更新 tooltip 组件\n   */\n\n\n  Tooltip.prototype.updateComponent = function (componentOptions) {\n    if (!(0, util_1.isEqual)(this.lastComponentOptions, componentOptions)) {\n      this.tooltipComponent.update(componentOptions);\n      this.lastComponentOptions = componentOptions;\n    }\n  };\n  /**\n   * 设置 tooltip 内容\n   */\n\n\n  Tooltip.prototype.setComponent = function () {\n    var tooltip = this.tooltipComponent.getContainer();\n    var container = window.document.createElement('div');\n    container.style.cursor = 'auto';\n    container.style.userSelect = 'text';\n    container.className = 'l7plot-tooltip-container'; // stopPropagation\n\n    ['mousemove', 'mousedown', 'mouseup', 'click', 'dblclick'].forEach(function (type) {\n      container.addEventListener(type, function (e) {\n        return e.stopPropagation();\n      });\n    });\n    container.appendChild(tooltip);\n    this.marker.setElement(container);\n  };\n  /**\n   * 设置 tooltip 位置\n   */\n\n\n  Tooltip.prototype.setPostion = function (position) {\n    this.marker.setLnglat(position);\n  };\n  /**\n   * 销毁\n   */\n\n\n  Tooltip.prototype.destroy = function () {\n    this.unBindInteractionEvent();\n    this.off();\n    this.marker.remove();\n    this.tooltipComponent.destroy();\n  };\n\n  return Tooltip;\n}(event_emitter_1.default);\n\nexports.Tooltip = Tooltip;","map":{"version":3,"sources":["../../../src/component/tooltip.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Tooltip = void 0;\nvar tslib_1 = require(\"tslib\");\nvar l7_component_1 = require(\"@antv/l7-component\");\nvar event_emitter_1 = (0, tslib_1.__importDefault)(require(\"@antv/event-emitter\"));\nvar util_1 = require(\"@antv/util\");\nvar l7plot_component_1 = require(\"@antv/l7plot-component\");\nvar lodash_es_1 = require(\"lodash-es\");\nvar types_1 = require(\"../types\");\nvar utils_1 = require(\"../utils\");\nvar TRIGGER_LIST = ['mousemove', 'click'];\nvar Tooltip = /** @class */ (function (_super) {\n    (0, tslib_1.__extends)(Tooltip, _super);\n    function Tooltip(scene, interactionLayers, options) {\n        var _this = _super.call(this) || this;\n        /**\n         * tooltip 是否可见\n         */\n        _this.currentVisible = false;\n        _this.interactionTriggerHander = function (event) {\n            var feature = event.feature, featureId = event.featureId;\n            var _a = _this.options, title = _a.title, customTitle = _a.customTitle, items = _a.items, customItems = _a.customItems;\n            // is GeoJson type\n            var isGeoFeature = feature.type === 'Feature' && feature.geometry && feature.properties;\n            // parse GeoJson properties\n            var properties = isGeoFeature ? feature.properties : feature;\n            var tooltipItems = [];\n            if (customItems) {\n                var items_1 = customItems(feature);\n                if (Array.isArray(items_1)) {\n                    tooltipItems = items_1;\n                }\n                else {\n                    throw new Error('customItems return array');\n                }\n            }\n            else if (items) {\n                items.forEach(function (item) {\n                    if ((0, util_1.isString)(item)) {\n                        var name_1 = item.split('.').pop() || item;\n                        var value = (0, lodash_es_1.get)(properties, item);\n                        if (value !== undefined) {\n                            tooltipItems.push({ name: name_1, value: value });\n                        }\n                    }\n                    else {\n                        var field = item.field, alias = item.alias, customValue = item.customValue;\n                        var name_2 = alias || field.split('.').pop() || field;\n                        var value = (0, lodash_es_1.get)(properties, field);\n                        if (value !== undefined) {\n                            tooltipItems.push({\n                                name: name_2,\n                                value: customValue ? customValue(value, properties, featureId) : value,\n                            });\n                        }\n                    }\n                });\n            }\n            var componentOptions = { title: customTitle ? customTitle(properties) : title, items: tooltipItems };\n            _this.updateTooltip(event, componentOptions);\n        };\n        _this.interactionUntriggerHander = function () {\n            _this.hideTooltip();\n        };\n        _this.scene = scene;\n        _this.interactionLayers = interactionLayers;\n        _this.options = (0, utils_1.deepAssign)({}, _this.getDefaultOptions(), options);\n        var _a = _this.options, offsets = _a.offsets, title = _a.title, showTitle = _a.showTitle, customContent = _a.customContent, domStyles = _a.domStyles, anchor = _a.anchor, className = _a.className;\n        _this.marker = new l7_component_1.Marker({\n            offsets: offsets,\n            anchor: anchor,\n            draggable: false,\n        });\n        _this.tooltipComponent = new l7plot_component_1.Tooltip({\n            title: title,\n            showTitle: showTitle,\n            items: [],\n            customContent: customContent,\n            domStyles: domStyles,\n            className: className,\n        });\n        _this.setComponent();\n        _this.initInteractionEvent();\n        return _this;\n    }\n    /**\n     * 获取默认配置\n     */\n    Tooltip.prototype.getDefaultOptions = function () {\n        return {\n            showTitle: true,\n            showComponent: true,\n            items: [],\n            offsets: [15, 0],\n            trigger: 'mousemove',\n            anchor: types_1.TooltipAnchorType['TOP-LEFT'],\n        };\n    };\n    /**\n     * 更新 tooltip 组件\n     */\n    Tooltip.prototype.update = function (options) {\n        this.marker.remove();\n        this.currentVisible = false;\n        this.options = (0, utils_1.deepAssign)({}, this.options, options);\n        var _a = this.options, offsets = _a.offsets, showTitle = _a.showTitle, customContent = _a.customContent, domStyles = _a.domStyles, anchor = _a.anchor, className = _a.className;\n        this.marker = new l7_component_1.Marker({\n            offsets: offsets,\n            anchor: anchor,\n            draggable: false,\n        });\n        this.tooltipComponent.update({\n            showTitle: showTitle,\n            customContent: customContent,\n            domStyles: domStyles,\n            className: className,\n        });\n        this.setComponent();\n    };\n    Tooltip.prototype.initInteractionEvent = function () {\n        var _this = this;\n        var trigger = this.options.trigger || 'mousemove';\n        if (!TRIGGER_LIST.includes(trigger)) {\n            throw new Error('trigger is mousemove or click');\n        }\n        this.interactionLayers.forEach(function (_a) {\n            var layer = _a.layer;\n            layer.on(trigger, _this.interactionTriggerHander);\n            layer.on(\"un\".concat(trigger), _this.interactionUntriggerHander);\n        });\n    };\n    Tooltip.prototype.unBindInteractionEvent = function () {\n        var _this = this;\n        var trigger = this.options.trigger || 'mousemove';\n        this.interactionLayers.forEach(function (_a) {\n            var layer = _a.layer;\n            layer.off(trigger, _this.interactionTriggerHander);\n            layer.off(\"un\".concat(trigger), _this.interactionUntriggerHander);\n        });\n    };\n    Tooltip.prototype.updateTooltip = function (mouseEvent, componentOptions) {\n        var lngLat = mouseEvent.lngLat, x = mouseEvent.x, y = mouseEvent.y;\n        if (this.options.showComponent) {\n            this.updateComponent(componentOptions);\n            this.setPostion(lngLat);\n        }\n        if (this.currentVisible) {\n            var event_1 = { type: 'tooltip:change', data: componentOptions, lngLat: lngLat, x: x, y: y };\n            this.emit('tooltip:change', event_1);\n        }\n        else {\n            this.showTooltip();\n            var event_2 = { type: 'tooltip:show', data: componentOptions, lngLat: lngLat, x: x, y: y };\n            this.emit('tooltip:show', event_2);\n        }\n    };\n    /**\n     * tooltip 添加到地图上\n     */\n    Tooltip.prototype.showTooltip = function () {\n        if (this.currentVisible)\n            return;\n        if (this.options.showComponent) {\n            this.scene.addMarker(this.marker);\n        }\n        this.currentVisible = true;\n    };\n    /**\n     * tooltip 从地图上移除\n     */\n    Tooltip.prototype.hideTooltip = function () {\n        if (!this.currentVisible)\n            return;\n        if (this.options.showComponent) {\n            this.marker.remove();\n        }\n        this.currentVisible = false;\n        var event = { type: 'tooltip:hide' };\n        this.emit('tooltip:hide', event);\n    };\n    /**\n     * 更新 tooltip 组件\n     */\n    Tooltip.prototype.updateComponent = function (componentOptions) {\n        if (!(0, util_1.isEqual)(this.lastComponentOptions, componentOptions)) {\n            this.tooltipComponent.update(componentOptions);\n            this.lastComponentOptions = componentOptions;\n        }\n    };\n    /**\n     * 设置 tooltip 内容\n     */\n    Tooltip.prototype.setComponent = function () {\n        var tooltip = this.tooltipComponent.getContainer();\n        var container = window.document.createElement('div');\n        container.style.cursor = 'auto';\n        container.style.userSelect = 'text';\n        container.className = 'l7plot-tooltip-container';\n        // stopPropagation\n        ['mousemove', 'mousedown', 'mouseup', 'click', 'dblclick'].forEach(function (type) {\n            container.addEventListener(type, function (e) { return e.stopPropagation(); });\n        });\n        container.appendChild(tooltip);\n        this.marker.setElement(container);\n    };\n    /**\n     * 设置 tooltip 位置\n     */\n    Tooltip.prototype.setPostion = function (position) {\n        this.marker.setLnglat(position);\n    };\n    /**\n     * 销毁\n     */\n    Tooltip.prototype.destroy = function () {\n        this.unBindInteractionEvent();\n        this.off();\n        this.marker.remove();\n        this.tooltipComponent.destroy();\n    };\n    return Tooltip;\n}(event_emitter_1.default));\nexports.Tooltip = Tooltip;\n//# sourceMappingURL=tooltip.js.map"]},"metadata":{},"sourceType":"script"}