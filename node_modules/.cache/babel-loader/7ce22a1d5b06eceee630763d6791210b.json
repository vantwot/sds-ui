{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { isNumber, isString } from '@antv/util';\nimport { formatPadding } from '../../util/base';\nimport { applyMatrix, invertMatrix } from '../../util/math';\n\nvar ViewController =\n/** @class */\nfunction () {\n  function ViewController(graph) {\n    this.destroyed = false;\n    this.graph = graph;\n    this.destroyed = false;\n  } // get view center coordinate\n\n\n  ViewController.prototype.getViewCenter = function () {\n    var padding = this.getFormatPadding();\n    var graph = this.graph;\n    var width = this.graph.get('width');\n    var height = graph.get('height');\n    return {\n      x: (width - padding[1] - padding[3]) / 2 + padding[3],\n      y: (height - padding[0] - padding[2]) / 2 + padding[0]\n    };\n  };\n\n  ViewController.prototype.fitCenter = function () {\n    var graph = this.graph;\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n  }; // fit view graph\n\n\n  ViewController.prototype.fitView = function () {\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var w = (width - padding[1] - padding[3]) / bbox.width;\n    var h = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio = w;\n\n    if (w > h) {\n      ratio = h;\n    }\n\n    if (!graph.zoom(ratio, viewCenter)) {\n      console.warn('zoom failed, ratio out of range, ratio: %f', ratio);\n    }\n  }; // fit view graph by rule\n\n\n  ViewController.prototype.fitViewByRules = function (rules) {\n    var _a = rules.onlyOutOfViewPort,\n        onlyOutOfViewPort = _a === void 0 ? false : _a,\n        _b = rules.direction,\n        direction = _b === void 0 ? 'both' : _b,\n        _c = rules.ratioRule,\n        ratioRule = _c === void 0 ? 'min' : _c;\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var wRatio = (width - padding[1] - padding[3]) / bbox.width;\n    var hRatio = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio;\n\n    if (direction === 'x') {\n      ratio = wRatio;\n    } else if (direction === 'y') {\n      ratio = hRatio;\n    } else {\n      // ratioRule\n      ratio = ratioRule === 'max' ? Math.max(wRatio, hRatio) : Math.min(wRatio, hRatio);\n    } // 如果设置了仅对超出视口宽高的场景进行fitview，则没超出的场景zoom取1\n\n\n    if (onlyOutOfViewPort) {\n      ratio = ratio < 1 ? ratio : 1;\n    }\n\n    var initZoomRatio = graph.getZoom();\n    var endZoom = initZoomRatio * ratio;\n    var minZoom = graph.get('minZoom'); // 如果zoom小于最小zoom, 则以最小zoom为准\n\n    if (endZoom < minZoom) {\n      endZoom = minZoom;\n      console.warn('fitview failed, ratio out of range, ratio: %f', ratio, 'graph minzoom has been used instead');\n    }\n\n    graph.zoomTo(endZoom, viewCenter);\n  };\n\n  ViewController.prototype.getFormatPadding = function () {\n    var padding = this.graph.get('fitViewPadding');\n    return formatPadding(padding);\n  };\n\n  ViewController.prototype.focusPoint = function (point, animate, animateCfg) {\n    var _this = this;\n\n    var viewCenter = this.getViewCenter();\n    var modelCenter = this.getPointByCanvas(viewCenter.x, viewCenter.y);\n    var viewportMatrix = this.graph.get('group').getMatrix();\n    if (!viewportMatrix) viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (animate) {\n      var dx_1 = (modelCenter.x - point.x) * viewportMatrix[0];\n      var dy_1 = (modelCenter.y - point.y) * viewportMatrix[4];\n      var lastX_1 = 0;\n      var lastY_1 = 0;\n      var newX_1 = 0;\n      var newY_1 = 0; // 动画每次平移一点，直到目标位置\n\n      this.graph.get('canvas').animate(function (ratio) {\n        newX_1 = dx_1 * ratio;\n        newY_1 = dy_1 * ratio;\n\n        _this.graph.translate(newX_1 - lastX_1, newY_1 - lastY_1);\n\n        lastX_1 = newX_1;\n        lastY_1 = newY_1;\n      }, __assign({}, animateCfg));\n    } else {\n      this.graph.translate((modelCenter.x - point.x) * viewportMatrix[0], (modelCenter.y - point.y) * viewportMatrix[4]);\n    }\n  };\n  /**\n   * 将 Canvas 坐标转成视口坐标\n   * @param canvasX canvas x 坐标\n   * @param canvasY canvas y 坐标\n   */\n\n\n  ViewController.prototype.getPointByCanvas = function (canvasX, canvasY) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    var point = invertMatrix({\n      x: canvasX,\n      y: canvasY\n    }, viewportMatrix);\n    return point;\n  };\n  /**\n   * 将页面坐标转成视口坐标\n   * @param clientX 页面 x 坐标\n   * @param clientY 页面 y 坐标\n   */\n\n\n  ViewController.prototype.getPointByClient = function (clientX, clientY) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = canvas.getPointByClient(clientX, clientY);\n    return this.getPointByCanvas(canvasPoint.x, canvasPoint.y);\n  };\n  /**\n   * 将视口坐标转成页面坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getClientByPoint = function (x, y) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = this.getCanvasByPoint(x, y);\n    var point = canvas.getClientByPoint(canvasPoint.x, canvasPoint.y);\n    return {\n      x: point.x,\n      y: point.y\n    };\n  };\n  /**\n   * 将视口坐标转成 Canvas 坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getCanvasByPoint = function (x, y) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return applyMatrix({\n      x: x,\n      y: y\n    }, viewportMatrix);\n  };\n  /**\n   * 将元素移动到画布中心\n   * @param item Item 实例或 id\n   * @param {boolean} animate 是否带有动画地移动\n   * @param {GraphAnimateConfig} animateCfg 若带有动画，动画的配置项\n   */\n\n\n  ViewController.prototype.focus = function (item, animate, animateCfg) {\n    if (isString(item)) {\n      item = this.graph.findById(item);\n    }\n\n    if (item) {\n      var x = 0,\n          y = 0;\n\n      if (item.getType && item.getType() === 'edge') {\n        var sourceMatrix = item.getSource().get('group').getMatrix();\n        var targetMatrix = item.getTarget().get('group').getMatrix();\n\n        if (sourceMatrix && targetMatrix) {\n          x = (sourceMatrix[6] + targetMatrix[6]) / 2;\n          y = (sourceMatrix[7] + targetMatrix[7]) / 2;\n        } else if (sourceMatrix || targetMatrix) {\n          x = sourceMatrix ? sourceMatrix[6] : targetMatrix[6];\n          y = sourceMatrix ? sourceMatrix[7] : targetMatrix[7];\n        }\n      } else {\n        var group = item.get('group');\n        var matrix = group.getMatrix();\n        if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n        x = matrix[6];\n        y = matrix[7];\n      } // 用实际位置而不是model中的x,y,防止由于拖拽等的交互导致model的x,y并不是当前的x,y\n\n\n      this.focusPoint({\n        x: x,\n        y: y\n      }, animate, animateCfg);\n    }\n  };\n  /**\n   * 改变 canvas 画布的宽度和高度\n   * @param width canvas 宽度\n   * @param height canvas 高度\n   */\n\n\n  ViewController.prototype.changeSize = function (width, height) {\n    var graph = this.graph;\n\n    if (!isNumber(width) || !isNumber(height)) {\n      throw Error('invalid canvas width & height, please make sure width & height type is number');\n    }\n\n    graph.set({\n      width: width,\n      height: height\n    });\n    var canvas = graph.get('canvas');\n    canvas.changeSize(width, height); // change the size of grid plugin if it exists on graph\n\n    var plugins = graph.get('plugins');\n    plugins.forEach(function (plugin) {\n      if (plugin.get('gridContainer')) {\n        // 网格定位信息初始化\n        plugin.positionInit();\n      }\n    });\n  };\n\n  ViewController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = false;\n  };\n\n  return ViewController;\n}();\n\nexport default ViewController;","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@antv/g6-core/es/graph/controller/view.js"],"names":["__assign","isNumber","isString","formatPadding","applyMatrix","invertMatrix","ViewController","graph","destroyed","prototype","getViewCenter","padding","getFormatPadding","width","get","height","x","y","fitCenter","group","resetMatrix","bbox","getCanvasBBox","viewCenter","groupCenter","translate","fitView","w","h","ratio","zoom","console","warn","fitViewByRules","rules","_a","onlyOutOfViewPort","_b","direction","_c","ratioRule","wRatio","hRatio","Math","max","min","initZoomRatio","getZoom","endZoom","minZoom","zoomTo","focusPoint","point","animate","animateCfg","_this","modelCenter","getPointByCanvas","viewportMatrix","getMatrix","dx_1","dy_1","lastX_1","lastY_1","newX_1","newY_1","canvasX","canvasY","getPointByClient","clientX","clientY","canvas","canvasPoint","getClientByPoint","getCanvasByPoint","focus","item","findById","getType","sourceMatrix","getSource","targetMatrix","getTarget","matrix","changeSize","Error","set","plugins","forEach","plugin","positionInit","destroy"],"mappings":"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","sourcesContent":["import { __assign } from \"tslib\";\nimport { isNumber, isString } from '@antv/util';\nimport { formatPadding } from '../../util/base';\nimport { applyMatrix, invertMatrix } from '../../util/math';\n\nvar ViewController =\n/** @class */\nfunction () {\n  function ViewController(graph) {\n    this.destroyed = false;\n    this.graph = graph;\n    this.destroyed = false;\n  } // get view center coordinate\n\n\n  ViewController.prototype.getViewCenter = function () {\n    var padding = this.getFormatPadding();\n    var graph = this.graph;\n    var width = this.graph.get('width');\n    var height = graph.get('height');\n    return {\n      x: (width - padding[1] - padding[3]) / 2 + padding[3],\n      y: (height - padding[0] - padding[2]) / 2 + padding[0]\n    };\n  };\n\n  ViewController.prototype.fitCenter = function () {\n    var graph = this.graph;\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n  }; // fit view graph\n\n\n  ViewController.prototype.fitView = function () {\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var w = (width - padding[1] - padding[3]) / bbox.width;\n    var h = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio = w;\n\n    if (w > h) {\n      ratio = h;\n    }\n\n    if (!graph.zoom(ratio, viewCenter)) {\n      console.warn('zoom failed, ratio out of range, ratio: %f', ratio);\n    }\n  }; // fit view graph by rule\n\n\n  ViewController.prototype.fitViewByRules = function (rules) {\n    var _a = rules.onlyOutOfViewPort,\n        onlyOutOfViewPort = _a === void 0 ? false : _a,\n        _b = rules.direction,\n        direction = _b === void 0 ? 'both' : _b,\n        _c = rules.ratioRule,\n        ratioRule = _c === void 0 ? 'min' : _c;\n    var graph = this.graph;\n    var padding = this.getFormatPadding();\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var group = graph.get('group');\n    group.resetMatrix();\n    var bbox = group.getCanvasBBox();\n    if (bbox.width === 0 || bbox.height === 0) return;\n    var viewCenter = this.getViewCenter();\n    var groupCenter = {\n      x: bbox.x + bbox.width / 2,\n      y: bbox.y + bbox.height / 2\n    };\n    graph.translate(viewCenter.x - groupCenter.x, viewCenter.y - groupCenter.y);\n    var wRatio = (width - padding[1] - padding[3]) / bbox.width;\n    var hRatio = (height - padding[0] - padding[2]) / bbox.height;\n    var ratio;\n\n    if (direction === 'x') {\n      ratio = wRatio;\n    } else if (direction === 'y') {\n      ratio = hRatio;\n    } else {\n      // ratioRule\n      ratio = ratioRule === 'max' ? Math.max(wRatio, hRatio) : Math.min(wRatio, hRatio);\n    } // 如果设置了仅对超出视口宽高的场景进行fitview，则没超出的场景zoom取1\n\n\n    if (onlyOutOfViewPort) {\n      ratio = ratio < 1 ? ratio : 1;\n    }\n\n    var initZoomRatio = graph.getZoom();\n    var endZoom = initZoomRatio * ratio;\n    var minZoom = graph.get('minZoom'); // 如果zoom小于最小zoom, 则以最小zoom为准\n\n    if (endZoom < minZoom) {\n      endZoom = minZoom;\n      console.warn('fitview failed, ratio out of range, ratio: %f', ratio, 'graph minzoom has been used instead');\n    }\n\n    graph.zoomTo(endZoom, viewCenter);\n  };\n\n  ViewController.prototype.getFormatPadding = function () {\n    var padding = this.graph.get('fitViewPadding');\n    return formatPadding(padding);\n  };\n\n  ViewController.prototype.focusPoint = function (point, animate, animateCfg) {\n    var _this = this;\n\n    var viewCenter = this.getViewCenter();\n    var modelCenter = this.getPointByCanvas(viewCenter.x, viewCenter.y);\n    var viewportMatrix = this.graph.get('group').getMatrix();\n    if (!viewportMatrix) viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n\n    if (animate) {\n      var dx_1 = (modelCenter.x - point.x) * viewportMatrix[0];\n      var dy_1 = (modelCenter.y - point.y) * viewportMatrix[4];\n      var lastX_1 = 0;\n      var lastY_1 = 0;\n      var newX_1 = 0;\n      var newY_1 = 0; // 动画每次平移一点，直到目标位置\n\n      this.graph.get('canvas').animate(function (ratio) {\n        newX_1 = dx_1 * ratio;\n        newY_1 = dy_1 * ratio;\n\n        _this.graph.translate(newX_1 - lastX_1, newY_1 - lastY_1);\n\n        lastX_1 = newX_1;\n        lastY_1 = newY_1;\n      }, __assign({}, animateCfg));\n    } else {\n      this.graph.translate((modelCenter.x - point.x) * viewportMatrix[0], (modelCenter.y - point.y) * viewportMatrix[4]);\n    }\n  };\n  /**\n   * 将 Canvas 坐标转成视口坐标\n   * @param canvasX canvas x 坐标\n   * @param canvasY canvas y 坐标\n   */\n\n\n  ViewController.prototype.getPointByCanvas = function (canvasX, canvasY) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    var point = invertMatrix({\n      x: canvasX,\n      y: canvasY\n    }, viewportMatrix);\n    return point;\n  };\n  /**\n   * 将页面坐标转成视口坐标\n   * @param clientX 页面 x 坐标\n   * @param clientY 页面 y 坐标\n   */\n\n\n  ViewController.prototype.getPointByClient = function (clientX, clientY) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = canvas.getPointByClient(clientX, clientY);\n    return this.getPointByCanvas(canvasPoint.x, canvasPoint.y);\n  };\n  /**\n   * 将视口坐标转成页面坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getClientByPoint = function (x, y) {\n    var canvas = this.graph.get('canvas');\n    var canvasPoint = this.getCanvasByPoint(x, y);\n    var point = canvas.getClientByPoint(canvasPoint.x, canvasPoint.y);\n    return {\n      x: point.x,\n      y: point.y\n    };\n  };\n  /**\n   * 将视口坐标转成 Canvas 坐标\n   * @param x 视口 x 坐标\n   * @param y 视口 y 坐标\n   */\n\n\n  ViewController.prototype.getCanvasByPoint = function (x, y) {\n    var viewportMatrix = this.graph.get('group').getMatrix();\n\n    if (!viewportMatrix) {\n      viewportMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n    }\n\n    return applyMatrix({\n      x: x,\n      y: y\n    }, viewportMatrix);\n  };\n  /**\n   * 将元素移动到画布中心\n   * @param item Item 实例或 id\n   * @param {boolean} animate 是否带有动画地移动\n   * @param {GraphAnimateConfig} animateCfg 若带有动画，动画的配置项\n   */\n\n\n  ViewController.prototype.focus = function (item, animate, animateCfg) {\n    if (isString(item)) {\n      item = this.graph.findById(item);\n    }\n\n    if (item) {\n      var x = 0,\n          y = 0;\n\n      if (item.getType && item.getType() === 'edge') {\n        var sourceMatrix = item.getSource().get('group').getMatrix();\n        var targetMatrix = item.getTarget().get('group').getMatrix();\n\n        if (sourceMatrix && targetMatrix) {\n          x = (sourceMatrix[6] + targetMatrix[6]) / 2;\n          y = (sourceMatrix[7] + targetMatrix[7]) / 2;\n        } else if (sourceMatrix || targetMatrix) {\n          x = sourceMatrix ? sourceMatrix[6] : targetMatrix[6];\n          y = sourceMatrix ? sourceMatrix[7] : targetMatrix[7];\n        }\n      } else {\n        var group = item.get('group');\n        var matrix = group.getMatrix();\n        if (!matrix) matrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\n        x = matrix[6];\n        y = matrix[7];\n      } // 用实际位置而不是model中的x,y,防止由于拖拽等的交互导致model的x,y并不是当前的x,y\n\n\n      this.focusPoint({\n        x: x,\n        y: y\n      }, animate, animateCfg);\n    }\n  };\n  /**\n   * 改变 canvas 画布的宽度和高度\n   * @param width canvas 宽度\n   * @param height canvas 高度\n   */\n\n\n  ViewController.prototype.changeSize = function (width, height) {\n    var graph = this.graph;\n\n    if (!isNumber(width) || !isNumber(height)) {\n      throw Error('invalid canvas width & height, please make sure width & height type is number');\n    }\n\n    graph.set({\n      width: width,\n      height: height\n    });\n    var canvas = graph.get('canvas');\n    canvas.changeSize(width, height); // change the size of grid plugin if it exists on graph\n\n    var plugins = graph.get('plugins');\n    plugins.forEach(function (plugin) {\n      if (plugin.get('gridContainer')) {\n        // 网格定位信息初始化\n        plugin.positionInit();\n      }\n    });\n  };\n\n  ViewController.prototype.destroy = function () {\n    this.graph = null;\n    this.destroyed = false;\n  };\n\n  return ViewController;\n}();\n\nexport default ViewController;"]},"metadata":{},"sourceType":"module"}