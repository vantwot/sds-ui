{"ast":null,"code":"/* eslint-disable no-bitwise */\nexport class FlagManager {\n  constructor(view, actions) {\n    let bootstrap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n    this.view = view;\n    const flags = {};\n    const attrs = {};\n    let shift = 0;\n    Object.keys(actions).forEach(attr => {\n      let labels = actions[attr];\n\n      if (!Array.isArray(labels)) {\n        labels = [labels];\n      }\n\n      labels.forEach(label => {\n        let flag = flags[label];\n\n        if (!flag) {\n          shift += 1;\n          flag = flags[label] = 1 << shift;\n        }\n\n        attrs[attr] |= flag;\n      });\n    });\n    let labels = bootstrap;\n\n    if (!Array.isArray(labels)) {\n      labels = [labels];\n    }\n\n    labels.forEach(label => {\n      if (!flags[label]) {\n        shift += 1;\n        flags[label] = 1 << shift;\n      }\n    }); // 26 - 30 are reserved for paper flags\n    // 31+ overflows maximal number\n\n    if (shift > 25) {\n      throw new Error('Maximum number of flags exceeded.');\n    }\n\n    this.flags = flags;\n    this.attrs = attrs;\n    this.bootstrap = bootstrap;\n  }\n\n  get cell() {\n    return this.view.cell;\n  }\n\n  getFlag(label) {\n    const flags = this.flags;\n\n    if (flags == null) {\n      return 0;\n    }\n\n    if (Array.isArray(label)) {\n      return label.reduce((memo, key) => memo | flags[key], 0);\n    }\n\n    return flags[label] | 0;\n  }\n\n  hasAction(flag, label) {\n    return flag & this.getFlag(label);\n  }\n\n  removeAction(flag, label) {\n    return flag ^ flag & this.getFlag(label);\n  }\n\n  getBootstrapFlag() {\n    return this.getFlag(this.bootstrap);\n  }\n\n  getChangedFlag() {\n    let flag = 0;\n\n    if (!this.attrs) {\n      return flag;\n    }\n\n    Object.keys(this.attrs).forEach(attr => {\n      if (this.cell.hasChanged(attr)) {\n        flag |= this.attrs[attr];\n      }\n    });\n    return flag;\n  }\n\n}","map":{"version":3,"sources":["../../src/view/flag.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* eslint-disable no-bitwise */\nexport class FlagManager {\n    constructor(view, actions, bootstrap = []) {\n        this.view = view;\n        const flags = {};\n        const attrs = {};\n        let shift = 0;\n        Object.keys(actions).forEach((attr) => {\n            let labels = actions[attr];\n            if (!Array.isArray(labels)) {\n                labels = [labels];\n            }\n            labels.forEach((label) => {\n                let flag = flags[label];\n                if (!flag) {\n                    shift += 1;\n                    flag = flags[label] = 1 << shift;\n                }\n                attrs[attr] |= flag;\n            });\n        });\n        let labels = bootstrap;\n        if (!Array.isArray(labels)) {\n            labels = [labels];\n        }\n        labels.forEach((label) => {\n            if (!flags[label]) {\n                shift += 1;\n                flags[label] = 1 << shift;\n            }\n        });\n        // 26 - 30 are reserved for paper flags\n        // 31+ overflows maximal number\n        if (shift > 25) {\n            throw new Error('Maximum number of flags exceeded.');\n        }\n        this.flags = flags;\n        this.attrs = attrs;\n        this.bootstrap = bootstrap;\n    }\n    get cell() {\n        return this.view.cell;\n    }\n    getFlag(label) {\n        const flags = this.flags;\n        if (flags == null) {\n            return 0;\n        }\n        if (Array.isArray(label)) {\n            return label.reduce((memo, key) => memo | flags[key], 0);\n        }\n        return flags[label] | 0;\n    }\n    hasAction(flag, label) {\n        return flag & this.getFlag(label);\n    }\n    removeAction(flag, label) {\n        return flag ^ (flag & this.getFlag(label));\n    }\n    getBootstrapFlag() {\n        return this.getFlag(this.bootstrap);\n    }\n    getChangedFlag() {\n        let flag = 0;\n        if (!this.attrs) {\n            return flag;\n        }\n        Object.keys(this.attrs).forEach((attr) => {\n            if (this.cell.hasChanged(attr)) {\n                flag |= this.attrs[attr];\n            }\n        });\n        return flag;\n    }\n}\n//# sourceMappingURL=flag.js.map"]},"metadata":{},"sourceType":"module"}