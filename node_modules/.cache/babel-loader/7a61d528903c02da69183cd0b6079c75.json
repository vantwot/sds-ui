{"ast":null,"code":"import _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { ManaSyringe, DisposableCollection, MenuItemType, IModelContribution, IModelService, RxModel, Disposable } from '@antv/xflow-core';\nimport { MODELS } from '@antv/xflow-core';\nimport { CONTEXT_MENU_MODEL } from '../interface';\nimport { ContextMenuConfig } from '../config';\nvar inject = ManaSyringe.inject,\n    singleton = ManaSyringe.singleton;\n/**\n * IModelContribution\n */\n\nvar CanvasContextMenuContribution = /*#__PURE__*/function () {\n  function CanvasContextMenuContribution() {\n    var _this = this;\n\n    _classCallCheck(this, CanvasContextMenuContribution);\n\n    /** 注册 model */\n    this.toDispose = new DisposableCollection();\n    /** 获取 MenuModel */\n\n    this.getMenuModelValue = function (contextMenuInfo) {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var config, anchor, type, cell, toDispose, data, menuModel, renderProps;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.menuConfig.getConfig();\n\n              case 2:\n                config = _context.sent;\n\n                /** 获取坐标 */\n                anchor = contextMenuInfo.anchor, type = contextMenuInfo.type, cell = contextMenuInfo.cell;\n                /** 获取Menu */\n\n                toDispose = new DisposableCollection();\n                this.toDispose.push(toDispose);\n                data = cell ? cell.getData() : null;\n                menuModel = new RxModel({\n                  id: 'menuroot',\n                  type: MenuItemType.Root,\n                  submenu: []\n                });\n                toDispose.push(Disposable.create(function () {\n                  menuModel.dispose();\n                }));\n                renderProps = {\n                  toDispose: toDispose,\n                  anchor: anchor,\n                  target: {\n                    data: data,\n                    type: type\n                  },\n                  customRender: null,\n                  menuModel: menuModel\n                };\n\n                if (!config.menuCustomRender) {\n                  _context.next = 14;\n                  break;\n                }\n\n                _context.next = 13;\n                return config.menuCustomRender(contextMenuInfo, this.modelService);\n\n              case 13:\n                renderProps.customRender = _context.sent;\n\n              case 14:\n                if (!config.menuModelService) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _context.next = 17;\n                return config.menuModelService(contextMenuInfo, renderProps.menuModel, this.modelService, toDispose);\n\n              case 17:\n                return _context.abrupt(\"return\", renderProps);\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    };\n  }\n  /** 注册 MenuModel */\n\n\n  _createClass(CanvasContextMenuContribution, [{\n    key: \"registerModel\",\n    value: function registerModel(registry) {\n      var _this2 = this;\n\n      var toDispose = [registry.registerModel({\n        id: CONTEXT_MENU_MODEL.id,\n        getInitialValue: function getInitialValue() {\n          return null;\n        },\n        watchChange: function watchChange(self, modelService) {\n          return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n            var _this3 = this;\n\n            var contextMenuModel;\n            return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    _context3.next = 2;\n                    return MODELS.CONTEXTMENU_TARGET.getModel(modelService);\n\n                  case 2:\n                    contextMenuModel = _context3.sent;\n                    return _context3.abrupt(\"return\", contextMenuModel.watch(function (contextMenuInfo) {\n                      return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n                        var contextMenuValue;\n                        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                          while (1) {\n                            switch (_context2.prev = _context2.next) {\n                              case 0:\n                                _context2.next = 2;\n                                return this.getMenuModelValue(contextMenuInfo);\n\n                              case 2:\n                                contextMenuValue = _context2.sent;\n                                self.setValue(contextMenuValue);\n\n                              case 4:\n                              case \"end\":\n                                return _context2.stop();\n                            }\n                          }\n                        }, _callee2, this);\n                      }));\n                    }));\n\n                  case 4:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, _callee3);\n          }));\n        }\n      })];\n      this.toDispose.pushAll(toDispose);\n    }\n  }]);\n\n  return CanvasContextMenuContribution;\n}();\n\n__decorate([inject(ContextMenuConfig), __metadata(\"design:type\", ContextMenuConfig)], CanvasContextMenuContribution.prototype, \"menuConfig\", void 0);\n\n__decorate([inject(IModelService), __metadata(\"design:type\", Object)], CanvasContextMenuContribution.prototype, \"modelService\", void 0);\n\nCanvasContextMenuContribution = __decorate([singleton({\n  contrib: [IModelContribution]\n})], CanvasContextMenuContribution);\nexport { CanvasContextMenuContribution };","map":{"version":3,"sources":["../../../src/canvas-context-menu/contributions/model.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,SACE,WADF,EAEE,oBAFF,EAGE,YAHF,EAIE,kBAJF,EAKE,aALF,EAME,OANF,EAOE,UAPF,QAQO,kBARP;AASA,SAAS,MAAT,QAAuB,kBAAvB;AACA,SAAS,kBAAT,QAAmC,cAAnC;AACA,SAAS,iBAAT,QAAkC,WAAlC;AAEA,IAAQ,MAAR,GAA8B,WAA9B,CAAQ,MAAR;AAAA,IAAgB,SAAhB,GAA8B,WAA9B,CAAgB,SAAhB;AACA;;AAEG;;AAEH,IAAa,6BAAb;AAAA,2CAAA;AAAA;;AAAA;;AACE;AACA,SAAA,SAAA,GAAY,IAAI,oBAAJ,EAAZ;AASA;;AACA,SAAA,iBAAA,GAAoB,UAAO,eAAP;AAAA,aAA4D,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,wCAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAC/D,uBAAM,KAAK,UAAL,CAAgB,SAAhB,EAAN;;AAD+D;AACxE,gBAAA,MADwE;;AAE9E;AACQ,gBAAA,MAHsE,GAG/C,eAH+C,CAGtE,MAHsE,EAG9D,IAH8D,GAG/C,eAH+C,CAG9D,IAH8D,EAGxD,IAHwD,GAG/C,eAH+C,CAGxD,IAHwD;AAI9E;;AACM,gBAAA,SALwE,GAK5D,IAAI,oBAAJ,EAL4D;AAM9E,qBAAK,SAAL,CAAe,IAAf,CAAoB,SAApB;AACM,gBAAA,IAPwE,GAOjE,IAAI,GAAG,IAAI,CAAC,OAAL,EAAH,GAAyB,IAPoC;AAQxE,gBAAA,SARwE,GAQ5D,IAAI,OAAJ,CAA0B;AAC1C,kBAAA,EAAE,EAAE,UADsC;AAE1C,kBAAA,IAAI,EAAE,YAAY,CAAC,IAFuB;AAG1C,kBAAA,OAAO,EAAE;AAHiC,iBAA1B,CAR4D;AAa9E,gBAAA,SAAS,CAAC,IAAV,CACE,UAAU,CAAC,MAAX,CAAkB,YAAK;AACrB,kBAAA,SAAS,CAAC,OAAV;AACD,iBAFD,CADF;AAKM,gBAAA,WAlBwE,GAkB/B;AAC7C,kBAAA,SAAS,EAAT,SAD6C;AAE7C,kBAAA,MAAM,EAAE,MAFqC;AAG7C,kBAAA,MAAM,EAAE;AAAE,oBAAA,IAAI,EAAJ,IAAF;AAAQ,oBAAA,IAAI,EAAJ;AAAR,mBAHqC;AAI7C,kBAAA,YAAY,EAAE,IAJ+B;AAK7C,kBAAA,SAAS,EAAE;AALkC,iBAlB+B;;AAAA,qBA0B1E,MAAM,CAAC,gBA1BmE;AAAA;AAAA;AAAA;;AAAA;AA2BjD,uBAAM,MAAM,CAAC,gBAAP,CAAwB,eAAxB,EAAyC,KAAK,YAA9C,CAAN;;AA3BiD;AA2B5E,gBAAA,WAAW,CAAC,YA3BgE;;AAAA;AAAA,qBA8B1E,MAAM,CAAC,gBA9BmE;AAAA;AAAA;AAAA;;AAAA;AA+B5E,uBAAM,MAAM,CAAC,gBAAP,CACJ,eADI,EAEJ,WAAW,CAAC,SAFR,EAGJ,KAAK,YAHD,EAIJ,SAJI,CAAN;;AA/B4E;AAAA,iDAuCvE,WAvCuE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAA,EAA5D;AAAA,KAApB;AA2DD;AAjBC;;;AAtDF;AAAA;AAAA,WAuDE,uBAAc,QAAd,EAAqC;AAAA;;AACnC,UAAM,SAAS,GAAG,CAChB,QAAQ,CAAC,aAAT,CAAkD;AAChD,QAAA,EAAE,EAAE,kBAAkB,CAAC,EADyB;AAEhD,QAAA,eAAe,EAAE;AAAA,iBAAM,IAAN;AAAA,SAF+B;AAGhD,QAAA,WAAW,EAAE,qBAAO,IAAP,EAAa,YAAb;AAAA,iBAA6B,SAAA,CAAA,MAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,wCAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACf,2BAAM,MAAM,CAAC,kBAAP,CAA0B,QAA1B,CAAmC,YAAnC,CAAN;;AADe;AAClC,oBAAA,gBADkC;AAAA,sDAEjC,gBAAgB,CAAC,KAAjB,CAAuB,UAAM,eAAN;AAAA,6BAAwB,SAAA,CAAA,MAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,wCAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAC3B,uCAAM,KAAK,iBAAL,CAAuB,eAAvB,CAAN;;AAD2B;AAC9C,gCAAA,gBAD8C;AAEpD,gCAAA,IAAI,CAAC,QAAL,CAAc,gBAAd;;AAFoD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAA,EAAxB;AAAA,qBAAvB,CAFiC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAA,EAA7B;AAAA;AAHmC,OAAlD,CADgB,CAAlB;AAaA,WAAK,SAAL,CAAe,OAAf,CAAuB,SAAvB;AACD;AAtEH;;AAAA;AAAA,GAAA;;AAME,UAAA,CAAA,CADC,MAAM,CAAC,iBAAD,CACP,E,0BAAY,iB,CAAZ,CAAA,E,uCAAA,E,YAAA,E,KAA6B,CAA7B,CAAA;;AAGA,UAAA,CAAA,CADC,MAAM,CAAC,aAAD,CACP,E,iCAAA,CAAA,E,uCAAA,E,cAAA,E,KAA2B,CAA3B,CAAA;;AATW,6BAA6B,GAAA,UAAA,CAAA,CADzC,SAAS,CAAC;AAAE,EAAA,OAAO,EAAE,CAAC,kBAAD;AAAX,CAAD,CACgC,CAAA,EAA7B,6BAA6B,CAA7B;SAAA,6B","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ManaSyringe, DisposableCollection, MenuItemType, IModelContribution, IModelService, RxModel, Disposable, } from '@antv/xflow-core';\nimport { MODELS } from '@antv/xflow-core';\nimport { CONTEXT_MENU_MODEL } from '../interface';\nimport { ContextMenuConfig } from '../config';\nconst { inject, singleton } = ManaSyringe;\n/**\n * IModelContribution\n */\nlet CanvasContextMenuContribution = class CanvasContextMenuContribution {\n    constructor() {\n        /** 注册 model */\n        this.toDispose = new DisposableCollection();\n        /** 获取 MenuModel */\n        this.getMenuModelValue = (contextMenuInfo) => __awaiter(this, void 0, void 0, function* () {\n            const config = yield this.menuConfig.getConfig();\n            /** 获取坐标 */\n            const { anchor, type, cell } = contextMenuInfo;\n            /** 获取Menu */\n            const toDispose = new DisposableCollection();\n            this.toDispose.push(toDispose);\n            const data = cell ? cell.getData() : null;\n            const menuModel = new RxModel({\n                id: 'menuroot',\n                type: MenuItemType.Root,\n                submenu: [],\n            });\n            toDispose.push(Disposable.create(() => {\n                menuModel.dispose();\n            }));\n            const renderProps = {\n                toDispose,\n                anchor: anchor,\n                target: { data, type },\n                customRender: null,\n                menuModel: menuModel,\n            };\n            if (config.menuCustomRender) {\n                renderProps.customRender = yield config.menuCustomRender(contextMenuInfo, this.modelService);\n            }\n            if (config.menuModelService) {\n                yield config.menuModelService(contextMenuInfo, renderProps.menuModel, this.modelService, toDispose);\n            }\n            return renderProps;\n        });\n    }\n    /** 注册 MenuModel */\n    registerModel(registry) {\n        const toDispose = [\n            registry.registerModel({\n                id: CONTEXT_MENU_MODEL.id,\n                getInitialValue: () => null,\n                watchChange: (self, modelService) => __awaiter(this, void 0, void 0, function* () {\n                    const contextMenuModel = yield MODELS.CONTEXTMENU_TARGET.getModel(modelService);\n                    return contextMenuModel.watch((contextMenuInfo) => __awaiter(this, void 0, void 0, function* () {\n                        const contextMenuValue = yield this.getMenuModelValue(contextMenuInfo);\n                        self.setValue(contextMenuValue);\n                    }));\n                }),\n            }),\n        ];\n        this.toDispose.pushAll(toDispose);\n    }\n};\n__decorate([\n    inject(ContextMenuConfig),\n    __metadata(\"design:type\", ContextMenuConfig)\n], CanvasContextMenuContribution.prototype, \"menuConfig\", void 0);\n__decorate([\n    inject(IModelService),\n    __metadata(\"design:type\", Object)\n], CanvasContextMenuContribution.prototype, \"modelService\", void 0);\nCanvasContextMenuContribution = __decorate([\n    singleton({ contrib: [IModelContribution] })\n], CanvasContextMenuContribution);\nexport { CanvasContextMenuContribution };\n//# sourceMappingURL=model.js.map"]},"metadata":{},"sourceType":"module"}