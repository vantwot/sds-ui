{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nimport Supercluster from 'supercluster/dist/supercluster';\nexport function cluster(data, option) {\n  var _option$radius = option.radius,\n      radius = _option$radius === void 0 ? 40 : _option$radius,\n      _option$maxZoom = option.maxZoom,\n      maxZoom = _option$maxZoom === void 0 ? 18 : _option$maxZoom,\n      _option$minZoom = option.minZoom,\n      minZoom = _option$minZoom === void 0 ? 0 : _option$minZoom,\n      _option$zoom = option.zoom,\n      zoom = _option$zoom === void 0 ? 2 : _option$zoom;\n\n  if (data.pointIndex) {\n    var clusterData = data.pointIndex.getClusters(data.extent, Math.floor(zoom));\n    data.dataArray = formatData(clusterData);\n    return data;\n  }\n\n  var pointIndex = new Supercluster({\n    radius: radius,\n    minZoom: minZoom,\n    maxZoom: maxZoom\n  });\n  var geojson = {\n    type: 'FeatureCollection',\n    features: []\n  };\n  geojson.features = data.dataArray.map(function (item) {\n    return {\n      type: 'Feature',\n      geometry: {\n        type: 'Point',\n        coordinates: item.coordinates\n      },\n      properties: _objectSpread({}, item)\n    };\n  });\n  pointIndex.load(geojson.features);\n  return pointIndex;\n}\nexport function formatData(clusterPoint) {\n  return clusterPoint.map(function (point, index) {\n    return _objectSpread({\n      coordinates: point.geometry.coordinates,\n      _id: index + 1\n    }, point.properties);\n  });\n}","map":{"version":3,"sources":["../../src/transform/cluster.ts"],"names":["radius","maxZoom","minZoom","zoom","option","data","clusterData","Math","formatData","pointIndex","geojson","type","features","geometry","coordinates","item","properties","point","_id","index"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,OAAA,YAAA,MAAA,gCAAA;AACA,OAAO,SAAA,OAAA,CAAA,IAAA,EAAA,MAAA,EAGQ;AACb,MAAA,cAAA,GAA6DI,MAA7D,CAAA,MAAA;AAAA,MAAQJ,MAAR,GAAA,cAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,cAAA;AAAA,MAAA,eAAA,GAA6DI,MAA7D,CAAA,OAAA;AAAA,MAAqBH,OAArB,GAAA,eAAA,KAAA,KAAA,CAAA,GAAA,EAAA,GAAA,eAAA;AAAA,MAAA,eAAA,GAA6DG,MAA7D,CAAA,OAAA;AAAA,MAAmCF,OAAnC,GAAA,eAAA,KAAA,KAAA,CAAA,GAAA,CAAA,GAAA,eAAA;AAAA,MAAA,YAAA,GAA6DE,MAA7D,CAAA,IAAA;AAAA,MAAgDD,IAAhD,GAAA,YAAA,KAAA,KAAA,CAAA,GAAA,CAAA,GAAA,YAAA;;AACA,MAAIE,IAAI,CAAR,UAAA,EAAqB;AACnB,QAAMC,WAAW,GAAGD,IAAI,CAAJA,UAAAA,CAAAA,WAAAA,CAClBA,IAAI,CADcA,MAAAA,EAElBE,IAAI,CAAJA,KAAAA,CAFF,IAEEA,CAFkBF,CAApB;AAIAA,IAAAA,IAAI,CAAJA,SAAAA,GAAiBG,UAAU,CAA3BH,WAA2B,CAA3BA;AACA,WAAA,IAAA;AACD;;AACD,MAAMI,UAAU,GAAG,IAAA,YAAA,CAAiB;AAClCT,IAAAA,MAAM,EAD4B,MAAA;AAElCE,IAAAA,OAAO,EAF2B,OAAA;AAGlCD,IAAAA,OAAO,EAAPA;AAHkC,GAAjB,CAAnB;AAKA,MAAMS,OAGL,GAAG;AACFC,IAAAA,IAAI,EADF,mBAAA;AAEFC,IAAAA,QAAQ,EAAE;AAFR,GAHJ;AAOAF,EAAAA,OAAO,CAAPA,QAAAA,GAAmB,IAAI,CAAJ,SAAA,CAAA,GAAA,CAAmB,UAAA,IAAA,EAAU;AAC9C,WAAO;AACLC,MAAAA,IAAI,EADC,SAAA;AAELE,MAAAA,QAAQ,EAAE;AACRF,QAAAA,IAAI,EADI,OAAA;AAERG,QAAAA,WAAW,EAAEC,IAAI,CAACD;AAFV,OAFL;AAMLE,MAAAA,UAAU,EAAA,aAAA,CAAA,EAAA,EAAA,IAAA;AANL,KAAP;AADFN,GAAmB,CAAnBA;AAYAD,EAAAA,UAAU,CAAVA,IAAAA,CAAgBC,OAAO,CAAvBD,QAAAA;AACA,SAAA,UAAA;AACD;AACD,OAAO,SAAA,UAAA,CAAA,YAAA,EAAyC;AAC9C,SAAO,YAAY,CAAZ,GAAA,CAAiB,UAAA,KAAA,EAAA,KAAA,EAAkB;AACxC,WAAA,aAAA,CAAA;AACEK,MAAAA,WAAW,EAAEG,KAAK,CAALA,QAAAA,CADf,WAAA;AAEEC,MAAAA,GAAG,EAAEC,KAAK,GAAG;AAFf,KAAA,EAGKF,KAAK,CAHV,UAAA,CAAA;AADF,GAAO,CAAP;AAOD","sourcesContent":["import {\n  IClusterOptions,\n  IParserData,\n  ISourceCFG,\n  ITransform,\n} from '@antv/l7-core';\n// @ts-ignore\n// tslint:disable-next-line:no-submodule-imports\nimport Supercluster from 'supercluster/dist/supercluster';\nexport function cluster(\n  data: IParserData,\n  option: Partial<IClusterOptions>,\n): IParserData {\n  const { radius = 40, maxZoom = 18, minZoom = 0, zoom = 2 } = option;\n  if (data.pointIndex) {\n    const clusterData = data.pointIndex.getClusters(\n      data.extent,\n      Math.floor(zoom),\n    );\n    data.dataArray = formatData(clusterData);\n    return data;\n  }\n  const pointIndex = new Supercluster({\n    radius,\n    minZoom,\n    maxZoom,\n  });\n  const geojson: {\n    type: string;\n    features: any[];\n  } = {\n    type: 'FeatureCollection',\n    features: [],\n  };\n  geojson.features = data.dataArray.map((item) => {\n    return {\n      type: 'Feature',\n      geometry: {\n        type: 'Point',\n        coordinates: item.coordinates,\n      },\n      properties: {\n        ...item,\n      },\n    };\n  });\n  pointIndex.load(geojson.features);\n  return pointIndex;\n}\nexport function formatData(clusterPoint: any[]) {\n  return clusterPoint.map((point, index) => {\n    return {\n      coordinates: point.geometry.coordinates,\n      _id: index + 1,\n      ...point.properties,\n    };\n  });\n}\n"]},"metadata":{},"sourceType":"module"}