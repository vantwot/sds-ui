{"ast":null,"code":"import _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { Emitter } from 'mana-common';\nexport var Disposable;\n\n(function (Disposable) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function is(arg) {\n    return !!arg && typeof arg === 'object' && 'dispose' in arg && typeof arg.dispose === 'function';\n  }\n\n  Disposable.is = is;\n\n  function create(func) {\n    return {\n      dispose: func\n    };\n  }\n\n  Disposable.create = create;\n  Disposable.NULL = create(function () {});\n})(Disposable || (Disposable = {}));\n\nexport var DisposableCollection = /*#__PURE__*/function () {\n  function DisposableCollection() {\n    var _this = this;\n\n    _classCallCheck(this, DisposableCollection);\n\n    this.disposables = [];\n    this.onDisposeEmitter = new Emitter();\n    this.disposingElements = false;\n\n    for (var _len = arguments.length, toDispose = new Array(_len), _key = 0; _key < _len; _key++) {\n      toDispose[_key] = arguments[_key];\n    }\n\n    toDispose.forEach(function (d) {\n      return _this.push(d);\n    });\n  }\n  /**\n   * This event is fired only once\n   * on first dispose of not empty collection.\n   */\n\n\n  _createClass(DisposableCollection, [{\n    key: \"onDispose\",\n    get: function get() {\n      return this.onDisposeEmitter.event;\n    }\n  }, {\n    key: \"checkDisposed\",\n    value: function checkDisposed() {\n      if (this.disposed && !this.disposingElements) {\n        this.onDisposeEmitter.fire(undefined);\n        this.onDisposeEmitter.dispose();\n      }\n    }\n  }, {\n    key: \"disposed\",\n    get: function get() {\n      return this.disposables.length === 0;\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var d;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(this.disposed || this.disposingElements)) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                this.disposingElements = true;\n\n              case 3:\n                if (this.disposed) {\n                  _context.next = 15;\n                  break;\n                }\n\n                _context.prev = 4;\n                d = this.disposables.pop();\n                _context.next = 8;\n                return d.dispose();\n\n              case 8:\n                _context.next = 13;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](4);\n                console.error(_context.t0);\n\n              case 13:\n                _context.next = 3;\n                break;\n\n              case 15:\n                this.disposingElements = false;\n                this.checkDisposed();\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[4, 10]]);\n      }));\n    }\n  }, {\n    key: \"push\",\n    value: function push(disposable) {\n      var _this2 = this;\n\n      var disposables = this.disposables;\n      disposables.push(disposable);\n      var originalDispose = disposable.dispose.bind(disposable);\n      var toRemove = Disposable.create(function () {\n        var index = disposables.indexOf(disposable);\n\n        if (index !== -1) {\n          disposables.splice(index, 1);\n        }\n\n        _this2.checkDisposed();\n      });\n\n      disposable.dispose = function () {\n        toRemove.dispose();\n        originalDispose();\n      };\n\n      return toRemove;\n    }\n  }, {\n    key: \"pushAll\",\n    value: function pushAll(disposables) {\n      var _this3 = this;\n\n      return disposables.map(function (disposable) {\n        return _this3.push(disposable);\n      });\n    }\n  }]);\n\n  return DisposableCollection;\n}();","map":{"version":3,"sources":["../../src/common/disposable.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Emitter } from 'mana-common';\nexport var Disposable;\n(function (Disposable) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    function is(arg) {\n        return !!arg && typeof arg === 'object' && 'dispose' in arg && typeof arg.dispose === 'function';\n    }\n    Disposable.is = is;\n    function create(func) {\n        return {\n            dispose: func,\n        };\n    }\n    Disposable.create = create;\n    Disposable.NULL = create(() => { });\n})(Disposable || (Disposable = {}));\nexport class DisposableCollection {\n    constructor(...toDispose) {\n        this.disposables = [];\n        this.onDisposeEmitter = new Emitter();\n        this.disposingElements = false;\n        toDispose.forEach(d => this.push(d));\n    }\n    /**\n     * This event is fired only once\n     * on first dispose of not empty collection.\n     */\n    get onDispose() {\n        return this.onDisposeEmitter.event;\n    }\n    checkDisposed() {\n        if (this.disposed && !this.disposingElements) {\n            this.onDisposeEmitter.fire(undefined);\n            this.onDisposeEmitter.dispose();\n        }\n    }\n    get disposed() {\n        return this.disposables.length === 0;\n    }\n    dispose() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.disposed || this.disposingElements) {\n                return;\n            }\n            this.disposingElements = true;\n            while (!this.disposed) {\n                try {\n                    const d = this.disposables.pop();\n                    yield d.dispose();\n                }\n                catch (e) {\n                    console.error(e);\n                }\n            }\n            this.disposingElements = false;\n            this.checkDisposed();\n        });\n    }\n    push(disposable) {\n        const { disposables } = this;\n        disposables.push(disposable);\n        const originalDispose = disposable.dispose.bind(disposable);\n        const toRemove = Disposable.create(() => {\n            const index = disposables.indexOf(disposable);\n            if (index !== -1) {\n                disposables.splice(index, 1);\n            }\n            this.checkDisposed();\n        });\n        disposable.dispose = () => {\n            toRemove.dispose();\n            originalDispose();\n        };\n        return toRemove;\n    }\n    pushAll(disposables) {\n        return disposables.map(disposable => this.push(disposable));\n    }\n}\n//# sourceMappingURL=disposable.js.map"]},"metadata":{},"sourceType":"module"}