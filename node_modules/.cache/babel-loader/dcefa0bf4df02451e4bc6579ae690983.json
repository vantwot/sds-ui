{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport React from 'react';\nimport classNames from 'classnames';\n/** app */\n\nimport { initApp } from '../application-module';\nimport { XFlowAppInternalProvider, useXFlowApp } from './app-context';\n/** app-extension */\n\nimport { ExtensionRegistryContext } from './extension-context';\nimport { useXflowPrefixCls } from './global-config-context';\nimport { XFlowAppExtensionMoudle } from './app-extension-module';\nimport { ExtensionRegistry, createExtensionRegistry } from './extension-registry';\n/** graph */\n\nimport { XFlowCanvas } from './canvas';\n/** command */\n\nimport { ModelServiceRegistry } from '../../model-service';\nimport { CommandsRegistry, XFlowGraphCommands } from '../../command-contributions';\n/** hook */\n\nimport { HookRegistry } from '../../hooks';\n/** UI model */\n\nimport { ToolbarRegistry } from '../../toolbar';\nimport { MenuRegistry } from '../../menu';\nexport const XFlow = props => {\n  const {\n    meta,\n    graphConfig,\n    graphData,\n    graphLayout,\n    onLoad,\n    isAutoCenter,\n    hookConfig,\n    modelServiceConfig,\n    commandConfig,\n    onAppConfigReady,\n    onAppDestroy,\n    children = [],\n    className\n  } = props;\n  const [appRef, setAppRef] = React.useState();\n  /** XFlow App 配置中心 */\n\n  const extensionRegistry = createExtensionRegistry();\n  /** didmount */\n\n  React.useEffect(() => {\n    /** before app start */\n    if (onAppConfigReady) {\n      onAppConfigReady(extensionRegistry);\n    }\n    /** 初始化应用 */\n\n\n    const app = initApp(extensionRegistry);\n    app.start().then(() => __awaiter(void 0, void 0, void 0, function* () {\n      /** 保留引用 */\n      setAppRef(app);\n      /** 自动执行 load Meta */\n\n      if (meta) {\n        yield app.commandService.executeCommand(XFlowGraphCommands.LOAD_META.id, {\n          meta\n        });\n      }\n      /** after app start */\n\n\n      if (onLoad) {\n        onLoad(app, extensionRegistry);\n      }\n\n      if (graphData) {\n        if (graphLayout) {\n          yield app.commandService.executeCommand(XFlowGraphCommands.GRAPH_LAYOUT.id, Object.assign({\n            graphData\n          }, graphLayout));\n        }\n\n        yield app.commandService.executeCommand(XFlowGraphCommands.GRAPH_RENDER.id, {\n          graphData\n        });\n      }\n    }));\n    /** unmount */\n\n    const destroy = () => __awaiter(void 0, void 0, void 0, function* () {\n      onAppDestroy && onAppDestroy(app);\n    });\n\n    return () => {\n      destroy();\n    };\n    /** 不要删 保证只生成一次 */\n    // eslint-disable-next-line\n  }, []);\n  /** 自动更新meta */\n\n  React.useEffect(() => {\n    if (appRef) {\n      appRef.commandService.executeCommand(XFlowGraphCommands.LOAD_META.id, {\n        meta\n      });\n    }\n    /** 不要删 只和meta联动 */\n    // eslint-disable-next-line\n\n  }, [meta]);\n  /** 自动渲染画布内容 */\n\n  React.useEffect(() => {\n    const fn = () => __awaiter(void 0, void 0, void 0, function* () {\n      if (appRef) {\n        if (graphData && graphLayout) {\n          yield appRef.commandService.executeCommand(XFlowGraphCommands.GRAPH_LAYOUT.id, Object.assign({\n            graphData\n          }, graphLayout));\n        }\n\n        yield appRef.commandService.executeCommand(XFlowGraphCommands.GRAPH_RENDER.id, {\n          graphData\n        });\n        /** 自动居中画布内容 */\n\n        if (isAutoCenter) {\n          const x6Graph = yield appRef.getGraphInstance();\n          x6Graph.centerContent();\n        }\n      }\n    });\n\n    fn();\n    /** 不要删 只和graphData联动 */\n    // eslint-disable-next-line\n  }, [graphData]);\n  /** classname */\n\n  const appClzName = classNames('xflow-app-workspace', className, ...extensionRegistry.getContainerClassNames());\n  /** 判断是否需要自动渲染画布组件, 坐标相对于xflow-graph-root */\n\n  const hasCanvasComponent = (Array.isArray(children) ? children : [children]).some(child => {\n    return child && child.props.isXFlowCanvas;\n  });\n  return React.createElement(XFlowAppInternalProvider, {\n    app: appRef\n  }, React.createElement(ExtensionRegistryContext.Provider, {\n    value: extensionRegistry\n  }, React.createElement(\"div\", {\n    className: appClzName,\n    id: extensionRegistry.getInstaceId()\n  }, !hasCanvasComponent && React.createElement(XFlowCanvas, {\n    config: graphConfig,\n    position: {\n      top: 0,\n      bottom: 0,\n      left: 0,\n      right: 0\n    }\n  }), children, React.createElement(ModelServiceRegistry, {\n    config: modelServiceConfig\n  }), React.createElement(CommandsRegistry, {\n    config: commandConfig\n  }), React.createElement(HookRegistry, {\n    config: hookConfig\n  }), React.createElement(ToolbarRegistry, null), React.createElement(MenuRegistry, null))));\n};\nXFlow.defaultProps = {};\nexport default XFlow;\nexport { useXFlowApp, useXflowPrefixCls, XFlowCanvas, XFlowAppExtensionMoudle as XFlowAppExtension, ExtensionRegistry };","map":{"version":3,"sources":["../../../src/xflow-main/components/index.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport React from 'react';\nimport classNames from 'classnames';\n/** app */\nimport { initApp } from '../application-module';\nimport { XFlowAppInternalProvider, useXFlowApp } from './app-context';\n/** app-extension */\nimport { ExtensionRegistryContext } from './extension-context';\nimport { useXflowPrefixCls } from './global-config-context';\nimport { XFlowAppExtensionMoudle } from './app-extension-module';\nimport { ExtensionRegistry, createExtensionRegistry } from './extension-registry';\n/** graph */\nimport { XFlowCanvas } from './canvas';\n/** command */\nimport { ModelServiceRegistry } from '../../model-service';\nimport { CommandsRegistry, XFlowGraphCommands } from '../../command-contributions';\n/** hook */\nimport { HookRegistry } from '../../hooks';\n/** UI model */\nimport { ToolbarRegistry } from '../../toolbar';\nimport { MenuRegistry } from '../../menu';\nexport const XFlow = props => {\n    const { meta, graphConfig, graphData, graphLayout, onLoad, isAutoCenter, hookConfig, modelServiceConfig, commandConfig, onAppConfigReady, onAppDestroy, children = [], className, } = props;\n    const [appRef, setAppRef] = React.useState();\n    /** XFlow App 配置中心 */\n    const extensionRegistry = createExtensionRegistry();\n    /** didmount */\n    React.useEffect(() => {\n        /** before app start */\n        if (onAppConfigReady) {\n            onAppConfigReady(extensionRegistry);\n        }\n        /** 初始化应用 */\n        const app = initApp(extensionRegistry);\n        app.start().then(() => __awaiter(void 0, void 0, void 0, function* () {\n            /** 保留引用 */\n            setAppRef(app);\n            /** 自动执行 load Meta */\n            if (meta) {\n                yield app.commandService.executeCommand(XFlowGraphCommands.LOAD_META.id, { meta });\n            }\n            /** after app start */\n            if (onLoad) {\n                onLoad(app, extensionRegistry);\n            }\n            if (graphData) {\n                if (graphLayout) {\n                    yield app.commandService.executeCommand(XFlowGraphCommands.GRAPH_LAYOUT.id, Object.assign({ graphData }, graphLayout));\n                }\n                yield app.commandService.executeCommand(XFlowGraphCommands.GRAPH_RENDER.id, { graphData });\n            }\n        }));\n        /** unmount */\n        const destroy = () => __awaiter(void 0, void 0, void 0, function* () {\n            onAppDestroy && onAppDestroy(app);\n        });\n        return () => {\n            destroy();\n        };\n        /** 不要删 保证只生成一次 */\n        // eslint-disable-next-line\n    }, []);\n    /** 自动更新meta */\n    React.useEffect(() => {\n        if (appRef) {\n            appRef.commandService.executeCommand(XFlowGraphCommands.LOAD_META.id, { meta });\n        }\n        /** 不要删 只和meta联动 */\n        // eslint-disable-next-line\n    }, [meta]);\n    /** 自动渲染画布内容 */\n    React.useEffect(() => {\n        const fn = () => __awaiter(void 0, void 0, void 0, function* () {\n            if (appRef) {\n                if (graphData && graphLayout) {\n                    yield appRef.commandService.executeCommand(XFlowGraphCommands.GRAPH_LAYOUT.id, Object.assign({ graphData }, graphLayout));\n                }\n                yield appRef.commandService.executeCommand(XFlowGraphCommands.GRAPH_RENDER.id, {\n                    graphData,\n                });\n                /** 自动居中画布内容 */\n                if (isAutoCenter) {\n                    const x6Graph = yield appRef.getGraphInstance();\n                    x6Graph.centerContent();\n                }\n            }\n        });\n        fn();\n        /** 不要删 只和graphData联动 */\n        // eslint-disable-next-line\n    }, [graphData]);\n    /** classname */\n    const appClzName = classNames('xflow-app-workspace', className, ...extensionRegistry.getContainerClassNames());\n    /** 判断是否需要自动渲染画布组件, 坐标相对于xflow-graph-root */\n    const hasCanvasComponent = (Array.isArray(children) ? children : [children]).some(child => {\n        return child && child.props.isXFlowCanvas;\n    });\n    return (React.createElement(XFlowAppInternalProvider, { app: appRef },\n        React.createElement(ExtensionRegistryContext.Provider, { value: extensionRegistry },\n            React.createElement(\"div\", { className: appClzName, id: extensionRegistry.getInstaceId() },\n                !hasCanvasComponent && (React.createElement(XFlowCanvas, { config: graphConfig, position: { top: 0, bottom: 0, left: 0, right: 0 } })),\n                children,\n                React.createElement(ModelServiceRegistry, { config: modelServiceConfig }),\n                React.createElement(CommandsRegistry, { config: commandConfig }),\n                React.createElement(HookRegistry, { config: hookConfig }),\n                React.createElement(ToolbarRegistry, null),\n                React.createElement(MenuRegistry, null)))));\n};\nXFlow.defaultProps = {};\nexport default XFlow;\nexport { useXFlowApp, useXflowPrefixCls, XFlowCanvas, XFlowAppExtensionMoudle as XFlowAppExtension, ExtensionRegistry, };\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}