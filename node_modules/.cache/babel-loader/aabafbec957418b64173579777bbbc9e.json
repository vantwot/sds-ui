{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport DOM from '../utils/dom';\nimport { Event } from './events/event';\n\nvar BoxZoomHandler = function () {\n  function BoxZoomHandler(map, options) {\n    _classCallCheck(this, BoxZoomHandler);\n\n    _defineProperty(this, \"map\", void 0);\n\n    _defineProperty(this, \"el\", void 0);\n\n    _defineProperty(this, \"container\", void 0);\n\n    _defineProperty(this, \"enabled\", void 0);\n\n    _defineProperty(this, \"active\", void 0);\n\n    _defineProperty(this, \"startPos\", void 0);\n\n    _defineProperty(this, \"lastPos\", void 0);\n\n    _defineProperty(this, \"box\", void 0);\n\n    _defineProperty(this, \"clickTolerance\", void 0);\n\n    this.map = map;\n    this.el = map.getCanvasContainer();\n    this.container = map.getContainer();\n    this.clickTolerance = options.clickTolerance || 1;\n  }\n\n  _createClass(BoxZoomHandler, [{\n    key: \"isEnabled\",\n    value: function isEnabled() {\n      return !!this.enabled;\n    }\n  }, {\n    key: \"isActive\",\n    value: function isActive() {\n      return !!this.active;\n    }\n  }, {\n    key: \"enable\",\n    value: function enable() {\n      if (this.isEnabled()) {\n        return;\n      }\n\n      this.enabled = true;\n    }\n  }, {\n    key: \"disable\",\n    value: function disable() {\n      if (!this.isEnabled()) {\n        return;\n      }\n\n      this.enabled = false;\n    }\n  }, {\n    key: \"mousedown\",\n    value: function mousedown(e, point) {\n      if (!this.isEnabled()) {\n        return;\n      }\n\n      if (!(e.shiftKey && e.button === 0)) {\n        return;\n      }\n\n      DOM.disableDrag();\n      this.startPos = this.lastPos = point;\n      this.active = true;\n    }\n  }, {\n    key: \"mousemoveWindow\",\n    value: function mousemoveWindow(e, point) {\n      if (!this.active) {\n        return;\n      }\n\n      var pos = point;\n\n      if (this.lastPos.equals(pos) || !this.box && pos.dist(this.startPos) < this.clickTolerance) {\n        return;\n      }\n\n      var p0 = this.startPos;\n      this.lastPos = pos;\n\n      if (!this.box) {\n        this.box = DOM.create('div', 'l7-boxzoom', this.container);\n        this.container.classList.add('l7-crosshair');\n        this.fireEvent('boxzoomstart', e);\n      }\n\n      var minX = Math.min(p0.x, pos.x);\n      var maxX = Math.max(p0.x, pos.x);\n      var minY = Math.min(p0.y, pos.y);\n      var maxY = Math.max(p0.y, pos.y);\n      DOM.setTransform(this.box, \"translate(\".concat(minX, \"px,\").concat(minY, \"px)\"));\n\n      if (this.box) {\n        this.box.style.width = \"\".concat(maxX - minX, \"px\");\n        this.box.style.height = \"\".concat(maxY - minY, \"px\");\n      }\n    }\n  }, {\n    key: \"mouseupWindow\",\n    value: function mouseupWindow(e, point) {\n      var _this = this;\n\n      if (!this.active) {\n        return;\n      }\n\n      if (e.button !== 0) {\n        return;\n      }\n\n      var p0 = this.startPos;\n      var p1 = point;\n      this.reset();\n      DOM.suppressClick();\n\n      if (p0.x === p1.x && p0.y === p1.y) {\n        this.fireEvent('boxzoomcancel', e);\n      } else {\n        this.map.emit('boxzoomend', new Event('boxzoomend', {\n          originalEvent: e\n        }));\n        return {\n          cameraAnimation: function cameraAnimation(map) {\n            return map.fitScreenCoordinates(p0, p1, _this.map.getBearing(), {\n              linear: true\n            });\n          }\n        };\n      }\n    }\n  }, {\n    key: \"keydown\",\n    value: function keydown(e) {\n      if (!this.active) {\n        return;\n      }\n\n      if (e.keyCode === 27) {\n        this.reset();\n        this.fireEvent('boxzoomcancel', e);\n      }\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.active = false;\n      this.container.classList.remove('l7-crosshair');\n\n      if (this.box) {\n        DOM.remove(this.box);\n        this.box = null;\n      }\n\n      DOM.enableDrag();\n      delete this.startPos;\n      delete this.lastPos;\n    }\n  }, {\n    key: \"fireEvent\",\n    value: function fireEvent(type, e) {\n      return this.map.emit(type, new Event(type, {\n        originalEvent: e\n      }));\n    }\n  }]);\n\n  return BoxZoomHandler;\n}();\n\nexport default BoxZoomHandler;","map":{"version":3,"sources":["../../src/handler/box_zoom.ts"],"names":["BoxZoomHandler","map","options","e","DOM","pos","p0","minX","Math","maxX","minY","maxY","p1","originalEvent","cameraAnimation","linear"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport { EarthMap } from '../earthmap';\nimport Point from '../geo/point';\nimport { Map } from '../map';\nimport DOM from '../utils/dom';\nimport { Event } from './events/event';\n\n/**\n * The `BoxZoomHandler` allows the user to zoom the map to fit within a bounding box.\n * The bounding box is defined by clicking and holding `shift` while dragging the cursor.\n */\nclass BoxZoomHandler {\n  private map: Map | EarthMap;\n  private el: HTMLElement;\n  private container: HTMLElement;\n  private enabled: boolean;\n  private active: boolean;\n  private startPos: Point;\n  private lastPos: Point;\n  private box: HTMLElement | null;\n  private clickTolerance: number;\n\n  /**\n   * @private\n   */\n  constructor(\n    map: Map | EarthMap,\n    options: {\n      clickTolerance: number;\n    },\n  ) {\n    this.map = map;\n    this.el = map.getCanvasContainer();\n    this.container = map.getContainer();\n    this.clickTolerance = options.clickTolerance || 1;\n  }\n\n  /**\n   * Returns a Boolean indicating whether the \"box zoom\" interaction is enabled.\n   *\n   * @returns {boolean} `true` if the \"box zoom\" interaction is enabled.\n   */\n  public isEnabled() {\n    return !!this.enabled;\n  }\n\n  /**\n   * Returns a Boolean indicating whether the \"box zoom\" interaction is active, i.e. currently being used.\n   *\n   * @returns {boolean} `true` if the \"box zoom\" interaction is active.\n   */\n  public isActive() {\n    return !!this.active;\n  }\n\n  /**\n   * Enables the \"box zoom\" interaction.\n   *\n   * @example\n   *   map.boxZoom.enable();\n   */\n  public enable() {\n    if (this.isEnabled()) {\n      return;\n    }\n    this.enabled = true;\n  }\n\n  /**\n   * Disables the \"box zoom\" interaction.\n   *\n   * @example\n   *   map.boxZoom.disable();\n   */\n  public disable() {\n    if (!this.isEnabled()) {\n      return;\n    }\n    this.enabled = false;\n  }\n\n  public mousedown(e: MouseEvent, point: Point) {\n    if (!this.isEnabled()) {\n      return;\n    }\n    if (!(e.shiftKey && e.button === 0)) {\n      return;\n    }\n\n    DOM.disableDrag();\n    this.startPos = this.lastPos = point;\n    this.active = true;\n  }\n\n  public mousemoveWindow(e: MouseEvent, point: Point) {\n    if (!this.active) {\n      return;\n    }\n\n    const pos = point;\n\n    if (\n      this.lastPos.equals(pos) ||\n      (!this.box && pos.dist(this.startPos) < this.clickTolerance)\n    ) {\n      return;\n    }\n\n    const p0 = this.startPos;\n    this.lastPos = pos;\n\n    if (!this.box) {\n      this.box = DOM.create('div', 'l7-boxzoom', this.container);\n      this.container.classList.add('l7-crosshair');\n      this.fireEvent('boxzoomstart', e);\n    }\n    const minX = Math.min(p0.x, pos.x);\n    const maxX = Math.max(p0.x, pos.x);\n    const minY = Math.min(p0.y, pos.y);\n    const maxY = Math.max(p0.y, pos.y);\n\n    DOM.setTransform(this.box, `translate(${minX}px,${minY}px)`);\n    if (this.box) {\n      this.box.style.width = `${maxX - minX}px`;\n      this.box.style.height = `${maxY - minY}px`;\n    }\n  }\n\n  public mouseupWindow(e: MouseEvent, point: Point) {\n    if (!this.active) {\n      return;\n    }\n\n    if (e.button !== 0) {\n      return;\n    }\n\n    const p0 = this.startPos;\n    const p1 = point;\n\n    this.reset();\n\n    DOM.suppressClick();\n\n    if (p0.x === p1.x && p0.y === p1.y) {\n      this.fireEvent('boxzoomcancel', e);\n    } else {\n      this.map.emit(\n        'boxzoomend',\n        new Event('boxzoomend', { originalEvent: e }),\n      );\n      return {\n        cameraAnimation: (map: Map) =>\n          map.fitScreenCoordinates(p0, p1, this.map.getBearing(), {\n            linear: true,\n          }),\n      };\n    }\n  }\n\n  public keydown(e: KeyboardEvent) {\n    if (!this.active) {\n      return;\n    }\n\n    if (e.keyCode === 27) {\n      this.reset();\n      this.fireEvent('boxzoomcancel', e);\n    }\n  }\n\n  public reset() {\n    this.active = false;\n\n    this.container.classList.remove('l7-crosshair');\n\n    if (this.box) {\n      DOM.remove(this.box);\n      this.box = null;\n    }\n\n    DOM.enableDrag();\n    // @ts-ignore\n    delete this.startPos;\n    // @ts-ignore\n    delete this.lastPos;\n  }\n\n  public fireEvent(type: string, e: any) {\n    return this.map.emit(type, new Event(type, { originalEvent: e }));\n  }\n}\n\nexport default BoxZoomHandler;\n"]},"metadata":{},"sourceType":"module"}