{"ast":null,"code":"import _slicedToArray from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { uuidv4 } from '@antv/xflow-core';\nimport { isNumber } from 'lodash';\nimport * as NodesComponent from './nodes';\nimport { NODE_HEIGHT, NODE_WIDTH, NODEPOOL } from './constants';\n/** 和 graph config 注册的节点保持一致 */\n\nvar getAnchorStyle = function getAnchorStyle(position) {\n  return {\n    position: {\n      name: position\n    },\n    attrs: {\n      circle: {\n        r: 4,\n        magnet: true,\n        stroke: '#31d0c6',\n        strokeWidth: 2,\n        fill: '#fff',\n        style: {\n          visibility: 'hidden'\n        }\n      }\n    },\n    zIndex: 10\n  };\n};\n\nvar getPorts = function getPorts() {\n  var position = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ['top', 'right', 'bottom', 'left'];\n  return {\n    items: position.map(function (name) {\n      return {\n        group: name,\n        id: uuidv4()\n      };\n    }),\n    groups: {\n      top: getAnchorStyle('top'),\n      right: getAnchorStyle('right'),\n      bottom: getAnchorStyle('bottom'),\n      left: getAnchorStyle('left')\n    }\n  };\n};\n\nexport var getRegisterNode = function getRegisterNode(nodes) {\n  return (nodes || []).map(function (item) {\n    var name = item.name,\n        popover = item.popover,\n        _item$label = item.label,\n        label = _item$label === void 0 ? '' : _item$label,\n        _item$width = item.width,\n        width = _item$width === void 0 ? NODE_HEIGHT : _item$width,\n        _item$height = item.height,\n        height = _item$height === void 0 ? NODE_HEIGHT : _item$height,\n        ports = item.ports;\n    var id = uuidv4(); // 暂不使用上层数据\n\n    return {\n      id: id,\n      renderKey: name,\n      name: name,\n      label: label,\n      popoverContent: popover,\n      width: width,\n      height: height,\n      ports: ports || getPorts(),\n      originData: Object.assign({}, item),\n      isCustom: true\n    };\n  });\n};\nexport var nodeService = function nodeService(nodes) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var customNodes;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            customNodes = getRegisterNode(nodes);\n            return _context.abrupt(\"return\", [].concat(_toConsumableArray(customNodes), _toConsumableArray(NODEPOOL.map(function (_ref) {\n              var name = _ref.name,\n                  ports = _ref.ports,\n                  _ref$width = _ref.width,\n                  width = _ref$width === void 0 ? NODE_WIDTH : _ref$width,\n                  _ref$height = _ref.height,\n                  height = _ref$height === void 0 ? NODE_HEIGHT : _ref$height,\n                  _ref$label = _ref.label,\n                  label = _ref$label === void 0 ? '' : _ref$label;\n              return {\n                id: uuidv4(),\n                renderKey: name,\n                name: name,\n                label: label,\n                popoverContent: function popoverContent() {\n                  return name;\n                },\n                width: width,\n                height: height,\n                ports: getPorts(ports)\n              };\n            }))));\n\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n};\nexport var setNodeRender = function setNodeRender(config) {\n  var nodes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  // 自定义节点\n  if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n    nodes.forEach(function (item) {\n      var name = item.name,\n          component = item.component;\n      config.setNodeRender(name, component);\n    });\n  }\n  /** 默认节点，通过 Terminal 标识，避免多次调用*/\n\n\n  if (!config.nodeRender.get('Terminal')) {\n    NODEPOOL.forEach(function (item) {\n      config.setNodeRender(item.name, NodesComponent[\"\".concat(item.name.replace(/\\s+/g, ''), \"Node\")]);\n    });\n  }\n}; // 创建节点路径\n\nexport var createPath = function createPath(paths) {\n  var offsetX = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var offsetY = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n  if (!paths.length) {\n    return null;\n  }\n\n  var path = ''; // @ts-ignore\n\n  paths.forEach(function (item) {\n    var _item = _slicedToArray(item, 5),\n        c = _item[0],\n        x = _item[1],\n        y = _item[2],\n        c2x = _item[3],\n        c2y = _item[4];\n\n    path += isNumber(y) ? \" \".concat(c, \" \").concat(x + offsetX, \" \").concat(y + offsetY) : \" \".concat(c);\n\n    if (c2y) {\n      path += \" \".concat(c2x + offsetX, \" \").concat(c2y + offsetY);\n    }\n  });\n  return path;\n};","map":{"version":3,"sources":["../../src/flowchart-node-panel/utils.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAS,MAAT,QAAuB,kBAAvB;AACA,SAAS,QAAT,QAAyB,QAAzB;AACA,OAAO,KAAK,cAAZ,MAAgC,SAAhC;AACA,SAAS,WAAT,EAAsB,UAAtB,EAAkC,QAAlC,QAAkD,aAAlD;AAEA;;AACA,IAAM,cAAc,GAAG,SAAjB,cAAiB,CAAC,QAAD,EAAqB;AAC1C,SAAO;AACL,IAAA,QAAQ,EAAE;AAAE,MAAA,IAAI,EAAE;AAAR,KADL;AAEL,IAAA,KAAK,EAAE;AACL,MAAA,MAAM,EAAE;AACN,QAAA,CAAC,EAAE,CADG;AAEN,QAAA,MAAM,EAAE,IAFF;AAGN,QAAA,MAAM,EAAE,SAHF;AAIN,QAAA,WAAW,EAAE,CAJP;AAKN,QAAA,IAAI,EAAE,MALA;AAMN,QAAA,KAAK,EAAE;AACL,UAAA,UAAU,EAAE;AADP;AAND;AADH,KAFF;AAcL,IAAA,MAAM,EAAE;AAdH,GAAP;AAgBD,CAjBD;;AAmBA,IAAM,QAAQ,GAAG,SAAX,QAAW,GAAkD;AAAA,MAAjD,QAAiD,uEAAtC,CAAC,KAAD,EAAQ,OAAR,EAAiB,QAAjB,EAA2B,MAA3B,CAAsC;AACjE,SAAO;AACL,IAAA,KAAK,EAAE,QAAQ,CAAC,GAAT,CAAa,UAAA,IAAI,EAAG;AACzB,aAAO;AAAE,QAAA,KAAK,EAAE,IAAT;AAAe,QAAA,EAAE,EAAE,MAAM;AAAzB,OAAP;AACD,KAFM,CADF;AAIL,IAAA,MAAM,EAAE;AACN,MAAA,GAAG,EAAE,cAAc,CAAC,KAAD,CADb;AAEN,MAAA,KAAK,EAAE,cAAc,CAAC,OAAD,CAFf;AAGN,MAAA,MAAM,EAAE,cAAc,CAAC,QAAD,CAHhB;AAIN,MAAA,IAAI,EAAE,cAAc,CAAC,MAAD;AAJd;AAJH,GAAP;AAWD,CAZD;;AAcA,OAAO,IAAM,eAAe,GAAG,SAAlB,eAAkB,CAAA,KAAK,EAAG;AACrC,SAAO,CAAC,KAAK,IAAI,EAAV,EAAc,GAAd,CAAkB,UAAA,IAAI,EAAG;AAC9B,QAAQ,IAAR,GAAwF,IAAxF,CAAQ,IAAR;AAAA,QAAc,OAAd,GAAwF,IAAxF,CAAc,OAAd;AAAA,sBAAwF,IAAxF,CAAuB,KAAvB;AAAA,QAAuB,KAAvB,4BAA+B,EAA/B;AAAA,sBAAwF,IAAxF,CAAmC,KAAnC;AAAA,QAAmC,KAAnC,4BAA2C,WAA3C;AAAA,uBAAwF,IAAxF,CAAwD,MAAxD;AAAA,QAAwD,MAAxD,6BAAiE,WAAjE;AAAA,QAA8E,KAA9E,GAAwF,IAAxF,CAA8E,KAA9E;AACA,QAAM,EAAE,GAAG,MAAM,EAAjB,CAF8B,CAEV;;AACpB,WAAO;AACL,MAAA,EAAE,EAAF,EADK;AAEL,MAAA,SAAS,EAAE,IAFN;AAGL,MAAA,IAAI,EAAJ,IAHK;AAIL,MAAA,KAAK,EAAL,KAJK;AAKL,MAAA,cAAc,EAAE,OALX;AAML,MAAA,KAAK,EAAL,KANK;AAOL,MAAA,MAAM,EAAN,MAPK;AAQL,MAAA,KAAK,EAAE,KAAK,IAAI,QAAQ,EARnB;AASL,MAAA,UAAU,EAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EAAO,IAAP,CATL;AAUL,MAAA,QAAQ,EAAE;AAVL,KAAP;AAYD,GAfM,CAAP;AAgBD,CAjBM;AAmBP,OAAO,IAAM,WAAW,GAAG,SAAd,WAAc,CAAM,KAAN;AAAA,SAAc,SAAA,CAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,wCAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACjC,YAAA,WADiC,GACnB,eAAe,CAAC,KAAD,CADI;AAAA,0EAIlC,WAJkC,sBAKlC,QAAQ,CAAC,GAAT,CAAa,gBAA0E;AAAA,kBAAvE,IAAuE,QAAvE,IAAuE;AAAA,kBAAjE,KAAiE,QAAjE,KAAiE;AAAA,oCAA1D,KAA0D;AAAA,kBAA1D,KAA0D,2BAAlD,UAAkD;AAAA,qCAAtC,MAAsC;AAAA,kBAAtC,MAAsC,4BAA7B,WAA6B;AAAA,oCAAhB,KAAgB;AAAA,kBAAhB,KAAgB,2BAAR,EAAQ;AACxF,qBAAO;AACL,gBAAA,EAAE,EAAE,MAAM,EADL;AAEL,gBAAA,SAAS,EAAE,IAFN;AAGL,gBAAA,IAAI,EAAJ,IAHK;AAIL,gBAAA,KAAK,EAAL,KAJK;AAKL,gBAAA,cAAc,EAAE;AAAA,yBAAM,IAAN;AAAA,iBALX;AAML,gBAAA,KAAK,EAAL,KANK;AAOL,gBAAA,MAAM,EAAN,MAPK;AAQL,gBAAA,KAAK,EAAE,QAAQ,CAAC,KAAD;AARV,eAAP;AAUD,aAXE,CALkC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAA,EAAd;AAAA,CAApB;AAoBP,OAAO,IAAM,aAAa,GAAG,SAAhB,aAAgB,CAAC,MAAD,EAAuB;AAAA,MAAd,KAAc,uEAAN,EAAM;;AAClD;AACA,MAAI,KAAK,KAAA,IAAL,IAAA,KAAK,KAAA,KAAA,CAAL,GAAK,KAAA,CAAL,GAAA,KAAK,CAAE,MAAX,EAAmB;AACjB,IAAA,KAAK,CAAC,OAAN,CAAc,UAAA,IAAI,EAAG;AACnB,UAAQ,IAAR,GAA4B,IAA5B,CAAQ,IAAR;AAAA,UAAc,SAAd,GAA4B,IAA5B,CAAc,SAAd;AACA,MAAA,MAAM,CAAC,aAAP,CAAqB,IAArB,EAA2B,SAA3B;AACD,KAHD;AAID;AACD;;;AACA,MAAI,CAAC,MAAM,CAAC,UAAP,CAAkB,GAAlB,CAAsB,UAAtB,CAAL,EAAwC;AACtC,IAAA,QAAQ,CAAC,OAAT,CAAiB,UAAA,IAAI,EAAG;AACtB,MAAA,MAAM,CAAC,aAAP,CAAqB,IAAI,CAAC,IAA1B,EAAgC,cAAc,WAAI,IAAI,CAAC,IAAL,CAAU,OAAV,CAAkB,MAAlB,EAA0B,EAA1B,CAAJ,UAA9C;AACD,KAFD;AAGD;AACF,CAdM,C,CAiBP;;AACA,OAAO,IAAM,UAAU,GAAG,SAAb,UAAa,CAAC,KAAD,EAA2D;AAAA,MAA5B,OAA4B,uEAAlB,CAAkB;AAAA,MAAf,OAAe,uEAAL,CAAK;;AACnF,MAAI,CAAC,KAAK,CAAC,MAAX,EAAmB;AACjB,WAAO,IAAP;AACD;;AACD,MAAI,IAAI,GAAG,EAAX,CAJmF,CAKnF;;AACA,EAAA,KAAK,CAAC,OAAN,CAAc,UAAC,IAAD,EAAgB;AAC5B,+BAA4B,IAA5B;AAAA,QAAO,CAAP;AAAA,QAAU,CAAV;AAAA,QAAa,CAAb;AAAA,QAAgB,GAAhB;AAAA,QAAqB,GAArB;;AACA,IAAA,IAAI,IAAI,QAAQ,CAAC,CAAD,CAAR,cAAkB,CAAlB,cAAuB,CAAC,GAAG,OAA3B,cAAsC,CAAC,GAAG,OAA1C,eAA0D,CAA1D,CAAR;;AACA,QAAI,GAAJ,EAAS;AACP,MAAA,IAAI,eAAQ,GAAG,GAAG,OAAd,cAAyB,GAAG,GAAG,OAA/B,CAAJ;AACD;AACF,GAND;AAQA,SAAO,IAAP;AACD,CAfM","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { uuidv4 } from '@antv/xflow-core';\nimport { isNumber } from 'lodash';\nimport * as NodesComponent from './nodes';\nimport { NODE_HEIGHT, NODE_WIDTH, NODEPOOL } from './constants';\n/** 和 graph config 注册的节点保持一致 */\nconst getAnchorStyle = (position) => {\n    return {\n        position: { name: position },\n        attrs: {\n            circle: {\n                r: 4,\n                magnet: true,\n                stroke: '#31d0c6',\n                strokeWidth: 2,\n                fill: '#fff',\n                style: {\n                    visibility: 'hidden',\n                },\n            },\n        },\n        zIndex: 10,\n    };\n};\nconst getPorts = (position = ['top', 'right', 'bottom', 'left']) => {\n    return {\n        items: position.map(name => {\n            return { group: name, id: uuidv4() };\n        }),\n        groups: {\n            top: getAnchorStyle('top'),\n            right: getAnchorStyle('right'),\n            bottom: getAnchorStyle('bottom'),\n            left: getAnchorStyle('left'),\n        },\n    };\n};\nexport const getRegisterNode = nodes => {\n    return (nodes || []).map(item => {\n        const { name, popover, label = '', width = NODE_HEIGHT, height = NODE_HEIGHT, ports } = item;\n        const id = uuidv4(); // 暂不使用上层数据\n        return {\n            id,\n            renderKey: name,\n            name,\n            label,\n            popoverContent: popover,\n            width,\n            height,\n            ports: ports || getPorts(),\n            originData: Object.assign({}, item),\n            isCustom: true,\n        };\n    });\n};\nexport const nodeService = (nodes) => __awaiter(void 0, void 0, void 0, function* () {\n    const customNodes = getRegisterNode(nodes);\n    return [\n        ...customNodes,\n        ...NODEPOOL.map(({ name, ports, width = NODE_WIDTH, height = NODE_HEIGHT, label = '' }) => {\n            return {\n                id: uuidv4(),\n                renderKey: name,\n                name,\n                label,\n                popoverContent: () => name,\n                width,\n                height,\n                ports: getPorts(ports),\n            };\n        }),\n    ];\n});\nexport const setNodeRender = (config, nodes = []) => {\n    // 自定义节点\n    if (nodes === null || nodes === void 0 ? void 0 : nodes.length) {\n        nodes.forEach(item => {\n            const { name, component } = item;\n            config.setNodeRender(name, component);\n        });\n    }\n    /** 默认节点，通过 Terminal 标识，避免多次调用*/\n    if (!config.nodeRender.get('Terminal')) {\n        NODEPOOL.forEach(item => {\n            config.setNodeRender(item.name, NodesComponent[`${item.name.replace(/\\s+/g, '')}Node`]);\n        });\n    }\n};\n// 创建节点路径\nexport const createPath = (paths, offsetX = 0, offsetY = 0) => {\n    if (!paths.length) {\n        return null;\n    }\n    let path = '';\n    // @ts-ignore\n    paths.forEach((item) => {\n        const [c, x, y, c2x, c2y] = item;\n        path += isNumber(y) ? ` ${c} ${x + offsetX} ${y + offsetY}` : ` ${c}`;\n        if (c2y) {\n            path += ` ${c2x + offsetX} ${c2y + offsetY}`;\n        }\n    });\n    return path;\n};\n//# sourceMappingURL=utils.js.map"]},"metadata":{},"sourceType":"module"}