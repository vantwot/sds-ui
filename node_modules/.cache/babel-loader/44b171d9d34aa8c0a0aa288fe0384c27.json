{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { each, mix } from '@antv/util';\nimport { Util } from '@antv/g6-core';\nimport Base from '../base';\nvar pointLineDistance = Util.pointLineDistance; // 对齐线样式\n\nvar alignLineStyle = {\n  stroke: '#FA8C16',\n  lineWidth: 1\n};\n\nvar SnapLine =\n/** @class */\nfunction (_super) {\n  __extends(SnapLine, _super);\n\n  function SnapLine(props) {\n    return _super.call(this, props) || this;\n  }\n\n  SnapLine.prototype.getDefaultCfgs = function () {\n    return {\n      line: alignLineStyle,\n\n      /**\n       * item align type\n       * @type {String|True|False}\n       */\n      itemAlignType: 'center',\n\n      /**\n       * tolerance to item force align\n       * @type {String|True|False}\n       */\n      tolerance: 5,\n      horizontalLines: {},\n      verticalLines: {},\n      alignLines: []\n    };\n  };\n\n  SnapLine.prototype.init = function () {}; // class-methods-use-this\n\n\n  SnapLine.prototype.getEvents = function () {\n    return {\n      'node:dragstart': 'onDragStart',\n      'node:drag': 'onDrag',\n      'node:dragend': 'onDragEnd'\n    };\n  };\n\n  SnapLine.prototype.onDragStart = function () {\n    this.initBoxLine();\n  };\n\n  SnapLine.prototype.onDrag = function (e) {\n    var item = e.item; // 计算辅助线位置,拖动过程中更新辅助线\n\n    var delegateShape = item.get('delegateShape') || item;\n    var bbox = delegateShape.getBBox();\n    var model = item.getModel();\n    var dx = model.x - bbox.x;\n    var dy = model.y - bbox.y;\n    this.show({\n      x: bbox.minX + dx,\n      y: bbox.minY + dy\n    }, {\n      width: bbox.width,\n      height: bbox.height\n    });\n  };\n\n  SnapLine.prototype.onDragEnd = function () {\n    // 拖动结束时候删除辅助线\n    this.destory();\n  };\n  /**\n   * 每次开始拖动之前，计算出所有节点在水平和垂直方向上，左中右三条中线，并缓存起来\n   *\n   * @param {object} item Node节点\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.initBoxLine = function () {\n    var _a = this._cfgs,\n        horizontalLines = _a.horizontalLines,\n        verticalLines = _a.verticalLines,\n        itemAlignType = _a.itemAlignType;\n    var graph = this.get('graph');\n    var nodes = graph.getNodes();\n    nodes.forEach(function (item) {\n      var bbox = item.getBBox();\n      var nodeId = item.get('id'); // 设置水平方向辅助线\n\n      if (itemAlignType === true || itemAlignType === 'horizontal') {\n        // tltr: top left top right\n        // lcrc: left center right center\n        // blbr: bottom left bottom right\n        horizontalLines[nodeId + \"tltr\"] = [bbox.minX, bbox.minY, bbox.maxX, bbox.minY, item];\n        horizontalLines[nodeId + \"lcrc\"] = [bbox.minX, bbox.centerY, bbox.maxX, bbox.centerY, item];\n        horizontalLines[nodeId + \"blbr\"] = [bbox.minX, bbox.maxY, bbox.maxX, bbox.maxY, item];\n      } else if (itemAlignType === 'center') {\n        horizontalLines[nodeId + \"lcrc\"] = [bbox.minX, bbox.centerY, bbox.maxX, bbox.centerY, item];\n      } // 设置垂直方向辅助线\n\n\n      if (itemAlignType === true || itemAlignType === 'vertical') {\n        // tlbl: top left bottom left\n        // tcbc: top center bottom center\n        // trbr: top right bottom right\n        verticalLines[nodeId + \"tlbl\"] = [bbox.minX, bbox.minY, bbox.minX, bbox.maxY, item];\n        verticalLines[nodeId + \"tcbc\"] = [bbox.centerX, bbox.minY, bbox.centerX, bbox.maxY, item];\n        verticalLines[nodeId + \"trbr\"] = [bbox.maxX, bbox.minY, bbox.maxX, bbox.maxY, item];\n      } else if (itemAlignType === 'center') {\n        verticalLines[nodeId + \"tcbc\"] = [bbox.centerX, bbox.minY, bbox.centerX, bbox.maxY, item];\n      }\n    });\n  };\n  /**\n   * 显示AlignLine\n   *\n   * @param {object} point 起始点\n   * @param {object} bbox BBox\n   * @returns\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.show = function (point, bbox) {\n    var originPoint = mix({}, point);\n    this.itemAlign(point, bbox, originPoint);\n    return point;\n  };\n  /**\n   * 拖动拖出中添加辅助线\n   *\n   * @param {object} point 起始点\n   * @param {object} bbox 代理形状的bbox\n   * @param {object} originPoint 原始点，同point\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.itemAlign = function (point, bbox, originPoint) {\n    var _this = this;\n\n    var _a = this._cfgs,\n        horizontalLines = _a.horizontalLines,\n        verticalLines = _a.verticalLines,\n        tolerance = _a.tolerance;\n    var tc = {\n      x: originPoint.x + bbox.width / 2,\n      y: originPoint.y\n    };\n    var cc = {\n      x: originPoint.x + bbox.width / 2,\n      y: originPoint.y + bbox.height / 2\n    };\n    var bc = {\n      x: originPoint.x + bbox.width / 2,\n      y: originPoint.y + bbox.height\n    };\n    var lc = {\n      x: originPoint.x,\n      y: originPoint.y + bbox.height / 2\n    };\n    var rc = {\n      x: originPoint.x + bbox.width,\n      y: originPoint.y + bbox.height / 2\n    };\n    var horizontalDis = [];\n    var verticalDis = [];\n    var alignCfg = null;\n    this.clearAlignLine();\n    each(horizontalLines, function (line) {\n      if (line[4].isVisible) {\n        horizontalDis.push(_this.getLineDisObject(line, tc));\n        horizontalDis.push(_this.getLineDisObject(line, cc));\n        horizontalDis.push(_this.getLineDisObject(line, bc));\n      }\n    });\n    each(verticalLines, function (line) {\n      if (line[4].isVisible) {\n        verticalDis.push(_this.getLineDisObject(line, lc));\n        verticalDis.push(_this.getLineDisObject(line, cc));\n        verticalDis.push(_this.getLineDisObject(line, rc));\n      }\n    });\n    horizontalDis.sort(function (a, b) {\n      return a.dis - b.dis;\n    });\n    verticalDis.sort(function (a, b) {\n      return a.dis - b.dis;\n    });\n\n    if (horizontalDis.length !== 0 && horizontalDis[0].dis < tolerance) {\n      point.y = horizontalDis[0].line[1] - horizontalDis[0].point.y + originPoint.y;\n      alignCfg = {\n        type: 'item',\n        horizontals: [horizontalDis[0]]\n      };\n\n      for (var i = 1; i < 3; i++) {\n        if (horizontalDis[0].dis === horizontalDis[i].dis) {\n          alignCfg.horizontals.push(horizontalDis[i]);\n        }\n      }\n    }\n\n    if (verticalDis.length !== 0 && verticalDis[0].dis < tolerance) {\n      point.x = verticalDis[0].line[0] - verticalDis[0].point.x + originPoint.x;\n\n      if (!alignCfg) {\n        alignCfg = {\n          type: 'item',\n          verticals: [verticalDis[0]]\n        };\n      } else {\n        alignCfg.verticals = [verticalDis[0]];\n      }\n\n      for (var i = 1; i < 3; i++) {\n        if (verticalDis[0].dis === verticalDis[i].dis) {\n          alignCfg.verticals.push(verticalDis[i]);\n        }\n      }\n    }\n\n    if (alignCfg) {\n      alignCfg.bbox = bbox;\n      this.addAlignLine(alignCfg);\n    }\n  };\n  /**\n   * 根据配置项添加辅助线\n   *\n   * @param {object} cfg\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.addAlignLine = function (cfg) {\n    var bbox = cfg.bbox,\n        type = cfg.type,\n        horizontals = cfg.horizontals,\n        verticals = cfg.verticals;\n    var _a = this._cfgs,\n        lineStyle = _a.line,\n        alignLines = _a.alignLines;\n    var graph = this.get('graph');\n    var group = graph.get('group');\n\n    if (type === 'item') {\n      if (horizontals) {\n        each(horizontals, function (horizontal) {\n          var refLine = horizontal.line,\n              refPoint = horizontal.point;\n          var lineCenterX = (refLine[0] + refLine[2]) / 2;\n          var x1;\n          var x2;\n\n          if (refPoint.x < lineCenterX) {\n            x1 = refPoint.x - bbox.width / 2;\n            x2 = Math.max(refLine[0], refLine[2]);\n          } else {\n            x1 = refPoint.x + bbox.width / 2;\n            x2 = Math.min(refLine[0], refLine[2]);\n          }\n\n          var lineAttrs = mix({\n            x1: x1,\n            y1: refLine[1],\n            x2: x2,\n            y2: refLine[1]\n          }, lineStyle);\n          var line = group.addShape('line', {\n            attrs: lineAttrs,\n            capture: false\n          });\n          alignLines.push(line);\n        });\n      }\n\n      if (verticals) {\n        each(verticals, function (vertical) {\n          var refLine = vertical.line,\n              refPoint = vertical.point;\n          var lineCenterY = (refLine[1] + refLine[3]) / 2;\n          var y1;\n          var y2;\n\n          if (refPoint.y < lineCenterY) {\n            y1 = refPoint.y - bbox.height / 2;\n            y2 = Math.max(refLine[1], refLine[3]);\n          } else {\n            y1 = refPoint.y + bbox.height / 2;\n            y2 = Math.min(refLine[1], refLine[3]);\n          }\n\n          var lineAtts = mix({\n            x1: refLine[0],\n            y1: y1,\n            x2: refLine[0],\n            y2: y2\n          }, lineStyle);\n          var line = group.addShape('line', {\n            attrs: lineAtts,\n            capture: false\n          });\n          alignLines.push(line);\n        });\n      }\n    }\n  };\n  /**\n   * 获取点到线的距离\n   *\n   * @param {array} line [x1, y1, x2, y2] 线的四个点\n   * @param {object} point 点的x和y坐标点 {x, y}\n   * @returns\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.getLineDisObject = function (line, point) {\n    return {\n      line: line,\n      point: point,\n      dis: pointLineDistance(line, point)\n    };\n  };\n\n  SnapLine.prototype.getContainer = function () {\n    return this.get('container');\n  };\n  /**\n   * 拖动过程中，清楚上次绘制的线\n   *\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.clearAlignLine = function () {\n    var alignLines = this._cfgs.alignLines;\n    each(alignLines, function (line) {\n      line.remove();\n    });\n    alignLines.length = 0;\n  };\n  /**\n   * 拖动结束时候，情况缓存的节点的辅助线，同时删除绘制的线\n   *\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.destory = function () {\n    var _a = this._cfgs,\n        horizontalLines = _a.horizontalLines,\n        verticalLines = _a.verticalLines;\n    var graph = this.get('graph');\n    var nodes = graph.getNodes();\n    nodes.forEach(function (node) {\n      var itemId = node.get('id');\n      delete horizontalLines[itemId + \"tltr\"];\n      delete horizontalLines[itemId + \"lcrc\"];\n      delete horizontalLines[itemId + \"blbr\"];\n      delete verticalLines[itemId + \"tlbl\"];\n      delete verticalLines[itemId + \"tcbc\"];\n      delete verticalLines[itemId + \"trbr\"];\n    });\n    this.clearAlignLine();\n  };\n\n  return SnapLine;\n}(Base);\n\nexport default SnapLine;","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/@antv/g6-plugin/es/snapline/index.js"],"names":["__extends","_extendStatics","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","each","mix","Util","Base","pointLineDistance","alignLineStyle","stroke","lineWidth","SnapLine","_super","props","getDefaultCfgs","line","itemAlignType","tolerance","horizontalLines","verticalLines","alignLines","init","getEvents","onDragStart","initBoxLine","onDrag","e","item","delegateShape","get","bbox","getBBox","model","getModel","dx","x","dy","y","show","minX","minY","width","height","onDragEnd","destory","_a","_cfgs","graph","nodes","getNodes","forEach","nodeId","maxX","centerY","maxY","centerX","point","originPoint","itemAlign","_this","tc","cc","bc","lc","rc","horizontalDis","verticalDis","alignCfg","clearAlignLine","isVisible","push","getLineDisObject","sort","a","dis","length","type","horizontals","i","verticals","addAlignLine","cfg","lineStyle","group","horizontal","refLine","refPoint","lineCenterX","x1","x2","Math","max","min","lineAttrs","y1","y2","addShape","attrs","capture","vertical","lineCenterY","lineAtts","getContainer","remove","node","itemId"],"mappings":"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","sourcesContent":["var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { each, mix } from '@antv/util';\nimport { Util } from '@antv/g6-core';\nimport Base from '../base';\nvar pointLineDistance = Util.pointLineDistance; // 对齐线样式\n\nvar alignLineStyle = {\n  stroke: '#FA8C16',\n  lineWidth: 1\n};\n\nvar SnapLine =\n/** @class */\nfunction (_super) {\n  __extends(SnapLine, _super);\n\n  function SnapLine(props) {\n    return _super.call(this, props) || this;\n  }\n\n  SnapLine.prototype.getDefaultCfgs = function () {\n    return {\n      line: alignLineStyle,\n\n      /**\n       * item align type\n       * @type {String|True|False}\n       */\n      itemAlignType: 'center',\n\n      /**\n       * tolerance to item force align\n       * @type {String|True|False}\n       */\n      tolerance: 5,\n      horizontalLines: {},\n      verticalLines: {},\n      alignLines: []\n    };\n  };\n\n  SnapLine.prototype.init = function () {}; // class-methods-use-this\n\n\n  SnapLine.prototype.getEvents = function () {\n    return {\n      'node:dragstart': 'onDragStart',\n      'node:drag': 'onDrag',\n      'node:dragend': 'onDragEnd'\n    };\n  };\n\n  SnapLine.prototype.onDragStart = function () {\n    this.initBoxLine();\n  };\n\n  SnapLine.prototype.onDrag = function (e) {\n    var item = e.item; // 计算辅助线位置,拖动过程中更新辅助线\n\n    var delegateShape = item.get('delegateShape') || item;\n    var bbox = delegateShape.getBBox();\n    var model = item.getModel();\n    var dx = model.x - bbox.x;\n    var dy = model.y - bbox.y;\n    this.show({\n      x: bbox.minX + dx,\n      y: bbox.minY + dy\n    }, {\n      width: bbox.width,\n      height: bbox.height\n    });\n  };\n\n  SnapLine.prototype.onDragEnd = function () {\n    // 拖动结束时候删除辅助线\n    this.destory();\n  };\n  /**\n   * 每次开始拖动之前，计算出所有节点在水平和垂直方向上，左中右三条中线，并缓存起来\n   *\n   * @param {object} item Node节点\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.initBoxLine = function () {\n    var _a = this._cfgs,\n        horizontalLines = _a.horizontalLines,\n        verticalLines = _a.verticalLines,\n        itemAlignType = _a.itemAlignType;\n    var graph = this.get('graph');\n    var nodes = graph.getNodes();\n    nodes.forEach(function (item) {\n      var bbox = item.getBBox();\n      var nodeId = item.get('id'); // 设置水平方向辅助线\n\n      if (itemAlignType === true || itemAlignType === 'horizontal') {\n        // tltr: top left top right\n        // lcrc: left center right center\n        // blbr: bottom left bottom right\n        horizontalLines[nodeId + \"tltr\"] = [bbox.minX, bbox.minY, bbox.maxX, bbox.minY, item];\n        horizontalLines[nodeId + \"lcrc\"] = [bbox.minX, bbox.centerY, bbox.maxX, bbox.centerY, item];\n        horizontalLines[nodeId + \"blbr\"] = [bbox.minX, bbox.maxY, bbox.maxX, bbox.maxY, item];\n      } else if (itemAlignType === 'center') {\n        horizontalLines[nodeId + \"lcrc\"] = [bbox.minX, bbox.centerY, bbox.maxX, bbox.centerY, item];\n      } // 设置垂直方向辅助线\n\n\n      if (itemAlignType === true || itemAlignType === 'vertical') {\n        // tlbl: top left bottom left\n        // tcbc: top center bottom center\n        // trbr: top right bottom right\n        verticalLines[nodeId + \"tlbl\"] = [bbox.minX, bbox.minY, bbox.minX, bbox.maxY, item];\n        verticalLines[nodeId + \"tcbc\"] = [bbox.centerX, bbox.minY, bbox.centerX, bbox.maxY, item];\n        verticalLines[nodeId + \"trbr\"] = [bbox.maxX, bbox.minY, bbox.maxX, bbox.maxY, item];\n      } else if (itemAlignType === 'center') {\n        verticalLines[nodeId + \"tcbc\"] = [bbox.centerX, bbox.minY, bbox.centerX, bbox.maxY, item];\n      }\n    });\n  };\n  /**\n   * 显示AlignLine\n   *\n   * @param {object} point 起始点\n   * @param {object} bbox BBox\n   * @returns\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.show = function (point, bbox) {\n    var originPoint = mix({}, point);\n    this.itemAlign(point, bbox, originPoint);\n    return point;\n  };\n  /**\n   * 拖动拖出中添加辅助线\n   *\n   * @param {object} point 起始点\n   * @param {object} bbox 代理形状的bbox\n   * @param {object} originPoint 原始点，同point\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.itemAlign = function (point, bbox, originPoint) {\n    var _this = this;\n\n    var _a = this._cfgs,\n        horizontalLines = _a.horizontalLines,\n        verticalLines = _a.verticalLines,\n        tolerance = _a.tolerance;\n    var tc = {\n      x: originPoint.x + bbox.width / 2,\n      y: originPoint.y\n    };\n    var cc = {\n      x: originPoint.x + bbox.width / 2,\n      y: originPoint.y + bbox.height / 2\n    };\n    var bc = {\n      x: originPoint.x + bbox.width / 2,\n      y: originPoint.y + bbox.height\n    };\n    var lc = {\n      x: originPoint.x,\n      y: originPoint.y + bbox.height / 2\n    };\n    var rc = {\n      x: originPoint.x + bbox.width,\n      y: originPoint.y + bbox.height / 2\n    };\n    var horizontalDis = [];\n    var verticalDis = [];\n    var alignCfg = null;\n    this.clearAlignLine();\n    each(horizontalLines, function (line) {\n      if (line[4].isVisible) {\n        horizontalDis.push(_this.getLineDisObject(line, tc));\n        horizontalDis.push(_this.getLineDisObject(line, cc));\n        horizontalDis.push(_this.getLineDisObject(line, bc));\n      }\n    });\n    each(verticalLines, function (line) {\n      if (line[4].isVisible) {\n        verticalDis.push(_this.getLineDisObject(line, lc));\n        verticalDis.push(_this.getLineDisObject(line, cc));\n        verticalDis.push(_this.getLineDisObject(line, rc));\n      }\n    });\n    horizontalDis.sort(function (a, b) {\n      return a.dis - b.dis;\n    });\n    verticalDis.sort(function (a, b) {\n      return a.dis - b.dis;\n    });\n\n    if (horizontalDis.length !== 0 && horizontalDis[0].dis < tolerance) {\n      point.y = horizontalDis[0].line[1] - horizontalDis[0].point.y + originPoint.y;\n      alignCfg = {\n        type: 'item',\n        horizontals: [horizontalDis[0]]\n      };\n\n      for (var i = 1; i < 3; i++) {\n        if (horizontalDis[0].dis === horizontalDis[i].dis) {\n          alignCfg.horizontals.push(horizontalDis[i]);\n        }\n      }\n    }\n\n    if (verticalDis.length !== 0 && verticalDis[0].dis < tolerance) {\n      point.x = verticalDis[0].line[0] - verticalDis[0].point.x + originPoint.x;\n\n      if (!alignCfg) {\n        alignCfg = {\n          type: 'item',\n          verticals: [verticalDis[0]]\n        };\n      } else {\n        alignCfg.verticals = [verticalDis[0]];\n      }\n\n      for (var i = 1; i < 3; i++) {\n        if (verticalDis[0].dis === verticalDis[i].dis) {\n          alignCfg.verticals.push(verticalDis[i]);\n        }\n      }\n    }\n\n    if (alignCfg) {\n      alignCfg.bbox = bbox;\n      this.addAlignLine(alignCfg);\n    }\n  };\n  /**\n   * 根据配置项添加辅助线\n   *\n   * @param {object} cfg\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.addAlignLine = function (cfg) {\n    var bbox = cfg.bbox,\n        type = cfg.type,\n        horizontals = cfg.horizontals,\n        verticals = cfg.verticals;\n    var _a = this._cfgs,\n        lineStyle = _a.line,\n        alignLines = _a.alignLines;\n    var graph = this.get('graph');\n    var group = graph.get('group');\n\n    if (type === 'item') {\n      if (horizontals) {\n        each(horizontals, function (horizontal) {\n          var refLine = horizontal.line,\n              refPoint = horizontal.point;\n          var lineCenterX = (refLine[0] + refLine[2]) / 2;\n          var x1;\n          var x2;\n\n          if (refPoint.x < lineCenterX) {\n            x1 = refPoint.x - bbox.width / 2;\n            x2 = Math.max(refLine[0], refLine[2]);\n          } else {\n            x1 = refPoint.x + bbox.width / 2;\n            x2 = Math.min(refLine[0], refLine[2]);\n          }\n\n          var lineAttrs = mix({\n            x1: x1,\n            y1: refLine[1],\n            x2: x2,\n            y2: refLine[1]\n          }, lineStyle);\n          var line = group.addShape('line', {\n            attrs: lineAttrs,\n            capture: false\n          });\n          alignLines.push(line);\n        });\n      }\n\n      if (verticals) {\n        each(verticals, function (vertical) {\n          var refLine = vertical.line,\n              refPoint = vertical.point;\n          var lineCenterY = (refLine[1] + refLine[3]) / 2;\n          var y1;\n          var y2;\n\n          if (refPoint.y < lineCenterY) {\n            y1 = refPoint.y - bbox.height / 2;\n            y2 = Math.max(refLine[1], refLine[3]);\n          } else {\n            y1 = refPoint.y + bbox.height / 2;\n            y2 = Math.min(refLine[1], refLine[3]);\n          }\n\n          var lineAtts = mix({\n            x1: refLine[0],\n            y1: y1,\n            x2: refLine[0],\n            y2: y2\n          }, lineStyle);\n          var line = group.addShape('line', {\n            attrs: lineAtts,\n            capture: false\n          });\n          alignLines.push(line);\n        });\n      }\n    }\n  };\n  /**\n   * 获取点到线的距离\n   *\n   * @param {array} line [x1, y1, x2, y2] 线的四个点\n   * @param {object} point 点的x和y坐标点 {x, y}\n   * @returns\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.getLineDisObject = function (line, point) {\n    return {\n      line: line,\n      point: point,\n      dis: pointLineDistance(line, point)\n    };\n  };\n\n  SnapLine.prototype.getContainer = function () {\n    return this.get('container');\n  };\n  /**\n   * 拖动过程中，清楚上次绘制的线\n   *\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.clearAlignLine = function () {\n    var alignLines = this._cfgs.alignLines;\n    each(alignLines, function (line) {\n      line.remove();\n    });\n    alignLines.length = 0;\n  };\n  /**\n   * 拖动结束时候，情况缓存的节点的辅助线，同时删除绘制的线\n   *\n   * @memberof AlignLine\n   */\n\n\n  SnapLine.prototype.destory = function () {\n    var _a = this._cfgs,\n        horizontalLines = _a.horizontalLines,\n        verticalLines = _a.verticalLines;\n    var graph = this.get('graph');\n    var nodes = graph.getNodes();\n    nodes.forEach(function (node) {\n      var itemId = node.get('id');\n      delete horizontalLines[itemId + \"tltr\"];\n      delete horizontalLines[itemId + \"lcrc\"];\n      delete horizontalLines[itemId + \"blbr\"];\n      delete verticalLines[itemId + \"tlbl\"];\n      delete verticalLines[itemId + \"tcbc\"];\n      delete verticalLines[itemId + \"trbr\"];\n    });\n    this.clearAlignLine();\n  };\n\n  return SnapLine;\n}(Base);\n\nexport default SnapLine;"]},"metadata":{},"sourceType":"module"}