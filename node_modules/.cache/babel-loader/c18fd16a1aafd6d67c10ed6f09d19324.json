{"ast":null,"code":"var _ = require(\"../lodash\");\n\nvar util = require(\"../util\");\n\nmodule.exports = sort;\n\nfunction sort(entries, biasRight, usePrev) {\n  var parts = util.partition(entries, function (entry) {\n    // NOTE: 有fixorder的也可以排\n    return _.has(entry, \"fixorder\") && !isNaN(entry.fixorder) || _.has(entry, \"barycenter\");\n  });\n\n  var sortable = parts.lhs,\n      unsortable = _.sortBy(parts.rhs, function (entry) {\n    return -entry.i;\n  }),\n      vs = [],\n      sum = 0,\n      weight = 0,\n      vsIndex = 0;\n\n  sortable.sort(compareWithBias(!!biasRight, !!usePrev));\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n\n  _.forEach(sortable, function (entry) {\n    vsIndex += entry.vs.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n\n  var result = {\n    vs: _.flatten(vs, true)\n  };\n\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n\n  return result;\n}\n\nfunction consumeUnsortable(vs, unsortable, index) {\n  var last;\n\n  while (unsortable.length && (last = _.last(unsortable)).i <= index) {\n    unsortable.pop();\n    vs.push(last.vs);\n    index++;\n  }\n\n  return index;\n}\n/**\n * 配置是否考虑使用之前的布局结果\n */\n\n\nfunction compareWithBias(bias, usePrev) {\n  return function (entryV, entryW) {\n    // 排序的时候先判断fixorder，不行再判断重心\n    if (entryV.fixorder !== undefined && entryW.fixorder !== undefined) {\n      return entryV.fixorder - entryW.fixorder;\n    }\n\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    } else if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    } // 重心相同，考虑之前排好的顺序\n\n\n    if (usePrev && entryV.order !== undefined && entryW.order !== undefined) {\n      if (entryV.order < entryW.order) {\n        return -1;\n      } else if (entryV.order > entryW.order) {\n        return 1;\n      }\n    }\n\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n}","map":{"version":3,"sources":["/home/manolo/sds-ui/node_modules/dagrejs/lib/order/sort.js"],"names":["_","require","util","module","exports","sort","entries","biasRight","usePrev","parts","partition","entry","has","isNaN","fixorder","sortable","lhs","unsortable","sortBy","rhs","i","vs","sum","weight","vsIndex","compareWithBias","consumeUnsortable","forEach","length","push","barycenter","result","flatten","index","last","pop","bias","entryV","entryW","undefined","order"],"mappings":"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","sourcesContent":["var _ = require(\"../lodash\");\nvar util = require(\"../util\");\n\nmodule.exports = sort;\n\nfunction sort(entries, biasRight, usePrev) {\n  var parts = util.partition(entries, function(entry) {\n    // NOTE: 有fixorder的也可以排\n    return (_.has(entry, \"fixorder\") && !isNaN(entry.fixorder)) || _.has(entry, \"barycenter\");\n  });\n  var sortable = parts.lhs,\n    unsortable = _.sortBy(parts.rhs, function(entry) { return -entry.i; }),\n    vs = [],\n    sum = 0,\n    weight = 0,\n    vsIndex = 0;\n\n  sortable.sort(compareWithBias(!!biasRight, !!usePrev));\n\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n\n  _.forEach(sortable, function (entry) {\n    vsIndex += entry.vs.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n\n  var result = { vs: _.flatten(vs, true) };\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n  return result;\n}\n\nfunction consumeUnsortable(vs, unsortable, index) {\n  var last;\n  while (unsortable.length && (last = _.last(unsortable)).i <= index) {\n    unsortable.pop();\n    vs.push(last.vs);\n    index++;\n  }\n  return index;\n}\n\n/**\n * 配置是否考虑使用之前的布局结果\n */\nfunction compareWithBias(bias, usePrev) {\n  return function(entryV, entryW) {\n    // 排序的时候先判断fixorder，不行再判断重心\n    if (entryV.fixorder !== undefined && entryW.fixorder !== undefined) {\n      return entryV.fixorder - entryW.fixorder;\n    }\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    } else if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    }\n    // 重心相同，考虑之前排好的顺序\n    if (usePrev && entryV.order !== undefined && entryW.order !== undefined) {\n      if (entryV.order < entryW.order) {\n        return -1;\n      } else if (entryV.order > entryW.order) {\n        return 1;\n      }\n    }\n\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n}\n"]},"metadata":{},"sourceType":"script"}