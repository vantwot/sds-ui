{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Disablable } from '../../common';\nexport class AutoSave extends Disablable {\n  constructor(options) {\n    super();\n    this.delay = 10;\n    this.throttle = 2;\n    this.threshold = 5;\n    this.changeCount = 0;\n    this.timestamp = 0;\n    this.options = Object.assign(Object.assign({}, AutoSave.defaultOptions), options);\n    this.graph.model.on('cell:change:*', this.onModelChanged, this);\n  }\n\n  get graph() {\n    return this.options.graph;\n  }\n\n  onModelChanged() {\n    if (this.disabled) {\n      return;\n    }\n\n    const now = new Date().getTime();\n    const dt = (now - this.timestamp) / 1000;\n\n    if (dt > this.delay || this.changeCount >= this.threshold && dt > this.throttle) {\n      this.save();\n      this.reset();\n    } else {\n      this.changeCount += 1;\n    }\n  }\n\n  save() {\n    this.trigger('save');\n  }\n\n  reset() {\n    this.changeCount = 0;\n    this.timestamp = new Date().getTime();\n  }\n\n  dispose() {\n    this.graph.model.off('cell:change:*', this.onModelChanged, this);\n  }\n\n}\n\n__decorate([Disablable.dispose()], AutoSave.prototype, \"dispose\", null);\n\n(function (AutoSave) {\n  AutoSave.defaultOptions = {\n    delay: 10,\n    throttle: 2,\n    threshold: 5\n  };\n})(AutoSave || (AutoSave = {}));","map":{"version":3,"sources":["../../../src/addon/autosave/index.ts"],"names":[],"mappings":";;;;;;;;AAAA,SAAS,UAAT,QAA2B,cAA3B;AAGA,OAAM,MAAO,QAAP,SAAwB,UAAxB,CAAsD;AAc1D,EAAA,WAAA,CAAY,OAAZ,EAAqC;AACnC;AARF,SAAA,KAAA,GAAQ,EAAR;AACA,SAAA,QAAA,GAAW,CAAX;AACA,SAAA,SAAA,GAAY,CAAZ;AAEQ,SAAA,WAAA,GAAc,CAAd;AACA,SAAA,SAAA,GAAY,CAAZ;AAIN,SAAK,OAAL,GAAY,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EACP,QAAQ,CAAC,cADF,CAAA,EAEP,OAFO,CAAZ;AAIA,SAAK,KAAL,CAAW,KAAX,CAAiB,EAAjB,CAAoB,eAApB,EAAqC,KAAK,cAA1C,EAA0D,IAA1D;AACD;;AAlBkB,MAAL,KAAK,GAAA;AACjB,WAAO,KAAK,OAAL,CAAa,KAApB;AACD;;AAkBO,EAAA,cAAc,GAAA;AACpB,QAAI,KAAK,QAAT,EAAmB;AACjB;AACD;;AAED,UAAM,GAAG,GAAG,IAAI,IAAJ,GAAW,OAAX,EAAZ;AACA,UAAM,EAAE,GAAG,CAAC,GAAG,GAAG,KAAK,SAAZ,IAAyB,IAApC;;AAEA,QACE,EAAE,GAAG,KAAK,KAAV,IACC,KAAK,WAAL,IAAoB,KAAK,SAAzB,IAAsC,EAAE,GAAG,KAAK,QAFnD,EAGE;AACA,WAAK,IAAL;AACA,WAAK,KAAL;AACD,KAND,MAMO;AACL,WAAK,WAAL,IAAoB,CAApB;AACD;AACF;;AAEO,EAAA,IAAI,GAAA;AACV,SAAK,OAAL,CAAa,MAAb;AACD;;AAED,EAAA,KAAK,GAAA;AACH,SAAK,WAAL,GAAmB,CAAnB;AACA,SAAK,SAAL,GAAiB,IAAI,IAAJ,GAAW,OAAX,EAAjB;AACD;;AAGD,EAAA,OAAO,GAAA;AACL,SAAK,KAAL,CAAW,KAAX,CAAiB,GAAjB,CAAqB,eAArB,EAAsC,KAAK,cAA3C,EAA2D,IAA3D;AACD;;AAtDyD;;AAoD1D,UAAA,CAAA,CADC,UAAU,CAAC,OAAX,EACD,CAAA,E,kBAAA,E,SAAA,EAEC,IAFD,CAAA;;AAKF,CAAA,UAAiB,QAAjB,EAAyB;AAkBV,EAAA,QAAA,CAAA,cAAA,GAAmC;AAC9C,IAAA,KAAK,EAAE,EADuC;AAE9C,IAAA,QAAQ,EAAE,CAFoC;AAG9C,IAAA,SAAS,EAAE;AAHmC,GAAnC;AASd,CA3BD,EAAiB,QAAQ,KAAR,QAAQ,GAAA,EAAA,CAAzB","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Disablable } from '../../common';\nexport class AutoSave extends Disablable {\n    constructor(options) {\n        super();\n        this.delay = 10;\n        this.throttle = 2;\n        this.threshold = 5;\n        this.changeCount = 0;\n        this.timestamp = 0;\n        this.options = Object.assign(Object.assign({}, AutoSave.defaultOptions), options);\n        this.graph.model.on('cell:change:*', this.onModelChanged, this);\n    }\n    get graph() {\n        return this.options.graph;\n    }\n    onModelChanged() {\n        if (this.disabled) {\n            return;\n        }\n        const now = new Date().getTime();\n        const dt = (now - this.timestamp) / 1000;\n        if (dt > this.delay ||\n            (this.changeCount >= this.threshold && dt > this.throttle)) {\n            this.save();\n            this.reset();\n        }\n        else {\n            this.changeCount += 1;\n        }\n    }\n    save() {\n        this.trigger('save');\n    }\n    reset() {\n        this.changeCount = 0;\n        this.timestamp = new Date().getTime();\n    }\n    dispose() {\n        this.graph.model.off('cell:change:*', this.onModelChanged, this);\n    }\n}\n__decorate([\n    Disablable.dispose()\n], AutoSave.prototype, \"dispose\", null);\n(function (AutoSave) {\n    AutoSave.defaultOptions = {\n        delay: 10,\n        throttle: 2,\n        threshold: 5,\n    };\n})(AutoSave || (AutoSave = {}));\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}