{"ast":null,"code":"import _toConsumableArray from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { FunctionExt } from '../util';\nexport var Events = /*#__PURE__*/function () {\n  function Events() {\n    _classCallCheck(this, Events);\n\n    this.listeners = {};\n  }\n\n  _createClass(Events, [{\n    key: \"on\",\n    value: function on(name, handler, context) {\n      if (handler == null) {\n        return this;\n      }\n\n      if (!this.listeners[name]) {\n        this.listeners[name] = [];\n      }\n\n      var cache = this.listeners[name];\n      cache.push(handler, context);\n      return this;\n    }\n  }, {\n    key: \"once\",\n    value: function once(name, handler, context) {\n      var _this = this;\n\n      var cb = function cb() {\n        _this.off(name, cb);\n\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        return Private.call([handler, context], args);\n      };\n\n      return this.on(name, cb, this);\n    }\n  }, {\n    key: \"off\",\n    value: function off(name, handler, context) {\n      // remove all events.\n      if (!(name || handler || context)) {\n        this.listeners = {};\n        return this;\n      }\n\n      var listeners = this.listeners;\n      var names = name ? [name] : Object.keys(listeners);\n      names.forEach(function (n) {\n        var cache = listeners[n];\n\n        if (!cache) {\n          return;\n        } // remove all events with specified name.\n\n\n        if (!(handler || context)) {\n          delete listeners[n];\n          return;\n        }\n\n        for (var i = cache.length - 2; i >= 0; i -= 2) {\n          if (!(handler && cache[i] !== handler || context && cache[i + 1] !== context)) {\n            cache.splice(i, 2);\n          }\n        }\n      });\n      return this;\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(name) {\n      var returned = true;\n\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      if (name !== '*') {\n        var _list = this.listeners[name];\n\n        if (_list != null) {\n          returned = Private.call(_toConsumableArray(_list), args);\n        }\n      }\n\n      var list = this.listeners['*'];\n\n      if (list != null) {\n        return FunctionExt.toAsyncBoolean([returned, Private.call(_toConsumableArray(list), [name].concat(args))]);\n      }\n\n      return returned;\n    }\n  }, {\n    key: \"emit\",\n    value: function emit(name) {\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n\n      return this.trigger.apply(this, [name].concat(args));\n    }\n  }]);\n\n  return Events;\n}();\nvar Private;\n\n(function (Private) {\n  function call(list, args) {\n    var results = [];\n\n    for (var i = 0; i < list.length; i += 2) {\n      var handler = list[i];\n      var context = list[i + 1];\n      var params = Array.isArray(args) ? args : [args];\n      var ret = FunctionExt.apply(handler, context, params);\n      results.push(ret);\n    }\n\n    return FunctionExt.toAsyncBoolean(results);\n  }\n\n  Private.call = call;\n})(Private || (Private = {}));","map":{"version":3,"sources":["../../src/common/events.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { FunctionExt } from '../util';\nexport class Events {\n    constructor() {\n        this.listeners = {};\n    }\n    on(name, handler, context) {\n        if (handler == null) {\n            return this;\n        }\n        if (!this.listeners[name]) {\n            this.listeners[name] = [];\n        }\n        const cache = this.listeners[name];\n        cache.push(handler, context);\n        return this;\n    }\n    once(name, handler, context) {\n        const cb = (...args) => {\n            this.off(name, cb);\n            return Private.call([handler, context], args);\n        };\n        return this.on(name, cb, this);\n    }\n    off(name, handler, context) {\n        // remove all events.\n        if (!(name || handler || context)) {\n            this.listeners = {};\n            return this;\n        }\n        const listeners = this.listeners;\n        const names = name ? [name] : Object.keys(listeners);\n        names.forEach((n) => {\n            const cache = listeners[n];\n            if (!cache) {\n                return;\n            }\n            // remove all events with specified name.\n            if (!(handler || context)) {\n                delete listeners[n];\n                return;\n            }\n            for (let i = cache.length - 2; i >= 0; i -= 2) {\n                if (!((handler && cache[i] !== handler) ||\n                    (context && cache[i + 1] !== context))) {\n                    cache.splice(i, 2);\n                }\n            }\n        });\n        return this;\n    }\n    trigger(name, ...args) {\n        let returned = true;\n        if (name !== '*') {\n            const list = this.listeners[name];\n            if (list != null) {\n                returned = Private.call([...list], args);\n            }\n        }\n        const list = this.listeners['*'];\n        if (list != null) {\n            return FunctionExt.toAsyncBoolean([\n                returned,\n                Private.call([...list], [name, ...args]),\n            ]);\n        }\n        return returned;\n    }\n    emit(name, ...args) {\n        return this.trigger(name, ...args);\n    }\n}\nvar Private;\n(function (Private) {\n    function call(list, args) {\n        const results = [];\n        for (let i = 0; i < list.length; i += 2) {\n            const handler = list[i];\n            const context = list[i + 1];\n            const params = Array.isArray(args) ? args : [args];\n            const ret = FunctionExt.apply(handler, context, params);\n            results.push(ret);\n        }\n        return FunctionExt.toAsyncBoolean(results);\n    }\n    Private.call = call;\n})(Private || (Private = {}));\n//# sourceMappingURL=events.js.map"]},"metadata":{},"sourceType":"module"}