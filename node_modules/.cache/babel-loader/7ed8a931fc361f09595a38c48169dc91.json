{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { FunctionExt } from '../../util';\nimport { View } from '../../view/view';\nimport { Graph } from '../../graph/graph';\nimport { Point } from '../../geometry';\nvar ClassName;\n\n(function (ClassName) {\n  ClassName.root = 'widget-minimap';\n  ClassName.viewport = `${ClassName.root}-viewport`;\n  ClassName.zoom = `${ClassName.viewport}-zoom`;\n})(ClassName || (ClassName = {}));\n\nexport class MiniMap extends View {\n  constructor(options) {\n    super();\n    this.options = Object.assign(Object.assign({}, Util.defaultOptions), options);\n    this.updateViewport = FunctionExt.debounce(this.updateViewport.bind(this), 0);\n    this.container = document.createElement('div');\n    this.$container = this.$(this.container).addClass(this.prefixClassName(ClassName.root));\n    const graphContainer = document.createElement('div');\n    this.container.appendChild(graphContainer);\n    this.$viewport = this.$('<div>').addClass(this.prefixClassName(ClassName.viewport));\n\n    if (this.options.scalable) {\n      this.zoomHandle = this.$('<div>').addClass(this.prefixClassName(ClassName.zoom)).appendTo(this.$viewport).get(0);\n    }\n\n    this.$container.append(this.$viewport).css({\n      width: this.options.width,\n      height: this.options.height,\n      padding: this.options.padding\n    });\n\n    if (this.options.container) {\n      this.options.container.appendChild(this.container);\n    }\n\n    this.sourceGraph = this.graph;\n    const targetGraphOptions = Object.assign(Object.assign({}, this.options.graphOptions), {\n      container: graphContainer,\n      model: this.sourceGraph.model,\n      frozen: true,\n      async: this.sourceGraph.isAsync(),\n      interacting: false,\n      grid: false,\n      background: false,\n      rotating: false,\n      resizing: false,\n      embedding: false,\n      selecting: false,\n      snapline: false,\n      clipboard: false,\n      history: false,\n      scroller: false\n    });\n    this.targetGraph = this.options.createGraph ? this.options.createGraph(targetGraphOptions) : new Graph(targetGraphOptions);\n    this.targetGraph.renderer.unfreeze();\n    this.updatePaper(this.sourceGraph.options.width, this.sourceGraph.options.height);\n    this.startListening();\n  }\n\n  get graph() {\n    return this.options.graph;\n  }\n\n  get scroller() {\n    return this.graph.scroller.widget;\n  }\n\n  get graphContainer() {\n    if (this.scroller) {\n      return this.scroller.container;\n    }\n\n    return this.graph.container;\n  }\n\n  get $graphContainer() {\n    if (this.scroller) {\n      return this.scroller.$container;\n    }\n\n    return this.$(this.graph.container);\n  }\n\n  startListening() {\n    if (this.scroller) {\n      this.$graphContainer.on(`scroll${this.getEventNamespace()}`, this.updateViewport);\n    } else {\n      this.sourceGraph.on('translate', this.updateViewport, this);\n    }\n\n    this.sourceGraph.on('resize', this.updatePaper, this);\n    this.delegateEvents({\n      mousedown: 'startAction',\n      touchstart: 'startAction',\n      [`mousedown .${this.prefixClassName('graph')}`]: 'scrollTo',\n      [`touchstart .${this.prefixClassName('graph')}`]: 'scrollTo'\n    });\n  }\n\n  stopListening() {\n    if (this.scroller) {\n      this.$graphContainer.off(this.getEventNamespace());\n    } else {\n      this.sourceGraph.off('translate', this.updateViewport, this);\n    }\n\n    this.sourceGraph.off('resize', this.updatePaper, this);\n    this.undelegateEvents();\n  }\n\n  onRemove() {\n    this.targetGraph.view.remove();\n    this.stopListening();\n    this.targetGraph.dispose();\n  }\n\n  updatePaper(w, h) {\n    let width;\n    let height;\n\n    if (typeof w === 'object') {\n      width = w.width;\n      height = w.height;\n    } else {\n      width = w;\n      height = h;\n    }\n\n    const origin = this.sourceGraph.options;\n    const scale = this.sourceGraph.transform.getScale();\n    const maxWidth = this.options.width - 2 * this.options.padding;\n    const maxHeight = this.options.height - 2 * this.options.padding;\n    width /= scale.sx; // eslint-disable-line\n\n    height /= scale.sy; // eslint-disable-line\n\n    this.ratio = Math.min(maxWidth / width, maxHeight / height);\n    const ratio = this.ratio;\n    const x = origin.x * ratio / scale.sx;\n    const y = origin.y * ratio / scale.sy;\n    width *= ratio; // eslint-disable-line\n\n    height *= ratio; // eslint-disable-line\n\n    this.targetGraph.resizeGraph(width, height);\n    this.targetGraph.translate(x, y);\n    this.targetGraph.scale(ratio, ratio);\n    this.updateViewport();\n    return this;\n  }\n\n  updateViewport() {\n    const ratio = this.ratio;\n    const scale = this.sourceGraph.transform.getScale();\n    let origin = null;\n\n    if (this.scroller) {\n      origin = this.scroller.clientToLocalPoint(0, 0);\n    } else {\n      const ctm = this.sourceGraph.matrix();\n      origin = new Point(-ctm.e / ctm.a, -ctm.f / ctm.d);\n    }\n\n    const position = this.$(this.targetGraph.container).position();\n    const translation = this.targetGraph.translate();\n    translation.ty = translation.ty || 0;\n    this.geometry = {\n      top: position.top + origin.y * ratio + translation.ty,\n      left: position.left + origin.x * ratio + translation.tx,\n      width: this.$graphContainer.innerWidth() * ratio / scale.sx,\n      height: this.$graphContainer.innerHeight() * ratio / scale.sy\n    };\n    this.$viewport.css(this.geometry);\n  }\n\n  startAction(evt) {\n    const e = this.normalizeEvent(evt);\n    const action = e.target === this.zoomHandle ? 'zooming' : 'panning';\n    const {\n      tx,\n      ty\n    } = this.sourceGraph.translate();\n    const eventData = {\n      action,\n      clientX: e.clientX,\n      clientY: e.clientY,\n      scrollLeft: this.graphContainer.scrollLeft,\n      scrollTop: this.graphContainer.scrollTop,\n      zoom: this.sourceGraph.zoom(),\n      scale: this.sourceGraph.transform.getScale(),\n      geometry: this.geometry,\n      translateX: tx,\n      translateY: ty\n    };\n    this.delegateDocumentEvents(Util.documentEvents, eventData);\n  }\n\n  doAction(evt) {\n    const e = this.normalizeEvent(evt);\n    const clientX = e.clientX;\n    const clientY = e.clientY;\n    const data = e.data;\n\n    switch (data.action) {\n      case 'panning':\n        {\n          const scale = this.sourceGraph.transform.getScale();\n          const rx = (clientX - data.clientX) * scale.sx;\n          const ry = (clientY - data.clientY) * scale.sy;\n\n          if (this.scroller) {\n            this.graphContainer.scrollLeft = data.scrollLeft + rx / this.ratio;\n            this.graphContainer.scrollTop = data.scrollTop + ry / this.ratio;\n          } else {\n            this.sourceGraph.translate(data.translateX - rx / this.ratio, data.translateY - ry / this.ratio);\n          }\n\n          break;\n        }\n\n      case 'zooming':\n        {\n          const startScale = data.scale;\n          const startGeometry = data.geometry;\n          const delta = 1 + (data.clientX - clientX) / startGeometry.width / startScale.sx;\n\n          if (data.frameId) {\n            cancelAnimationFrame(data.frameId);\n          }\n\n          data.frameId = requestAnimationFrame(() => {\n            this.sourceGraph.zoom(delta * data.zoom, {\n              absolute: true,\n              minScale: this.options.minScale,\n              maxScale: this.options.maxScale\n            });\n          });\n          break;\n        }\n\n      default:\n        break;\n    }\n  }\n\n  stopAction() {\n    this.undelegateDocumentEvents();\n  }\n\n  scrollTo(evt) {\n    const e = this.normalizeEvent(evt);\n    let x;\n    let y;\n    const ts = this.targetGraph.translate();\n    ts.ty = ts.ty || 0;\n\n    if (e.offsetX == null) {\n      const offset = this.$(this.targetGraph.container).offset();\n      x = e.pageX - offset.left;\n      y = e.pageY - offset.top;\n    } else {\n      x = e.offsetX;\n      y = e.offsetY;\n    }\n\n    const cx = (x - ts.tx) / this.ratio;\n    const cy = (y - ts.ty) / this.ratio;\n    this.sourceGraph.centerPoint(cx, cy);\n  }\n\n  dispose() {\n    this.remove();\n  }\n\n}\n\n__decorate([View.dispose()], MiniMap.prototype, \"dispose\", null);\n\nvar Util;\n\n(function (Util) {\n  Util.defaultOptions = {\n    width: 300,\n    height: 200,\n    padding: 10,\n    scalable: true,\n    minScale: 0.01,\n    maxScale: 16,\n    graphOptions: {},\n    createGraph: options => new Graph(options)\n  };\n  Util.documentEvents = {\n    mousemove: 'doAction',\n    touchmove: 'doAction',\n    mouseup: 'stopAction',\n    touchend: 'stopAction'\n  };\n})(Util || (Util = {}));","map":{"version":3,"sources":["../../../src/addon/minimap/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { FunctionExt } from '../../util';\nimport { View } from '../../view/view';\nimport { Graph } from '../../graph/graph';\nimport { Point } from '../../geometry';\nvar ClassName;\n(function (ClassName) {\n    ClassName.root = 'widget-minimap';\n    ClassName.viewport = `${ClassName.root}-viewport`;\n    ClassName.zoom = `${ClassName.viewport}-zoom`;\n})(ClassName || (ClassName = {}));\nexport class MiniMap extends View {\n    constructor(options) {\n        super();\n        this.options = Object.assign(Object.assign({}, Util.defaultOptions), options);\n        this.updateViewport = FunctionExt.debounce(this.updateViewport.bind(this), 0);\n        this.container = document.createElement('div');\n        this.$container = this.$(this.container).addClass(this.prefixClassName(ClassName.root));\n        const graphContainer = document.createElement('div');\n        this.container.appendChild(graphContainer);\n        this.$viewport = this.$('<div>').addClass(this.prefixClassName(ClassName.viewport));\n        if (this.options.scalable) {\n            this.zoomHandle = this.$('<div>')\n                .addClass(this.prefixClassName(ClassName.zoom))\n                .appendTo(this.$viewport)\n                .get(0);\n        }\n        this.$container.append(this.$viewport).css({\n            width: this.options.width,\n            height: this.options.height,\n            padding: this.options.padding,\n        });\n        if (this.options.container) {\n            this.options.container.appendChild(this.container);\n        }\n        this.sourceGraph = this.graph;\n        const targetGraphOptions = Object.assign(Object.assign({}, this.options.graphOptions), { container: graphContainer, model: this.sourceGraph.model, frozen: true, async: this.sourceGraph.isAsync(), interacting: false, grid: false, background: false, rotating: false, resizing: false, embedding: false, selecting: false, snapline: false, clipboard: false, history: false, scroller: false });\n        this.targetGraph = this.options.createGraph\n            ? this.options.createGraph(targetGraphOptions)\n            : new Graph(targetGraphOptions);\n        this.targetGraph.renderer.unfreeze();\n        this.updatePaper(this.sourceGraph.options.width, this.sourceGraph.options.height);\n        this.startListening();\n    }\n    get graph() {\n        return this.options.graph;\n    }\n    get scroller() {\n        return this.graph.scroller.widget;\n    }\n    get graphContainer() {\n        if (this.scroller) {\n            return this.scroller.container;\n        }\n        return this.graph.container;\n    }\n    get $graphContainer() {\n        if (this.scroller) {\n            return this.scroller.$container;\n        }\n        return this.$(this.graph.container);\n    }\n    startListening() {\n        if (this.scroller) {\n            this.$graphContainer.on(`scroll${this.getEventNamespace()}`, this.updateViewport);\n        }\n        else {\n            this.sourceGraph.on('translate', this.updateViewport, this);\n        }\n        this.sourceGraph.on('resize', this.updatePaper, this);\n        this.delegateEvents({\n            mousedown: 'startAction',\n            touchstart: 'startAction',\n            [`mousedown .${this.prefixClassName('graph')}`]: 'scrollTo',\n            [`touchstart .${this.prefixClassName('graph')}`]: 'scrollTo',\n        });\n    }\n    stopListening() {\n        if (this.scroller) {\n            this.$graphContainer.off(this.getEventNamespace());\n        }\n        else {\n            this.sourceGraph.off('translate', this.updateViewport, this);\n        }\n        this.sourceGraph.off('resize', this.updatePaper, this);\n        this.undelegateEvents();\n    }\n    onRemove() {\n        this.targetGraph.view.remove();\n        this.stopListening();\n        this.targetGraph.dispose();\n    }\n    updatePaper(w, h) {\n        let width;\n        let height;\n        if (typeof w === 'object') {\n            width = w.width;\n            height = w.height;\n        }\n        else {\n            width = w;\n            height = h;\n        }\n        const origin = this.sourceGraph.options;\n        const scale = this.sourceGraph.transform.getScale();\n        const maxWidth = this.options.width - 2 * this.options.padding;\n        const maxHeight = this.options.height - 2 * this.options.padding;\n        width /= scale.sx; // eslint-disable-line\n        height /= scale.sy; // eslint-disable-line\n        this.ratio = Math.min(maxWidth / width, maxHeight / height);\n        const ratio = this.ratio;\n        const x = (origin.x * ratio) / scale.sx;\n        const y = (origin.y * ratio) / scale.sy;\n        width *= ratio; // eslint-disable-line\n        height *= ratio; // eslint-disable-line\n        this.targetGraph.resizeGraph(width, height);\n        this.targetGraph.translate(x, y);\n        this.targetGraph.scale(ratio, ratio);\n        this.updateViewport();\n        return this;\n    }\n    updateViewport() {\n        const ratio = this.ratio;\n        const scale = this.sourceGraph.transform.getScale();\n        let origin = null;\n        if (this.scroller) {\n            origin = this.scroller.clientToLocalPoint(0, 0);\n        }\n        else {\n            const ctm = this.sourceGraph.matrix();\n            origin = new Point(-ctm.e / ctm.a, -ctm.f / ctm.d);\n        }\n        const position = this.$(this.targetGraph.container).position();\n        const translation = this.targetGraph.translate();\n        translation.ty = translation.ty || 0;\n        this.geometry = {\n            top: position.top + origin.y * ratio + translation.ty,\n            left: position.left + origin.x * ratio + translation.tx,\n            width: (this.$graphContainer.innerWidth() * ratio) / scale.sx,\n            height: (this.$graphContainer.innerHeight() * ratio) / scale.sy,\n        };\n        this.$viewport.css(this.geometry);\n    }\n    startAction(evt) {\n        const e = this.normalizeEvent(evt);\n        const action = e.target === this.zoomHandle ? 'zooming' : 'panning';\n        const { tx, ty } = this.sourceGraph.translate();\n        const eventData = {\n            action,\n            clientX: e.clientX,\n            clientY: e.clientY,\n            scrollLeft: this.graphContainer.scrollLeft,\n            scrollTop: this.graphContainer.scrollTop,\n            zoom: this.sourceGraph.zoom(),\n            scale: this.sourceGraph.transform.getScale(),\n            geometry: this.geometry,\n            translateX: tx,\n            translateY: ty,\n        };\n        this.delegateDocumentEvents(Util.documentEvents, eventData);\n    }\n    doAction(evt) {\n        const e = this.normalizeEvent(evt);\n        const clientX = e.clientX;\n        const clientY = e.clientY;\n        const data = e.data;\n        switch (data.action) {\n            case 'panning': {\n                const scale = this.sourceGraph.transform.getScale();\n                const rx = (clientX - data.clientX) * scale.sx;\n                const ry = (clientY - data.clientY) * scale.sy;\n                if (this.scroller) {\n                    this.graphContainer.scrollLeft = data.scrollLeft + rx / this.ratio;\n                    this.graphContainer.scrollTop = data.scrollTop + ry / this.ratio;\n                }\n                else {\n                    this.sourceGraph.translate(data.translateX - rx / this.ratio, data.translateY - ry / this.ratio);\n                }\n                break;\n            }\n            case 'zooming': {\n                const startScale = data.scale;\n                const startGeometry = data.geometry;\n                const delta = 1 + (data.clientX - clientX) / startGeometry.width / startScale.sx;\n                if (data.frameId) {\n                    cancelAnimationFrame(data.frameId);\n                }\n                data.frameId = requestAnimationFrame(() => {\n                    this.sourceGraph.zoom(delta * data.zoom, {\n                        absolute: true,\n                        minScale: this.options.minScale,\n                        maxScale: this.options.maxScale,\n                    });\n                });\n                break;\n            }\n            default:\n                break;\n        }\n    }\n    stopAction() {\n        this.undelegateDocumentEvents();\n    }\n    scrollTo(evt) {\n        const e = this.normalizeEvent(evt);\n        let x;\n        let y;\n        const ts = this.targetGraph.translate();\n        ts.ty = ts.ty || 0;\n        if (e.offsetX == null) {\n            const offset = this.$(this.targetGraph.container).offset();\n            x = e.pageX - offset.left;\n            y = e.pageY - offset.top;\n        }\n        else {\n            x = e.offsetX;\n            y = e.offsetY;\n        }\n        const cx = (x - ts.tx) / this.ratio;\n        const cy = (y - ts.ty) / this.ratio;\n        this.sourceGraph.centerPoint(cx, cy);\n    }\n    dispose() {\n        this.remove();\n    }\n}\n__decorate([\n    View.dispose()\n], MiniMap.prototype, \"dispose\", null);\nvar Util;\n(function (Util) {\n    Util.defaultOptions = {\n        width: 300,\n        height: 200,\n        padding: 10,\n        scalable: true,\n        minScale: 0.01,\n        maxScale: 16,\n        graphOptions: {},\n        createGraph: (options) => new Graph(options),\n    };\n    Util.documentEvents = {\n        mousemove: 'doAction',\n        touchmove: 'doAction',\n        mouseup: 'stopAction',\n        touchend: 'stopAction',\n    };\n})(Util || (Util = {}));\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}