{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _wrapNativeSuper from \"@babel/runtime/helpers/wrapNativeSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport { $window, $XMLHttpRequest } from './mini-adapter';\n\nvar AJAXError = function (_Error) {\n  _inherits(AJAXError, _Error);\n\n  var _super = _createSuper(AJAXError);\n\n  function AJAXError(message, status, url) {\n    var _this;\n\n    _classCallCheck(this, AJAXError);\n\n    _this = _super.call(this, message);\n\n    _defineProperty(_assertThisInitialized(_this), \"status\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"url\", void 0);\n\n    _this.status = status;\n    _this.url = url;\n    _this.name = _this.constructor.name;\n    _this.message = message;\n    return _this;\n  }\n\n  _createClass(AJAXError, [{\n    key: \"toString\",\n    value: function toString() {\n      return \"\".concat(this.name, \": \").concat(this.message, \" (\").concat(this.status, \"): \").concat(this.url);\n    }\n  }]);\n\n  return AJAXError;\n}(_wrapNativeSuper(Error));\n\nfunction makeRequest(requestParameters) {\n  var xhr = new $XMLHttpRequest();\n  xhr.open('GET', requestParameters.url, true);\n\n  for (var k in requestParameters.headers) {\n    if (requestParameters.headers.hasOwnProperty(k)) {\n      xhr.setRequestHeader(k, requestParameters.headers[k]);\n    }\n  }\n\n  xhr.withCredentials = requestParameters.credentials === 'include';\n  return xhr;\n}\n\nexport var getJSON = function getJSON(requestParameters, callback) {\n  var xhr = makeRequest(requestParameters);\n  xhr.setRequestHeader('Accept', 'application/json');\n\n  xhr.onerror = function () {\n    callback(new Error(xhr.statusText));\n  };\n\n  xhr.onload = function () {\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      var data;\n\n      try {\n        data = JSON.parse(xhr.response);\n      } catch (err) {\n        return callback(err);\n      }\n\n      callback(null, data);\n    } else {\n      if (xhr.status === 401) {\n        callback(new AJAXError(\"\".concat(xhr.statusText), xhr.status, requestParameters.url));\n      } else {\n        callback(new AJAXError(xhr.statusText, xhr.status, requestParameters.url));\n      }\n    }\n  };\n\n  xhr.send();\n  return xhr;\n};\nexport var getArrayBuffer = function getArrayBuffer(requestParameters, callback) {\n  var xhr = makeRequest(requestParameters);\n  xhr.responseType = 'arraybuffer';\n\n  xhr.onerror = function () {\n    callback(new Error(xhr.statusText));\n  };\n\n  xhr.onload = function () {\n    var response = xhr.response;\n\n    if (response.byteLength === 0 && xhr.status === 200) {\n      return callback(new Error('http status 200 returned without content.'));\n    }\n\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      callback(null, {\n        data: response,\n        cacheControl: xhr.getResponseHeader('Cache-Control'),\n        expires: xhr.getResponseHeader('Expires')\n      });\n    } else {\n      callback(new AJAXError(xhr.statusText, xhr.status, requestParameters.url));\n    }\n  };\n\n  xhr.send();\n  return xhr;\n};\n\nfunction sameOrigin(url) {\n  var a = $window.document.createElement('a');\n  a.href = url;\n  return a.protocol === $window.document.location.protocol && a.host === $window.document.location.host;\n}\n\nvar transparentPngUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\nexport var getImage = function getImage(requestParameters, callback) {\n  return getArrayBuffer(requestParameters, function (err, imgData) {\n    if (err) {\n      callback(err);\n    } else if (imgData) {\n      var img = new $window.Image();\n      img.crossOrigin = 'anonymous';\n      var URL = $window.URL || $window.webkitURL;\n\n      img.onload = function () {\n        callback(null, img);\n        URL.revokeObjectURL(img.src);\n      };\n\n      var blob = new $window.Blob([new Uint8Array(imgData.data)], {\n        type: 'image/png'\n      });\n      img.src = imgData.data.byteLength ? URL.createObjectURL(blob) : transparentPngUrl;\n    }\n  });\n};","map":{"version":3,"sources":["../src/fetchData.ts"],"names":["AJAXError","Error","xhr","requestParameters","getJSON","makeRequest","callback","data","JSON","getArrayBuffer","response","cacheControl","expires","a","$window","transparentPngUrl","getImage","img","URL","blob","imgData","type"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAAA,OAAA,EAAA,eAAA,QAAA,gBAAA;;IACMA,S;;;;;AAIJ,WAAA,SAAA,CAAA,OAAA,EAAA,MAAA,EAAA,GAAA,EAA0D;AAAA,QAAA,KAAA;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,SAAA,CAAA;;AACxD,IAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAA,OAAA,CAAA;;AADwD,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,QAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAA,eAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,EAAA,KAAA,EAAA,KAAA,CAAA,CAAA;;AAExD,IAAA,KAAA,CAAA,MAAA,GAAA,MAAA;AACA,IAAA,KAAA,CAAA,GAAA,GAAA,GAAA;AAGA,IAAA,KAAA,CAAA,IAAA,GAAY,KAAA,CAAA,WAAA,CAAZ,IAAA;AACA,IAAA,KAAA,CAAA,OAAA,GAAA,OAAA;AAPwD,WAAA,KAAA;AAQzD;;;;WAED,SAAA,QAAA,GAAkB;AAChB,aAAA,GAAA,MAAA,CAAU,KAAV,IAAA,EAAA,IAAA,EAAA,MAAA,CAAwB,KAAxB,OAAA,EAAA,IAAA,EAAA,MAAA,CAAyC,KAAzC,MAAA,EAAA,KAAA,EAAA,MAAA,CAA0D,KAA1D,GAAA,CAAA;AACD;;;;mBAhBqBC,K;;AAmBxB,SAAA,WAAA,CAAA,iBAAA,EAA6C;AAC3C,MAAMC,GAAG,GAAG,IAAZ,eAAY,EAAZ;AAEAA,EAAAA,GAAG,CAAHA,IAAAA,CAAAA,KAAAA,EAAgBC,iBAAiB,CAAjCD,GAAAA,EAAAA,IAAAA;;AACA,OAAK,IAAL,CAAA,IAAgBC,iBAAiB,CAAjC,OAAA,EAA2C;AACzC,QAAIA,iBAAiB,CAAjBA,OAAAA,CAAAA,cAAAA,CAAJ,CAAIA,CAAJ,EAAiD;AAC/CD,MAAAA,GAAG,CAAHA,gBAAAA,CAAAA,CAAAA,EAAwBC,iBAAiB,CAAjBA,OAAAA,CAAxBD,CAAwBC,CAAxBD;AACD;AACF;;AACDA,EAAAA,GAAG,CAAHA,eAAAA,GAAsBC,iBAAiB,CAAjBA,WAAAA,KAAtBD,SAAAA;AACA,SAAA,GAAA;AACD;;AAED,OAAO,IAAME,OAAO,GAAG,SAAVA,OAAU,CAAA,iBAAA,EAAA,QAAA,EAA2C;AAChE,MAAMF,GAAG,GAAGG,WAAW,CAAvB,iBAAuB,CAAvB;AACAH,EAAAA,GAAG,CAAHA,gBAAAA,CAAAA,QAAAA,EAAAA,kBAAAA;;AACAA,EAAAA,GAAG,CAAHA,OAAAA,GAAc,YAAM;AAClBI,IAAAA,QAAQ,CAAC,IAAA,KAAA,CAAUJ,GAAG,CAAtBI,UAAS,CAAD,CAARA;AADFJ,GAAAA;;AAGAA,EAAAA,GAAG,CAAHA,MAAAA,GAAa,YAAM;AACjB,QAAIA,GAAG,CAAHA,MAAAA,IAAAA,GAAAA,IAAqBA,GAAG,CAAHA,MAAAA,GAArBA,GAAAA,IAAyCA,GAAG,CAAhD,QAAA,EAA2D;AACzD,UAAA,IAAA;;AACA,UAAI;AACFK,QAAAA,IAAI,GAAGC,IAAI,CAAJA,KAAAA,CAAWN,GAAG,CAArBK,QAAOC,CAAPD;AADF,OAAA,CAEE,OAAA,GAAA,EAAY;AACZ,eAAOD,QAAQ,CAAf,GAAe,CAAf;AACD;;AACDA,MAAAA,QAAQ,CAAA,IAAA,EAARA,IAAQ,CAARA;AAPF,KAAA,MAQO;AACL,UAAIJ,GAAG,CAAHA,MAAAA,KAAJ,GAAA,EAAwB;AACtBI,QAAAA,QAAQ,CACN,IAAA,SAAA,CAAA,GAAA,MAAA,CAAiBJ,GAAG,CAApB,UAAA,CAAA,EAAmCA,GAAG,CAAtC,MAAA,EAA+CC,iBAAiB,CADlEG,GACE,CADM,CAARA;AADF,OAAA,MAIO;AACLA,QAAAA,QAAQ,CACN,IAAA,SAAA,CAAcJ,GAAG,CAAjB,UAAA,EAA8BA,GAAG,CAAjC,MAAA,EAA0CC,iBAAiB,CAD7DG,GACE,CADM,CAARA;AAGD;AACF;AAnBHJ,GAAAA;;AAqBAA,EAAAA,GAAG,CAAHA,IAAAA;AACA,SAAA,GAAA;AA5BK,CAAA;AA+BP,OAAO,IAAMO,cAAc,GAAG,SAAjBA,cAAiB,CAAA,iBAAA,EAAA,QAAA,EAA2C;AACvE,MAAMP,GAAG,GAAGG,WAAW,CAAvB,iBAAuB,CAAvB;AACAH,EAAAA,GAAG,CAAHA,YAAAA,GAAAA,aAAAA;;AACAA,EAAAA,GAAG,CAAHA,OAAAA,GAAc,YAAM;AAClBI,IAAAA,QAAQ,CAAC,IAAA,KAAA,CAAUJ,GAAG,CAAtBI,UAAS,CAAD,CAARA;AADFJ,GAAAA;;AAGAA,EAAAA,GAAG,CAAHA,MAAAA,GAAa,YAAM;AACjB,QAAMQ,QAAQ,GAAGR,GAAG,CAApB,QAAA;;AACA,QAAIQ,QAAQ,CAARA,UAAAA,KAAAA,CAAAA,IAA6BR,GAAG,CAAHA,MAAAA,KAAjC,GAAA,EAAqD;AACnD,aAAOI,QAAQ,CAAC,IAAA,KAAA,CAAhB,2CAAgB,CAAD,CAAf;AACD;;AACD,QAAIJ,GAAG,CAAHA,MAAAA,IAAAA,GAAAA,IAAqBA,GAAG,CAAHA,MAAAA,GAArBA,GAAAA,IAAyCA,GAAG,CAAhD,QAAA,EAA2D;AACzDI,MAAAA,QAAQ,CAAA,IAAA,EAAO;AACbC,QAAAA,IAAI,EADS,QAAA;AAEbI,QAAAA,YAAY,EAAET,GAAG,CAAHA,iBAAAA,CAFD,eAECA,CAFD;AAGbU,QAAAA,OAAO,EAAEV,GAAG,CAAHA,iBAAAA,CAAAA,SAAAA;AAHI,OAAP,CAARI;AADF,KAAA,MAMO;AACLA,MAAAA,QAAQ,CACN,IAAA,SAAA,CAAcJ,GAAG,CAAjB,UAAA,EAA8BA,GAAG,CAAjC,MAAA,EAA0CC,iBAAiB,CAD7DG,GACE,CADM,CAARA;AAGD;AAfHJ,GAAAA;;AAiBAA,EAAAA,GAAG,CAAHA,IAAAA;AACA,SAAA,GAAA;AAxBK,CAAA;;AA2BP,SAAA,UAAA,CAAA,GAAA,EAAiC;AAC/B,MAAMW,CAAC,GAAGC,OAAO,CAAPA,QAAAA,CAAAA,aAAAA,CAAV,GAAUA,CAAV;AACAD,EAAAA,CAAC,CAADA,IAAAA,GAAAA,GAAAA;AACA,SACEA,CAAC,CAADA,QAAAA,KAAeC,OAAO,CAAPA,QAAAA,CAAAA,QAAAA,CAAfD,QAAAA,IACAA,CAAC,CAADA,IAAAA,KAAWC,OAAO,CAAPA,QAAAA,CAAAA,QAAAA,CAFb,IAAA;AAID;;AAED,IAAMC,iBAAiB,GAAvB,oHAAA;AAGA,OAAO,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAA,iBAAA,EAAA,QAAA,EAA2C;AAGjE,SAAOP,cAAc,CAAA,iBAAA,EAAoB,UAAA,GAAA,EAAA,OAAA,EAA+B;AACtE,QAAA,GAAA,EAAS;AACPH,MAAAA,QAAQ,CAARA,GAAQ,CAARA;AADF,KAAA,MAEO,IAAA,OAAA,EAAa;AAClB,UAAMW,GAAG,GAAG,IAAIH,OAAO,CAAvB,KAAY,EAAZ;AACAG,MAAAA,GAAG,CAAHA,WAAAA,GAAAA,WAAAA;AACA,UAAMC,GAAG,GAAGJ,OAAO,CAAPA,GAAAA,IAAeA,OAAO,CAAlC,SAAA;;AAEAG,MAAAA,GAAG,CAAHA,MAAAA,GAAa,YAAM;AACjBX,QAAAA,QAAQ,CAAA,IAAA,EAARA,GAAQ,CAARA;AACAY,QAAAA,GAAG,CAAHA,eAAAA,CAAoBD,GAAG,CAAvBC,GAAAA;AAFFD,OAAAA;;AAIA,UAAME,IAAI,GAAG,IAAIL,OAAO,CAAX,IAAA,CAAiB,CAAC,IAAA,UAAA,CAAeM,OAAO,CAAxC,IAAkB,CAAD,CAAjB,EAAiD;AAC5DC,QAAAA,IAAI,EAAE;AADsD,OAAjD,CAAb;AAGAJ,MAAAA,GAAG,CAAHA,GAAAA,GAAUG,OAAO,CAAPA,IAAAA,CAAAA,UAAAA,GACNF,GAAG,CAAHA,eAAAA,CADME,IACNF,CADME,GAAVH,iBAAAA;AAGD;AAlBH,GAAqB,CAArB;AAHK,CAAA","sourcesContent":["import { $window, $XMLHttpRequest } from './mini-adapter';\nclass AJAXError extends Error {\n  private status: number;\n  private url: string;\n\n  constructor(message: string, status: number, url: string) {\n    super(message);\n    this.status = status;\n    this.url = url;\n\n    // work around for https://github.com/Rich-Harris/buble/issues/40\n    this.name = this.constructor.name;\n    this.message = message;\n  }\n\n  public toString() {\n    return `${this.name}: ${this.message} (${this.status}): ${this.url}`;\n  }\n}\n\nfunction makeRequest(requestParameters: any) {\n  const xhr = new $XMLHttpRequest();\n\n  xhr.open('GET', requestParameters.url, true);\n  for (const k in requestParameters.headers) {\n    if (requestParameters.headers.hasOwnProperty(k)) {\n      xhr.setRequestHeader(k, requestParameters.headers[k]);\n    }\n  }\n  xhr.withCredentials = requestParameters.credentials === 'include';\n  return xhr;\n}\n\nexport const getJSON = (requestParameters: any, callback: any) => {\n  const xhr = makeRequest(requestParameters);\n  xhr.setRequestHeader('Accept', 'application/json');\n  xhr.onerror = () => {\n    callback(new Error(xhr.statusText));\n  };\n  xhr.onload = () => {\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      let data;\n      try {\n        data = JSON.parse(xhr.response);\n      } catch (err) {\n        return callback(err);\n      }\n      callback(null, data);\n    } else {\n      if (xhr.status === 401) {\n        callback(\n          new AJAXError(`${xhr.statusText}`, xhr.status, requestParameters.url),\n        );\n      } else {\n        callback(\n          new AJAXError(xhr.statusText, xhr.status, requestParameters.url),\n        );\n      }\n    }\n  };\n  xhr.send();\n  return xhr;\n};\n\nexport const getArrayBuffer = (requestParameters: any, callback: any) => {\n  const xhr = makeRequest(requestParameters);\n  xhr.responseType = 'arraybuffer';\n  xhr.onerror = () => {\n    callback(new Error(xhr.statusText));\n  };\n  xhr.onload = () => {\n    const response = xhr.response;\n    if (response.byteLength === 0 && xhr.status === 200) {\n      return callback(new Error('http status 200 returned without content.'));\n    }\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      callback(null, {\n        data: response,\n        cacheControl: xhr.getResponseHeader('Cache-Control'),\n        expires: xhr.getResponseHeader('Expires'),\n      });\n    } else {\n      callback(\n        new AJAXError(xhr.statusText, xhr.status, requestParameters.url),\n      );\n    }\n  };\n  xhr.send();\n  return xhr;\n};\n\nfunction sameOrigin(url: string) {\n  const a = $window.document.createElement('a');\n  a.href = url;\n  return (\n    a.protocol === $window.document.location.protocol &&\n    a.host === $window.document.location.host\n  );\n}\n\nconst transparentPngUrl =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\n\nexport const getImage = (requestParameters: any, callback: any) => {\n  // request the image with XHR to work around caching issues\n  // see https://github.com/mapbox/mapbox-gl-js/issues/1470\n  return getArrayBuffer(requestParameters, (err: string, imgData: any) => {\n    if (err) {\n      callback(err);\n    } else if (imgData) {\n      const img = new $window.Image();\n      img.crossOrigin = 'anonymous';\n      const URL = $window.URL || $window.webkitURL;\n      // @ts-ignore\n      img.onload = () => {\n        callback(null, img);\n        URL.revokeObjectURL(img.src);\n      };\n      const blob = new $window.Blob([new Uint8Array(imgData.data)], {\n        type: 'image/png',\n      });\n      img.src = imgData.data.byteLength\n        ? URL.createObjectURL(blob)\n        : transparentPngUrl;\n    }\n  });\n};\n"]},"metadata":{},"sourceType":"module"}