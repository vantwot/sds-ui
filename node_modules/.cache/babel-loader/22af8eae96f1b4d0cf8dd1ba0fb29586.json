{"ast":null,"code":"import _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport React, { useCallback } from 'react';\nimport { Empty, Collapse } from 'antd';\nimport { get } from 'lodash';\nimport { Addon } from '@antv/x6';\nimport { getNodeReactComponent, useXFlowApp, uuidv4, XFlowNodeCommands } from '@antv/xflow-core';\nimport { setNodeRender } from './utils';\nimport { getProps } from '../flowchart-canvas/utils';\nimport { NodeTitle, defaultNodeFactory } from '../canvas-node-tree-panel/panel-body';\nvar Panel = Collapse.Panel;\nexport var NodePanelBody = function NodePanelBody(props) {\n  var x6NodeFactory = props.x6NodeFactory,\n      dndOptions = props.dndOptions,\n      state = props.state,\n      prefixClz = props.prefixClz,\n      registerNode = props.registerNode,\n      _props$defaultActiveK = props.defaultActiveKey,\n      defaultActiveKey = _props$defaultActiveK === void 0 ? ['official', 'custom'] : _props$defaultActiveK;\n\n  var _ref = registerNode !== null && registerNode !== void 0 ? registerNode : {},\n      _ref$title = _ref.title,\n      title = _ref$title === void 0 ? '复制节点' : _ref$title;\n\n  var _useXFlowApp = useXFlowApp(),\n      graphProvider = _useXFlowApp.graphProvider,\n      modelService = _useXFlowApp.modelService,\n      commandService = _useXFlowApp.commandService;\n\n  var _React$useState = React.useState(),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      dnd = _React$useState2[0],\n      setDnd = _React$useState2[1];\n  /** 获取graph实例 */\n\n\n  var _React$useState3 = React.useState(),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      graph = _React$useState4[0],\n      setGraph = _React$useState4[1];\n\n  graphProvider.getGraphInstance().then(function (x6Graph) {\n    setGraph(x6Graph);\n  });\n  var graphConfig = undefined;\n  graphProvider.getGraphOptions().then(function (x6GraphConfig) {\n    /** x6GraphConfig 上缺失 setNodeRender 方法  */\n    setNodeRender(getProps('graphConfig'), get(props, 'registerNode.nodes', []));\n    graphConfig = x6GraphConfig;\n  });\n  var onNodeDrop = useCallback(function (node) {\n    return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _a, ports, nodeConfig, args, onAddNode;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              ports = node.ports;\n              nodeConfig = Object.assign(Object.assign({}, node), {\n                id: \"node-\".concat(uuidv4()),\n                zIndex: 10,\n                ports: Object.assign(Object.assign({}, ports), {\n                  items: (_a = ports.items) === null || _a === void 0 ? void 0 : _a.map(function (item) {\n                    return Object.assign(Object.assign({}, item), {\n                      id: uuidv4()\n                    });\n                  })\n                })\n              });\n              args = {\n                nodeConfig: nodeConfig\n              };\n              _context.next = 5;\n              return commandService.executeCommand(XFlowNodeCommands.ADD_NODE.id, args);\n\n            case 5:\n              onAddNode = getProps('onAddNode');\n\n              if (typeof onAddNode === 'function') {\n                onAddNode(nodeConfig);\n              }\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n  }, [commandService]);\n  React.useEffect(function () {\n    if (!graph) {\n      return;\n    }\n\n    var dndInstance = new Addon.Dnd(Object.assign(Object.assign({\n      scaled: false,\n      animation: false\n    }, dndOptions), {\n      target: graph,\n\n      /** 这里考虑到需要新增群组的需求，不使用x6的getDropNod方法\n       * 在validateNode时调用command添加\n       */\n      validateNode: function validateNode(droppingNode) {\n        return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n          var nodeConfig;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  nodeConfig = Object.assign(Object.assign({}, droppingNode.getData()), droppingNode.getPosition());\n                  _context2.next = 3;\n                  return onNodeDrop(nodeConfig);\n\n                case 3:\n                  return _context2.abrupt(\"return\", false);\n\n                case 4:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n      }\n    }));\n    setDnd(dndInstance);\n  }, [commandService, dndOptions, graph, modelService, onNodeDrop]);\n  var onMouseDown = React.useCallback(function (nodeConfig) {\n    return function (e) {\n      if (!graph || !dnd || !graphConfig) {\n        return;\n      }\n\n      var renderKey = graphConfig.nodeTypeParser(nodeConfig);\n      var _nodeConfig$width = nodeConfig.width,\n          width = _nodeConfig$width === void 0 ? 180 : _nodeConfig$width,\n          _nodeConfig$height = nodeConfig.height,\n          height = _nodeConfig$height === void 0 ? 40 : _nodeConfig$height;\n      var reactComponent = graphConfig.nodeRender.get(renderKey);\n      var wrappedComponent = getNodeReactComponent(reactComponent, commandService, modelService);\n      var nodeData = {\n        data: nodeConfig,\n        width: width,\n        height: height,\n        view: graphConfig.graphId,\n        component: wrappedComponent\n      };\n      var x6Node = x6NodeFactory ? x6NodeFactory(nodeData) : defaultNodeFactory(nodeData);\n      dnd.start(x6Node, e.nativeEvent);\n    };\n  }, [commandService, dnd, graph, graphConfig, modelService, x6NodeFactory]);\n  var renderTree = React.useCallback(function () {\n    var list = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    return list.map(function (item) {\n      var popoverContent = item.popoverContent;\n      return React.createElement(NodeTitle, {\n        item: item,\n        key: item.id,\n        onMouseDown: onMouseDown(item),\n        popoverContent: popoverContent,\n        prefixClz: prefixClz,\n        modelService: modelService,\n        commandService: commandService,\n        graphConfig: graphConfig\n      });\n    });\n  }, [commandService, graphConfig, modelService, onMouseDown, prefixClz]);\n  var customNode = state.nodeList.filter(function (item) {\n    return item.isCustom;\n  });\n  var officialNode = state.nodeList.filter(function (item) {\n    return !item.isCustom;\n  });\n  var searchCustomNode = state.searchList.filter(function (item) {\n    return item.isCustom;\n  });\n  var searchOfficialNode = state.searchList.filter(function (item) {\n    return !item.isCustom;\n  });\n  var hasCustomNode = customNode.length > 0;\n  return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    className: \"\".concat(prefixClz, \"-body\")\n  }, React.createElement(Collapse, {\n    defaultActiveKey: defaultActiveKey,\n    style: {\n      border: 'none'\n    }\n  }, React.createElement(Panel, {\n    header: \"\\u901A\\u7528\\u8282\\u70B9\",\n    key: \"official\",\n    style: {\n      border: 'none'\n    }\n  }, !state.keyword && React.createElement(\"div\", {\n    className: \"\".concat(prefixClz, \"-official\")\n  }, renderTree(officialNode)), state.searchList.length > 0 && React.createElement(\"div\", {\n    className: \"\".concat(prefixClz, \"-official\")\n  }, renderTree(searchOfficialNode))), hasCustomNode && React.createElement(Panel, {\n    header: title,\n    key: \"custom\",\n    style: {\n      border: 'none'\n    }\n  }, !state.keyword && React.createElement(\"div\", {\n    className: \"\".concat(prefixClz, \"-custom\")\n  }, renderTree(customNode)), state.searchList.length > 0 && React.createElement(\"div\", {\n    className: \"\".concat(prefixClz, \"-custom\")\n  }, renderTree(searchCustomNode)))), state.keyword && state.searchList.length === 0 && React.createElement(Empty, {\n    style: {\n      marginTop: '48px'\n    }\n  })));\n};","map":{"version":3,"sources":["../../src/flowchart-node-panel/panel-body.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport React, { useCallback } from 'react';\nimport { Empty, Collapse } from 'antd';\nimport { get } from 'lodash';\nimport { Addon } from '@antv/x6';\nimport { getNodeReactComponent, useXFlowApp, uuidv4, XFlowNodeCommands } from '@antv/xflow-core';\nimport { setNodeRender } from './utils';\nimport { getProps } from '../flowchart-canvas/utils';\nimport { NodeTitle, defaultNodeFactory } from '../canvas-node-tree-panel/panel-body';\nconst { Panel } = Collapse;\nexport const NodePanelBody = props => {\n    const { x6NodeFactory, dndOptions, state, prefixClz, registerNode, defaultActiveKey = ['official', 'custom'], } = props;\n    const { title = '复制节点' } = registerNode !== null && registerNode !== void 0 ? registerNode : {};\n    const { graphProvider, modelService, commandService } = useXFlowApp();\n    const [dnd, setDnd] = React.useState();\n    /** 获取graph实例 */\n    const [graph, setGraph] = React.useState();\n    graphProvider.getGraphInstance().then(x6Graph => {\n        setGraph(x6Graph);\n    });\n    let graphConfig = undefined;\n    graphProvider.getGraphOptions().then(x6GraphConfig => {\n        /** x6GraphConfig 上缺失 setNodeRender 方法  */\n        setNodeRender(getProps('graphConfig'), get(props, 'registerNode.nodes', []));\n        graphConfig = x6GraphConfig;\n    });\n    const onNodeDrop = useCallback((node) => __awaiter(void 0, void 0, void 0, function* () {\n        var _a;\n        const { ports } = node;\n        const nodeConfig = Object.assign(Object.assign({}, node), { id: `node-${uuidv4()}`, zIndex: 10, ports: Object.assign(Object.assign({}, ports), { items: (_a = ports.items) === null || _a === void 0 ? void 0 : _a.map(item => (Object.assign(Object.assign({}, item), { id: uuidv4() }))) }) });\n        const args = {\n            nodeConfig,\n        };\n        yield commandService.executeCommand(XFlowNodeCommands.ADD_NODE.id, args);\n        const onAddNode = getProps('onAddNode');\n        if (typeof onAddNode === 'function') {\n            onAddNode(nodeConfig);\n        }\n    }), [commandService]);\n    React.useEffect(() => {\n        if (!graph) {\n            return;\n        }\n        const dndInstance = new Addon.Dnd(Object.assign(Object.assign({ scaled: false, animation: false }, dndOptions), { target: graph, \n            /** 这里考虑到需要新增群组的需求，不使用x6的getDropNod方法\n             * 在validateNode时调用command添加\n             */\n            validateNode: (droppingNode) => __awaiter(void 0, void 0, void 0, function* () {\n                const nodeConfig = Object.assign(Object.assign({}, droppingNode.getData()), droppingNode.getPosition());\n                yield onNodeDrop(nodeConfig);\n                return false;\n            }) }));\n        setDnd(dndInstance);\n    }, [commandService, dndOptions, graph, modelService, onNodeDrop]);\n    const onMouseDown = React.useCallback((nodeConfig) => (e) => {\n        if (!graph || !dnd || !graphConfig) {\n            return;\n        }\n        const renderKey = graphConfig.nodeTypeParser(nodeConfig);\n        const { width = 180, height = 40 } = nodeConfig;\n        const reactComponent = graphConfig.nodeRender.get(renderKey);\n        const wrappedComponent = getNodeReactComponent(reactComponent, commandService, modelService);\n        const nodeData = {\n            data: nodeConfig,\n            width,\n            height,\n            view: graphConfig.graphId,\n            component: wrappedComponent,\n        };\n        const x6Node = x6NodeFactory ? x6NodeFactory(nodeData) : defaultNodeFactory(nodeData);\n        dnd.start(x6Node, e.nativeEvent);\n    }, [commandService, dnd, graph, graphConfig, modelService, x6NodeFactory]);\n    const renderTree = React.useCallback((list = []) => {\n        return list.map(item => {\n            const { popoverContent } = item;\n            return (React.createElement(NodeTitle, { item: item, key: item.id, onMouseDown: onMouseDown(item), popoverContent: popoverContent, prefixClz: prefixClz, modelService: modelService, commandService: commandService, graphConfig: graphConfig }));\n        });\n    }, [commandService, graphConfig, modelService, onMouseDown, prefixClz]);\n    const customNode = state.nodeList.filter(item => item.isCustom);\n    const officialNode = state.nodeList.filter(item => !item.isCustom);\n    const searchCustomNode = state.searchList.filter(item => item.isCustom);\n    const searchOfficialNode = state.searchList.filter(item => !item.isCustom);\n    const hasCustomNode = customNode.length > 0;\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: `${prefixClz}-body` },\n            React.createElement(Collapse, { defaultActiveKey: defaultActiveKey, style: { border: 'none' } },\n                React.createElement(Panel, { header: \"\\u901A\\u7528\\u8282\\u70B9\", key: \"official\", style: { border: 'none' } },\n                    !state.keyword && (React.createElement(\"div\", { className: `${prefixClz}-official` }, renderTree(officialNode))),\n                    state.searchList.length > 0 && (React.createElement(\"div\", { className: `${prefixClz}-official` }, renderTree(searchOfficialNode)))),\n                hasCustomNode && (React.createElement(Panel, { header: title, key: \"custom\", style: { border: 'none' } },\n                    !state.keyword && (React.createElement(\"div\", { className: `${prefixClz}-custom` }, renderTree(customNode))),\n                    state.searchList.length > 0 && (React.createElement(\"div\", { className: `${prefixClz}-custom` }, renderTree(searchCustomNode)))))),\n            state.keyword && state.searchList.length === 0 && React.createElement(Empty, { style: { marginTop: '48px' } }))));\n};\n//# sourceMappingURL=panel-body.js.map"]},"metadata":{},"sourceType":"module"}