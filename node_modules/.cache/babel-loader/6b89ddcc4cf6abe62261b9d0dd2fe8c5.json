{"ast":null,"code":"import _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport Mousetrap from 'mousetrap';\nimport { Dom, FunctionExt } from '../util';\nimport { Disposable } from '../common';\nexport var Keyboard = /*#__PURE__*/function (_Disposable) {\n  _inherits(Keyboard, _Disposable);\n\n  var _super = _createSuper(Keyboard);\n\n  function Keyboard(options) {\n    var _this;\n\n    _classCallCheck(this, Keyboard);\n\n    _this = _super.call(this);\n    _this.options = options;\n    var scroller = _this.graph.scroller.widget;\n    _this.container = scroller ? scroller.container : _this.graph.container;\n\n    if (options.global) {\n      _this.target = document;\n    } else {\n      _this.target = _this.container;\n\n      if (!_this.disabled) {\n        // ensure the container focusable\n        _this.target.setAttribute('tabindex', '-1');\n      } // change to mouseup event，prevent page stalling caused by focus\n\n\n      _this.graph.on('cell:mouseup', _this.focus, _assertThisInitialized(_this));\n\n      _this.graph.on('blank:mouseup', _this.focus, _assertThisInitialized(_this));\n    }\n\n    _this.mousetrap = Keyboard.createMousetrap(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(Keyboard, [{\n    key: \"graph\",\n    get: function get() {\n      return this.options.graph;\n    }\n  }, {\n    key: \"disabled\",\n    get: function get() {\n      return this.options.enabled !== true;\n    }\n  }, {\n    key: \"enable\",\n    value: function enable() {\n      if (this.disabled) {\n        this.options.enabled = true;\n        this.graph.options.keyboard.enabled = true;\n\n        if (this.target instanceof HTMLElement) {\n          this.target.setAttribute('tabindex', '-1');\n        }\n      }\n    }\n  }, {\n    key: \"disable\",\n    value: function disable() {\n      if (!this.disabled) {\n        this.options.enabled = false;\n        this.graph.options.keyboard.enabled = false;\n\n        if (this.target instanceof HTMLElement) {\n          this.target.removeAttribute('tabindex');\n        }\n      }\n    }\n  }, {\n    key: \"on\",\n    value: function on(keys, callback, action) {\n      this.mousetrap.bind(this.getKeys(keys), callback, action);\n    }\n  }, {\n    key: \"off\",\n    value: function off(keys, action) {\n      this.mousetrap.unbind(this.getKeys(keys), action);\n    }\n  }, {\n    key: \"focus\",\n    value: function focus() {\n      var target = this.target;\n      target.focus({\n        preventScroll: true\n      });\n    }\n  }, {\n    key: \"getKeys\",\n    value: function getKeys(keys) {\n      var _this2 = this;\n\n      return (Array.isArray(keys) ? keys : [keys]).map(function (key) {\n        return _this2.formatkey(key);\n      });\n    }\n  }, {\n    key: \"formatkey\",\n    value: function formatkey(key) {\n      var formated = key.toLowerCase().replace(/\\s/g, '').replace('delete', 'del').replace('cmd', 'command');\n      var formatFn = this.options.format;\n\n      if (formatFn) {\n        return FunctionExt.call(formatFn, this.graph, formated);\n      }\n\n      return formated;\n    }\n  }, {\n    key: \"isGraphEvent\",\n    value: function isGraphEvent(e) {\n      var target = e.srcElement || e.target;\n\n      if (target) {\n        if (target === this.target || target === document.body) {\n          return true;\n        }\n\n        return Dom.contains(this.container, target);\n      }\n\n      return false;\n    }\n  }, {\n    key: \"isEnabledForEvent\",\n    value: function isEnabledForEvent(e) {\n      var allowed = !this.disabled && this.isGraphEvent(e);\n\n      if (allowed) {\n        var target = e.target;\n        var tagName = target && target.tagName.toLowerCase();\n        var code = e.keyCode || e.which;\n\n        if (tagName === 'input' && (code === 8 || code === 46)) {\n          return false;\n        }\n\n        if (this.options.guard) {\n          return FunctionExt.call(this.options.guard, this.graph, e);\n        }\n      }\n\n      return allowed;\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.mousetrap.reset();\n    }\n  }]);\n\n  return Keyboard;\n}(Disposable);\n\n__decorate([Disposable.dispose()], Keyboard.prototype, \"dispose\", null);\n\n(function (Keyboard) {\n  function createMousetrap(keyboard) {\n    var mousetrap = new Mousetrap(keyboard.target);\n    var stopCallback = mousetrap.stopCallback;\n\n    mousetrap.stopCallback = function (e, elem, combo) {\n      if (keyboard.isEnabledForEvent(e)) {\n        if (stopCallback) {\n          return stopCallback.call(mousetrap, e, elem, combo);\n        }\n\n        return false;\n      }\n\n      return true;\n    };\n\n    return mousetrap;\n  }\n\n  Keyboard.createMousetrap = createMousetrap;\n})(Keyboard || (Keyboard = {}));","map":{"version":3,"sources":["../../src/graph/keyboard.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport Mousetrap from 'mousetrap';\nimport { Dom, FunctionExt } from '../util';\nimport { Disposable } from '../common';\nexport class Keyboard extends Disposable {\n    constructor(options) {\n        super();\n        this.options = options;\n        const scroller = this.graph.scroller.widget;\n        this.container = scroller ? scroller.container : this.graph.container;\n        if (options.global) {\n            this.target = document;\n        }\n        else {\n            this.target = this.container;\n            if (!this.disabled) {\n                // ensure the container focusable\n                this.target.setAttribute('tabindex', '-1');\n            }\n            // change to mouseup event，prevent page stalling caused by focus\n            this.graph.on('cell:mouseup', this.focus, this);\n            this.graph.on('blank:mouseup', this.focus, this);\n        }\n        this.mousetrap = Keyboard.createMousetrap(this);\n    }\n    get graph() {\n        return this.options.graph;\n    }\n    get disabled() {\n        return this.options.enabled !== true;\n    }\n    enable() {\n        if (this.disabled) {\n            this.options.enabled = true;\n            this.graph.options.keyboard.enabled = true;\n            if (this.target instanceof HTMLElement) {\n                this.target.setAttribute('tabindex', '-1');\n            }\n        }\n    }\n    disable() {\n        if (!this.disabled) {\n            this.options.enabled = false;\n            this.graph.options.keyboard.enabled = false;\n            if (this.target instanceof HTMLElement) {\n                this.target.removeAttribute('tabindex');\n            }\n        }\n    }\n    on(keys, callback, action) {\n        this.mousetrap.bind(this.getKeys(keys), callback, action);\n    }\n    off(keys, action) {\n        this.mousetrap.unbind(this.getKeys(keys), action);\n    }\n    focus() {\n        const target = this.target;\n        target.focus({\n            preventScroll: true,\n        });\n    }\n    getKeys(keys) {\n        return (Array.isArray(keys) ? keys : [keys]).map((key) => this.formatkey(key));\n    }\n    formatkey(key) {\n        const formated = key\n            .toLowerCase()\n            .replace(/\\s/g, '')\n            .replace('delete', 'del')\n            .replace('cmd', 'command');\n        const formatFn = this.options.format;\n        if (formatFn) {\n            return FunctionExt.call(formatFn, this.graph, formated);\n        }\n        return formated;\n    }\n    isGraphEvent(e) {\n        const target = (e.srcElement || e.target);\n        if (target) {\n            if (target === this.target || target === document.body) {\n                return true;\n            }\n            return Dom.contains(this.container, target);\n        }\n        return false;\n    }\n    isEnabledForEvent(e) {\n        const allowed = !this.disabled && this.isGraphEvent(e);\n        if (allowed) {\n            const target = e.target;\n            const tagName = target && target.tagName.toLowerCase();\n            const code = e.keyCode || e.which;\n            if (tagName === 'input' && (code === 8 || code === 46)) {\n                return false;\n            }\n            if (this.options.guard) {\n                return FunctionExt.call(this.options.guard, this.graph, e);\n            }\n        }\n        return allowed;\n    }\n    dispose() {\n        this.mousetrap.reset();\n    }\n}\n__decorate([\n    Disposable.dispose()\n], Keyboard.prototype, \"dispose\", null);\n(function (Keyboard) {\n    function createMousetrap(keyboard) {\n        const mousetrap = new Mousetrap(keyboard.target);\n        const stopCallback = mousetrap.stopCallback;\n        mousetrap.stopCallback = (e, elem, combo) => {\n            if (keyboard.isEnabledForEvent(e)) {\n                if (stopCallback) {\n                    return stopCallback.call(mousetrap, e, elem, combo);\n                }\n                return false;\n            }\n            return true;\n        };\n        return mousetrap;\n    }\n    Keyboard.createMousetrap = createMousetrap;\n})(Keyboard || (Keyboard = {}));\n//# sourceMappingURL=keyboard.js.map"]},"metadata":{},"sourceType":"module"}