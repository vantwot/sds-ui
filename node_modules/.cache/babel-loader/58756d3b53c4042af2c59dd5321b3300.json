{"ast":null,"code":"import _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _get from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport { View } from '../../view';\nexport var Widget = /*#__PURE__*/function (_View) {\n  _inherits(Widget, _View);\n\n  var _super = _createSuper(Widget);\n\n  function Widget(options) {\n    var _this;\n\n    _classCallCheck(this, Widget);\n\n    _this = _super.call(this);\n\n    var _a = options,\n        view = _a.view,\n        cell = _a.cell,\n        node = _a.node,\n        edge = _a.edge,\n        graph = _a.graph,\n        localOptions = __rest(_a, [\"view\", \"cell\", \"node\", \"edge\", \"graph\"]);\n\n    if (view) {\n      _this.view = view;\n      _this.cell = view.cell;\n      _this.graph = view.graph;\n      _this.model = _this.graph.model;\n    } else if ((cell || edge || node) && graph) {\n      _this.cell = node || edge || cell;\n      _this.view = graph.renderer.findViewByCell(_this.cell);\n      _this.graph = graph;\n      _this.model = _this.graph.model;\n    }\n\n    var ctor = _this.constructor;\n\n    if (options.clearAll !== false) {\n      ctor.removeInstances(_this.graph);\n    }\n\n    ctor.register(_assertThisInitialized(_this));\n\n    _this.init(localOptions);\n\n    return _this;\n  }\n\n  _createClass(Widget, [{\n    key: \"init\",\n    value: function init(options) {} // eslint-disable-line\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      return this;\n    }\n  }, {\n    key: \"startListening\",\n    value: function startListening() {\n      if (this.options.clearOnBlankMouseDown !== false) {\n        this.graph.on('blank:mousedown', this.remove, this);\n      }\n    }\n  }, {\n    key: \"stopListening\",\n    value: function stopListening() {\n      if (this.options.clearOnBlankMouseDown !== false) {\n        this.graph.off('blank:mousedown', this.remove, this);\n      }\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      this.stopListening();\n      var ctor = this.constructor;\n      ctor.unregister(this);\n      return _get(_getPrototypeOf(Widget.prototype), \"remove\", this).call(this);\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.remove();\n    }\n  }], [{\n    key: \"ensureCache\",\n    value: function ensureCache() {\n      if (!this.instanceCache.has(this)) {\n        this.instanceCache.set(this, {});\n      }\n\n      return this.instanceCache.get(this);\n    }\n  }, {\n    key: \"register\",\n    value: function register(instance, graph) {\n      if (graph == null) {\n        // eslint-disable-next-line\n        graph = instance.graph;\n      }\n\n      var dic = this.ensureCache();\n      var cache = dic[graph.view.cid];\n\n      if (cache == null) {\n        cache = dic[graph.view.cid] = {};\n      }\n\n      cache[instance.cid] = instance;\n    }\n  }, {\n    key: \"unregister\",\n    value: function unregister(instance, graph) {\n      if (graph == null) {\n        // eslint-disable-next-line\n        graph = instance.graph;\n      }\n\n      var dic = this.ensureCache();\n\n      if (dic[graph.view.cid]) {\n        delete dic[graph.view.cid][instance.cid];\n      }\n    }\n  }, {\n    key: \"removeInstances\",\n    value: function removeInstances(graph) {\n      var dic = this.ensureCache();\n      var cache = dic[graph.view.cid];\n\n      if (cache) {\n        Object.keys(cache).forEach(function (cid) {\n          var instance = cache[cid];\n\n          if (instance) {\n            instance.remove();\n          }\n        });\n      }\n    }\n  }, {\n    key: \"getInstances\",\n    value: function getInstances(graph) {\n      var dic = this.ensureCache();\n      return dic[graph.view.cid] || {};\n    }\n  }]);\n\n  return Widget;\n}(View); // #region static\n\nWidget.instanceCache = new WeakMap();\n\n__decorate([View.dispose()], Widget.prototype, \"dispose\", null);","map":{"version":3,"sources":["../../../src/addon/common/widget.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { View } from '../../view';\nexport class Widget extends View {\n    constructor(options) {\n        super();\n        const _a = options, { view, cell, node, edge, graph } = _a, localOptions = __rest(_a, [\"view\", \"cell\", \"node\", \"edge\", \"graph\"]);\n        if (view) {\n            this.view = view;\n            this.cell = view.cell;\n            this.graph = view.graph;\n            this.model = this.graph.model;\n        }\n        else if ((cell || edge || node) && graph) {\n            this.cell = node || edge || cell;\n            this.view = graph.renderer.findViewByCell(this.cell);\n            this.graph = graph;\n            this.model = this.graph.model;\n        }\n        const ctor = this.constructor;\n        if (options.clearAll !== false) {\n            ctor.removeInstances(this.graph);\n        }\n        ctor.register(this);\n        this.init(localOptions);\n    }\n    static ensureCache() {\n        if (!this.instanceCache.has(this)) {\n            this.instanceCache.set(this, {});\n        }\n        return this.instanceCache.get(this);\n    }\n    static register(instance, graph) {\n        if (graph == null) {\n            // eslint-disable-next-line\n            graph = instance.graph;\n        }\n        const dic = this.ensureCache();\n        let cache = dic[graph.view.cid];\n        if (cache == null) {\n            cache = dic[graph.view.cid] = {};\n        }\n        cache[instance.cid] = instance;\n    }\n    static unregister(instance, graph) {\n        if (graph == null) {\n            // eslint-disable-next-line\n            graph = instance.graph;\n        }\n        const dic = this.ensureCache();\n        if (dic[graph.view.cid]) {\n            delete dic[graph.view.cid][instance.cid];\n        }\n    }\n    static removeInstances(graph) {\n        const dic = this.ensureCache();\n        const cache = dic[graph.view.cid];\n        if (cache) {\n            Object.keys(cache).forEach((cid) => {\n                const instance = cache[cid];\n                if (instance) {\n                    instance.remove();\n                }\n            });\n        }\n    }\n    static getInstances(graph) {\n        const dic = this.ensureCache();\n        return dic[graph.view.cid] || {};\n    }\n    init(options) { } // eslint-disable-line\n    render() {\n        return this;\n    }\n    startListening() {\n        if (this.options.clearOnBlankMouseDown !== false) {\n            this.graph.on('blank:mousedown', this.remove, this);\n        }\n    }\n    stopListening() {\n        if (this.options.clearOnBlankMouseDown !== false) {\n            this.graph.off('blank:mousedown', this.remove, this);\n        }\n    }\n    remove() {\n        this.stopListening();\n        const ctor = this.constructor;\n        ctor.unregister(this);\n        return super.remove();\n    }\n    dispose() {\n        this.remove();\n    }\n}\n// #region static\nWidget.instanceCache = new WeakMap();\n__decorate([\n    View.dispose()\n], Widget.prototype, \"dispose\", null);\n//# sourceMappingURL=widget.js.map"]},"metadata":{},"sourceType":"module"}