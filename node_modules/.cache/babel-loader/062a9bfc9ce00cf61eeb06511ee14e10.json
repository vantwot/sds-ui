{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { NodeView, Scheduler } from '@antv/x6';\nimport { Portal } from './portal';\nimport { Wrap } from './wrap';\nexport class ReactShapeView extends NodeView {\n  init() {\n    super.init();\n    this.cell.on('removed', () => {\n      Portal.disconnect(this.cell.id);\n    });\n  }\n\n  getComponentContainer() {\n    return this.cell.prop('useForeignObject') === false ? this.selectors.content : this.selectors.foContent;\n  }\n\n  confirmUpdate(flag) {\n    const ret = super.confirmUpdate(flag);\n    return this.handleAction(ret, ReactShapeView.action, () => {\n      if (Scheduler) {\n        Scheduler.scheduleTask(() => {\n          this.renderReactComponent();\n        });\n      } else {\n        this.renderReactComponent();\n      }\n    });\n  }\n\n  renderReactComponent() {\n    this.unmountReactComponent();\n    const root = this.getComponentContainer();\n    const node = this.cell;\n    const graph = this.graph;\n\n    if (root) {\n      const component = this.graph.hook.getReactComponent(node);\n      const elem = React.createElement(Wrap, {\n        graph,\n        node,\n        component\n      });\n\n      if (Portal.isActive()) {\n        Portal.connect(this.cell.id, ReactDOM.createPortal(elem, root));\n      } else {\n        ReactDOM.render(elem, root);\n      }\n    }\n  }\n\n  unmountReactComponent() {\n    const root = this.getComponentContainer();\n\n    if (root) {\n      ReactDOM.unmountComponentAtNode(root);\n    }\n\n    return root;\n  }\n\n  onMouseDown(e, x, y) {\n    const target = e.target;\n    const tagName = target.tagName.toLowerCase();\n\n    if (tagName === 'input') {\n      const type = target.getAttribute('type');\n\n      if (type == null || ['text', 'password', 'number', 'email', 'search', 'tel', 'url'].includes(type)) {\n        return;\n      }\n    }\n\n    super.onMouseDown(e, x, y);\n  }\n\n  dispose() {\n    Portal.disconnect(this.cell.id);\n    this.unmountReactComponent();\n  }\n\n}\n\n__decorate([NodeView.dispose()], ReactShapeView.prototype, \"dispose\", null);\n\n(function (ReactShapeView) {\n  ReactShapeView.action = 'react';\n  ReactShapeView.config({\n    bootstrap: [ReactShapeView.action],\n    actions: {\n      component: ReactShapeView.action\n    }\n  });\n  NodeView.registry.register('react-shape-view', ReactShapeView, true);\n})(ReactShapeView || (ReactShapeView = {}));","map":{"version":3,"sources":["../src/view.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { NodeView, Scheduler } from '@antv/x6';\nimport { Portal } from './portal';\nimport { Wrap } from './wrap';\nexport class ReactShapeView extends NodeView {\n    init() {\n        super.init();\n        this.cell.on('removed', () => {\n            Portal.disconnect(this.cell.id);\n        });\n    }\n    getComponentContainer() {\n        return this.cell.prop('useForeignObject') === false\n            ? this.selectors.content\n            : this.selectors.foContent;\n    }\n    confirmUpdate(flag) {\n        const ret = super.confirmUpdate(flag);\n        return this.handleAction(ret, ReactShapeView.action, () => {\n            if (Scheduler) {\n                Scheduler.scheduleTask(() => {\n                    this.renderReactComponent();\n                });\n            }\n            else {\n                this.renderReactComponent();\n            }\n        });\n    }\n    renderReactComponent() {\n        this.unmountReactComponent();\n        const root = this.getComponentContainer();\n        const node = this.cell;\n        const graph = this.graph;\n        if (root) {\n            const component = this.graph.hook.getReactComponent(node);\n            const elem = React.createElement(Wrap, { graph, node, component });\n            if (Portal.isActive()) {\n                Portal.connect(this.cell.id, ReactDOM.createPortal(elem, root));\n            }\n            else {\n                ReactDOM.render(elem, root);\n            }\n        }\n    }\n    unmountReactComponent() {\n        const root = this.getComponentContainer();\n        if (root) {\n            ReactDOM.unmountComponentAtNode(root);\n        }\n        return root;\n    }\n    onMouseDown(e, x, y) {\n        const target = e.target;\n        const tagName = target.tagName.toLowerCase();\n        if (tagName === 'input') {\n            const type = target.getAttribute('type');\n            if (type == null ||\n                [\n                    'text',\n                    'password',\n                    'number',\n                    'email',\n                    'search',\n                    'tel',\n                    'url',\n                ].includes(type)) {\n                return;\n            }\n        }\n        super.onMouseDown(e, x, y);\n    }\n    dispose() {\n        Portal.disconnect(this.cell.id);\n        this.unmountReactComponent();\n    }\n}\n__decorate([\n    NodeView.dispose()\n], ReactShapeView.prototype, \"dispose\", null);\n(function (ReactShapeView) {\n    ReactShapeView.action = 'react';\n    ReactShapeView.config({\n        bootstrap: [ReactShapeView.action],\n        actions: {\n            component: ReactShapeView.action,\n        },\n    });\n    NodeView.registry.register('react-shape-view', ReactShapeView, true);\n})(ReactShapeView || (ReactShapeView = {}));\n//# sourceMappingURL=view.js.map"]},"metadata":{},"sourceType":"module"}