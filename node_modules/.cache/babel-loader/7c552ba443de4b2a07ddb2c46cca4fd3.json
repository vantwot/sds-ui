{"ast":null,"code":"import _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _createForOfIteratorHelper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { singleton, Contribution, contrib } from 'mana-syringe';\nimport { DisposableCollection } from '../common/disposable';\nimport { IFrontendApplicationContribution } from '../xflow-main/interface';\nimport { initHooks, IHookService, IHookContribution } from './interface';\n\nvar HookRegistry = /*#__PURE__*/function () {\n  function HookRegistry() {\n    var _this = this;\n\n    _classCallCheck(this, HookRegistry);\n\n    /** disposables */\n    this.toDispose = new DisposableCollection();\n    /** hooks */\n\n    this.hookProvider = function () {\n      return _this.hooks;\n    };\n    /** 注册hook插件 */\n\n\n    this.registerHook = function (fn) {\n      return fn(_this.hooks);\n    };\n    /** 注册hook  */\n\n\n    this.registerHookHub = function (hookName, hook) {\n      _this.hooks[hookName] = hook;\n      return {\n        dispose: function dispose() {\n          delete _this.hooks[hookName];\n        }\n      };\n    };\n    /** app启动时，收集hook扩展点的注册项 */\n\n\n    this.onStart = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var contributions, _iterator, _step, contribution, _iterator2, _step2, _contribution;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                contributions = this.contributionProvider.getContributions();\n                _iterator = _createForOfIteratorHelper(contributions);\n\n                try {\n                  for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                    contribution = _step.value;\n                    contribution.registerHookHub(this);\n                  }\n                } catch (err) {\n                  _iterator.e(err);\n                } finally {\n                  _iterator.f();\n                }\n\n                _iterator2 = _createForOfIteratorHelper(contributions);\n\n                try {\n                  for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                    _contribution = _step2.value;\n\n                    _contribution.registerHook(this.hooks);\n                  }\n                } catch (err) {\n                  _iterator2.e(err);\n                } finally {\n                  _iterator2.f();\n                }\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    };\n\n    this.hooks = initHooks();\n  }\n  /** app的停止逻辑 */\n\n\n  _createClass(HookRegistry, [{\n    key: \"onStop\",\n    value: function onStop() {\n      this.toDispose.dispose();\n    }\n  }]);\n\n  return HookRegistry;\n}();\n\n__decorate([contrib(IHookContribution), __metadata(\"design:type\", Object)], HookRegistry.prototype, \"contributionProvider\", void 0);\n\nHookRegistry = __decorate([singleton({\n  contrib: [IFrontendApplicationContribution, IHookService]\n}), __metadata(\"design:paramtypes\", [])], HookRegistry);\nexport { HookRegistry };","map":{"version":3,"sources":["../../src/hooks/hook-registry.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,SAAS,SAAT,EAAoB,YAApB,EAAkC,OAAlC,QAAiD,cAAjD;AACA,SAAS,oBAAT,QAAqC,sBAArC;AACA,SAAS,gCAAT,QAAiD,yBAAjD;AACA,SAAS,SAAT,EAAoB,YAApB,EAAkC,iBAAlC,QAA2D,aAA3D;;AAGA,IAAa,YAAb;AASE,0BAAA;AAAA;;AAAA;;AANA;AACQ,SAAA,SAAA,GAAY,IAAI,oBAAJ,EAAZ;AASR;;AACA,SAAA,YAAA,GAAe;AAAA,aAAM,KAAI,CAAC,KAAX;AAAA,KAAf;AAEA;;;AACA,SAAA,YAAA,GAAe,UAAC,EAAD,EAAiC;AAC9C,aAAO,EAAE,CAAC,KAAI,CAAC,KAAN,CAAT;AACD,KAFD;AAIA;;;AACA,SAAA,eAAA,GAAkB,UAAC,QAAD,EAAmB,IAAnB,EAAoC;AACpD,MAAA,KAAI,CAAC,KAAL,CAAW,QAAX,IAAuB,IAAvB;AACA,aAAO;AACL,QAAA,OAAO,EAAE,mBAAK;AACZ,iBAAO,KAAI,CAAC,KAAL,CAAW,QAAX,CAAP;AACD;AAHI,OAAP;AAKD,KAPD;AAaA;;;AACA,SAAA,OAAA,GAAU;AAAA,aAAW,SAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,wCAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACb,gBAAA,aADa,GACG,KAAK,oBAAL,CAA0B,gBAA1B,EADH;AAAA,uDAEQ,aAFR;;AAAA;AAEnB,sEAA0C;AAA/B,oBAAA,YAA+B;AACxC,oBAAA,YAAY,CAAC,eAAb,CAA6B,IAA7B;AACD;AAJkB;AAAA;AAAA;AAAA;AAAA;;AAAA,wDAKQ,aALR;;AAAA;AAKnB,yEAA0C;AAA/B,oBAAA,aAA+B;;AACxC,oBAAA,aAAY,CAAC,YAAb,CAA0B,KAAK,KAA/B;AACD;AAPkB;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAA,EAAX;AAAA,KAAV;;AA1BE,SAAK,KAAL,GAAa,SAAS,EAAtB;AACD;AAmCD;;;AA9CF;AAAA;AAAA,WA+CE,kBAAM;AACJ,WAAK,SAAL,CAAe,OAAf;AACD;AAjDH;;AAAA;AAAA,GAAA;;AAiCE,UAAA,CAAA,CADC,OAAO,CAAC,iBAAD,CACR,E,iCAAA,CAAA,E,sBAAA,E,sBAAA,E,KAAoF,CAApF,CAAA;;AAjCW,YAAY,GAAA,UAAA,CAAA,CADxB,SAAS,CAAC;AAAE,EAAA,OAAO,EAAE,CAAC,gCAAD,EAAmC,YAAnC;AAAX,CAAD,CACe,E,mCAAA,CAAA,EAAZ,YAAY,CAAZ;SAAA,Y","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { singleton, Contribution, contrib } from 'mana-syringe';\nimport { DisposableCollection } from '../common/disposable';\nimport { IFrontendApplicationContribution } from '../xflow-main/interface';\nimport { initHooks, IHookService, IHookContribution } from './interface';\nlet HookRegistry = class HookRegistry {\n    constructor() {\n        /** disposables */\n        this.toDispose = new DisposableCollection();\n        /** hooks */\n        this.hookProvider = () => this.hooks;\n        /** 注册hook插件 */\n        this.registerHook = (fn) => {\n            return fn(this.hooks);\n        };\n        /** 注册hook  */\n        this.registerHookHub = (hookName, hook) => {\n            this.hooks[hookName] = hook;\n            return {\n                dispose: () => {\n                    delete this.hooks[hookName];\n                },\n            };\n        };\n        /** app启动时，收集hook扩展点的注册项 */\n        this.onStart = () => __awaiter(this, void 0, void 0, function* () {\n            const contributions = this.contributionProvider.getContributions();\n            for (const contribution of contributions) {\n                contribution.registerHookHub(this);\n            }\n            for (const contribution of contributions) {\n                contribution.registerHook(this.hooks);\n            }\n        });\n        this.hooks = initHooks();\n    }\n    /** app的停止逻辑 */\n    onStop() {\n        this.toDispose.dispose();\n    }\n};\n__decorate([\n    contrib(IHookContribution),\n    __metadata(\"design:type\", Object)\n], HookRegistry.prototype, \"contributionProvider\", void 0);\nHookRegistry = __decorate([\n    singleton({ contrib: [IFrontendApplicationContribution, IHookService] }),\n    __metadata(\"design:paramtypes\", [])\n], HookRegistry);\nexport { HookRegistry };\n//# sourceMappingURL=hook-registry.js.map"]},"metadata":{},"sourceType":"module"}