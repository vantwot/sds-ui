{"ast":null,"code":"import _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _get from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { NodeView, Scheduler } from '@antv/x6';\nimport { Portal } from './portal';\nimport { Wrap } from './wrap';\nexport var ReactShapeView = /*#__PURE__*/function (_NodeView) {\n  _inherits(ReactShapeView, _NodeView);\n\n  var _super = _createSuper(ReactShapeView);\n\n  function ReactShapeView() {\n    _classCallCheck(this, ReactShapeView);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(ReactShapeView, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      _get(_getPrototypeOf(ReactShapeView.prototype), \"init\", this).call(this);\n\n      this.cell.on('removed', function () {\n        Portal.disconnect(_this.cell.id);\n      });\n    }\n  }, {\n    key: \"getComponentContainer\",\n    value: function getComponentContainer() {\n      return this.cell.prop('useForeignObject') === false ? this.selectors.content : this.selectors.foContent;\n    }\n  }, {\n    key: \"confirmUpdate\",\n    value: function confirmUpdate(flag) {\n      var _this2 = this;\n\n      var ret = _get(_getPrototypeOf(ReactShapeView.prototype), \"confirmUpdate\", this).call(this, flag);\n\n      return this.handleAction(ret, ReactShapeView.action, function () {\n        if (Scheduler) {\n          Scheduler.scheduleTask(function () {\n            _this2.renderReactComponent();\n          });\n        } else {\n          _this2.renderReactComponent();\n        }\n      });\n    }\n  }, {\n    key: \"renderReactComponent\",\n    value: function renderReactComponent() {\n      this.unmountReactComponent();\n      var root = this.getComponentContainer();\n      var node = this.cell;\n      var graph = this.graph;\n\n      if (root) {\n        var component = this.graph.hook.getReactComponent(node);\n        var elem = React.createElement(Wrap, {\n          graph: graph,\n          node: node,\n          component: component\n        });\n\n        if (Portal.isActive()) {\n          Portal.connect(this.cell.id, ReactDOM.createPortal(elem, root));\n        } else {\n          ReactDOM.render(elem, root);\n        }\n      }\n    }\n  }, {\n    key: \"unmountReactComponent\",\n    value: function unmountReactComponent() {\n      var root = this.getComponentContainer();\n\n      if (root) {\n        ReactDOM.unmountComponentAtNode(root);\n      }\n\n      return root;\n    }\n  }, {\n    key: \"onMouseDown\",\n    value: function onMouseDown(e, x, y) {\n      var target = e.target;\n      var tagName = target.tagName.toLowerCase();\n\n      if (tagName === 'input') {\n        var type = target.getAttribute('type');\n\n        if (type == null || ['text', 'password', 'number', 'email', 'search', 'tel', 'url'].includes(type)) {\n          return;\n        }\n      }\n\n      _get(_getPrototypeOf(ReactShapeView.prototype), \"onMouseDown\", this).call(this, e, x, y);\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      Portal.disconnect(this.cell.id);\n      this.unmountReactComponent();\n    }\n  }]);\n\n  return ReactShapeView;\n}(NodeView);\n\n__decorate([NodeView.dispose()], ReactShapeView.prototype, \"dispose\", null);\n\n(function (ReactShapeView) {\n  ReactShapeView.action = 'react';\n  ReactShapeView.config({\n    bootstrap: [ReactShapeView.action],\n    actions: {\n      component: ReactShapeView.action\n    }\n  });\n  NodeView.registry.register('react-shape-view', ReactShapeView, true);\n})(ReactShapeView || (ReactShapeView = {}));","map":{"version":3,"sources":["../src/view.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { NodeView, Scheduler } from '@antv/x6';\nimport { Portal } from './portal';\nimport { Wrap } from './wrap';\nexport class ReactShapeView extends NodeView {\n    init() {\n        super.init();\n        this.cell.on('removed', () => {\n            Portal.disconnect(this.cell.id);\n        });\n    }\n    getComponentContainer() {\n        return this.cell.prop('useForeignObject') === false\n            ? this.selectors.content\n            : this.selectors.foContent;\n    }\n    confirmUpdate(flag) {\n        const ret = super.confirmUpdate(flag);\n        return this.handleAction(ret, ReactShapeView.action, () => {\n            if (Scheduler) {\n                Scheduler.scheduleTask(() => {\n                    this.renderReactComponent();\n                });\n            }\n            else {\n                this.renderReactComponent();\n            }\n        });\n    }\n    renderReactComponent() {\n        this.unmountReactComponent();\n        const root = this.getComponentContainer();\n        const node = this.cell;\n        const graph = this.graph;\n        if (root) {\n            const component = this.graph.hook.getReactComponent(node);\n            const elem = React.createElement(Wrap, { graph, node, component });\n            if (Portal.isActive()) {\n                Portal.connect(this.cell.id, ReactDOM.createPortal(elem, root));\n            }\n            else {\n                ReactDOM.render(elem, root);\n            }\n        }\n    }\n    unmountReactComponent() {\n        const root = this.getComponentContainer();\n        if (root) {\n            ReactDOM.unmountComponentAtNode(root);\n        }\n        return root;\n    }\n    onMouseDown(e, x, y) {\n        const target = e.target;\n        const tagName = target.tagName.toLowerCase();\n        if (tagName === 'input') {\n            const type = target.getAttribute('type');\n            if (type == null ||\n                [\n                    'text',\n                    'password',\n                    'number',\n                    'email',\n                    'search',\n                    'tel',\n                    'url',\n                ].includes(type)) {\n                return;\n            }\n        }\n        super.onMouseDown(e, x, y);\n    }\n    dispose() {\n        Portal.disconnect(this.cell.id);\n        this.unmountReactComponent();\n    }\n}\n__decorate([\n    NodeView.dispose()\n], ReactShapeView.prototype, \"dispose\", null);\n(function (ReactShapeView) {\n    ReactShapeView.action = 'react';\n    ReactShapeView.config({\n        bootstrap: [ReactShapeView.action],\n        actions: {\n            component: ReactShapeView.action,\n        },\n    });\n    NodeView.registry.register('react-shape-view', ReactShapeView, true);\n})(ReactShapeView || (ReactShapeView = {}));\n//# sourceMappingURL=view.js.map"]},"metadata":{},"sourceType":"module"}