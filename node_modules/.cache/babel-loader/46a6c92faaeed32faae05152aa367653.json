{"ast":null,"code":"import _regeneratorRuntime from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { injectable, inject, postConstruct } from 'mana-syringe';\nimport { DisposableCollection } from '../common/disposable';\nimport { IGraphProvider } from '../xflow-main/graph/graph-provider';\nimport { IModelService, MODELS } from '../model-service';\nimport { IHookService } from '../hooks';\nimport { IGraphCommandService } from '../command/interface';\n\nvar CmdContext = /*#__PURE__*/function () {\n  function CmdContext() {\n    var _this = this;\n\n    _classCallCheck(this, CmdContext);\n\n    /** undos 存在这里 */\n    this.toDispose = new DisposableCollection();\n    /** command handler的runtimeHook */\n\n    this.runtimeHooks = [];\n    /** 获取 x6 实例 */\n\n    this.getX6Graph = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var graphInstance;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.graph) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", this.graph);\n\n              case 2:\n                _context.next = 4;\n                return this.graphProvider.getGraphInstance();\n\n              case 4:\n                graphInstance = _context.sent;\n                this.graph = graphInstance;\n                return _context.abrupt(\"return\", graphInstance);\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    };\n    /** 获取 graph */\n\n\n    this.getGraphConfig = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.graphProvider.getGraphOptions());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    };\n\n    this.getGraphMeta = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var service, meta;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                service = this.getModelService();\n                _context3.t0 = this.graphMeta;\n\n                if (_context3.t0) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                _context3.next = 5;\n                return MODELS.GRAPH_META.useValue(service);\n\n              case 5:\n                _context3.t0 = _context3.sent;\n\n              case 6:\n                meta = _context3.t0;\n                return _context3.abrupt(\"return\", meta);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n    };\n    /** 设置参数 */\n\n\n    this.setArgs = function (args) {\n      var runtimeHooks = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n      _this.args = args;\n      _this.runtimeHooks = runtimeHooks;\n      return {\n        args: args,\n        hooks: runtimeHooks\n      };\n    };\n    /** 获取参数 */\n\n\n    this.getArgs = function () {\n      /** 注入graph meta */\n      var args = Object.assign(Object.assign({}, _this.args), {\n        graphMeta: _this.graphMeta,\n        modelService: _this.getModelService(),\n        commandService: _this.getCommands(),\n        getX6Graph: _this.getX6Graph,\n        getGraphConfig: _this.getGraphConfig\n      });\n      return {\n        args: args,\n        hooks: _this.runtimeHooks\n      };\n    };\n    /** 设置执行结果 */\n\n\n    this.setResult = function (result) {\n      _this.result = result;\n      return _this.result;\n    };\n    /** 获取执行结果 */\n\n\n    this.getResult = function () {\n      return _this.result;\n    };\n    /** hooks */\n\n\n    this.getHooks = function () {\n      return _this.hookService.hookProvider();\n    };\n    /** 获取Command Service */\n\n\n    this.getCommands = function () {\n      return _this.commandService;\n    };\n    /** 获取Context Service */\n\n\n    this.getModelService = function () {\n      return _this.modelService;\n    };\n    /** 添加undo */\n\n\n    this.addUndo = function (disposable) {\n      if (!Array.isArray(disposable)) {\n        return _this.addUndo([disposable]);\n      }\n\n      _this.toDispose.pushAll(disposable);\n    };\n    /** 执行undo */\n\n\n    this.undo = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.toDispose.dispose();\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n    };\n    /** 是否可以执行undo */\n\n\n    this.isUndoable = function () {\n      return !_this.toDispose.disposed;\n    };\n    /** 获取 toDispose */\n\n\n    this.getDisposables = function () {\n      return _this.toDispose;\n    };\n    /** 设置的共享变量 可以在command间共享 */\n\n\n    this.setGlobal = function (key, value) {\n      _this.commandService.setGlobal(key, value);\n    };\n    /** 获取共享变量 */\n\n\n    this.getGlobal = function (key) {\n      return _this.commandService.getGlobal(key);\n    };\n  }\n\n  _createClass(CmdContext, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n\n      this.getGraphMeta().then(function (meta) {\n        _this2.graphMeta = meta;\n      });\n    }\n  }]);\n\n  return CmdContext;\n}();\n\n__decorate([inject(IGraphProvider), __metadata(\"design:type\", Object)], CmdContext.prototype, \"graphProvider\", void 0);\n\n__decorate([inject(IHookService), __metadata(\"design:type\", Object)], CmdContext.prototype, \"hookService\", void 0);\n\n__decorate([inject(IGraphCommandService), __metadata(\"design:type\", Object)], CmdContext.prototype, \"commandService\", void 0);\n\n__decorate([inject(IModelService), __metadata(\"design:type\", Object)], CmdContext.prototype, \"modelService\", void 0);\n\n__decorate([postConstruct(), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], CmdContext.prototype, \"init\", null);\n\nCmdContext = __decorate([injectable()], CmdContext);\nexport { CmdContext };","map":{"version":3,"sources":["../../src/command-contributions/cmd-context.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { injectable, inject, postConstruct } from 'mana-syringe';\nimport { DisposableCollection } from '../common/disposable';\nimport { IGraphProvider } from '../xflow-main/graph/graph-provider';\nimport { IModelService, MODELS } from '../model-service';\nimport { IHookService } from '../hooks';\nimport { IGraphCommandService } from '../command/interface';\nlet CmdContext = class CmdContext {\n    constructor() {\n        /** undos 存在这里 */\n        this.toDispose = new DisposableCollection();\n        /** command handler的runtimeHook */\n        this.runtimeHooks = [];\n        /** 获取 x6 实例 */\n        this.getX6Graph = () => __awaiter(this, void 0, void 0, function* () {\n            if (this.graph)\n                return this.graph;\n            const graphInstance = yield this.graphProvider.getGraphInstance();\n            this.graph = graphInstance;\n            return graphInstance;\n        });\n        /** 获取 graph */\n        this.getGraphConfig = () => __awaiter(this, void 0, void 0, function* () {\n            return this.graphProvider.getGraphOptions();\n        });\n        this.getGraphMeta = () => __awaiter(this, void 0, void 0, function* () {\n            const service = this.getModelService();\n            const meta = this.graphMeta || (yield MODELS.GRAPH_META.useValue(service));\n            return meta;\n        });\n        /** 设置参数 */\n        this.setArgs = (args, runtimeHooks = []) => {\n            this.args = args;\n            this.runtimeHooks = runtimeHooks;\n            return { args, hooks: runtimeHooks };\n        };\n        /** 获取参数 */\n        this.getArgs = () => {\n            /** 注入graph meta */\n            const args = Object.assign(Object.assign({}, this.args), { graphMeta: this.graphMeta, modelService: this.getModelService(), commandService: this.getCommands(), getX6Graph: this.getX6Graph, getGraphConfig: this.getGraphConfig });\n            return { args: args, hooks: this.runtimeHooks };\n        };\n        /** 设置执行结果 */\n        this.setResult = (result) => {\n            this.result = result;\n            return this.result;\n        };\n        /** 获取执行结果 */\n        this.getResult = () => {\n            return this.result;\n        };\n        /** hooks */\n        this.getHooks = () => {\n            return this.hookService.hookProvider();\n        };\n        /** 获取Command Service */\n        this.getCommands = () => {\n            return this.commandService;\n        };\n        /** 获取Context Service */\n        this.getModelService = () => {\n            return this.modelService;\n        };\n        /** 添加undo */\n        this.addUndo = (disposable) => {\n            if (!Array.isArray(disposable)) {\n                return this.addUndo([disposable]);\n            }\n            this.toDispose.pushAll(disposable);\n        };\n        /** 执行undo */\n        this.undo = () => __awaiter(this, void 0, void 0, function* () {\n            yield this.toDispose.dispose();\n        });\n        /** 是否可以执行undo */\n        this.isUndoable = () => {\n            return !this.toDispose.disposed;\n        };\n        /** 获取 toDispose */\n        this.getDisposables = () => this.toDispose;\n        /** 设置的共享变量 可以在command间共享 */\n        this.setGlobal = (key, value) => {\n            this.commandService.setGlobal(key, value);\n        };\n        /** 获取共享变量 */\n        this.getGlobal = (key) => {\n            return this.commandService.getGlobal(key);\n        };\n    }\n    init() {\n        this.getGraphMeta().then(meta => {\n            this.graphMeta = meta;\n        });\n    }\n};\n__decorate([\n    inject(IGraphProvider),\n    __metadata(\"design:type\", Object)\n], CmdContext.prototype, \"graphProvider\", void 0);\n__decorate([\n    inject(IHookService),\n    __metadata(\"design:type\", Object)\n], CmdContext.prototype, \"hookService\", void 0);\n__decorate([\n    inject(IGraphCommandService),\n    __metadata(\"design:type\", Object)\n], CmdContext.prototype, \"commandService\", void 0);\n__decorate([\n    inject(IModelService),\n    __metadata(\"design:type\", Object)\n], CmdContext.prototype, \"modelService\", void 0);\n__decorate([\n    postConstruct(),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", []),\n    __metadata(\"design:returntype\", void 0)\n], CmdContext.prototype, \"init\", null);\nCmdContext = __decorate([\n    injectable()\n], CmdContext);\nexport { CmdContext };\n//# sourceMappingURL=cmd-context.js.map"]},"metadata":{},"sourceType":"module"}