{"ast":null,"code":"import _toConsumableArray from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _construct from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/construct\";\nimport _slicedToArray from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport _wrapNativeSuper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport toposort from 'toposort';\nexport var ErrorUtils;\n\n(function (ErrorUtils) {\n  var ErrorEnum;\n\n  (function (ErrorEnum) {\n    ErrorEnum[\"INVALID_HOOK_BEFORE\"] = \"INVALID_HOOK_BEFORE\";\n    ErrorEnum[\"INVALID_HOOK_AFTER\"] = \"INVALID_HOOK_AFTER\";\n    ErrorEnum[\"INVALID_HOOK_ARGS_LENGTH\"] = \"INVALID_HOOK_ARGS_LENGTH\";\n  })(ErrorEnum = ErrorUtils.ErrorEnum || (ErrorUtils.ErrorEnum = {}));\n\n  var HookError = /*#__PURE__*/function (_Error) {\n    _inherits(HookError, _Error);\n\n    var _super = _createSuper(HookError);\n\n    function HookError(code, message) {\n      var _this;\n\n      _classCallCheck(this, HookError);\n\n      if (Array.isArray(message)) {\n        message = message.filter(function (line) {\n          return !!line;\n        }).join(' ');\n      }\n\n      _this = _super.call(this, \"\".concat(code, \": \").concat(message));\n\n      if (Error.captureStackTrace) {\n        ;\n        Error.captureStackTrace(_assertThisInitialized(_this), HookError);\n      }\n\n      _this.code = code;\n      _this.contexts = {};\n\n      for (var _len = arguments.length, contexts = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        contexts[_key - 2] = arguments[_key];\n      }\n\n      contexts.forEach(function (context) {\n        if (typeof context === 'object') {\n          Object.entries(context).forEach(function (pair) {\n            var _pair = _slicedToArray(pair, 2),\n                key = _pair[0],\n                value = _pair[1];\n\n            if (key !== 'key' && value) {\n              _this.contexts[key] = JSON.parse(JSON.stringify(value));\n            }\n          });\n        }\n      });\n      return _this;\n    }\n\n    _createClass(HookError, [{\n      key: \"toString\",\n      value: function toString() {\n        return \"\".concat(this.code, \": \").concat(this.message);\n      }\n    }]);\n\n    return HookError;\n  }( /*#__PURE__*/_wrapNativeSuper(Error));\n\n  ErrorUtils.HookError = HookError;\n\n  var createError = function createError(code, message) {\n    for (var _len2 = arguments.length, args = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n      args[_key2 - 2] = arguments[_key2];\n    }\n\n    return _construct(HookError, [code, message].concat(args));\n  };\n\n  ErrorUtils.HookBeforeError = function () {\n    return createError(ErrorEnum.INVALID_HOOK_BEFORE, ['hook require a before dependency but not exist in hookmap']);\n  };\n\n  ErrorUtils.HookAfterError = function () {\n    return createError(ErrorEnum.INVALID_HOOK_AFTER, ['hook require a after dependency but not exist in hookmap']);\n  };\n\n  ErrorUtils.InvalidHookArguments = function (hook) {\n    return createError(ErrorEnum.INVALID_HOOK_ARGS_LENGTH, ['hook handlers must have 0 to 2 arguments', \"but got \".concat(hook.handler.length)]);\n  };\n})(ErrorUtils || (ErrorUtils = {}));\n\nexport var HookUtils;\n\n(function (HookUtils) {\n  /** 处理 runtime hooks */\n  HookUtils.normalize = function () {\n    var hookConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var hookMap = arguments.length > 1 ? arguments[1] : undefined;\n    var runtimeHook = Array.isArray(hookConfig) ? hookConfig : [hookConfig];\n    var innerHooks = [];\n    hookMap.forEach(function (val) {\n      innerHooks.push(val);\n    });\n    return [].concat(innerHooks, _toConsumableArray(runtimeHook)).filter(function (item) {\n      return item && !!item.handler;\n    });\n  };\n  /** 排序 hooks */\n\n\n  HookUtils.sort = function () {\n    var hooks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var hookMap = arguments.length > 1 ? arguments[1] : undefined;\n    var edges = [];\n    hooks.forEach(function (hook) {\n      if (hook.before) {\n        if (!hookMap.has(hook.before)) {\n          throw ErrorUtils.HookBeforeError();\n        }\n\n        var edge = [hookMap.get(hook.before), hook];\n        edges.push(edge);\n      }\n\n      if (hook.after) {\n        if (!hookMap.has(hook.after)) {\n          throw ErrorUtils.HookBeforeError();\n        }\n\n        var _edge = [hook, hookMap.get(hook.after)];\n        edges.push(_edge);\n      }\n    });\n    var sortedHooks = toposort(edges);\n    sortedHooks.reverse();\n    return sortedHooks;\n  };\n})(HookUtils || (HookUtils = {}));\n\nexport var Deferred = function Deferred() {\n  var _this2 = this;\n\n  _classCallCheck(this, Deferred);\n\n  this.isResolved = false;\n  this.isRejected = false;\n  this.promise = new Promise(function (resolve, reject) {\n    _this2.resolve = function (args) {\n      _this2.isResolved = true;\n      resolve(args);\n    };\n\n    _this2.reject = function (args) {\n      _this2.isRejected = true;\n      reject(args);\n    };\n  });\n};","map":{"version":3,"sources":["../src/utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import toposort from 'toposort';\nexport var ErrorUtils;\n(function (ErrorUtils) {\n    let ErrorEnum;\n    (function (ErrorEnum) {\n        ErrorEnum[\"INVALID_HOOK_BEFORE\"] = \"INVALID_HOOK_BEFORE\";\n        ErrorEnum[\"INVALID_HOOK_AFTER\"] = \"INVALID_HOOK_AFTER\";\n        ErrorEnum[\"INVALID_HOOK_ARGS_LENGTH\"] = \"INVALID_HOOK_ARGS_LENGTH\";\n    })(ErrorEnum = ErrorUtils.ErrorEnum || (ErrorUtils.ErrorEnum = {}));\n    class HookError extends Error {\n        constructor(code, message, ...contexts) {\n            if (Array.isArray(message)) {\n                message = message\n                    .filter(function (line) {\n                    return !!line;\n                })\n                    .join(' ');\n            }\n            super(`${code}: ${message}`);\n            if (Error.captureStackTrace) {\n                ;\n                Error.captureStackTrace(this, HookError);\n            }\n            this.code = code;\n            this.contexts = {};\n            contexts.forEach(context => {\n                if (typeof context === 'object') {\n                    Object.entries(context).forEach(pair => {\n                        const [key, value] = pair;\n                        if (key !== 'key' && value) {\n                            this.contexts[key] = JSON.parse(JSON.stringify(value));\n                        }\n                    });\n                }\n            });\n        }\n        toString() {\n            return `${this.code}: ${this.message}`;\n        }\n    }\n    ErrorUtils.HookError = HookError;\n    const createError = (code, message, ...args) => {\n        return new HookError(code, message, ...args);\n    };\n    ErrorUtils.HookBeforeError = () => {\n        return createError(ErrorEnum.INVALID_HOOK_BEFORE, [\n            'hook require a before dependency but not exist in hookmap',\n        ]);\n    };\n    ErrorUtils.HookAfterError = () => {\n        return createError(ErrorEnum.INVALID_HOOK_AFTER, [\n            'hook require a after dependency but not exist in hookmap',\n        ]);\n    };\n    ErrorUtils.InvalidHookArguments = (hook) => {\n        return createError(ErrorEnum.INVALID_HOOK_ARGS_LENGTH, [\n            'hook handlers must have 0 to 2 arguments',\n            `but got ${hook.handler.length}`,\n        ]);\n    };\n})(ErrorUtils || (ErrorUtils = {}));\nexport var HookUtils;\n(function (HookUtils) {\n    /** 处理 runtime hooks */\n    HookUtils.normalize = (hookConfig = [], hookMap) => {\n        const runtimeHook = Array.isArray(hookConfig) ? hookConfig : [hookConfig];\n        const innerHooks = [];\n        hookMap.forEach(val => {\n            innerHooks.push(val);\n        });\n        return [...innerHooks, ...runtimeHook].filter(item => item && !!item.handler);\n    };\n    /** 排序 hooks */\n    HookUtils.sort = (hooks = [], hookMap) => {\n        const edges = [];\n        hooks.forEach(hook => {\n            if (hook.before) {\n                if (!hookMap.has(hook.before)) {\n                    throw ErrorUtils.HookBeforeError();\n                }\n                const edge = [hookMap.get(hook.before), hook];\n                edges.push(edge);\n            }\n            if (hook.after) {\n                if (!hookMap.has(hook.after)) {\n                    throw ErrorUtils.HookBeforeError();\n                }\n                const edge = [hook, hookMap.get(hook.after)];\n                edges.push(edge);\n            }\n        });\n        const sortedHooks = toposort(edges);\n        sortedHooks.reverse();\n        return sortedHooks;\n    };\n})(HookUtils || (HookUtils = {}));\nexport class Deferred {\n    constructor() {\n        this.isResolved = false;\n        this.isRejected = false;\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = args => {\n                this.isResolved = true;\n                resolve(args);\n            };\n            this.reject = args => {\n                this.isRejected = true;\n                reject(args);\n            };\n        });\n    }\n}\n//# sourceMappingURL=utils.js.map"]},"metadata":{},"sourceType":"module"}