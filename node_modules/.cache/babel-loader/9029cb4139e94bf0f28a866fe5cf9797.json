{"ast":null,"code":"import _defineProperty from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/manolo/sds-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { FunctionExt } from '../../util';\nimport { View } from '../../view/view';\nimport { Graph } from '../../graph/graph';\nimport { Point } from '../../geometry';\nvar ClassName;\n\n(function (ClassName) {\n  ClassName.root = 'widget-minimap';\n  ClassName.viewport = \"\".concat(ClassName.root, \"-viewport\");\n  ClassName.zoom = \"\".concat(ClassName.viewport, \"-zoom\");\n})(ClassName || (ClassName = {}));\n\nexport var MiniMap = /*#__PURE__*/function (_View) {\n  _inherits(MiniMap, _View);\n\n  var _super = _createSuper(MiniMap);\n\n  function MiniMap(options) {\n    var _this;\n\n    _classCallCheck(this, MiniMap);\n\n    _this = _super.call(this);\n    _this.options = Object.assign(Object.assign({}, Util.defaultOptions), options);\n    _this.updateViewport = FunctionExt.debounce(_this.updateViewport.bind(_assertThisInitialized(_this)), 0);\n    _this.container = document.createElement('div');\n    _this.$container = _this.$(_this.container).addClass(_this.prefixClassName(ClassName.root));\n    var graphContainer = document.createElement('div');\n\n    _this.container.appendChild(graphContainer);\n\n    _this.$viewport = _this.$('<div>').addClass(_this.prefixClassName(ClassName.viewport));\n\n    if (_this.options.scalable) {\n      _this.zoomHandle = _this.$('<div>').addClass(_this.prefixClassName(ClassName.zoom)).appendTo(_this.$viewport).get(0);\n    }\n\n    _this.$container.append(_this.$viewport).css({\n      width: _this.options.width,\n      height: _this.options.height,\n      padding: _this.options.padding\n    });\n\n    if (_this.options.container) {\n      _this.options.container.appendChild(_this.container);\n    }\n\n    _this.sourceGraph = _this.graph;\n    var targetGraphOptions = Object.assign(Object.assign({}, _this.options.graphOptions), {\n      container: graphContainer,\n      model: _this.sourceGraph.model,\n      frozen: true,\n      async: _this.sourceGraph.isAsync(),\n      interacting: false,\n      grid: false,\n      background: false,\n      rotating: false,\n      resizing: false,\n      embedding: false,\n      selecting: false,\n      snapline: false,\n      clipboard: false,\n      history: false,\n      scroller: false\n    });\n    _this.targetGraph = _this.options.createGraph ? _this.options.createGraph(targetGraphOptions) : new Graph(targetGraphOptions);\n\n    _this.targetGraph.renderer.unfreeze();\n\n    _this.updatePaper(_this.sourceGraph.options.width, _this.sourceGraph.options.height);\n\n    _this.startListening();\n\n    return _this;\n  }\n\n  _createClass(MiniMap, [{\n    key: \"graph\",\n    get: function get() {\n      return this.options.graph;\n    }\n  }, {\n    key: \"scroller\",\n    get: function get() {\n      return this.graph.scroller.widget;\n    }\n  }, {\n    key: \"graphContainer\",\n    get: function get() {\n      if (this.scroller) {\n        return this.scroller.container;\n      }\n\n      return this.graph.container;\n    }\n  }, {\n    key: \"$graphContainer\",\n    get: function get() {\n      if (this.scroller) {\n        return this.scroller.$container;\n      }\n\n      return this.$(this.graph.container);\n    }\n  }, {\n    key: \"startListening\",\n    value: function startListening() {\n      var _this$delegateEvents;\n\n      if (this.scroller) {\n        this.$graphContainer.on(\"scroll\".concat(this.getEventNamespace()), this.updateViewport);\n      } else {\n        this.sourceGraph.on('translate', this.updateViewport, this);\n      }\n\n      this.sourceGraph.on('resize', this.updatePaper, this);\n      this.delegateEvents((_this$delegateEvents = {\n        mousedown: 'startAction',\n        touchstart: 'startAction'\n      }, _defineProperty(_this$delegateEvents, \"mousedown .\".concat(this.prefixClassName('graph')), 'scrollTo'), _defineProperty(_this$delegateEvents, \"touchstart .\".concat(this.prefixClassName('graph')), 'scrollTo'), _this$delegateEvents));\n    }\n  }, {\n    key: \"stopListening\",\n    value: function stopListening() {\n      if (this.scroller) {\n        this.$graphContainer.off(this.getEventNamespace());\n      } else {\n        this.sourceGraph.off('translate', this.updateViewport, this);\n      }\n\n      this.sourceGraph.off('resize', this.updatePaper, this);\n      this.undelegateEvents();\n    }\n  }, {\n    key: \"onRemove\",\n    value: function onRemove() {\n      this.targetGraph.view.remove();\n      this.stopListening();\n      this.targetGraph.dispose();\n    }\n  }, {\n    key: \"updatePaper\",\n    value: function updatePaper(w, h) {\n      var width;\n      var height;\n\n      if (typeof w === 'object') {\n        width = w.width;\n        height = w.height;\n      } else {\n        width = w;\n        height = h;\n      }\n\n      var origin = this.sourceGraph.options;\n      var scale = this.sourceGraph.transform.getScale();\n      var maxWidth = this.options.width - 2 * this.options.padding;\n      var maxHeight = this.options.height - 2 * this.options.padding;\n      width /= scale.sx; // eslint-disable-line\n\n      height /= scale.sy; // eslint-disable-line\n\n      this.ratio = Math.min(maxWidth / width, maxHeight / height);\n      var ratio = this.ratio;\n      var x = origin.x * ratio / scale.sx;\n      var y = origin.y * ratio / scale.sy;\n      width *= ratio; // eslint-disable-line\n\n      height *= ratio; // eslint-disable-line\n\n      this.targetGraph.resizeGraph(width, height);\n      this.targetGraph.translate(x, y);\n      this.targetGraph.scale(ratio, ratio);\n      this.updateViewport();\n      return this;\n    }\n  }, {\n    key: \"updateViewport\",\n    value: function updateViewport() {\n      var ratio = this.ratio;\n      var scale = this.sourceGraph.transform.getScale();\n      var origin = null;\n\n      if (this.scroller) {\n        origin = this.scroller.clientToLocalPoint(0, 0);\n      } else {\n        var ctm = this.sourceGraph.matrix();\n        origin = new Point(-ctm.e / ctm.a, -ctm.f / ctm.d);\n      }\n\n      var position = this.$(this.targetGraph.container).position();\n      var translation = this.targetGraph.translate();\n      translation.ty = translation.ty || 0;\n      this.geometry = {\n        top: position.top + origin.y * ratio + translation.ty,\n        left: position.left + origin.x * ratio + translation.tx,\n        width: this.$graphContainer.innerWidth() * ratio / scale.sx,\n        height: this.$graphContainer.innerHeight() * ratio / scale.sy\n      };\n      this.$viewport.css(this.geometry);\n    }\n  }, {\n    key: \"startAction\",\n    value: function startAction(evt) {\n      var e = this.normalizeEvent(evt);\n      var action = e.target === this.zoomHandle ? 'zooming' : 'panning';\n\n      var _this$sourceGraph$tra = this.sourceGraph.translate(),\n          tx = _this$sourceGraph$tra.tx,\n          ty = _this$sourceGraph$tra.ty;\n\n      var eventData = {\n        action: action,\n        clientX: e.clientX,\n        clientY: e.clientY,\n        scrollLeft: this.graphContainer.scrollLeft,\n        scrollTop: this.graphContainer.scrollTop,\n        zoom: this.sourceGraph.zoom(),\n        scale: this.sourceGraph.transform.getScale(),\n        geometry: this.geometry,\n        translateX: tx,\n        translateY: ty\n      };\n      this.delegateDocumentEvents(Util.documentEvents, eventData);\n    }\n  }, {\n    key: \"doAction\",\n    value: function doAction(evt) {\n      var _this2 = this;\n\n      var e = this.normalizeEvent(evt);\n      var clientX = e.clientX;\n      var clientY = e.clientY;\n      var data = e.data;\n\n      switch (data.action) {\n        case 'panning':\n          {\n            var scale = this.sourceGraph.transform.getScale();\n            var rx = (clientX - data.clientX) * scale.sx;\n            var ry = (clientY - data.clientY) * scale.sy;\n\n            if (this.scroller) {\n              this.graphContainer.scrollLeft = data.scrollLeft + rx / this.ratio;\n              this.graphContainer.scrollTop = data.scrollTop + ry / this.ratio;\n            } else {\n              this.sourceGraph.translate(data.translateX - rx / this.ratio, data.translateY - ry / this.ratio);\n            }\n\n            break;\n          }\n\n        case 'zooming':\n          {\n            var startScale = data.scale;\n            var startGeometry = data.geometry;\n            var delta = 1 + (data.clientX - clientX) / startGeometry.width / startScale.sx;\n\n            if (data.frameId) {\n              cancelAnimationFrame(data.frameId);\n            }\n\n            data.frameId = requestAnimationFrame(function () {\n              _this2.sourceGraph.zoom(delta * data.zoom, {\n                absolute: true,\n                minScale: _this2.options.minScale,\n                maxScale: _this2.options.maxScale\n              });\n            });\n            break;\n          }\n\n        default:\n          break;\n      }\n    }\n  }, {\n    key: \"stopAction\",\n    value: function stopAction() {\n      this.undelegateDocumentEvents();\n    }\n  }, {\n    key: \"scrollTo\",\n    value: function scrollTo(evt) {\n      var e = this.normalizeEvent(evt);\n      var x;\n      var y;\n      var ts = this.targetGraph.translate();\n      ts.ty = ts.ty || 0;\n\n      if (e.offsetX == null) {\n        var offset = this.$(this.targetGraph.container).offset();\n        x = e.pageX - offset.left;\n        y = e.pageY - offset.top;\n      } else {\n        x = e.offsetX;\n        y = e.offsetY;\n      }\n\n      var cx = (x - ts.tx) / this.ratio;\n      var cy = (y - ts.ty) / this.ratio;\n      this.sourceGraph.centerPoint(cx, cy);\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.remove();\n    }\n  }]);\n\n  return MiniMap;\n}(View);\n\n__decorate([View.dispose()], MiniMap.prototype, \"dispose\", null);\n\nvar Util;\n\n(function (Util) {\n  Util.defaultOptions = {\n    width: 300,\n    height: 200,\n    padding: 10,\n    scalable: true,\n    minScale: 0.01,\n    maxScale: 16,\n    graphOptions: {},\n    createGraph: function createGraph(options) {\n      return new Graph(options);\n    }\n  };\n  Util.documentEvents = {\n    mousemove: 'doAction',\n    touchmove: 'doAction',\n    mouseup: 'stopAction',\n    touchend: 'stopAction'\n  };\n})(Util || (Util = {}));","map":{"version":3,"sources":["../../../src/addon/minimap/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { FunctionExt } from '../../util';\nimport { View } from '../../view/view';\nimport { Graph } from '../../graph/graph';\nimport { Point } from '../../geometry';\nvar ClassName;\n(function (ClassName) {\n    ClassName.root = 'widget-minimap';\n    ClassName.viewport = `${ClassName.root}-viewport`;\n    ClassName.zoom = `${ClassName.viewport}-zoom`;\n})(ClassName || (ClassName = {}));\nexport class MiniMap extends View {\n    constructor(options) {\n        super();\n        this.options = Object.assign(Object.assign({}, Util.defaultOptions), options);\n        this.updateViewport = FunctionExt.debounce(this.updateViewport.bind(this), 0);\n        this.container = document.createElement('div');\n        this.$container = this.$(this.container).addClass(this.prefixClassName(ClassName.root));\n        const graphContainer = document.createElement('div');\n        this.container.appendChild(graphContainer);\n        this.$viewport = this.$('<div>').addClass(this.prefixClassName(ClassName.viewport));\n        if (this.options.scalable) {\n            this.zoomHandle = this.$('<div>')\n                .addClass(this.prefixClassName(ClassName.zoom))\n                .appendTo(this.$viewport)\n                .get(0);\n        }\n        this.$container.append(this.$viewport).css({\n            width: this.options.width,\n            height: this.options.height,\n            padding: this.options.padding,\n        });\n        if (this.options.container) {\n            this.options.container.appendChild(this.container);\n        }\n        this.sourceGraph = this.graph;\n        const targetGraphOptions = Object.assign(Object.assign({}, this.options.graphOptions), { container: graphContainer, model: this.sourceGraph.model, frozen: true, async: this.sourceGraph.isAsync(), interacting: false, grid: false, background: false, rotating: false, resizing: false, embedding: false, selecting: false, snapline: false, clipboard: false, history: false, scroller: false });\n        this.targetGraph = this.options.createGraph\n            ? this.options.createGraph(targetGraphOptions)\n            : new Graph(targetGraphOptions);\n        this.targetGraph.renderer.unfreeze();\n        this.updatePaper(this.sourceGraph.options.width, this.sourceGraph.options.height);\n        this.startListening();\n    }\n    get graph() {\n        return this.options.graph;\n    }\n    get scroller() {\n        return this.graph.scroller.widget;\n    }\n    get graphContainer() {\n        if (this.scroller) {\n            return this.scroller.container;\n        }\n        return this.graph.container;\n    }\n    get $graphContainer() {\n        if (this.scroller) {\n            return this.scroller.$container;\n        }\n        return this.$(this.graph.container);\n    }\n    startListening() {\n        if (this.scroller) {\n            this.$graphContainer.on(`scroll${this.getEventNamespace()}`, this.updateViewport);\n        }\n        else {\n            this.sourceGraph.on('translate', this.updateViewport, this);\n        }\n        this.sourceGraph.on('resize', this.updatePaper, this);\n        this.delegateEvents({\n            mousedown: 'startAction',\n            touchstart: 'startAction',\n            [`mousedown .${this.prefixClassName('graph')}`]: 'scrollTo',\n            [`touchstart .${this.prefixClassName('graph')}`]: 'scrollTo',\n        });\n    }\n    stopListening() {\n        if (this.scroller) {\n            this.$graphContainer.off(this.getEventNamespace());\n        }\n        else {\n            this.sourceGraph.off('translate', this.updateViewport, this);\n        }\n        this.sourceGraph.off('resize', this.updatePaper, this);\n        this.undelegateEvents();\n    }\n    onRemove() {\n        this.targetGraph.view.remove();\n        this.stopListening();\n        this.targetGraph.dispose();\n    }\n    updatePaper(w, h) {\n        let width;\n        let height;\n        if (typeof w === 'object') {\n            width = w.width;\n            height = w.height;\n        }\n        else {\n            width = w;\n            height = h;\n        }\n        const origin = this.sourceGraph.options;\n        const scale = this.sourceGraph.transform.getScale();\n        const maxWidth = this.options.width - 2 * this.options.padding;\n        const maxHeight = this.options.height - 2 * this.options.padding;\n        width /= scale.sx; // eslint-disable-line\n        height /= scale.sy; // eslint-disable-line\n        this.ratio = Math.min(maxWidth / width, maxHeight / height);\n        const ratio = this.ratio;\n        const x = (origin.x * ratio) / scale.sx;\n        const y = (origin.y * ratio) / scale.sy;\n        width *= ratio; // eslint-disable-line\n        height *= ratio; // eslint-disable-line\n        this.targetGraph.resizeGraph(width, height);\n        this.targetGraph.translate(x, y);\n        this.targetGraph.scale(ratio, ratio);\n        this.updateViewport();\n        return this;\n    }\n    updateViewport() {\n        const ratio = this.ratio;\n        const scale = this.sourceGraph.transform.getScale();\n        let origin = null;\n        if (this.scroller) {\n            origin = this.scroller.clientToLocalPoint(0, 0);\n        }\n        else {\n            const ctm = this.sourceGraph.matrix();\n            origin = new Point(-ctm.e / ctm.a, -ctm.f / ctm.d);\n        }\n        const position = this.$(this.targetGraph.container).position();\n        const translation = this.targetGraph.translate();\n        translation.ty = translation.ty || 0;\n        this.geometry = {\n            top: position.top + origin.y * ratio + translation.ty,\n            left: position.left + origin.x * ratio + translation.tx,\n            width: (this.$graphContainer.innerWidth() * ratio) / scale.sx,\n            height: (this.$graphContainer.innerHeight() * ratio) / scale.sy,\n        };\n        this.$viewport.css(this.geometry);\n    }\n    startAction(evt) {\n        const e = this.normalizeEvent(evt);\n        const action = e.target === this.zoomHandle ? 'zooming' : 'panning';\n        const { tx, ty } = this.sourceGraph.translate();\n        const eventData = {\n            action,\n            clientX: e.clientX,\n            clientY: e.clientY,\n            scrollLeft: this.graphContainer.scrollLeft,\n            scrollTop: this.graphContainer.scrollTop,\n            zoom: this.sourceGraph.zoom(),\n            scale: this.sourceGraph.transform.getScale(),\n            geometry: this.geometry,\n            translateX: tx,\n            translateY: ty,\n        };\n        this.delegateDocumentEvents(Util.documentEvents, eventData);\n    }\n    doAction(evt) {\n        const e = this.normalizeEvent(evt);\n        const clientX = e.clientX;\n        const clientY = e.clientY;\n        const data = e.data;\n        switch (data.action) {\n            case 'panning': {\n                const scale = this.sourceGraph.transform.getScale();\n                const rx = (clientX - data.clientX) * scale.sx;\n                const ry = (clientY - data.clientY) * scale.sy;\n                if (this.scroller) {\n                    this.graphContainer.scrollLeft = data.scrollLeft + rx / this.ratio;\n                    this.graphContainer.scrollTop = data.scrollTop + ry / this.ratio;\n                }\n                else {\n                    this.sourceGraph.translate(data.translateX - rx / this.ratio, data.translateY - ry / this.ratio);\n                }\n                break;\n            }\n            case 'zooming': {\n                const startScale = data.scale;\n                const startGeometry = data.geometry;\n                const delta = 1 + (data.clientX - clientX) / startGeometry.width / startScale.sx;\n                if (data.frameId) {\n                    cancelAnimationFrame(data.frameId);\n                }\n                data.frameId = requestAnimationFrame(() => {\n                    this.sourceGraph.zoom(delta * data.zoom, {\n                        absolute: true,\n                        minScale: this.options.minScale,\n                        maxScale: this.options.maxScale,\n                    });\n                });\n                break;\n            }\n            default:\n                break;\n        }\n    }\n    stopAction() {\n        this.undelegateDocumentEvents();\n    }\n    scrollTo(evt) {\n        const e = this.normalizeEvent(evt);\n        let x;\n        let y;\n        const ts = this.targetGraph.translate();\n        ts.ty = ts.ty || 0;\n        if (e.offsetX == null) {\n            const offset = this.$(this.targetGraph.container).offset();\n            x = e.pageX - offset.left;\n            y = e.pageY - offset.top;\n        }\n        else {\n            x = e.offsetX;\n            y = e.offsetY;\n        }\n        const cx = (x - ts.tx) / this.ratio;\n        const cy = (y - ts.ty) / this.ratio;\n        this.sourceGraph.centerPoint(cx, cy);\n    }\n    dispose() {\n        this.remove();\n    }\n}\n__decorate([\n    View.dispose()\n], MiniMap.prototype, \"dispose\", null);\nvar Util;\n(function (Util) {\n    Util.defaultOptions = {\n        width: 300,\n        height: 200,\n        padding: 10,\n        scalable: true,\n        minScale: 0.01,\n        maxScale: 16,\n        graphOptions: {},\n        createGraph: (options) => new Graph(options),\n    };\n    Util.documentEvents = {\n        mousemove: 'doAction',\n        touchmove: 'doAction',\n        mouseup: 'stopAction',\n        touchend: 'stopAction',\n    };\n})(Util || (Util = {}));\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"module"}