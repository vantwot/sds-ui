{"ast":null,"code":"import React from 'react';\n/** AppContext */\n\nexport const XFlowAppContext = React.createContext(null);\nXFlowAppContext.displayName = 'XFlowAppContext';\n/** AppContext:获取 app */\n\nexport const useXFlowApp = () => {\n  const container = React.useContext(XFlowAppContext);\n  return container && container.getApp ? container.getApp() : null;\n};\n/** AppContext: 获取 appContainer */\n\nexport const useXFlowAppContainer = () => {\n  return React.useContext(XFlowAppContext);\n};\n\nclass AppContainer {\n  constructor() {\n    let isUserDefined = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    this.cache = null;\n\n    this.setApp = app => {\n      this.cache = app;\n\n      if (this.onAppChangeCallback) {\n        this.onAppChangeCallback(app);\n      }\n    };\n\n    this.isUserDefined = () => this.isUserDefinedFlag;\n\n    this.getApp = () => {\n      return this.cache;\n    };\n\n    this.onAppChange = cb => {\n      this.onAppChangeCallback = cb;\n    };\n\n    this.dispose = () => {\n      this.cache = null;\n    };\n\n    this.isUserDefinedFlag = isUserDefined;\n  }\n\n}\n/** XFlow内部使用 */\n\n\nexport const XFlowAppInternalProvider = props => {\n  const userDefinedAppContainer = useXFlowAppContainer();\n  const [, setTick] = React.useState(null);\n  const appContainer = React.useMemo(() => {\n    return userDefinedAppContainer && userDefinedAppContainer.isUserDefined() ? userDefinedAppContainer : new AppContainer(false); // 不要移除：保证config只生成一次\n    // eslint-disable-next-line\n  }, []); // set appChange callback\n\n  if (!appContainer.isUserDefined()) {\n    appContainer.onAppChange(() => setTick(0));\n  }\n\n  React.useEffect(() => {\n    if (props.app) {\n      appContainer.setApp(props.app);\n    } // 不要移除：只关心 props.app\n    // eslint-disable-next-line\n\n  }, [props.app]);\n\n  if (appContainer.isUserDefined()) {\n    return React.createElement(React.Fragment, null, props.children);\n  }\n\n  return React.createElement(XFlowAppContext.Provider, {\n    value: Object.assign({}, appContainer)\n  }, props.children);\n};\nXFlowAppInternalProvider.displayName = 'XFlowAppInternalProvider';\n/** XFlow外部使用 */\n\nexport const XFlowAppProvider = _ref => {\n  let {\n    children\n  } = _ref;\n  const [, setTick] = React.useState(null);\n  const appContainer = React.useMemo(() => {\n    return new AppContainer(true);\n  }, []); // add callback\n\n  appContainer.onAppChange(() => setTick(0));\n  return React.createElement(XFlowAppContext.Provider, {\n    value: Object.assign({}, appContainer)\n  }, children);\n};\nXFlowAppProvider.displayName = 'XFlowAppProvider';","map":{"version":3,"sources":["../../../src/xflow-main/components/app-context.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import React from 'react';\n/** AppContext */\nexport const XFlowAppContext = React.createContext(null);\nXFlowAppContext.displayName = 'XFlowAppContext';\n/** AppContext:获取 app */\nexport const useXFlowApp = () => {\n    const container = React.useContext(XFlowAppContext);\n    return container && container.getApp ? container.getApp() : null;\n};\n/** AppContext: 获取 appContainer */\nexport const useXFlowAppContainer = () => {\n    return React.useContext(XFlowAppContext);\n};\nclass AppContainer {\n    constructor(isUserDefined = false) {\n        this.cache = null;\n        this.setApp = (app) => {\n            this.cache = app;\n            if (this.onAppChangeCallback) {\n                this.onAppChangeCallback(app);\n            }\n        };\n        this.isUserDefined = () => this.isUserDefinedFlag;\n        this.getApp = () => {\n            return this.cache;\n        };\n        this.onAppChange = cb => {\n            this.onAppChangeCallback = cb;\n        };\n        this.dispose = () => {\n            this.cache = null;\n        };\n        this.isUserDefinedFlag = isUserDefined;\n    }\n}\n/** XFlow内部使用 */\nexport const XFlowAppInternalProvider = props => {\n    const userDefinedAppContainer = useXFlowAppContainer();\n    const [, setTick] = React.useState(null);\n    const appContainer = React.useMemo(() => {\n        return userDefinedAppContainer && userDefinedAppContainer.isUserDefined()\n            ? userDefinedAppContainer\n            : new AppContainer(false);\n        // 不要移除：保证config只生成一次\n        // eslint-disable-next-line\n    }, []);\n    // set appChange callback\n    if (!appContainer.isUserDefined()) {\n        appContainer.onAppChange(() => setTick(0));\n    }\n    React.useEffect(() => {\n        if (props.app) {\n            appContainer.setApp(props.app);\n        }\n        // 不要移除：只关心 props.app\n        // eslint-disable-next-line\n    }, [props.app]);\n    if (appContainer.isUserDefined()) {\n        return React.createElement(React.Fragment, null, props.children);\n    }\n    return (React.createElement(XFlowAppContext.Provider, { value: Object.assign({}, appContainer) }, props.children));\n};\nXFlowAppInternalProvider.displayName = 'XFlowAppInternalProvider';\n/** XFlow外部使用 */\nexport const XFlowAppProvider = ({ children }) => {\n    const [, setTick] = React.useState(null);\n    const appContainer = React.useMemo(() => {\n        return new AppContainer(true);\n    }, []);\n    // add callback\n    appContainer.onAppChange(() => setTick(0));\n    return React.createElement(XFlowAppContext.Provider, { value: Object.assign({}, appContainer) }, children);\n};\nXFlowAppProvider.displayName = 'XFlowAppProvider';\n//# sourceMappingURL=app-context.js.map"]},"metadata":{},"sourceType":"module"}